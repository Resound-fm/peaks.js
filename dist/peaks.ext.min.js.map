{"version":3,"file":"peaks.ext.min.js","sources":["../node_modules/eventemitter3/index.js","../src/cue.js","../src/utils.js","../src/cue-emitter.js","../src/point.js","../src/waveform-points.js","../src/segment.js","../src/waveform-segments.js","../src/keyboard-handler.js","../src/mediaelement-player.js","../src/player.js","../src/default-point-marker.js","../src/default-segment-marker.js","../src/marker-factories.js","../src/scrollbar.js","../src/highlight-layer.js","../src/mouse-drag-handler.js","../src/playhead-layer.js","../src/point-marker.js","../src/points-layer.js","../src/overlay-segment-marker.js","../src/segment-marker.js","../src/waveform-shape.js","../src/segment-shape.js","../src/segments-layer.js","../src/waveform-axis.js","../src/waveform-overview.js","../src/waveform-zoomview.js","../src/view-controller.js","../src/zoom-controller.js","../src/waveform-builder.js","../src/main.js"],"sourcesContent":["'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","/**\n * @file\n *\n * Defines the {@link Cue} class.\n *\n * @module cue\n */\n\n/**\n * A cue represents an event to be triggered at some point on the media\n * timeline.\n *\n * @class\n * @alias Cue\n *\n * @param {Number} time Cue time, in seconds.\n * @param {Number} type Cue mark type, either <code>Cue.POINT</code>,\n *   <code>Cue.SEGMENT_START</code>, or <code>Cue.SEGMENT_END</code>.\n * @param {String} id The id of the {@link Point} or {@link Segment}.\n */\n\nfunction Cue(time, type, id) {\n  this.time = time;\n  this.type = type;\n  this.id = id;\n}\n\n/**\n  * @constant\n  * @type {Number}\n  */\n\nCue.POINT = 0;\nCue.SEGMENT_START = 1;\nCue.SEGMENT_END = 2;\n\n/**\n * Callback function for use with Array.prototype.sort().\n *\n * @static\n * @param {Cue} a\n * @param {Cue} b\n * @return {Number}\n */\n\nCue.sorter = function(a, b) {\n  return a.time - b.time;\n};\n\nexport default Cue;\n","import Konva from 'konva/lib/Core';\n\nfunction zeroPad(number, precision) {\n  number = number.toString();\n\n  while (number.length < precision) {\n    number = '0' + number;\n  }\n\n  return number;\n}\n\n/**\n * Returns a formatted time string.\n *\n * @param {Number} time The time to be formatted, in seconds.\n * @param {Number} precision Decimal places to which time is displayed\n * @returns {String}\n */\n\nexport function formatTime(time, precision) {\n  let result = [];\n\n  const fractionSeconds = Math.floor((time % 1) * Math.pow(10, precision));\n  const seconds = Math.floor(time);\n  const minutes = Math.floor(seconds / 60);\n  const hours = Math.floor(minutes / 60);\n\n  if (hours > 0) {\n    result.push(hours); // Hours\n  }\n  result.push(minutes % 60); // Mins\n  result.push(seconds % 60); // Seconds\n\n  for (let i = 0; i < result.length; i++) {\n    result[i] = zeroPad(result[i], 2);\n  }\n\n  result = result.join(':');\n\n  if (precision > 0) {\n    result += '.' + zeroPad(fractionSeconds, precision);\n  }\n\n  return result;\n}\n\n/**\n * Rounds the given value up to the nearest given multiple.\n *\n * @param {Number} value\n * @param {Number} multiple\n * @returns {Number}\n *\n * @example\n * roundUpToNearest(5.5, 3); // returns 6\n * roundUpToNearest(141.0, 10); // returns 150\n * roundUpToNearest(-5.5, 3); // returns -6\n */\n\nexport function roundUpToNearest(value, multiple) {\n  if (multiple === 0) {\n    return 0;\n  }\n\n  let multiplier = 1;\n\n  if (value < 0.0) {\n    multiplier = -1;\n    value = -value;\n  }\n\n  const roundedUp = Math.ceil(value);\n\n  return multiplier * (((roundedUp + multiple - 1) / multiple) | 0) * multiple;\n}\n\nexport function clamp(value, min, max) {\n  if (value < min) {\n    return min;\n  }\n  else if (value > max) {\n    return max;\n  }\n  else {\n    return value;\n  }\n}\n\nexport function objectHasProperty(object, field) {\n  return Object.prototype.hasOwnProperty.call(object, field);\n}\n\nexport function extend(to, from) {\n  for (const key in from) {\n    if (objectHasProperty(from, key)) {\n      to[key] = from[key];\n    }\n  }\n\n  return to;\n}\n\n/**\n * Checks whether the given array contains values in ascending order.\n *\n * @param {Array<Number>} array The array to test\n * @returns {Boolean}\n */\n\nexport function isInAscendingOrder(array) {\n  if (array.length === 0) {\n    return true;\n  }\n\n  let value = array[0];\n\n  for (let i = 1; i < array.length; i++) {\n    if (value >= array[i]) {\n      return false;\n    }\n\n    value = array[i];\n  }\n\n  return true;\n}\n\n/**\n * Checks whether the given value is a number.\n *\n * @param {Number} value The value to test\n * @returns {Boolean}\n */\n\nexport function isNumber(value) {\n  return typeof value === 'number';\n}\n\n/**\n * Checks whether the given value is a finite number.\n *\n * @param {Number} value The value to test\n * @returns {Boolean}\n */\n\nexport function isFinite(value) {\n  if (typeof value !== 'number') {\n    return false;\n  }\n\n  // Check for NaN and infinity\n  // eslint-disable-next-line no-self-compare\n  if (value !== value || value === Infinity || value === -Infinity) {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Checks whether the given value is a valid timestamp.\n *\n * @param {Number} value The value to test\n * @returns {Boolean}\n */\n\nexport function isValidTime(value) {\n  return (typeof value === 'number') && Number.isFinite(value);\n}\n\n/**\n * Checks whether the given value is a valid object.\n *\n * @param {Object|Array} value The value to test\n * @returns {Boolean}\n */\n\nexport function isObject(value) {\n  return (value !== null) && (typeof value === 'object')\n    && !Array.isArray(value);\n}\n\n/**\n * Checks whether the given value is a valid string.\n *\n * @param {String} value The value to test\n * @returns {Boolean}\n */\n\nexport function isString(value) {\n  return typeof value === 'string';\n}\n\n/**\n * Checks whether the given value is a valid ArrayBuffer.\n *\n * @param {ArrayBuffer} value The value to test\n * @returns {Boolean}\n */\n\nexport function isArrayBuffer(value) {\n  return Object.prototype.toString.call(value).includes('ArrayBuffer');\n}\n\n/**\n * Checks whether the given value is null or undefined.\n *\n * @param {Object} value The value to test\n * @returns {Boolean}\n */\n\nexport function isNullOrUndefined(value) {\n  return value === undefined || value === null;\n}\n\n/**\n * Checks whether the given value is a function.\n *\n * @param {Function} value The value to test\n * @returns {Boolean}\n */\n\nexport function isFunction(value) {\n  return typeof value === 'function';\n}\n\n/**\n * Checks whether the given value is a boolean.\n *\n * @param {Function} value The value to test\n * @returns {Boolean}\n */\n\nexport function isBoolean(value) {\n  return value === true || value === false;\n}\n\n/**\n * Checks whether the given value is a valid HTML element.\n *\n * @param {HTMLElement} value The value to test\n * @returns {Boolean}\n */\n\nexport function isHTMLElement(value) {\n  return value instanceof HTMLElement;\n}\n\n/**\n * Checks whether the given value is an array\n *\n * @param {Function} value The value to test\n * @returns {Boolean}\n */\n\nexport function isArray(value) {\n  return Array.isArray(value);\n}\n\n/**\n * Checks whether the given value is a valid linear gradient color\n *\n * @param {Function} value The value to test\n * @returns {Boolean}\n */\n\nexport function isLinearGradientColor(value) {\n  return isObject(value) &&\n    objectHasProperty(value, 'linearGradientStart') &&\n    objectHasProperty(value, 'linearGradientEnd') &&\n    objectHasProperty(value, 'linearGradientColorStops') &&\n    isNumber(value.linearGradientStart) &&\n    isNumber(value.linearGradientEnd) &&\n    isArray(value.linearGradientColorStops) &&\n    value.linearGradientColorStops.length === 2;\n}\n\nexport function getMarkerObject(obj) {\n  while (obj.parent !== null) {\n    if (obj.parent instanceof Konva.Layer) {\n      return obj;\n    }\n\n    obj = obj.parent;\n  }\n\n  return null;\n}\n","/**\n * @file\n *\n * Defines the {@link CueEmitter} class.\n *\n * @module cue-emitter\n */\n\nimport Cue from './cue';\nimport { objectHasProperty } from './utils';\n\nconst isHeadless = /HeadlessChrome/.test(navigator.userAgent);\n\nfunction windowIsVisible() {\n  if (isHeadless || navigator.webdriver) {\n    return false;\n  }\n\n  return (typeof document === 'object') &&\n    ('visibilityState' in document) &&\n    (document.visibilityState === 'visible');\n}\n\nconst requestAnimationFrame =\n  window.requestAnimationFrame ||\n  window.mozRequestAnimationFrame ||\n  window.webkitRequestAnimationFrame ||\n  window.msRequestAnimationFrame;\n\nconst cancelAnimationFrame =\n  window.cancelAnimationFrame ||\n  window.mozCancelAnimationFrame ||\n  window.webkitCancelAnimationFrame ||\n  window.msCancelAnimationFrame;\n\nconst eventTypes = {\n  forward: {},\n  reverse: {}\n};\n\nconst EVENT_TYPE_POINT = 0;\nconst EVENT_TYPE_SEGMENT_ENTER = 1;\nconst EVENT_TYPE_SEGMENT_EXIT = 2;\n\neventTypes.forward[Cue.POINT] = EVENT_TYPE_POINT;\neventTypes.forward[Cue.SEGMENT_START] = EVENT_TYPE_SEGMENT_ENTER;\neventTypes.forward[Cue.SEGMENT_END] = EVENT_TYPE_SEGMENT_EXIT;\n\neventTypes.reverse[Cue.POINT] = EVENT_TYPE_POINT;\neventTypes.reverse[Cue.SEGMENT_START] = EVENT_TYPE_SEGMENT_EXIT;\neventTypes.reverse[Cue.SEGMENT_END] = EVENT_TYPE_SEGMENT_ENTER;\n\nconst eventNames = {};\n\neventNames[EVENT_TYPE_POINT] = 'points.enter';\neventNames[EVENT_TYPE_SEGMENT_ENTER] = 'segments.enter';\neventNames[EVENT_TYPE_SEGMENT_EXIT] = 'segments.exit';\n\n/**\n * Given a cue instance, returns the corresponding {@link Point}\n * {@link Segment}.\n *\n * @param {Peaks} peaks\n * @param {Cue} cue\n * @return {Point|Segment}\n * @throws {Error}\n */\n\nfunction getPointOrSegment(peaks, cue) {\n  switch (cue.type) {\n    case Cue.POINT:\n      return peaks.points.getPoint(cue.id);\n\n    case Cue.SEGMENT_START:\n    case Cue.SEGMENT_END:\n      return peaks.segments.getSegment(cue.id);\n\n    default:\n      throw new Error('getPointOrSegment: id not found?');\n  }\n}\n\n/**\n * CueEmitter is responsible for emitting <code>points.enter</code>,\n * <code>segments.enter</code>, and <code>segments.exit</code> events.\n *\n * @class\n * @alias CueEmitter\n *\n * @param {Peaks} peaks Parent {@link Peaks} instance.\n */\n\nfunction CueEmitter(peaks) {\n  this._cues = [];\n  this._peaks = peaks;\n  this._previousTime = -1;\n  this._updateCues = this._updateCues.bind(this);\n  // Event handlers:\n  this._onPlaying = this.onPlaying.bind(this);\n  this._onSeeked = this.onSeeked.bind(this);\n  this._onTimeUpdate = this.onTimeUpdate.bind(this);\n  this._onAnimationFrame = this.onAnimationFrame.bind(this);\n  this._rAFHandle = null;\n  this._activeSegments = {};\n  this._attachEventHandlers();\n}\n\n/**\n * This function is bound to all {@link Peaks} events relating to mutated\n * [Points]{@link Point} or [Segments]{@link Segment}, and updates the\n * list of cues accordingly.\n *\n * @private\n */\n\nCueEmitter.prototype._updateCues = function() {\n  const self = this;\n\n  const points = self._peaks.points.getPoints();\n  const segments = self._peaks.segments.getSegments();\n\n  self._cues.length = 0;\n\n  points.forEach(function(point) {\n    self._cues.push(new Cue(point.time, Cue.POINT, point.id));\n  });\n\n  segments.forEach(function(segment) {\n    self._cues.push(new Cue(segment.startTime, Cue.SEGMENT_START, segment.id));\n    self._cues.push(new Cue(segment.endTime, Cue.SEGMENT_END, segment.id));\n  });\n\n  self._cues.sort(Cue.sorter);\n\n  const time = self._peaks.player.getCurrentTime();\n\n  self._updateActiveSegments(time);\n};\n\n/**\n * Emits events for any cues passed through during media playback.\n *\n * @param {Number} time The current time on the media timeline.\n * @param {Number} previousTime The previous time on the media timeline when\n *   this function was called.\n */\n\nCueEmitter.prototype._onUpdate = function(time, previousTime) {\n  const isForward = time > previousTime;\n  let start;\n  let end;\n  let step;\n\n  if (isForward) {\n    start = 0;\n    end = this._cues.length;\n    step = 1;\n  }\n  else {\n    start = this._cues.length - 1;\n    end = -1;\n    step = -1;\n  }\n\n  // Cues are sorted\n  for (let i = start; isForward ? i < end : i > end; i += step) {\n    const cue = this._cues[i];\n\n    if (isForward ? cue.time > previousTime : cue.time < previousTime) {\n      if (isForward ? cue.time > time : cue.time < time) {\n        break;\n      }\n\n      // Cue falls between time and previousTime\n\n      const marker = getPointOrSegment(this._peaks, cue);\n\n      const eventType = isForward ? eventTypes.forward[cue.type] :\n                                    eventTypes.reverse[cue.type];\n\n      if (eventType === EVENT_TYPE_SEGMENT_ENTER) {\n        this._activeSegments[marker.id] = marker;\n      }\n      else if (eventType === EVENT_TYPE_SEGMENT_EXIT) {\n        delete this._activeSegments[marker.id];\n      }\n\n      this._peaks.emit(eventNames[eventType], marker);\n    }\n  }\n};\n\n// the next handler and onAnimationFrame are bound together\n// when the window isn't in focus, rAF is throttled\n// falling back to timeUpdate\n\nCueEmitter.prototype.onTimeUpdate = function(time) {\n  if (windowIsVisible()) {\n    return;\n  }\n\n  if (this._peaks.player.isPlaying() && !this._peaks.player.isSeeking()) {\n    this._onUpdate(time, this._previousTime);\n  }\n\n  this._previousTime = time;\n};\n\nCueEmitter.prototype.onAnimationFrame = function() {\n  const time = this._peaks.player.getCurrentTime();\n\n  if (!this._peaks.player.isSeeking()) {\n    this._onUpdate(time, this._previousTime);\n  }\n\n  this._previousTime = time;\n\n  if (this._peaks.player.isPlaying()) {\n    this._rAFHandle = requestAnimationFrame(this._onAnimationFrame);\n  }\n};\n\nCueEmitter.prototype.onPlaying = function() {\n  this._previousTime = this._peaks.player.getCurrentTime();\n  this._rAFHandle = requestAnimationFrame(this._onAnimationFrame);\n};\n\nCueEmitter.prototype.onSeeked = function(time) {\n  this._previousTime = time;\n\n  this._updateActiveSegments(time);\n};\n\nfunction getSegmentIdComparator(id) {\n  return function compareSegmentIds(segment) {\n    return segment.id === id;\n  };\n}\n\n/**\n * The active segments is the set of all segments which overlap the current\n * playhead position. This function updates that set and emits\n * <code>segments.enter</code> and <code>segments.exit</code> events.\n */\n\nCueEmitter.prototype._updateActiveSegments = function(time) {\n  const self = this;\n\n  const activeSegments = self._peaks.segments.getSegmentsAtTime(time);\n\n  // Remove any segments no longer active.\n\n  for (const id in self._activeSegments) {\n    if (objectHasProperty(self._activeSegments, id)) {\n      const segment = activeSegments.find(getSegmentIdComparator(id));\n\n      if (!segment) {\n        self._peaks.emit('segments.exit', self._activeSegments[id]);\n        delete self._activeSegments[id];\n      }\n    }\n  }\n\n  // Add new active segments.\n\n  activeSegments.forEach(function(segment) {\n    if (!(segment.id in self._activeSegments)) {\n      self._activeSegments[segment.id] = segment;\n      self._peaks.emit('segments.enter', segment);\n    }\n  });\n};\n\nconst events = [\n  'points.update',\n  'points.dragmove',\n  'points.add',\n  'points.remove',\n  'points.remove_all',\n  'segments.update',\n  'segments.dragged',\n  'segments.add',\n  'segments.remove',\n  'segments.remove_all'\n];\n\nCueEmitter.prototype._attachEventHandlers = function() {\n  this._peaks.on('player.timeupdate', this._onTimeUpdate);\n  this._peaks.on('player.playing', this._onPlaying);\n  this._peaks.on('player.seeked', this._onSeeked);\n\n  for (let i = 0; i < events.length; i++) {\n    this._peaks.on(events[i], this._updateCues);\n  }\n\n  this._updateCues();\n};\n\nCueEmitter.prototype._detachEventHandlers = function() {\n  this._peaks.off('player.timeupdate', this._onTimeUpdate);\n  this._peaks.off('player.playing', this._onPlaying);\n  this._peaks.off('player.seeked', this._onSeeked);\n\n  for (let i = 0; i < events.length; i++) {\n    this._peaks.off(events[i], this._updateCues);\n  }\n};\n\nCueEmitter.prototype.destroy = function() {\n  if (this._rAFHandle) {\n    cancelAnimationFrame(this._rAFHandle);\n    this._rAFHandle = null;\n  }\n\n  this._detachEventHandlers();\n\n  this._previousTime = -1;\n};\n\nexport default CueEmitter;\n","/**\n * @file\n *\n * Defines the {@link Point} class.\n *\n * @module point\n */\n\nimport {\n  isBoolean, isLinearGradientColor, isNullOrUndefined, isString,\n  isValidTime, objectHasProperty\n} from './utils';\n\nconst pointOptions = ['id', 'time', 'labelText', 'color', 'editable'];\n\nconst invalidOptions = [\n  'update', 'isVisible', 'peaks'\n];\n\nfunction setDefaultPointOptions(options) {\n  if (isNullOrUndefined(options.labelText)) {\n    options.labelText = '';\n  }\n\n  if (isNullOrUndefined(options.editable)) {\n    options.editable = false;\n  }\n}\n\nfunction validatePointOptions(options, updating) {\n  const context = updating ? 'update()' : 'add()';\n\n  if (!updating || (updating && objectHasProperty(options, 'time'))) {\n    if (!isValidTime(options.time)) {\n      // eslint-disable-next-line max-len\n      throw new TypeError('peaks.points.' + context + ': time should be a numeric value');\n    }\n  }\n\n  if (options.time < 0) {\n    // eslint-disable-next-line max-len\n    throw new RangeError('peaks.points.' + context + ': time should not be negative');\n  }\n\n  if (objectHasProperty(options, 'labelText') && !isString(options.labelText)) {\n    throw new TypeError('peaks.points.' + context + ': labelText must be a string');\n  }\n\n  if (objectHasProperty(options, 'editable') && !isBoolean(options.editable)) {\n    throw new TypeError('peaks.points.' + context + ': editable must be true or false');\n  }\n\n  if (objectHasProperty(options, 'color') &&\n    !isString(options.color) &&\n    !isLinearGradientColor(options.color)) {\n    // eslint-disable-next-line max-len\n    throw new TypeError('peaks.points.' + context + ': color must be a string or a valid linear gradient object');\n  }\n\n  invalidOptions.forEach(function(name) {\n    if (objectHasProperty(options, name)) {\n      throw new Error('peaks.points.' + context + ': invalid option name: ' + name);\n    }\n  });\n\n  pointOptions.forEach(function(name) {\n    if (objectHasProperty(options, '_' + name)) {\n      throw new Error('peaks.points.' + context + ': invalid option name: _' + name);\n    }\n  });\n}\n\n/**\n * A point is a single instant of time, with associated label and color.\n *\n * @class\n * @alias Point\n *\n * @param {Peaks} peaks A reference to the Peaks instance.\n * @param {String} id A unique identifier for the point.\n * @param {Number} time Point time, in seconds.\n * @param {String} labelText Point label text.\n * @param {String} color Point marker color.\n * @param {Boolean} editable If <code>true</code> the segment start and\n *   end times can be adjusted via the user interface.\n * @param {*} data Optional application specific data.\n */\n\nfunction Point(options) {\n  this._peaks = options.peaks;\n  this._setUserData(options);\n}\n\nPoint.prototype._setUserData = function(options) {\n  for (const key in options) {\n    if (objectHasProperty(options, key)) {\n      if (pointOptions.indexOf(key) === -1) {\n        this[key] = options[key];\n      }\n      else {\n        this['_' + key] = options[key];\n      }\n    }\n  }\n};\n\nObject.defineProperties(Point.prototype, {\n  id: {\n    enumerable: true,\n    get: function() {\n      return this._id;\n    }\n  },\n  time: {\n    enumerable: true,\n    get: function() {\n      return this._time;\n    }\n  },\n  labelText: {\n    get: function() {\n      return this._labelText;\n    }\n  },\n  color: {\n    enumerable: true,\n    get: function() {\n      return this._color;\n    }\n  },\n  editable: {\n    enumerable: true,\n    get: function() {\n      return this._editable;\n    }\n  }\n});\n\nPoint.prototype.update = function(options) {\n  if (objectHasProperty(options, 'id')) {\n    throw new Error('peaks.points.update(): id cannot be updated');\n  }\n\n  validatePointOptions(options, true);\n\n  this._setUserData(options);\n\n  this._peaks.emit('points.update', this, options);\n};\n\n/**\n * Returns <code>true</code> if the point lies with in a given time range.\n *\n * @param {Number} startTime The start of the time region, in seconds.\n * @param {Number} endTime The end of the time region, in seconds.\n * @returns {Boolean}\n */\n\nPoint.prototype.isVisible = function(startTime, endTime) {\n  return this.time >= startTime && this.time < endTime;\n};\n\nPoint.prototype._setTime = function(time) {\n  this._time = time;\n};\n\nexport { Point, setDefaultPointOptions, validatePointOptions };\n","/**\n * @file\n *\n * Defines the {@link WaveformPoints} class.\n *\n * @module waveform-points\n */\n\nimport { Point, setDefaultPointOptions, validatePointOptions } from './point';\nimport { extend, isNullOrUndefined, objectHasProperty } from './utils';\n\n/**\n * Point parameters.\n *\n * @typedef {Object} PointOptions\n * @global\n * @property {Number} point Point time, in seconds.\n * @property {Boolean=} editable If <code>true</code> the point time can be\n *   adjusted via the user interface.\n *   Default: <code>false</code>.\n * @property {String=} color Point marker color.\n *   Default: a random color.\n * @property {String=} labelText Point label text.\n *   Default: an empty string.\n * @property {String=} id A unique point identifier.\n *   Default: an automatically generated identifier.\n */\n\n/**\n * Handles all functionality related to the adding, removing and manipulation\n * of points. A point is a single instant of time.\n *\n * @class\n * @alias WaveformPoints\n *\n * @param {Peaks} peaks The parent Peaks object.\n */\n\nfunction WaveformPoints(peaks) {\n  this._peaks = peaks;\n  this._points = [];\n  this._pointsById = {};\n  this._pointIdCounter = 0;\n}\n\n/**\n * Returns a new unique point id value.\n *\n * @returns {String}\n */\n\nWaveformPoints.prototype._getNextPointId = function() {\n  return 'peaks.point.' + this._pointIdCounter++;\n};\n\n/**\n * Adds a new point object.\n *\n * @private\n * @param {Point} point\n */\n\nWaveformPoints.prototype._addPoint = function(point) {\n  this._points.push(point);\n\n  this._pointsById[point.id] = point;\n};\n\n/**\n * Creates a new point object.\n *\n * @private\n * @param {PointOptions} options\n * @returns {Point}\n */\n\nWaveformPoints.prototype._createPoint = function(options) {\n  const pointOptions = {};\n\n  extend(pointOptions, options);\n\n  if (isNullOrUndefined(pointOptions.id)) {\n    pointOptions.id = this._getNextPointId();\n  }\n\n  setDefaultPointOptions(pointOptions);\n\n  validatePointOptions(pointOptions, false);\n\n  pointOptions.peaks = this._peaks;\n\n  return new Point(pointOptions);\n};\n\n/**\n * Returns all points.\n *\n * @returns {Array<Point>}\n */\n\nWaveformPoints.prototype.getPoints = function() {\n  return this._points;\n};\n\n/**\n * Returns the point with the given id, or <code>undefined</code> if not found.\n *\n * @param {String} id\n * @returns {Point}\n */\n\nWaveformPoints.prototype.getPoint = function(id) {\n  return this._pointsById[id];\n};\n\n/**\n * Returns all points within a given time region.\n *\n * @param {Number} startTime The start of the time region, in seconds.\n * @param {Number} endTime The end of the time region, in seconds.\n * @returns {Array<Point>}\n */\n\nWaveformPoints.prototype.find = function(startTime, endTime) {\n  return this._points.filter(function(point) {\n    return point.isVisible(startTime, endTime);\n  });\n};\n\n/**\n * Adds one or more points to the timeline.\n *\n * @param {PointOptions|Array<PointOptions>} pointOrPoints\n *\n * @returns Point|Array<Point>\n */\n\nWaveformPoints.prototype.add = function(/* pointOrPoints */) {\n  const self = this;\n\n  const arrayArgs = Array.isArray(arguments[0]);\n  let points = arrayArgs ?\n               arguments[0] :\n               Array.prototype.slice.call(arguments);\n\n  points = points.map(function(pointOptions) {\n    const point = self._createPoint(pointOptions);\n\n    if (objectHasProperty(self._pointsById, point.id)) {\n      throw new Error('peaks.points.add(): duplicate id');\n    }\n\n    return point;\n  });\n\n  points.forEach(function(point) {\n    self._addPoint(point);\n  });\n\n  this._peaks.emit('points.add', points);\n\n  return arrayArgs ? points : points[0];\n};\n\n/**\n * Returns the indexes of points that match the given predicate.\n *\n * @private\n * @param {Function} predicate Predicate function to find matching points.\n * @returns {Array<Number>} An array of indexes into the points array of\n *   the matching elements.\n */\n\nWaveformPoints.prototype._findPoint = function(predicate) {\n  const indexes = [];\n\n  for (let i = 0, length = this._points.length; i < length; i++) {\n    if (predicate(this._points[i])) {\n      indexes.push(i);\n    }\n  }\n\n  return indexes;\n};\n\n/**\n * Removes the points at the given array indexes.\n *\n * @private\n * @param {Array<Number>} indexes The array indexes to remove.\n * @returns {Array<Point>} The removed {@link Point} objects.\n */\n\nWaveformPoints.prototype._removeIndexes = function(indexes) {\n  const removed = [];\n\n  for (let i = 0; i < indexes.length; i++) {\n    const index = indexes[i] - removed.length;\n\n    const itemRemoved = this._points.splice(index, 1)[0];\n\n    delete this._pointsById[itemRemoved.id];\n\n    removed.push(itemRemoved);\n  }\n\n  return removed;\n};\n\n/**\n * Removes all points that match a given predicate function.\n *\n * After removing the points, this function emits a\n * <code>points.remove</code> event with the removed {@link Point}\n * objects.\n *\n * @private\n * @param {Function} predicate A predicate function that identifies which\n *   points to remove.\n * @returns {Array<Point>} The removed {@link Points} objects.\n */\n\nWaveformPoints.prototype._removePoints = function(predicate) {\n  const indexes = this._findPoint(predicate);\n\n  const removed = this._removeIndexes(indexes);\n\n  this._peaks.emit('points.remove', removed);\n\n  return removed;\n};\n\n/**\n * Removes the given point.\n *\n * @param {Point} point The point to remove.\n * @returns {Array<Point>} The removed points.\n */\n\nWaveformPoints.prototype.remove = function(point) {\n  return this._removePoints(function(p) {\n    return p === point;\n  });\n};\n\n/**\n * Removes any points with the given id.\n *\n * @param {String} id\n * @returns {Array<Point>} The removed {@link Point} objects.\n */\n\nWaveformPoints.prototype.removeById = function(pointId) {\n  return this._removePoints(function(point) {\n    return point.id === pointId;\n  });\n};\n\n/**\n * Removes any points at the given time.\n *\n * @param {Number} time\n * @returns {Array<Point>} The removed {@link Point} objects.\n */\n\nWaveformPoints.prototype.removeByTime = function(time) {\n  return this._removePoints(function(point) {\n    return point.time === time;\n  });\n};\n\n/**\n * Removes all points.\n *\n * After removing the points, this function emits a\n * <code>points.remove_all</code> event.\n */\n\nWaveformPoints.prototype.removeAll = function() {\n  this._points = [];\n  this._pointsById = {};\n  this._peaks.emit('points.remove_all');\n};\n\nexport default WaveformPoints;\n","/**\n * @file\n *\n * Defines the {@link Segment} class.\n *\n * @module segment\n */\n\nimport {\n  isBoolean, isNullOrUndefined, isLinearGradientColor,\n  isString, isValidTime, objectHasProperty\n} from './utils';\n\nconst segmentOptions = [\n  'id', 'startTime', 'endTime', 'labelText', 'color', 'borderColor', 'editable'\n];\n\nconst invalidOptions = [\n  'update', 'isVisible', 'peaks'\n];\n\nfunction setDefaultSegmentOptions(options, globalSegmentOptions) {\n  if (isNullOrUndefined(options.color)) {\n    if (globalSegmentOptions.overlay) {\n      options.color = globalSegmentOptions.overlayColor;\n    }\n    else {\n      options.color = globalSegmentOptions.waveformColor;\n    }\n  }\n\n  if (isNullOrUndefined(options.borderColor)) {\n    options.borderColor = globalSegmentOptions.overlayBorderColor;\n  }\n\n  if (isNullOrUndefined(options.labelText)) {\n    options.labelText = '';\n  }\n\n  if (isNullOrUndefined(options.editable)) {\n    options.editable = false;\n  }\n}\n\nfunction validateSegmentOptions(options, updating) {\n  const context = updating ? 'update()' : 'add()';\n\n  if (objectHasProperty(options, 'startTime') && !isValidTime(options.startTime)) {\n    // eslint-disable-next-line max-len\n    throw new TypeError('peaks.segments.' + context + ': startTime should be a valid number');\n  }\n\n  if (objectHasProperty(options, 'endTime') && !isValidTime(options.endTime)) {\n    // eslint-disable-next-line max-len\n    throw new TypeError('peaks.segments.' + context + ': endTime should be a valid number');\n  }\n\n  if (!updating) {\n    if (!objectHasProperty(options, 'startTime') || !objectHasProperty(options, 'endTime')) {\n      throw new TypeError('peaks.segments.' + context + ': missing startTime or endTime');\n    }\n  }\n\n  if (options.startTime < 0) {\n    // eslint-disable-next-line max-len\n    throw new RangeError('peaks.segments.' + context + ': startTime should not be negative');\n  }\n\n  if (options.endTime < 0) {\n    // eslint-disable-next-line max-len\n    throw new RangeError('peaks.segments.' + context + ': endTime should not be negative');\n  }\n\n  if (options.endTime < options.startTime) {\n    // eslint-disable-next-line max-len\n    throw new RangeError('peaks.segments.' + context + ': endTime should not be less than startTime');\n  }\n\n  if (objectHasProperty(options, 'labelText') && !isString(options.labelText)) {\n    throw new TypeError('peaks.segments.' + context + ': labelText must be a string');\n  }\n\n  if (objectHasProperty(options, 'editable') && !isBoolean(options.editable)) {\n    throw new TypeError('peaks.segments.' + context + ': editable must be true or false');\n  }\n\n  if (objectHasProperty(options, 'color') &&\n    !isString(options.color) &&\n    !isLinearGradientColor(options.color)) {\n    // eslint-disable-next-line max-len\n    throw new TypeError('peaks.segments.' + context + ': color must be a string or a valid linear gradient object');\n  }\n\n  if (objectHasProperty(options, 'borderColor') && !isString(options.borderColor)) {\n    // eslint-disable-next-line max-len\n    throw new TypeError('peaks.segments.' + context + ': borderColor must be a string');\n  }\n\n  invalidOptions.forEach(function(name) {\n    if (objectHasProperty(options, name)) {\n      throw new Error('peaks.segments.' + context + ': invalid option name: ' + name);\n    }\n  });\n\n  segmentOptions.forEach(function(name) {\n    if (objectHasProperty(options, '_' + name)) {\n      throw new Error('peaks.segments.' + context + ': invalid option name: _' + name);\n    }\n  });\n}\n\n/**\n * A segment is a region of time, with associated label and color.\n *\n * @class\n * @alias Segment\n *\n * @param {Peaks} peaks A reference to the Peaks instance.\n * @param {String} id A unique identifier for the segment.\n * @param {Number} startTime Segment start time, in seconds.\n * @param {Number} endTime Segment end time, in seconds.\n * @param {String} labelText Segment label text.\n * @param {String | LinearGradientColor} color Segment color.\n * @param {String} borderColor Segment border color.\n * @param {Boolean} editable If <code>true</code> the segment start and\n *   end times can be adjusted via the user interface.\n * @param {*} data Optional application specific data.\n */\n\nfunction Segment(options) {\n  this._peaks       = options.peaks;\n  this._id          = options.id;\n  this._startTime   = options.startTime;\n  this._endTime     = options.endTime;\n  this._labelText   = options.labelText;\n  this._color       = options.color;\n  this._borderColor = options.borderColor;\n  this._editable    = options.editable;\n\n  this._setUserData(options);\n}\n\nSegment.prototype._setUserData = function(options) {\n  for (const key in options) {\n    if (objectHasProperty(options, key)) {\n      if (segmentOptions.indexOf(key) === -1) {\n        this[key] = options[key];\n      }\n      else {\n        this['_' + key] = options[key];\n      }\n    }\n  }\n};\n\nObject.defineProperties(Segment.prototype, {\n  id: {\n    enumerable: true,\n    get: function() {\n      return this._id;\n    }\n  },\n  startTime: {\n    enumerable: true,\n    get: function() {\n      return this._startTime;\n    }\n  },\n  endTime: {\n    enumerable: true,\n    get: function() {\n      return this._endTime;\n    }\n  },\n  labelText: {\n    enumerable: true,\n    get: function() {\n      return this._labelText;\n    }\n  },\n  color: {\n    enumerable: true,\n    get: function() {\n      return this._color;\n    }\n  },\n  borderColor: {\n    enumerable: true,\n    get: function() {\n      return this._borderColor;\n    }\n  },\n  editable: {\n    enumerable: true,\n    get: function() {\n      return this._editable;\n    }\n  }\n});\n\nSegment.prototype.update = function(options) {\n  if (objectHasProperty(options, 'id')) {\n    throw new Error('peaks.segments.update(): id cannot be updated');\n  }\n\n  validateSegmentOptions(options, true);\n\n  this._setUserData(options);\n\n  this._peaks.emit('segments.update', this, options);\n};\n\n/**\n * Returns <code>true</code> if the segment overlaps a given time region.\n *\n * @param {Number} startTime The start of the time region, in seconds.\n * @param {Number} endTime The end of the time region, in seconds.\n * @returns {Boolean}\n *\n * @see http://wiki.c2.com/?TestIfDateRangesOverlap\n */\n\nSegment.prototype.isVisible = function(startTime, endTime) {\n  return this.startTime < endTime && startTime < this.endTime;\n};\n\nSegment.prototype._setStartTime = function(time) {\n  this._startTime = time;\n};\n\nSegment.prototype._setEndTime = function(time) {\n  this._endTime = time;\n};\n\nexport { Segment, setDefaultSegmentOptions, validateSegmentOptions };\n","/**\n * @file\n *\n * Defines the {@link WaveformSegments} class.\n *\n * @module waveform-segments\n */\n\nimport { Segment, setDefaultSegmentOptions, validateSegmentOptions } from './segment';\nimport { extend, isNullOrUndefined, objectHasProperty } from './utils';\n\n/**\n * Segment parameters.\n *\n * @typedef {Object} SegmentOptions\n * @global\n * @property {Number} startTime Segment start time, in seconds.\n * @property {Number} endTime Segment end time, in seconds.\n * @property {Boolean=} editable If <code>true</code> the segment start and\n *   end times can be adjusted via the user interface.\n *   Default: <code>false</code>.\n * @property {String=} color Segment waveform color.\n *   Default: Set by the <code>segmentOptions.waveformColor</code> option\n *   or the <code>segmentOptions.overlayColor</code> option.\n * @property {String=} borderColor Segment border color.\n *   Default: Set by the <code>segmentOptions.overlayBorderColor</code> option.\n * @property {String=} labelText Segment label text.\n *   Default: an empty string.\n * @property {String=} id A unique segment identifier.\n *   Default: an automatically generated identifier.\n */\n\n/**\n * Handles all functionality related to the adding, removing and manipulation\n * of segments.\n *\n * @class\n * @alias WaveformSegments\n *\n * @param {Peaks} peaks The parent Peaks object.\n */\n\nfunction WaveformSegments(peaks) {\n  this._peaks = peaks;\n  this._segments = [];\n  this._segmentsById = {};\n  this._segmentIdCounter = 0;\n}\n\n/**\n * Returns a new unique segment id value.\n *\n * @private\n * @returns {String}\n */\n\nWaveformSegments.prototype._getNextSegmentId = function() {\n  return 'peaks.segment.' + this._segmentIdCounter++;\n};\n\n/**\n * Adds a new segment object.\n *\n * @private\n * @param {Segment} segment\n */\n\nWaveformSegments.prototype._addSegment = function(segment) {\n  this._segments.push(segment);\n\n  this._segmentsById[segment.id] = segment;\n};\n\n/**\n * Creates a new segment object.\n *\n * @private\n * @param {SegmentOptions} options\n * @return {Segment}\n */\n\nWaveformSegments.prototype._createSegment = function(options) {\n  const segmentOptions = {};\n\n  extend(segmentOptions, options);\n\n  if (isNullOrUndefined(segmentOptions.id)) {\n    segmentOptions.id = this._getNextSegmentId();\n  }\n\n  setDefaultSegmentOptions(segmentOptions, this._peaks.options.segmentOptions);\n\n  validateSegmentOptions(segmentOptions, false);\n\n  segmentOptions.peaks = this._peaks;\n\n  return new Segment(segmentOptions);\n};\n\n/**\n * Returns all segments.\n *\n * @returns {Array<Segment>}\n */\n\nWaveformSegments.prototype.getSegments = function() {\n  return this._segments;\n};\n\n/**\n * Returns the segment with the given id, or <code>undefined</code> if not found.\n *\n * @param {String} id\n * @returns {Segment}\n */\n\nWaveformSegments.prototype.getSegment = function(id) {\n  return this._segmentsById[id];\n};\n\n/**\n * Returns all segments that overlap a given point in time.\n *\n * @param {Number} time\n * @returns {Array<Segment>}\n */\n\nWaveformSegments.prototype.getSegmentsAtTime = function(time) {\n  return this._segments.filter(function(segment) {\n    return time >= segment.startTime && time < segment.endTime;\n  });\n};\n\n/**\n * Returns all segments that overlap a given time region.\n *\n * @param {Number} startTime The start of the time region, in seconds.\n * @param {Number} endTime The end of the time region, in seconds.\n *\n * @returns {Array<Segment>}\n */\n\nWaveformSegments.prototype.find = function(startTime, endTime) {\n  return this._segments.filter(function(segment) {\n    return segment.isVisible(startTime, endTime);\n  });\n};\n\n/**\n * Returns a copy of the segments array, sorted by ascending segment start time.\n *\n * @returns {Array<Segment>}\n */\n\nWaveformSegments.prototype._getSortedSegments = function() {\n  return this._segments.slice().sort(function(a, b) {\n    return a.startTime - b.startTime;\n  });\n};\n\nWaveformSegments.prototype.findPreviousSegment = function(segment) {\n  const sortedSegments = this._getSortedSegments();\n\n  const index = sortedSegments.findIndex(function(s) {\n    return s.id === segment.id;\n  });\n\n  if (index !== -1) {\n    return sortedSegments[index - 1];\n  }\n\n  return undefined;\n};\n\nWaveformSegments.prototype.findNextSegment = function(segment) {\n  const sortedSegments = this._getSortedSegments();\n\n  const index = sortedSegments.findIndex(function(s) {\n    return s.id === segment.id;\n  });\n\n  if (index !== -1) {\n    return sortedSegments[index + 1];\n  }\n\n  return undefined;\n};\n\n/**\n * Adds one or more segments to the timeline.\n *\n * @param {SegmentOptions|Array<SegmentOptions>} segmentOrSegments\n *\n * @returns Segment|Array<Segment>\n */\n\nWaveformSegments.prototype.add = function(/* segmentOrSegments */) {\n  const self = this;\n\n  const arrayArgs = Array.isArray(arguments[0]);\n  let segments = arrayArgs ?\n                 arguments[0] :\n                 Array.prototype.slice.call(arguments);\n\n  segments = segments.map(function(segmentOptions) {\n    const segment = self._createSegment(segmentOptions);\n\n    if (objectHasProperty(self._segmentsById, segment.id)) {\n      throw new Error('peaks.segments.add(): duplicate id');\n    }\n\n    return segment;\n  });\n\n  segments.forEach(function(segment) {\n    self._addSegment(segment);\n  });\n\n  this._peaks.emit('segments.add', segments);\n\n  return arrayArgs ? segments : segments[0];\n};\n\n/**\n * Returns the indexes of segments that match the given predicate.\n *\n * @private\n * @param {Function} predicate Predicate function to find matching segments.\n * @returns {Array<Number>} An array of indexes into the segments array of\n *   the matching elements.\n */\n\nWaveformSegments.prototype._findSegment = function(predicate) {\n  const indexes = [];\n\n  for (let i = 0, length = this._segments.length; i < length; i++) {\n    if (predicate(this._segments[i])) {\n      indexes.push(i);\n    }\n  }\n\n  return indexes;\n};\n\n/**\n * Removes the segments at the given array indexes.\n *\n * @private\n * @param {Array<Number>} indexes The array indexes to remove.\n * @returns {Array<Segment>} The removed {@link Segment} objects.\n */\n\nWaveformSegments.prototype._removeIndexes = function(indexes) {\n  const removed = [];\n\n  for (let i = 0; i < indexes.length; i++) {\n    const index = indexes[i] - removed.length;\n\n    const itemRemoved = this._segments.splice(index, 1)[0];\n\n    delete this._segmentsById[itemRemoved.id];\n\n    removed.push(itemRemoved);\n  }\n\n  return removed;\n};\n\n/**\n * Removes all segments that match a given predicate function.\n *\n * After removing the segments, this function also emits a\n * <code>segments.remove</code> event with the removed {@link Segment}\n * objects.\n *\n * @private\n * @param {Function} predicate A predicate function that identifies which\n *   segments to remove.\n * @returns {Array<Segment>} The removed {@link Segment} objects.\n */\n\nWaveformSegments.prototype._removeSegments = function(predicate) {\n  const indexes = this._findSegment(predicate);\n\n  const removed = this._removeIndexes(indexes);\n\n  this._peaks.emit('segments.remove', removed);\n\n  return removed;\n};\n\n/**\n * Removes the given segment.\n *\n * @param {Segment} segment The segment to remove.\n * @returns {Array<Segment>} The removed segment.\n */\n\nWaveformSegments.prototype.remove = function(segment) {\n  return this._removeSegments(function(s) {\n    return s === segment;\n  });\n};\n\n/**\n * Removes any segments with the given id.\n *\n * @param {String} id\n * @returns {Array<Segment>} The removed {@link Segment} objects.\n */\n\nWaveformSegments.prototype.removeById = function(segmentId) {\n  return this._removeSegments(function(segment) {\n    return segment.id === segmentId;\n  });\n};\n\n/**\n * Removes any segments with the given start time, and optional end time.\n *\n * @param {Number} startTime Segments with this start time are removed.\n * @param {Number?} endTime If present, only segments with both the given\n *   start time and end time are removed.\n * @returns {Array<Segment>} The removed {@link Segment} objects.\n */\n\nWaveformSegments.prototype.removeByTime = function(startTime, endTime) {\n  endTime = (typeof endTime === 'number') ? endTime : 0;\n\n  let filter;\n\n  if (endTime > 0) {\n    filter = function(segment) {\n      return segment.startTime === startTime && segment.endTime === endTime;\n    };\n  }\n  else {\n    filter = function(segment) {\n      return segment.startTime === startTime;\n    };\n  }\n\n  return this._removeSegments(filter);\n};\n\n/**\n * Removes all segments.\n *\n * After removing the segments, this function emits a\n * <code>segments.remove_all</code> event.\n */\n\nWaveformSegments.prototype.removeAll = function() {\n  this._segments = [];\n  this._segmentsById = {};\n  this._peaks.emit('segments.remove_all');\n};\n\nexport default WaveformSegments;\n","/**\n * @file\n *\n * Defines the {@link KeyboardHandler} class.\n *\n * @module keyboard-handler\n */\n\nconst nodes = ['OBJECT', 'TEXTAREA', 'INPUT', 'SELECT', 'OPTION'];\n\nconst SPACE = 32,\n    TAB = 9,\n    LEFT_ARROW = 37,\n    RIGHT_ARROW = 39;\n\nconst keys = [SPACE, TAB, LEFT_ARROW, RIGHT_ARROW];\n\n/**\n * Configures keyboard event handling.\n *\n * @class\n * @alias KeyboardHandler\n *\n * @param {EventEmitter} eventEmitter\n */\n\nfunction KeyboardHandler(eventEmitter) {\n  this.eventEmitter = eventEmitter;\n\n  this._handleKeyEvent = this._handleKeyEvent.bind(this);\n\n  document.addEventListener('keydown', this._handleKeyEvent);\n  document.addEventListener('keypress', this._handleKeyEvent);\n  document.addEventListener('keyup', this._handleKeyEvent);\n}\n\n/**\n * Keyboard event handler function.\n *\n * @note Arrow keys only triggered on keydown, not keypress.\n *\n * @param {KeyboardEvent} event\n * @private\n */\n\nKeyboardHandler.prototype._handleKeyEvent = function handleKeyEvent(event) {\n  if (nodes.indexOf(event.target.nodeName) === -1) {\n    if (keys.indexOf(event.type) > -1) {\n      event.preventDefault();\n    }\n\n    if (event.type === 'keydown' || event.type === 'keypress') {\n      switch (event.keyCode) {\n        case SPACE:\n          this.eventEmitter.emit('keyboard.space');\n          break;\n\n        case TAB:\n          this.eventEmitter.emit('keyboard.tab');\n          break;\n      }\n    }\n    else if (event.type === 'keyup') {\n      switch (event.keyCode) {\n        case LEFT_ARROW:\n          if (event.shiftKey) {\n            this.eventEmitter.emit('keyboard.shift_left');\n          }\n          else {\n            this.eventEmitter.emit('keyboard.left');\n          }\n          break;\n\n        case RIGHT_ARROW:\n          if (event.shiftKey) {\n            this.eventEmitter.emit('keyboard.shift_right');\n          }\n          else {\n            this.eventEmitter.emit('keyboard.right');\n          }\n          break;\n      }\n    }\n  }\n};\n\nKeyboardHandler.prototype.destroy = function() {\n  document.removeEventListener('keydown', this._handleKeyEvent);\n  document.removeEventListener('keypress', this._handleKeyEvent);\n  document.removeEventListener('keyup', this._handleKeyEvent);\n};\n\nexport default KeyboardHandler;\n","/**\n * @file\n *\n * Implementation of {@link Player} adapter based on the HTML5 media element.\n *\n * @module mediaelement-player\n */\n\n/**\n * Checks whether the given HTMLMediaElement has either a src attribute\n * or any child <code>&lt;source&gt;</code> nodes\n */\n\nfunction mediaElementHasSource(mediaElement) {\n  if (mediaElement.src) {\n    return true;\n  }\n\n  if (mediaElement.querySelector('source')) {\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * A wrapper for interfacing with the HTML5 media element API.\n * Initializes the player for a given media element.\n *\n * @class\n * @alias MediaElementPlayer\n * @param {HTMLMediaElement} mediaElement The HTML <code>&lt;audio&gt;</code>\n *   or <code>&lt;video&gt;</code> element to associate with the\n *   {@link Peaks} instance.\n */\n\nfunction MediaElementPlayer(mediaElement) {\n  this._mediaElement = mediaElement;\n}\n\n/**\n * Adds an event listener to the media element.\n *\n * @private\n * @param {String} type The event type to listen for.\n * @param {Function} callback An event handler function.\n */\n\nMediaElementPlayer.prototype._addMediaListener = function(type, callback) {\n  this._listeners.push({ type: type, callback: callback });\n  this._mediaElement.addEventListener(type, callback);\n};\n\nMediaElementPlayer.prototype.init = function(eventEmitter) {\n  const self = this;\n\n  self._eventEmitter = eventEmitter;\n  self._listeners = [];\n  self._duration = self.getDuration();\n\n  self._addMediaListener('timeupdate', function() {\n    self._eventEmitter.emit('player.timeupdate', self.getCurrentTime());\n  });\n\n  self._addMediaListener('playing', function() {\n    self._eventEmitter.emit('player.playing', self.getCurrentTime());\n  });\n\n  self._addMediaListener('pause', function() {\n    self._eventEmitter.emit('player.pause', self.getCurrentTime());\n  });\n\n  self._addMediaListener('ended', function() {\n    self._eventEmitter.emit('player.ended');\n  });\n\n  self._addMediaListener('seeked', function() {\n    self._eventEmitter.emit('player.seeked', self.getCurrentTime());\n  });\n\n  self._addMediaListener('canplay', function() {\n    self._eventEmitter.emit('player.canplay');\n  });\n\n  self._addMediaListener('error', function(event) {\n    self._eventEmitter.emit('player.error', event.target.error);\n  });\n\n  self._interval = null;\n\n  if (!mediaElementHasSource(self._mediaElement)) {\n    return Promise.resolve();\n  }\n\n  return new Promise(function(resolve, reject) {\n    function eventHandler(event) {\n      self._mediaElement.removeEventListener('loadedmetadata', eventHandler);\n      self._mediaElement.removeEventListener('error', eventHandler);\n\n      if (event.type === 'loadedmetadata') {\n        resolve();\n      }\n      else {\n        reject(event.target.error);\n      }\n    }\n\n    // If the media element has preload=\"none\", clicking to seek in the\n    // waveform won't work, so here we force the media to load.\n    if (self._mediaElement.readyState === HTMLMediaElement.HAVE_NOTHING) {\n      // Wait for the readyState to change to HAVE_METADATA so we know the\n      // duration is valid, otherwise it could be NaN.\n      self._mediaElement.addEventListener('loadedmetadata', eventHandler);\n      self._mediaElement.addEventListener('error', eventHandler);\n      self._mediaElement.load();\n    }\n    else {\n      resolve();\n    }\n  });\n};\n\n/**\n * Cleans up the player object, removing all event listeners from the\n * associated media element.\n */\n\nMediaElementPlayer.prototype.destroy = function() {\n  for (let i = 0; i < this._listeners.length; i++) {\n    const listener = this._listeners[i];\n\n    this._mediaElement.removeEventListener(\n      listener.type,\n      listener.callback\n    );\n  }\n\n  this._listeners.length = 0;\n\n  this._mediaElement = null;\n};\n\nMediaElementPlayer.prototype.play = function() {\n  return this._mediaElement.play();\n};\n\nMediaElementPlayer.prototype.pause = function() {\n  this._mediaElement.pause();\n};\n\nMediaElementPlayer.prototype.isPlaying = function() {\n  return !this._mediaElement.paused;\n};\n\nMediaElementPlayer.prototype.isSeeking = function() {\n  return this._mediaElement.seeking;\n};\n\nMediaElementPlayer.prototype.getCurrentTime = function() {\n  return this._mediaElement.currentTime;\n};\n\nMediaElementPlayer.prototype.getDuration = function() {\n  return this._mediaElement.duration;\n};\n\nMediaElementPlayer.prototype.seek = function(time) {\n  this._mediaElement.currentTime = time;\n};\n\nfunction SetSourceHandler(eventEmitter, mediaElement) {\n  this._eventEmitter = eventEmitter;\n  this._mediaElement = mediaElement;\n  this._playerCanPlayHandler = this._playerCanPlayHandler.bind(this);\n  this._playerErrorHandler = this._playerErrorHandler.bind(this);\n}\n\nSetSourceHandler.prototype.setSource = function(options, callback) {\n  const self = this;\n\n  self._options = options;\n  self._callback = callback;\n\n  self._eventEmitter.on('player.canplay', self._playerCanPlayHandler);\n  self._eventEmitter.on('player.error', self._playerErrorHandler);\n\n  return new Promise(function(resolve, reject) {\n    self._resolve = resolve;\n    self._reject = reject;\n\n    self._eventEmitter.on('player.canplay', self._playerCanPlayHandler);\n    self._eventEmitter.on('player.error', self._playerErrorHandler);\n\n    self._mediaElement.setAttribute('src', options.mediaUrl);\n\n    // Force the media element to load, in case the media element\n    // has preload=\"none\".\n    if (self._mediaElement.readyState === HTMLMediaElement.HAVE_NOTHING) {\n      self._mediaElement.load();\n    }\n  });\n};\n\nSetSourceHandler.prototype._reset = function() {\n  this._eventEmitter.removeListener('player.canplay', this._playerCanPlayHandler);\n  this._eventEmitter.removeListener('player.error', this._playerErrorHandler);\n};\n\nSetSourceHandler.prototype._playerCanPlayHandler = function() {\n  this._reset();\n\n  this._resolve();\n};\n\nSetSourceHandler.prototype._playerErrorHandler = function(err) {\n  this._reset();\n\n  // Return the MediaError object from the media element\n  this._reject(err);\n};\n\nMediaElementPlayer.prototype.setSource = function(options) {\n  if (!options.mediaUrl) {\n    // eslint-disable-next-line max-len\n    return Promise.reject(new Error('peaks.setSource(): options must contain a mediaUrl when using mediaElement'));\n  }\n\n  const setSourceHandler = new SetSourceHandler(this._eventEmitter, this._mediaElement);\n\n  return setSourceHandler.setSource(options);\n};\n\nexport default MediaElementPlayer;\n","/**\n * @file\n *\n * A general audio player class which interfaces with external audio players.\n * The default audio player in Peaks.js is {@link MediaElementPlayer}.\n *\n * @module player\n */\n\nimport { isValidTime } from './utils';\n\nfunction getAllPropertiesFrom(adapter) {\n  const allProperties = [];\n  let obj = adapter;\n\n  while (obj) {\n    Object.getOwnPropertyNames(obj).forEach(function(p) {\n      allProperties.push(p);\n    });\n\n    obj = Object.getPrototypeOf(obj);\n  }\n\n  return allProperties;\n}\n\nfunction validateAdapter(adapter) {\n  const publicAdapterMethods = [\n    'init',\n    'destroy',\n    'play',\n    'pause',\n    'isPlaying',\n    'isSeeking',\n    'getCurrentTime',\n    'getDuration',\n    'seek'\n  ];\n\n  const allProperties = getAllPropertiesFrom(adapter);\n\n  publicAdapterMethods.forEach(function(method) {\n    if (!allProperties.includes(method)) {\n      throw new TypeError('Peaks.init(): Player method ' + method + ' is undefined');\n    }\n\n    if ((typeof adapter[method]) !== 'function') {\n      throw new TypeError('Peaks.init(): Player method ' + method + ' is not a function');\n    }\n  });\n}\n\n/**\n * A wrapper for interfacing with an external player API.\n *\n * @class\n * @alias Player\n *\n * @param {Peaks} peaks The parent {@link Peaks} object.\n * @param {Adapter} adapter The player adapter.\n */\n\nfunction Player(peaks, adapter) {\n  this._peaks = peaks;\n\n  this._playingSegment = false;\n  this._segment = null;\n  this._loop = false;\n  this._playSegmentTimerCallback = this._playSegmentTimerCallback.bind(this);\n\n  validateAdapter(adapter);\n  this._adapter = adapter;\n}\n\nPlayer.prototype.init = function() {\n  return this._adapter.init(this._peaks);\n};\n\n/**\n * Cleans up the player object.\n */\n\nPlayer.prototype.destroy = function() {\n  this._adapter.destroy();\n};\n\n/**\n * Starts playback.\n * @returns {Promise}\n */\n\nPlayer.prototype.play = function() {\n  return this._adapter.play();\n};\n\n/**\n * Pauses playback.\n */\n\nPlayer.prototype.pause = function() {\n  this._adapter.pause();\n};\n\n/**\n * @returns {Boolean} <code>true</code> if playing, <code>false</code>\n * otherwise.\n */\n\nPlayer.prototype.isPlaying = function() {\n  return this._adapter.isPlaying();\n};\n\n/**\n * @returns {boolean} <code>true</code> if seeking\n */\n\nPlayer.prototype.isSeeking = function() {\n  return this._adapter.isSeeking();\n};\n\n/**\n * Returns the current playback time position, in seconds.\n *\n * @returns {Number}\n */\n\nPlayer.prototype.getCurrentTime = function() {\n  return this._adapter.getCurrentTime();\n};\n\n/**\n * Returns the media duration, in seconds.\n *\n * @returns {Number}\n */\n\nPlayer.prototype.getDuration = function() {\n  return this._adapter.getDuration();\n};\n\n/**\n * Seeks to a given time position within the media.\n *\n * @param {Number} time The time position, in seconds.\n */\n\nPlayer.prototype.seek = function(time) {\n  if (!isValidTime(time)) {\n    this._peaks._logger('peaks.player.seek(): parameter must be a valid time, in seconds');\n    return;\n  }\n\n  this._adapter.seek(time);\n};\n\n/**\n * Plays the given segment.\n *\n * @param {Segment} segment The segment denoting the time region to play.\n * @param {Boolean} loop If true, playback is looped.\n */\n\nPlayer.prototype.playSegment = function(segment, loop) {\n  const self = this;\n\n  if (!segment ||\n    !isValidTime(segment.startTime) ||\n    !isValidTime(segment.endTime)) {\n    return Promise.reject(\n      new Error('peaks.player.playSegment(): parameter must be a segment object')\n    );\n  }\n\n  self._segment = segment;\n  self._loop = loop;\n\n  // Set audio time to segment start time\n  self.seek(segment.startTime);\n\n  self._peaks.once('player.playing', function() {\n    if (!self._playingSegment) {\n      self._playingSegment = true;\n\n      // We need to use requestAnimationFrame here as the timeupdate event\n      // doesn't fire often enough.\n      window.requestAnimationFrame(self._playSegmentTimerCallback);\n    }\n  });\n\n  // Start playing audio\n  return self.play();\n};\n\nPlayer.prototype._playSegmentTimerCallback = function() {\n  if (!this.isPlaying()) {\n    this._playingSegment = false;\n    return;\n  }\n  else if (this.getCurrentTime() >= this._segment.endTime) {\n    if (this._loop) {\n      this.seek(this._segment.startTime);\n    }\n    else {\n      this.pause();\n      this._peaks.emit('player.ended');\n      this._playingSegment = false;\n      return;\n    }\n  }\n\n  window.requestAnimationFrame(this._playSegmentTimerCallback);\n};\n\nPlayer.prototype._setSource = function(options) {\n  return this._adapter.setSource(options);\n};\n\nexport default Player;\n","/**\n * @file\n *\n * Defines the {@link DefaultPointMarker} class.\n *\n * @module default-point-marker\n */\n\nimport { Line } from 'konva/lib/shapes/Line';\nimport { Rect } from 'konva/lib/shapes/Rect';\nimport { Text } from 'konva/lib/shapes/Text';\n\n/**\n * Creates a point marker handle.\n *\n * @class\n * @alias DefaultPointMarker\n *\n * @param {CreatePointMarkerOptions} options\n */\n\nfunction DefaultPointMarker(options) {\n  this._options = options;\n}\n\nDefaultPointMarker.prototype.init = function(group) {\n  const handleWidth  = 10;\n  const handleHeight = 20;\n  const handleX      = -(handleWidth / 2) + 0.5; // Place in the middle of the marker\n\n  // Label\n\n  if (this._options.view === 'zoomview') {\n    // Label - create with default y, the real value is set in fitToView().\n    this._label = new Text({\n      x:          2,\n      y:          0,\n      text:       this._options.point.labelText,\n      textAlign:  'left',\n      fontFamily: this._options.fontFamily || 'sans-serif',\n      fontSize:   this._options.fontSize || 10,\n      fontStyle:  this._options.fontStyle || 'normal',\n      fill:       '#000'\n    });\n  }\n\n  // Handle - create with default y, the real value is set in fitToView().\n\n  if (this._options.draggable) {\n    this._handle = new Rect({\n      x:      handleX,\n      y:      0,\n      width:  handleWidth,\n      height: handleHeight,\n      fill:   this._options.color\n    });\n  }\n\n  // Line - create with default y and points, the real values\n  // are set in fitToView().\n  this._line = new Line({\n    x:           0,\n    y:           0,\n    stroke:      this._options.color,\n    strokeWidth: 1\n  });\n\n  // Time label\n\n  if (this._handle) {\n    // Time - create with default y, the real value is set in fitToView().\n    this._time = new Text({\n      x:          -24,\n      y:          0,\n      text:       this._options.layer.formatTime(this._options.point.time),\n      fontFamily: this._options.fontFamily,\n      fontSize:   this._options.fontSize,\n      fontStyle:  this._options.fontStyle,\n      fill:       '#000',\n      textAlign:  'center'\n    });\n\n    this._time.hide();\n  }\n\n  if (this._handle) {\n    group.add(this._handle);\n  }\n\n  group.add(this._line);\n\n  if (this._label) {\n    group.add(this._label);\n  }\n\n  if (this._time) {\n    group.add(this._time);\n  }\n\n  this.fitToView();\n\n  this.bindEventHandlers(group);\n};\n\nDefaultPointMarker.prototype.bindEventHandlers = function(group) {\n  const self = this;\n\n  if (self._handle) {\n    self._handle.on('mouseover touchstart', function() {\n      // Position text to the left of the marker\n      self._time.setX(-24 - self._time.getWidth());\n      self._time.show();\n    });\n\n    self._handle.on('mouseout touchend', function() {\n      self._time.hide();\n    });\n\n    group.on('dragstart', function() {\n      self._time.setX(-24 - self._time.getWidth());\n      self._time.show();\n    });\n\n    group.on('dragend', function() {\n      self._time.hide();\n    });\n  }\n};\n\nDefaultPointMarker.prototype.fitToView = function() {\n  const height = this._options.layer.getHeight();\n\n  this._line.points([0.5, 0, 0.5, height]);\n\n  if (this._label) {\n    this._label.y(12);\n  }\n\n  if (this._handle) {\n    this._handle.y(height / 2 - 10.5);\n  }\n\n  if (this._time) {\n    this._time.y(height / 2 - 5);\n  }\n};\n\nDefaultPointMarker.prototype.timeUpdated = function(time) {\n  if (this._time) {\n    this._time.setText(this._options.layer.formatTime(time));\n  }\n};\n\nexport default DefaultPointMarker;\n","/**\n * @file\n *\n * Defines the {@link DefaultSegmentMarker} class.\n *\n * @module default-segment-marker\n */\n\nimport { Line } from 'konva/lib/shapes/Line';\nimport { Rect } from 'konva/lib/shapes/Rect';\nimport { Text } from 'konva/lib/shapes/Text';\n\n/**\n * Creates a segment marker handle.\n *\n * @class\n * @alias DefaultSegmentMarker\n *\n * @param {CreateSegmentMarkerOptions} options\n */\n\nfunction DefaultSegmentMarker(options) {\n  this._options = options;\n}\n\nDefaultSegmentMarker.prototype.init = function(group) {\n  const handleWidth  = 15;\n  const handleHeight = 48;\n  let handleX      = -(handleWidth / 2) - 8; // Place off to the side of the segment\n\n  handleX = this._options.startMarker ? (handleX * -1) - 14.9 : handleX;\n\n  const xPosition = this._options.startMarker ? -24 : 24;\n\n  const time = this._options.startMarker ? this._options.segment.startTime :\n                                           this._options.segment.endTime;\n\n  const handleLineColor = this._options.segment.borderColor;\n\n  const handleColor = this._options.segment.handleColor;\n\n  // Label - create with default y, the real value is set in fitToView().\n  this._label = new Text({\n    x:          xPosition,\n    y:          0,\n    text:       this._options.layer.formatTime(time),\n    fontFamily: this._options.fontFamily,\n    fontSize:   this._options.fontSize,\n    fontStyle:  this._options.fontStyle,\n    fill:       '#000',\n    textAlign:  'center'\n  });\n\n  this._label.hide();\n\n  // Handle - create with default y, the real value is set in fitToView().\n  this._handle = new Rect({\n    x:           handleX,\n    y:           0,\n    width:       handleWidth,\n    height:      handleHeight,\n    fill:        handleColor,\n    stroke:      handleColor,\n    strokeWidth: 0\n  });\n\n  this._handleLineOne = new Rect({\n    name: 'handleLineOne',\n    x: handleX + 4.5,\n    y: 0,\n    width: 0.5,\n    height: 16,\n    fill: handleLineColor,\n    stroke: handleLineColor,\n    strokeWidth: 1\n  });\n\n  this._handleLineTwo = new Rect({\n    name: 'handleLineTwo',\n    x: handleX + 9.5,\n    y: 0,\n    width: 0.5,\n    height: 16,\n    fill: handleLineColor,\n    stroke: handleLineColor,\n    strokeWidth: 1\n  });\n\n  this._handleLineSingle = new Rect({\n    name: 'handleLineSingle',\n    x: handleX + 7,\n    y: 0,\n    width: 0.5,\n    height: 16,\n    fill: handleLineColor,\n    stroke: handleLineColor,\n    strokeWidth: 1,\n    visible: false\n  });\n\n  // Vertical Line - create with default y and points, the real values\n  // are set in fitToView().\n  this._line = new Line({\n    x:           0,\n    y:           0\n  });\n\n  group.add(this._label);\n  // group.add(this._line);\n  group.add(this._handleLineOne);\n  group.add(this._handleLineTwo);\n  group.add(this._handleLineSingle);\n  group.add(this._handle);\n\n  this.fitToView();\n\n  this.bindEventHandlers(group);\n\n  setTimeout(() => {\n    let focusedSegmentShape;\n    const segmentShapes = this._options.layer._segmentShapes;\n\n    for (const [value] of Object.entries(segmentShapes)) {\n      const segmentShape = segmentShapes[value];\n\n      if (segmentShape._endMarker !== null) {\n        focusedSegmentShape = segmentShape;\n        break;\n      }\n    }\n\n    const segmentShapeWidth = focusedSegmentShape._overlay.width();\n\n    if (segmentShapeWidth <= 32.5) {\n      const markerInfo = this.getMarkerInfo(focusedSegmentShape);\n\n      this.updateMarkersSmall(segmentShapeWidth, markerInfo);\n    }\n  }, 0);\n};\n\nDefaultSegmentMarker.prototype.bindEventHandlers = function(group) {\n  const self = this;\n\n  // const xPosition = self._options.startMarker ? -24 : 24;\n\n  if (self._options.draggable) {\n    group.on('dragstart', function() {\n      // self._handle.attrs.fill = '#3641414D'; // neutral-800 .30a\n      // self._handle.attrs.stroke = '#3641414D'; // neutral-800 .30a\n      // if (self._options.startMarker) {\n      //   self._label.setX(xPosition - self._label.getWidth());\n      // }\n\n      // self._label.show();\n    });\n\n    group.on('dragend', function() {\n      // self._label.hide();\n    });\n  }\n\n  self._handle.on('mouseover touchstart', function() {\n    document.body.style.cursor = 'col-resize';\n    // self._handle.attrs.fill = '#3641414D'; // neutral-800 .30a\n    // self._handle.attrs.stroke = '#3641414D'; // neutral-800 .30a\n    // if (self._options.startMarker) {\n    //   self._label.setX(xPosition - self._label.getWidth());\n    // }\n\n    // self._label.show();\n    this.parent.parent.draw();\n  });\n\n  self._handle.on('mouseout touchend', function() {\n    document.body.style.cursor = 'default';\n    // self._handle.attrs.fill = '#6E797A4D'; // neutral-600 .30a\n    // self._handle.attrs.stroke = '#6E797A4D'; // neutral-600 .30a\n    // self._label.hide();\n    this.parent.parent.draw();\n  });\n};\n\nDefaultSegmentMarker.prototype.fitToView = function() {\n  const height = this._options.layer.getHeight();\n\n  this._label.y(height / 2 - 5);\n  this._handle.y(height / 2 + 45);\n  this._handleLineOne.y(height / 2 + 61);\n  this._handleLineTwo.y(height / 2 + 61);\n  this._handleLineSingle.y(height / 2 + 61);\n  // this._line.points([0.5, 0, 0.5, height]);\n};\n\nDefaultSegmentMarker.prototype.updateMarkersSmall = function(segmentShapeWidth, markerInfo) {\n  const { endMarkerHandleLineSingle, startMarkerHandleLineSingle } = markerInfo;\n  const newHandleWidth = (segmentShapeWidth / 2) - 0.5;\n\n  markerInfo.endMarker._handle.x(-newHandleWidth + 1);\n  markerInfo.startMarker._handle.attrs.width = newHandleWidth;\n  markerInfo.endMarker._handle.attrs.width = newHandleWidth;\n\n  markerInfo.endMarkerHandleLines.forEach(line => line.hide());\n  endMarkerHandleLineSingle.show();\n  endMarkerHandleLineSingle.x((newHandleWidth / 2) - newHandleWidth);\n  markerInfo.startMarkerHandleLines.forEach(line => line.hide());\n  startMarkerHandleLineSingle.show();\n  startMarkerHandleLineSingle.x(newHandleWidth / 2);\n};\n\nDefaultSegmentMarker.prototype.getMarkerInfo = function(segmentShape) {\n  const { _endMarker, _startMarker } = segmentShape;\n  const endMarker = _endMarker._marker;\n  const endMarkerGroupChildren = _endMarker._group.children;\n  const startMarker = _startMarker._marker;\n  const startMarkerGroupChildren = _startMarker._group.children;\n\n  const endMarkerHandleLines = endMarkerGroupChildren.filter(\n    child => child.attrs.name === 'handleLineOne' || child.attrs.name === 'handleLineTwo');\n  const endMarkerHandleLineSingle = endMarkerGroupChildren.find(\n    child => child.attrs.name === 'handleLineSingle');\n  const startMarkerHandleLines = startMarkerGroupChildren.filter(\n    child => child.attrs.name === 'handleLineOne' || child.attrs.name === 'handleLineTwo');\n  const startMarkerHandleLineSingle = startMarkerGroupChildren.find(\n    child => child.attrs.name === 'handleLineSingle');\n\n  return {\n    endMarker,\n    startMarker,\n    endMarkerHandleLines,\n    endMarkerHandleLineSingle,\n    startMarkerHandleLines,\n    startMarkerHandleLineSingle\n  };\n};\n\nDefaultSegmentMarker.prototype.timeUpdated = function(time) {\n  let focusedSegmentShape;\n  const segmentShapes = this._options.layer._segmentShapes;\n\n  for (const [value] of Object.entries(segmentShapes)) {\n    const segmentShape = segmentShapes[value];\n\n    if (segmentShape._endMarker !== null) {\n      focusedSegmentShape = segmentShape;\n      break;\n    }\n  }\n\n  const markerInfo = this.getMarkerInfo(focusedSegmentShape);\n\n  const segmentShapeWidth = focusedSegmentShape._overlay.width();\n\n  if (segmentShapeWidth <= 32.5) {\n    this.updateMarkersSmall(segmentShapeWidth, markerInfo);\n  }\n  else {\n    const handleX = -(15 / 2) - 8;\n    const startHandleX = handleX * -1 - 14.9;\n    const endHandleX = handleX;\n\n    markerInfo.endMarker._handle.x(endHandleX);\n    markerInfo.startMarker._handle.x(startHandleX);\n\n    markerInfo.startMarker._handle.attrs.width = 15;\n    markerInfo.endMarker._handle.attrs.width = 15;\n\n    markerInfo.endMarkerHandleLines.forEach(line => line.show());\n    markerInfo.endMarkerHandleLineSingle.hide();\n    markerInfo.startMarkerHandleLines.forEach(line => line.show());\n    markerInfo.startMarkerHandleLineSingle.hide();\n  }\n\n  this._label.setText(this._options.layer.formatTime(time));\n};\n\nexport default DefaultSegmentMarker;\n","/**\n * @file\n *\n * Factory functions for creating point and segment marker handles.\n *\n * @module marker-factories\n */\n\nimport DefaultPointMarker from './default-point-marker';\nimport DefaultSegmentMarker from './default-segment-marker';\nimport { Text } from 'konva/lib/shapes/Text';\n\n/**\n * Parameters for the {@link createSegmentMarker} function.\n *\n * @typedef {Object} CreateSegmentMarkerOptions\n * @global\n * @property {Segment} segment\n * @property {Boolean} draggable If true, marker is draggable.\n * @property {Boolean} startMarker\n * @property {String} color\n * @property {String} fontFamily\n * @property {Number} fontSize\n * @property {String} fontStyle\n * @property {Layer} layer\n * @property {String} view\n * @property {SegmentDisplayOptions} segmentOptions\n */\n\n/**\n * Creates a left or right side segment marker handle.\n *\n * @param {CreateSegmentMarkerOptions} options\n * @returns {Marker}\n */\n\nexport function createSegmentMarker(options) {\n  if (options.view === 'zoomview') {\n    return new DefaultSegmentMarker(options);\n  }\n\n  return null;\n}\n\n/**\n * Parameters for the {@link createSegmentLabel} function.\n *\n * @typedef {Object} SegmentLabelOptions\n * @global\n * @property {Segment} segment The {@link Segment} object associated with this\n *   label.\n * @property {String} view The name of the view that the label is being\n *   created in, either <code>zoomview</code> or <code>overview</code>.\n * @property {SegmentsLayer} layer\n * @property {String} fontFamily\n * @property {Number} fontSize\n * @property {String} fontStyle\n */\n\n/**\n * Creates a Konva object that renders information about a segment, such as\n * its label text.\n *\n * @param {SegmentLabelOptions} options\n * @returns {Konva.Text}\n */\n\nexport function createSegmentLabel(options) {\n  return new Text({\n    x:          12,\n    y:          12,\n    text:       options.segment.labelText,\n    textAlign:  'center',\n    fontFamily: options.fontFamily || 'sans-serif',\n    fontSize:   options.fontSize || 12,\n    fontStyle:  options.fontStyle || 'normal',\n    fill:       '#000'\n  });\n}\n\n/**\n * Parameters for the {@link createPointMarker} function.\n *\n * @typedef {Object} CreatePointMarkerOptions\n * @global\n * @property {Point} point\n * @property {Boolean} draggable If true, marker is draggable.\n * @property {String} color\n * @property {Layer} layer\n * @property {String} view\n * @property {String} fontFamily\n * @property {Number} fontSize\n * @property {String} fontStyle\n */\n\n/**\n * Creates a point marker handle.\n *\n * @param {CreatePointMarkerOptions} options\n * @returns {Marker}\n */\n\nexport function createPointMarker(options) {\n  return new DefaultPointMarker(options);\n}\n","/**\n * @file\n *\n * Defines the {@link Scrollbar} class.\n *\n * @module scrollbar\n */\n\nimport { clamp } from './utils';\n\nimport Konva from 'konva/lib/Core';\nimport { Rect } from 'konva/lib/shapes/Rect';\n\n/**\n * Creates a scrollbar.\n *\n * @class\n * @alias Scrollbar\n *\n * @param {WaveformData} waveformData\n * @param {HTMLElement} container\n * @param {Peaks} peaks\n */\n\nfunction Scrollbar(waveformData, container, peaks) {\n  this._waveformData = waveformData;\n  this._container = container;\n  this._peaks = peaks;\n  this._options = peaks.options.scrollbar;\n  this._zoomview = peaks.views.getView('zoomview');\n\n  this._dragBoundFunc = this._dragBoundFunc.bind(this);\n  this._onScrollboxDragStart = this._onScrollboxDragStart.bind(this);\n  this._onScrollboxDragMove = this._onScrollboxDragMove.bind(this);\n  this._onScrollboxDragEnd = this._onScrollboxDragEnd.bind(this);\n  this._onZoomviewDisplaying = this._onZoomviewDisplaying.bind(this);\n  this._onScrollbarClick = this._onScrollbarClick.bind(this);\n  this._onWindowResize = this._onWindowResize.bind(this);\n\n  peaks.on('zoomview.displaying', this._onZoomviewDisplaying);\n  peaks.on('window_resize', this._onWindowResize);\n\n  this._width = container.clientWidth;\n  // this._height = container.clientHeight;\n  this._height = 10;\n\n  this._stage = new Konva.Stage({\n    container: container,\n    width: this._width,\n    height: this._height\n  });\n\n  this._layer = new Konva.Layer();\n  this._stage.on('click', this._onScrollbarClick);\n\n  this._stage.add(this._layer);\n\n  this._color = this._options.color;\n  this._scrollboxX = 0;\n  this._minScrollboxWidth = this._options.minWidth;\n\n  this._offsetY = 0;\n\n  this._scrollbox = new Konva.Group({\n    draggable:     true,\n    dragBoundFunc: this._dragBoundFunc\n  });\n\n  this._scrollboxRect = new Rect({\n    x:           this._scrollboxX,\n    y:           this._offsetY,\n    width:       0,\n    height:      this._height,\n    fill:        this._color,\n    cornerRadius: 10\n  });\n\n  this._scrollbox.add(this._scrollboxRect);\n  this._setScrollboxWidth();\n\n  this._scrollbox.on('dragstart', this._onScrollboxDragStart);\n  this._scrollbox.on('dragmove', this._onScrollboxDragMove);\n  this._scrollbox.on('dragend', this._onScrollboxDragEnd);\n\n  this._layer.add(this._scrollbox);\n  this._layer.draw();\n}\n\n/**\n * Sets the width of the scrollbox, based on the visible waveform region\n * in the zoomview and minimum scrollbox width option.\n */\n\nScrollbar.prototype._setScrollboxWidth = function() {\n  if (this._zoomview) {\n    this._scrollboxWidth = Math.floor(\n      this._width * this._zoomview.pixelsToTime(this._zoomview.getWidth()) /\n        this._peaks.player.getDuration()\n    );\n\n    if (this._scrollboxWidth < this._minScrollboxWidth) {\n      this._scrollboxWidth = this._minScrollboxWidth;\n    }\n  }\n  else {\n    this._scrollboxWidth = this._minScrollboxWidth;\n  }\n\n  this._scrollboxRect.width(this._scrollboxWidth);\n};\n\n/**\n * @returns {Number} The maximum scrollbox position, in pixels.\n */\n\nScrollbar.prototype._getScrollbarRange = function() {\n  return this._width - this._scrollboxWidth;\n};\n\nScrollbar.prototype._dragBoundFunc = function(pos) {\n  // Allow the scrollbar to be moved horizontally but not vertically.\n  return {\n    x: pos.x,\n    y: 0\n  };\n};\n\nScrollbar.prototype._onScrollboxDragStart = function() {\n  this._dragging = true;\n};\n\nScrollbar.prototype._onScrollboxDragEnd = function() {\n  this._dragging = false;\n};\n\nScrollbar.prototype._onScrollboxDragMove = function() {\n  const range = this._getScrollbarRange();\n  let x = this._scrollbox.x();\n\n  x = clamp(x, 0, range);\n\n  this._scrollbox.x(x);\n\n  if (x !== this._scrollboxX) {\n    this._scrollboxX = x;\n\n    if (this._zoomview) {\n      this._updateWaveform(x);\n    }\n  }\n};\n\nScrollbar.prototype._onZoomviewDisplaying = function(/* startTime , endTime */) {\n  if (!this._dragging) {\n    this._updateScrollbarWidthAndPosition();\n  }\n};\n\nScrollbar.prototype._updateScrollbarWidthAndPosition = function() {\n  this._setScrollboxWidth();\n\n  if (this._zoomview) {\n    const startTime = this._zoomview.getStartTime();\n\n    const zoomviewRange = this._zoomview.getPixelLength() - this._zoomview.getWidth();\n\n    const scrollBoxPos = Math.floor(\n      this._zoomview.timeToPixels(startTime) * this._getScrollbarRange() / zoomviewRange\n    );\n\n    this._scrollbox.x(scrollBoxPos);\n    this._layer.draw();\n  }\n};\n\nScrollbar.prototype._onScrollbarClick = function(event) {\n  // Handle clicks on the scrollbar outside the scrollbox.\n  if (event.target === this._stage) {\n    if (this._zoomview) {\n      let x = event.evt.layerX;\n\n      // Centre the scrollbox where the user clicked.\n      x = Math.floor(x - this._scrollboxWidth / 2);\n\n      if (x < 0) {\n        x = 0;\n      }\n\n      this._updateWaveform(x);\n    }\n  }\n};\n\n/**\n * Sets the zoomview waveform position based on scrollbar position.\n */\n\nScrollbar.prototype._updateWaveform = function(x) {\n  const offset = Math.floor(\n    (this._zoomview.getPixelLength() - this._zoomview.getWidth()) * x / this._getScrollbarRange()\n  );\n\n  this._zoomview.updateWaveform(offset);\n};\n\nScrollbar.prototype._onWindowResize = function() {\n  this._width = this._container.clientWidth;\n  this._stage.width(this._width);\n\n  this._updateScrollbarWidthAndPosition();\n};\n\nScrollbar.prototype.fitToContainer = function() {\n  if (this._container.clientWidth === 0 && this._container.clientHeight === 0) {\n    return;\n  }\n\n  if (this._container.clientWidth !== this._width) {\n    this._width = this._container.clientWidth;\n    this._stage.width(this._width);\n  }\n\n  this._height = this._container.clientHeight;\n  this._stage.height(this._height);\n\n  this._stage.draw();\n};\n\nScrollbar.prototype.destroy = function() {\n  this._peaks.off('window_resize', this._onWindowResize);\n\n  this._layer.destroy();\n\n  this._stage.destroy();\n  this._stage = null;\n};\n\nexport default Scrollbar;\n","/**\n * @file\n *\n * Defines the {@link HighlightLayer} class.\n *\n * @module highlight-layer\n */\n\nimport Konva from 'konva/lib/Core';\nimport { Rect } from 'konva/lib/shapes/Rect';\n\nimport { clamp } from  './utils';\n\n/**\n * Highlight layer options\n *\n * @typedef {Object} HighlightLayerOptions\n * @global\n * @property {Number} highlightOffset\n * @property {String} highlightColor\n * @property {String} highlightStrokeColor\n * @property {Number} highlightOpacity\n * @property {Number} highlightCornerRadius\n */\n\n/**\n * Creates the highlight region that shows the position of the zoomable\n * waveform view in the overview waveform.\n *\n * @class\n * @alias HighlightLayer\n *\n * @param {WaveformOverview} view\n * @param {HighlightLayerOptions} options\n */\n\nfunction HighlightLayer(view, options) {\n  this._view          = view;\n  this._offset        = options.highlightOffset;\n  this._color         = options.highlightColor;\n  this._layer         = new Konva.Layer({ listening: false });\n  this._highlightRect = null;\n  this._startTime     = null;\n  this._endTime       = null;\n  this._strokeColor   = options.highlightStrokeColor;\n  this._opacity       = options.highlightOpacity;\n  this._cornerRadius  = options.highlightCornerRadius;\n}\n\nHighlightLayer.prototype.addToStage = function(stage) {\n  stage.add(this._layer);\n};\n\nHighlightLayer.prototype.showHighlight = function(startTime, endTime) {\n  if (!this._highlightRect) {\n    this._createHighlightRect(startTime, endTime);\n  }\n\n  this._update(startTime, endTime);\n};\n\n/**\n * Updates the position of the highlight region.\n *\n * @param {Number} startTime The start of the highlight region, in seconds.\n * @param {Number} endTime The end of the highlight region, in seconds.\n */\n\nHighlightLayer.prototype._update = function(startTime, endTime) {\n  this._startTime = startTime;\n  this._endTime = endTime;\n\n  const startOffset = this._view.timeToPixels(startTime);\n  const endOffset   = this._view.timeToPixels(endTime);\n\n  this._highlightRect.setAttrs({\n    x:     startOffset,\n    width: endOffset - startOffset\n  });\n};\n\nHighlightLayer.prototype._createHighlightRect = function(startTime, endTime) {\n  this._startTime = startTime;\n  this._endTime   = endTime;\n\n  const startOffset = this._view.timeToPixels(startTime);\n  const endOffset   = this._view.timeToPixels(endTime);\n\n  // Create with default y and height, the real values are set in fitToView().\n  this._highlightRect = new Rect({\n    x:            startOffset,\n    y:            0,\n    width:        endOffset - startOffset,\n    height:       0,\n    stroke:       this._strokeColor,\n    strokeWidth:  1,\n    fill:         this._color,\n    opacity:      this._opacity,\n    cornerRadius: this._cornerRadius\n  });\n\n  this.fitToView();\n\n  this._layer.add(this._highlightRect);\n};\n\nHighlightLayer.prototype.removeHighlight = function() {\n  if (this._highlightRect) {\n    this._highlightRect.destroy();\n    this._highlightRect = null;\n  }\n};\n\nHighlightLayer.prototype.updateHighlight = function() {\n  if (this._highlightRect) {\n    this._update(this._startTime, this._endTime);\n  }\n};\n\nHighlightLayer.prototype.fitToView = function() {\n  if (this._highlightRect) {\n    const height = this._view.getHeight();\n    const offset = clamp(this._offset, 0, Math.floor(height / 2));\n\n    this._highlightRect.setAttrs({\n      y: offset,\n      height: height - (offset * 2)\n    });\n  }\n};\n\nexport default HighlightLayer;\n","/**\n * @file\n *\n * Defines the {@link MouseDragHandler} class.\n *\n * @module mouse-drag-handler\n */\n\nimport { getMarkerObject } from './utils';\n\n/**\n * An object to receive callbacks on mouse drag events. Each function is\n * called with the current mouse X position, relative to the stage's\n * container HTML element.\n *\n * @typedef {Object} MouseDragHandlers\n * @global\n * @property {Function} onMouseDown Mouse down event handler.\n * @property {Function} onMouseMove Mouse move event handler.\n * @property {Function} onMouseUp Mouse up event handler.\n */\n\n/**\n * Creates a handler for mouse events to allow interaction with the waveform\n * views by clicking and dragging the mouse.\n *\n * @class\n * @alias MouseDragHandler\n *\n * @param {Konva.Stage} stage\n * @param {MouseDragHandlers} handlers\n */\n\nfunction MouseDragHandler(stage, handlers) {\n  this._stage     = stage;\n  this._handlers  = handlers;\n  this._dragging  = false;\n  this._mouseDown = this._mouseDown.bind(this);\n  this._mouseUp   = this._mouseUp.bind(this);\n  this._mouseMove = this._mouseMove.bind(this);\n\n  this._stage.on('mousedown', this._mouseDown);\n  this._stage.on('touchstart', this._mouseDown);\n\n  this._lastMouseClientX = null;\n}\n\n/**\n * Mouse down event handler.\n *\n * @param {MouseEvent} event\n */\n\nMouseDragHandler.prototype._mouseDown = function(event) {\n  let segment = null;\n\n  if (event.type === 'mousedown' && event.evt.button !== 0) {\n    // Mouse drag only applies to the primary mouse button.\n    // The secondary button may be used to show a context menu\n    // and we don't want to also treat this as a mouse drag operation.\n    return;\n  }\n\n  const marker = getMarkerObject(event.target);\n\n  if (marker && marker.attrs.draggable) {\n    // Avoid interfering with drag/drop of point and segment markers.\n    if (marker.attrs.name === 'point-marker' ||\n        marker.attrs.name === 'segment-marker') {\n      return;\n    }\n\n    // Check if we're dragging a segment.\n    if (marker.attrs.name === 'segment-overlay') {\n      segment = marker;\n    }\n  }\n\n  this._lastMouseClientX = Math.floor(\n    event.type === 'touchstart' ? event.evt.touches[0].clientX : event.evt.clientX\n  );\n\n  if (this._handlers.onMouseDown) {\n    const mouseDownPosX = this._getMousePosX(this._lastMouseClientX);\n\n    this._handlers.onMouseDown(mouseDownPosX, segment);\n  }\n\n  // Use the window mousemove and mouseup handlers instead of the\n  // Konva.Stage ones so that we still receive events if the user moves the\n  // mouse outside the stage.\n  window.addEventListener('mousemove', this._mouseMove, { capture: false, passive: true });\n  window.addEventListener('touchmove', this._mouseMove, { capture: false, passive: true });\n  window.addEventListener('mouseup', this._mouseUp, { capture: false, passive: true });\n  window.addEventListener('touchend', this._mouseUp, { capture: false, passive: true });\n  window.addEventListener('blur', this._mouseUp, { capture: false, passive: true });\n};\n\n/**\n * Mouse move event handler.\n *\n * @param {MouseEvent} event\n */\n\nMouseDragHandler.prototype._mouseMove = function(event) {\n  const clientX = Math.floor(\n    event.type === 'touchmove' ? event.changedTouches[0].clientX : event.clientX\n  );\n\n  // Don't update on vertical mouse movement.\n  if (clientX === this._lastMouseClientX) {\n    return;\n  }\n\n  this._lastMouseClientX = clientX;\n\n  this._dragging = true;\n\n  if (this._handlers.onMouseMove) {\n    const mousePosX = this._getMousePosX(clientX);\n\n    this._handlers.onMouseMove(mousePosX);\n  }\n};\n\n/**\n * Mouse up event handler.\n *\n * @param {MouseEvent} event\n */\n\nMouseDragHandler.prototype._mouseUp = function(event) {\n  let clientX;\n\n  if (event.type === 'touchend') {\n    clientX = Math.floor(event.changedTouches[0].clientX);\n\n    if (event.cancelable) {\n      event.preventDefault();\n    }\n  }\n  else {\n    clientX = Math.floor(event.clientX);\n  }\n\n  if (this._handlers.onMouseUp) {\n    const mousePosX = this._getMousePosX(clientX);\n\n    this._handlers.onMouseUp(mousePosX);\n  }\n\n  window.removeEventListener('mousemove', this._mouseMove, { capture: false });\n  window.removeEventListener('touchmove', this._mouseMove, { capture: false });\n  window.removeEventListener('mouseup', this._mouseUp, { capture: false });\n  window.removeEventListener('touchend', this._mouseUp, { capture: false });\n  window.removeEventListener('blur', this._mouseUp, { capture: false });\n\n  this._dragging = false;\n};\n\n/**\n * @returns {Number} The mouse X position, relative to the container that\n * received the mouse down event.\n *\n * @private\n * @param {Number} clientX Mouse client X position.\n */\n\nMouseDragHandler.prototype._getMousePosX = function(clientX) {\n  const containerPos = this._stage.getContainer().getBoundingClientRect();\n\n  return clientX - containerPos.left;\n};\n\n/**\n * Returns <code>true</code> if the mouse is being dragged, i.e., moved with\n * the mouse button held down.\n *\n * @returns {Boolean}\n */\n\nMouseDragHandler.prototype.isDragging = function() {\n  return this._dragging;\n};\n\nexport default MouseDragHandler;\n","/**\n * @file\n *\n * Defines the {@link PlayheadLayer} class.\n *\n * @module playhead-layer\n */\n\nimport Konva from 'konva/lib/Core';\nimport { Animation } from 'konva/lib/Animation';\nimport { Line } from 'konva/lib/shapes/Line';\nimport { Text } from 'konva/lib/shapes/Text';\n\n/**\n * Creates a Konva.Layer that displays a playhead marker.\n *\n * @class\n * @alias PlayheadLayer\n *\n * @param {Object} options\n * @param {Player} options.player\n * @param {WaveformOverview|WaveformZoomView} options.view\n * @param {Boolean} options.showPlayheadTime If <code>true</code> The playback time position\n *   is shown next to the playhead.\n * @param {String} options.playheadColor\n * @param {String} options.playheadTextColor\n * @param {String} options.playheadFontFamily\n * @param {Number} options.playheadFontSize\n * @param {String} options.playheadFontStyle\n */\n\nfunction PlayheadLayer(options) {\n  this._player = options.player;\n  this._view = options.view;\n  this._playheadPixel = 0;\n  this._playheadLineAnimation = null;\n  this._playheadVisible = false;\n  this._playheadColor = options.playheadColor;\n  this._playheadTextColor = options.playheadTextColor;\n\n  this._playheadFontFamily = options.playheadFontFamily;\n  this._playheadFontSize = options.playheadFontSize;\n  this._playheadFontStyle = options.playheadFontStyle;\n\n  this._playheadLayer = new Konva.Layer();\n\n  this._createPlayhead(this._playheadColor);\n\n  if (options.showPlayheadTime) {\n    this._createPlayheadText(this._playheadTextColor);\n  }\n\n  this.fitToView();\n\n  this.zoomLevelChanged();\n}\n\n/**\n * Adds the layer to the given {Konva.Stage}.\n *\n * @param {Konva.Stage} stage\n */\n\nPlayheadLayer.prototype.addToStage = function(stage) {\n  stage.add(this._playheadLayer);\n};\n\n/**\n * Decides whether to use an animation to update the playhead position.\n *\n * If the zoom level is such that the number of pixels per second of audio is\n * low, we can use timeupdate events from the HTMLMediaElement to\n * set the playhead position. Otherwise, we use an animation to update the\n * playhead position more smoothly. The animation is CPU intensive, so we\n * avoid using it where possible.\n */\n\nPlayheadLayer.prototype.zoomLevelChanged = function() {\n  const pixelsPerSecond = this._view.timeToPixels(1.0);\n\n  this._useAnimation = pixelsPerSecond >= 5;\n\n  if (this._useAnimation) {\n    if (this._player.isPlaying() && !this._playheadLineAnimation) {\n      // Start the animation\n      this._start();\n    }\n  }\n  else {\n    if (this._playheadLineAnimation) {\n      // Stop the animation\n      const time = this._player.getCurrentTime();\n\n      this.stop(time);\n    }\n  }\n};\n\n/**\n * Resizes the playhead UI objects to fit the available space in the\n * view.\n */\n\nPlayheadLayer.prototype.fitToView = function() {\n  const height = this._view.getHeight();\n\n  this._playheadLine.points([0.5, 0, 0.5, height]);\n\n  if (this._playheadText) {\n    this._playheadText.y(12);\n  }\n};\n\n/**\n * Creates the playhead UI objects.\n *\n * @private\n * @param {String} color\n */\n\nPlayheadLayer.prototype._createPlayhead = function(color) {\n  // Create with default points, the real values are set in fitToView().\n  this._playheadLine = new Line({\n    stroke:      color,\n    strokeWidth: 1\n  });\n\n  this._playheadGroup = new Konva.Group({\n    x: 0,\n    y: 0\n  });\n\n  this._playheadGroup.add(this._playheadLine);\n  this._playheadLayer.add(this._playheadGroup);\n};\n\nPlayheadLayer.prototype._createPlayheadText = function(color) {\n  const time = this._player.getCurrentTime();\n  const text = this._view.formatTime(time);\n\n  // Create with default y, the real value is set in fitToView().\n  this._playheadText = new Text({\n    x: 2,\n    y: 0,\n    text: text,\n    fontSize: this._playheadFontSize,\n    fontFamily: this._playheadFontFamily,\n    fontStyle: this._playheadFontStyle,\n    fill: color,\n    align: 'right'\n  });\n\n  this._playheadGroup.add(this._playheadText);\n};\n\n/**\n * Updates the playhead position.\n *\n * @param {Number} time Current playhead position, in seconds.\n */\n\nPlayheadLayer.prototype.updatePlayheadTime = function(time) {\n  this._syncPlayhead(time);\n\n  if (this._player.isPlaying()) {\n    this._start();\n  }\n};\n\n/**\n * Updates the playhead position.\n *\n * @private\n * @param {Number} time Current playhead position, in seconds.\n */\n\nPlayheadLayer.prototype._syncPlayhead = function(time) {\n  const pixelIndex = this._view.timeToPixels(time);\n\n  const frameOffset = this._view.getFrameOffset();\n  const width = this._view.getWidth();\n\n  const isVisible = (pixelIndex >= frameOffset) &&\n                    (pixelIndex <= frameOffset + width);\n\n  this._playheadPixel = pixelIndex;\n\n  if (isVisible) {\n    const playheadX = this._playheadPixel - frameOffset;\n\n    if (!this._playheadVisible) {\n      this._playheadVisible = true;\n      this._playheadGroup.show();\n    }\n\n    this._playheadGroup.setX(playheadX);\n\n    if (this._playheadText) {\n      const text = this._view.formatTime(time);\n      const playheadTextWidth = this._playheadText.getTextWidth();\n\n      this._playheadText.setText(text);\n\n      if (playheadTextWidth + playheadX > width - 2) {\n        this._playheadText.setX(-playheadTextWidth - 2);\n      }\n      else if (playheadTextWidth + playheadX < width) {\n        this._playheadText.setX(2);\n      }\n    }\n  }\n  else {\n    if (this._playheadVisible) {\n      this._playheadVisible = false;\n      this._playheadGroup.hide();\n    }\n  }\n\n  if (this._view.playheadPosChanged) {\n    this._view.playheadPosChanged(time);\n  }\n};\n\n/**\n * Starts a playhead animation in sync with the media playback.\n *\n * @private\n */\n\nPlayheadLayer.prototype._start = function() {\n  const self = this;\n\n  if (self._playheadLineAnimation) {\n    self._playheadLineAnimation.stop();\n    self._playheadLineAnimation = null;\n  }\n\n  if (!self._useAnimation) {\n    return;\n  }\n\n  let lastPlayheadPosition = null;\n\n  self._playheadLineAnimation = new Animation(function() {\n    const time = self._player.getCurrentTime();\n    const playheadPosition = self._view.timeToPixels(time);\n\n    if (playheadPosition !== lastPlayheadPosition) {\n      self._syncPlayhead(time);\n      lastPlayheadPosition = playheadPosition;\n    }\n  }, self._playheadLayer);\n\n  self._playheadLineAnimation.start();\n};\n\nPlayheadLayer.prototype.stop = function(time) {\n  if (this._playheadLineAnimation) {\n    this._playheadLineAnimation.stop();\n    this._playheadLineAnimation = null;\n  }\n\n  this._syncPlayhead(time);\n};\n\n/**\n * Returns the position of the playhead marker, in pixels relative to the\n * left hand side of the waveform view.\n *\n * @return {Number}\n */\n\nPlayheadLayer.prototype.getPlayheadOffset = function() {\n  return this._playheadPixel - this._view.getFrameOffset();\n};\n\nPlayheadLayer.prototype.getPlayheadPixel = function() {\n  return this._playheadPixel;\n};\n\nPlayheadLayer.prototype.showPlayheadTime = function(show) {\n  if (show) {\n    if (!this._playheadText) {\n      // Create it\n      this._createPlayheadText(this._playheadTextColor);\n      this.fitToView();\n    }\n  }\n  else {\n    if (this._playheadText) {\n      this._playheadText.remove();\n      this._playheadText.destroy();\n      this._playheadText = null;\n    }\n  }\n};\n\nPlayheadLayer.prototype.updatePlayheadText = function() {\n  if (this._playheadText) {\n    const time = this._player.getCurrentTime();\n    const text = this._view.formatTime(time);\n\n    this._playheadText.setText(text);\n  }\n};\n\nPlayheadLayer.prototype.destroy = function() {\n  if (this._playheadLineAnimation) {\n    this._playheadLineAnimation.stop();\n    this._playheadLineAnimation = null;\n  }\n};\n\nexport default PlayheadLayer;\n","/**\n * @file\n *\n * Defines the {@link PointMarker} class.\n *\n * @module point-marker\n */\n\nimport Konva from 'konva/lib/Core';\n\n/**\n * Parameters for the {@link PointMarker} constructor.\n *\n * @typedef {Object} PointMarkerOptions\n * @global\n * @property {Point} point Point object with timestamp.\n * @property {Boolean} draggable If true, marker is draggable.\n * @property {Marker} marker\n * @property {Function} onclick\n * @property {Function} onDblClick\n * @property {Function} onDragStart\n * @property {Function} onDragMove Callback during mouse drag operations.\n * @property {Function} onDragEnd\n * @property {Function} dragBoundFunc\n * @property {Function} onMouseEnter\n * @property {Function} onMouseLeave\n * @property {Function} onContextMenu\n */\n\n/**\n * Creates a point marker handle.\n *\n * @class\n * @alias PointMarker\n *\n * @param {PointMarkerOptions} options\n */\n\nfunction PointMarker(options) {\n  this._point     = options.point;\n  this._marker    = options.marker;\n  this._draggable = options.draggable;\n\n  this._onDragStart   = options.onDragStart;\n  this._onDragMove    = options.onDragMove;\n  this._onDragEnd     = options.onDragEnd;\n  this._dragBoundFunc = options.dragBoundFunc;\n  this._onMouseEnter  = options.onMouseEnter;\n  this._onMouseLeave  = options.onMouseLeave;\n\n  this._group = new Konva.Group({\n    name:          'point-marker',\n    point:         this._point,\n    draggable:     this._draggable,\n    dragBoundFunc: options.dragBoundFunc\n  });\n\n  this._bindDefaultEventHandlers();\n\n  this._marker.init(this._group);\n}\n\nPointMarker.prototype._bindDefaultEventHandlers = function() {\n  const self = this;\n\n  self._group.on('dragstart', function(event) {\n    self._onDragStart(event, self._point);\n  });\n\n  self._group.on('dragmove', function(event) {\n    self._onDragMove(event, self._point);\n  });\n\n  self._group.on('dragend', function(event) {\n    self._onDragEnd(event, self._point);\n  });\n\n  self._group.on('mouseenter', function(event) {\n    self._onMouseEnter(event, self._point);\n  });\n\n  self._group.on('mouseleave', function(event) {\n    self._onMouseLeave(event, self._point);\n  });\n};\n\n/**\n * @param {Konva.Layer} layer\n */\n\nPointMarker.prototype.addToLayer = function(layer) {\n  layer.add(this._group);\n};\n\nPointMarker.prototype.fitToView = function() {\n  this._marker.fitToView();\n};\n\nPointMarker.prototype.getPoint = function() {\n  return this._point;\n};\n\nPointMarker.prototype.getX = function() {\n  return this._group.getX();\n};\n\nPointMarker.prototype.setX = function(x) {\n  this._group.setX(x);\n};\n\nPointMarker.prototype.getWidth = function() {\n  return this._group.getWidth();\n};\n\nPointMarker.prototype.getAbsolutePosition = function() {\n  return this._group.getAbsolutePosition();\n};\n\nPointMarker.prototype.timeUpdated = function(time) {\n  if (this._marker.timeUpdated) {\n    this._marker.timeUpdated(time);\n  }\n};\n\nPointMarker.prototype.update = function() {\n  if (this._marker.update) {\n    this._marker.update();\n  }\n};\n\nPointMarker.prototype.destroy = function() {\n  if (this._marker.destroy) {\n    this._marker.destroy();\n  }\n\n  this._group.destroyChildren();\n  this._group.destroy();\n};\n\nexport default PointMarker;\n","/**\n * @file\n *\n * Defines the {@link PointsLayer} class.\n *\n * @module points-layer\n */\n\nimport PointMarker from './point-marker';\nimport { clamp, objectHasProperty } from './utils';\nimport Konva from 'konva/lib/Core';\n\nconst defaultFontFamily = 'sans-serif';\nconst defaultFontSize = 10;\nconst defaultFontShape = 'normal';\n\n/**\n * Creates a Konva.Layer that displays point markers against the audio\n * waveform.\n *\n * @class\n * @alias PointsLayer\n *\n * @param {Peaks} peaks\n * @param {WaveformOverview|WaveformZoomView} view\n * @param {Boolean} allowEditing\n */\n\nfunction PointsLayer(peaks, view, allowEditing) {\n  this._peaks        = peaks;\n  this._view         = view;\n  this._allowEditing = allowEditing;\n  this._pointMarkers = {};\n  this._layer        = new Konva.Layer();\n\n  this._onPointsDrag = this._onPointsDrag.bind(this);\n\n  this._onPointMarkerDragStart   = this._onPointMarkerDragStart.bind(this);\n  this._onPointMarkerDragMove    = this._onPointMarkerDragMove.bind(this);\n  this._onPointMarkerDragEnd     = this._onPointMarkerDragEnd.bind(this);\n  this._pointMarkerDragBoundFunc = this._pointMarkerDragBoundFunc.bind(this);\n  this._onPointMarkerMouseEnter  = this._onPointMarkerMouseEnter.bind(this);\n  this._onPointMarkerMouseLeave  = this._onPointMarkerMouseLeave.bind(this);\n\n  this._onPointsUpdate    = this._onPointsUpdate.bind(this);\n  this._onPointsAdd       = this._onPointsAdd.bind(this);\n  this._onPointsRemove    = this._onPointsRemove.bind(this);\n  this._onPointsRemoveAll = this._onPointsRemoveAll.bind(this);\n\n  this._peaks.on('points.update', this._onPointsUpdate);\n  this._peaks.on('points.add', this._onPointsAdd);\n  this._peaks.on('points.remove', this._onPointsRemove);\n  this._peaks.on('points.remove_all', this._onPointsRemoveAll);\n\n  this._peaks.on('points.dragstart', this._onPointsDrag);\n  this._peaks.on('points.dragmove', this._onPointsDrag);\n  this._peaks.on('points.dragend', this._onPointsDrag);\n}\n\n/**\n * Adds the layer to the given {Konva.Stage}.\n *\n * @param {Konva.Stage} stage\n */\n\nPointsLayer.prototype.addToStage = function(stage) {\n  stage.add(this._layer);\n};\n\nPointsLayer.prototype.enableEditing = function(enable) {\n  this._allowEditing = enable;\n};\n\nPointsLayer.prototype.formatTime = function(time) {\n  return this._view.formatTime(time);\n};\n\nPointsLayer.prototype._onPointsUpdate = function(point, options) {\n  const frameStartTime = this._view.getStartTime();\n  const frameEndTime   = this._view.getEndTime();\n\n  const pointMarker = this._pointMarkers[point.id];\n  const isVisible = point.isVisible(frameStartTime, frameEndTime);\n\n  if (pointMarker && !isVisible) {\n    // Remove point marker that is no longer visible.\n    this._removePoint(point);\n  }\n  else if (!pointMarker && isVisible) {\n    // Add point marker for visible point.\n    this._updatePoint(point);\n  }\n  else if (pointMarker && isVisible) {\n    // Update the point marker with the changed attributes.\n    if (objectHasProperty(options, 'time')) {\n      const pointMarkerOffset = this._view.timeToPixels(point.time);\n\n      const pointMarkerX = pointMarkerOffset - this._view.getFrameOffset();\n\n      pointMarker.setX(pointMarkerX);\n      pointMarker.timeUpdated(point.time);\n    }\n\n    pointMarker.update();\n  }\n};\n\nPointsLayer.prototype._onPointsAdd = function(points) {\n  const self = this;\n\n  const frameStartTime = self._view.getStartTime();\n  const frameEndTime   = self._view.getEndTime();\n\n  points.forEach(function(point) {\n    if (point.isVisible(frameStartTime, frameEndTime)) {\n      self._updatePoint(point);\n    }\n  });\n};\n\nPointsLayer.prototype._onPointsRemove = function(points) {\n  const self = this;\n\n  points.forEach(function(point) {\n    self._removePoint(point);\n  });\n};\n\nPointsLayer.prototype._onPointsRemoveAll = function() {\n  this._layer.removeChildren();\n  this._pointMarkers = {};\n};\n\n/**\n * Creates the Konva UI objects for a given point.\n *\n * @private\n * @param {Point} point\n * @returns {PointMarker}\n */\n\nPointsLayer.prototype._createPointMarker = function(point) {\n  const editable = this._allowEditing && point.editable;\n\n  const marker = this._peaks.options.createPointMarker({\n    point:      point,\n    draggable:  editable,\n    color:      point.color ? point.color : this._peaks.options.pointMarkerColor,\n    fontFamily: this._peaks.options.fontFamily || defaultFontFamily,\n    fontSize:   this._peaks.options.fontSize || defaultFontSize,\n    fontStyle:  this._peaks.options.fontStyle || defaultFontShape,\n    layer:      this,\n    view:       this._view.getName()\n  });\n\n  return new PointMarker({\n    point:         point,\n    draggable:     editable,\n    marker:        marker,\n    onDragStart:   this._onPointMarkerDragStart,\n    onDragMove:    this._onPointMarkerDragMove,\n    onDragEnd:     this._onPointMarkerDragEnd,\n    dragBoundFunc: this._pointMarkerDragBoundFunc,\n    onMouseEnter:  this._onPointMarkerMouseEnter,\n    onMouseLeave:  this._onPointMarkerMouseLeave\n  });\n};\n\nPointsLayer.prototype.getHeight = function() {\n  return this._view.getHeight();\n};\n\n/**\n * Adds a Konva UI object to the layer for a given point.\n *\n * @private\n * @param {Point} point\n * @returns {PointMarker}\n */\n\nPointsLayer.prototype._addPointMarker = function(point) {\n  const pointMarker = this._createPointMarker(point);\n\n  this._pointMarkers[point.id] = pointMarker;\n\n  pointMarker.addToLayer(this._layer);\n\n  return pointMarker;\n};\n\nPointsLayer.prototype._onPointsDrag = function(event) {\n  const pointMarker = this._updatePoint(event.point);\n\n  pointMarker.timeUpdated(event.point.time);\n  pointMarker.update();\n};\n\n/**\n * @param {Point} point\n */\n\nPointsLayer.prototype._onPointMarkerDragMove = function(event, point) {\n  const pointMarker = this._pointMarkers[point.id];\n\n  const markerX = pointMarker.getX();\n\n  const offset = markerX + pointMarker.getWidth();\n\n  point._setTime(this._view.pixelOffsetToTime(offset));\n\n  this._peaks.emit('points.dragmove', {\n    point: point,\n    evt: event.evt\n  });\n};\n\n/**\n * @param {KonvaEventObject} event\n * @param {Point} point\n */\n\nPointsLayer.prototype._onPointMarkerMouseEnter = function(event, point) {\n  this._peaks.emit('points.mouseenter', {\n    point: point,\n    evt: event.evt\n  });\n};\n\n/**\n * @param {KonvaEventObject} event\n * @param {Point} point\n */\n\nPointsLayer.prototype._onPointMarkerMouseLeave = function(event, point) {\n  this._peaks.emit('points.mouseleave', {\n    point: point,\n    evt: event.evt\n  });\n};\n\n/**\n * @param {KonvaEventObject} event\n * @param {Point} point\n */\n\nPointsLayer.prototype._onPointMarkerDragStart = function(event, point) {\n  this._dragPointMarker = this._pointMarkers[point.id];\n\n  this._peaks.emit('points.dragstart', {\n    point: point,\n    evt: event.evt\n  });\n};\n\n/**\n * @param {KonvaEventObject} event\n * @param {Point} point\n */\n\nPointsLayer.prototype._onPointMarkerDragEnd = function(event, point) {\n  this._dragPointMarker = null;\n\n  this._peaks.emit('points.dragend', {\n    point: point,\n    evt: event.evt\n  });\n};\n\nPointsLayer.prototype._pointMarkerDragBoundFunc = function(pos) {\n  // Allow the marker to be moved horizontally but not vertically.\n  return {\n    x: clamp(pos.x, 0, this._view.getWidth()),\n    y: this._dragPointMarker.getAbsolutePosition().y\n  };\n};\n\n/**\n * Updates the positions of all displayed points in the view.\n *\n * @param {Number} startTime The start of the visible range in the view,\n *   in seconds.\n * @param {Number} endTime The end of the visible range in the view,\n *   in seconds.\n */\n\nPointsLayer.prototype.updatePoints = function(startTime, endTime) {\n  // Update all points in the visible time range.\n  const points = this._peaks.points.find(startTime, endTime);\n\n  points.forEach(this._updatePoint.bind(this));\n\n  // TODO: In the overview all points are visible, so no need to do this.\n  this._removeInvisiblePoints(startTime, endTime);\n};\n\n/**\n * @private\n * @param {Point} point\n */\n\nPointsLayer.prototype._updatePoint = function(point) {\n  const pointMarker = this._findOrAddPointMarker(point);\n\n  const pointMarkerOffset = this._view.timeToPixels(point.time);\n  const pointMarkerX = pointMarkerOffset - this._view.getFrameOffset();\n\n  pointMarker.setX(pointMarkerX);\n\n  return pointMarker;\n};\n\n/**\n * @private\n * @param {Point} point\n * @return {PointMarker}\n */\n\nPointsLayer.prototype._findOrAddPointMarker = function(point) {\n  let pointMarker = this._pointMarkers[point.id];\n\n  if (!pointMarker) {\n    pointMarker = this._addPointMarker(point);\n  }\n\n  return pointMarker;\n};\n\n/**\n * Remove any points that are not visible, i.e., are outside the given time\n * range.\n *\n * @private\n * @param {Number} startTime The start of the visible time range, in seconds.\n * @param {Number} endTime The end of the visible time range, in seconds.\n */\n\nPointsLayer.prototype._removeInvisiblePoints = function(startTime, endTime) {\n  for (const pointId in this._pointMarkers) {\n    if (objectHasProperty(this._pointMarkers, pointId)) {\n      const point = this._pointMarkers[pointId].getPoint();\n\n      if (!point.isVisible(startTime, endTime)) {\n        this._removePoint(point);\n      }\n    }\n  }\n};\n\n/**\n * Removes the UI object for a given point.\n *\n * @private\n * @param {Point} point\n */\n\nPointsLayer.prototype._removePoint = function(point) {\n  const pointMarker = this._pointMarkers[point.id];\n\n  if (pointMarker) {\n    pointMarker.destroy();\n    delete this._pointMarkers[point.id];\n  }\n};\n\n/**\n * Toggles visibility of the points layer.\n *\n * @param {Boolean} visible\n */\n\nPointsLayer.prototype.setVisible = function(visible) {\n  this._layer.setVisible(visible);\n};\n\nPointsLayer.prototype.destroy = function() {\n  this._peaks.off('points.update', this._onPointsUpdate);\n  this._peaks.off('points.add', this._onPointsAdd);\n  this._peaks.off('points.remove', this._onPointsRemove);\n  this._peaks.off('points.remove_all', this._onPointsRemoveAll);\n  this._peaks.off('points.dragstart', this._onPointsDrag);\n  this._peaks.off('points.dragmove', this._onPointsDrag);\n  this._peaks.off('points.dragend', this._onPointsDrag);\n};\n\nPointsLayer.prototype.fitToView = function() {\n  for (const pointId in this._pointMarkers) {\n    if (objectHasProperty(this._pointMarkers, pointId)) {\n      const pointMarker = this._pointMarkers[pointId];\n\n      pointMarker.fitToView();\n    }\n  }\n};\n\nPointsLayer.prototype.draw = function() {\n  this._layer.draw();\n};\n\nexport default PointsLayer;\n","/**\n * @file\n *\n * Defines the {@link OverlaySegmentMarker} class.\n *\n * @module overlay-segment-marker\n */\n\nimport { Rect } from 'konva/lib/shapes/Rect';\nimport { Text } from 'konva/lib/shapes/Text';\n\nimport { clamp } from './utils';\n\n/**\n * Creates a segment marker handle.\n *\n * @class\n * @alias OverlaySegmentMarker\n *\n * @param {CreateSegmentMarkerOptions} options\n */\n\nfunction OverlaySegmentMarker(options) {\n  this._options = options;\n}\n\nOverlaySegmentMarker.prototype.init = function(group) {\n  const handleWidth  = 10;\n  const handleHeight = 20;\n  const handleX      = -(handleWidth / 2) + 0.5; // Place in the middle of the marker\n\n  const xPosition = this._options.startMarker ? -24 : 24;\n\n  const time = this._options.startMarker ? this._options.segment.startTime :\n                                           this._options.segment.endTime;\n\n  // Label - create with default y, the real value is set in fitToView().\n  this._label = new Text({\n    x:          xPosition,\n    y:          0,\n    text:       this._options.layer.formatTime(time),\n    fontFamily: this._options.fontFamily,\n    fontSize:   this._options.fontSize,\n    fontStyle:  this._options.fontStyle,\n    fill:       '#000',\n    textAlign:  'center'\n  });\n\n  this._label.hide();\n\n  // Handle - create with default y, the real value is set in fitToView().\n  this._handle = new Rect({\n    x:      handleX,\n    y:      0,\n    width:  handleWidth,\n    height: handleHeight\n  });\n\n  group.add(this._label);\n  group.add(this._handle);\n\n  this.fitToView();\n\n  this.bindEventHandlers(group);\n};\n\nOverlaySegmentMarker.prototype.bindEventHandlers = function(group) {\n  const self = this;\n\n  const xPosition = self._options.startMarker ? -24 : 24;\n\n  if (self._options.draggable) {\n    group.on('dragstart', function() {\n      if (self._options.startMarker) {\n        self._label.setX(xPosition - self._label.getWidth());\n      }\n\n      self._label.show();\n    });\n\n    group.on('dragend', function() {\n      self._label.hide();\n    });\n  }\n\n  self._handle.on('mouseover touchstart', function() {\n    if (self._options.startMarker) {\n      self._label.setX(xPosition - self._label.getWidth());\n    }\n\n    self._label.show();\n\n    document.body.style.cursor = 'ew-resize';\n  });\n\n  self._handle.on('mouseout touchend', function() {\n    self._label.hide();\n\n    document.body.style.cursor = 'default';\n  });\n};\n\nOverlaySegmentMarker.prototype.fitToView = function() {\n  const viewHeight = this._options.layer.getHeight();\n\n  const overlayOffset = this._options.segmentOptions.overlayOffset;\n  const overlayRectHeight = clamp(0, viewHeight - 2 * overlayOffset);\n\n  this._label.y(viewHeight / 2 - 5);\n  this._handle.y(overlayOffset);\n  this._handle.height(overlayRectHeight);\n};\n\nOverlaySegmentMarker.prototype.timeUpdated = function(time) {\n  this._label.setText(this._options.layer.formatTime(time));\n};\n\nexport default OverlaySegmentMarker;\n","/**\n * @file\n *\n * Defines the {@link SegmentMarker} class.\n *\n * @module segment-marker\n */\n\nimport Konva from 'konva/lib/Core';\n\n/**\n * Parameters for the {@link SegmentMarker} constructor.\n *\n * @typedef {Object} SegmentMarkerOptions\n * @global\n * @property {Segment} segment\n * @property {SegmentShape} segmentShape\n * @property {Boolean} draggable If true, marker is draggable.\n * @property {Boolean} startMarker If <code>true</code>, the marker indicates\n *   the start time of the segment. If <code>false</code>, the marker\n *   indicates the end time of the segment.\n * @property {Function} onDragStart\n * @property {Function} onDragMove\n * @property {Function} onDragEnd\n * @property {Function} dragBoundFunc\n */\n\n/**\n * Creates a segment handle marker for the start or end of a segment.\n *\n * @class\n * @alias SegmentMarker\n *\n * @param {SegmentMarkerOptions} options\n */\n\nfunction SegmentMarker(options) {\n  const self = this;\n\n  self._segment       = options.segment;\n  self._marker        = options.marker;\n  self._segmentShape  = options.segmentShape;\n  self._draggable     = options.draggable;\n  self._startMarker   = options.startMarker;\n\n  self._onDragStart   = options.onDragStart;\n  self._onDragMove    = options.onDragMove;\n  self._onDragEnd     = options.onDragEnd;\n\n  self._group = new Konva.Group({\n    name:          'segment-marker',\n    segment:       self._segment,\n    draggable:     self._draggable,\n    dragBoundFunc: function(pos) {\n      return options.dragBoundFunc(self, pos);\n    }\n  });\n\n  self._bindDefaultEventHandlers();\n\n  self._marker.init(self._group);\n}\n\nSegmentMarker.prototype._bindDefaultEventHandlers = function() {\n  const self = this;\n\n  if (self._draggable) {\n    self._group.on('dragstart', function(event) {\n      self._onDragStart(self, event);\n    });\n\n    self._group.on('dragmove', function(event) {\n      self._onDragMove(self, event);\n    });\n\n    self._group.on('dragend', function(event) {\n      self._onDragEnd(self, event);\n    });\n  }\n};\n\nSegmentMarker.prototype.addToLayer = function(layer) {\n  layer.add(this._group);\n};\n\nSegmentMarker.prototype.moveToTop = function() {\n  this._group.moveToTop();\n};\n\nSegmentMarker.prototype.fitToView = function() {\n  this._marker.fitToView();\n};\n\nSegmentMarker.prototype.getSegment = function() {\n  return this._segment;\n};\n\nSegmentMarker.prototype.getX = function() {\n  return this._group.getX();\n};\n\nSegmentMarker.prototype.setX = function(x) {\n  this._group.setX(x);\n};\n\nSegmentMarker.prototype.getWidth = function() {\n  return this._group.getWidth();\n};\n\nSegmentMarker.prototype.getAbsolutePosition = function() {\n  return this._group.getAbsolutePosition();\n};\n\nSegmentMarker.prototype.isStartMarker = function() {\n  return this._startMarker;\n};\n\nSegmentMarker.prototype.update = function(options) {\n  if (this._marker.update) {\n    this._marker.update(options);\n  }\n};\n\nSegmentMarker.prototype.destroy = function() {\n  if (this._marker.destroy) {\n    this._marker.destroy();\n  }\n\n  this._group.destroyChildren();\n  this._group.destroy();\n};\n\nSegmentMarker.prototype.startDrag = function() {\n  this._group.startDrag();\n};\n\nSegmentMarker.prototype.stopDrag = function() {\n  this._group.stopDrag();\n};\n\nexport default SegmentMarker;","/**\n * @file\n *\n * Defines the {@link WaveformShape} class.\n *\n * @module waveform-shape\n */\n\nimport { clamp, isLinearGradientColor, isString } from './utils';\nimport Konva from 'konva/lib/Core';\n\n/**\n * Waveform shape options.\n *\n * @typedef {Object} WaveformShapeOptions\n * @global\n * @property {String | LinearGradientColor} color Waveform color.\n * @property {WaveformOverview|WaveformZoomView} view The view object\n *   that contains the waveform shape.\n * @property {Segment?} segment If given, render a waveform image\n *   covering the segment's time range. Otherwise, render the entire\n *   waveform duration.\n */\n\n/**\n * Creates a Konva.Shape object that renders a waveform image.\n *\n * @class\n * @alias WaveformShape\n *\n * @param {WaveformShapeOptions} options\n */\n\nfunction WaveformShape(options) {\n  this._color = options.color;\n\n  const shapeOptions = {};\n\n  if (isString(options.color)) {\n    shapeOptions.fill = options.color;\n  }\n  else if (isLinearGradientColor(options.color)) {\n    const startY = options.view._height * (options.color.linearGradientStart / 100);\n    const endY = options.view._height * (options.color.linearGradientEnd / 100);\n\n    shapeOptions.fillLinearGradientStartPointY = startY;\n    shapeOptions.fillLinearGradientEndPointY = endY;\n    shapeOptions.fillLinearGradientColorStops = [\n      0, options.color.linearGradientColorStops[0],\n      1, options.color.linearGradientColorStops[1]\n    ];\n  }\n  else {\n    throw new TypeError('Unknown type for color property');\n  }\n\n  this._shape = new Konva.Shape(shapeOptions);\n  this._view = options.view;\n  this._segment = options.segment;\n\n  this._shape.sceneFunc(this._sceneFunc.bind(this));\n}\n\nWaveformShape.prototype.getX = function() {\n  return this._shape.getX();\n};\n\nWaveformShape.prototype.setX = function(x) {\n  return this._shape.setX(x);\n};\n\nWaveformShape.prototype.setSegment = function(segment) {\n  this._segment = segment;\n};\n\nWaveformShape.prototype.setWaveformColor = function(color) {\n  if (isString(color)) {\n    this._shape.fill(color);\n\n    this._shape.fillLinearGradientStartPointY(null);\n    this._shape.fillLinearGradientEndPointY(null);\n    this._shape.fillLinearGradientColorStops(null);\n  }\n  else if (isLinearGradientColor(color)) {\n    this._shape.fill(null);\n\n    const startY = this._view._height * (color.linearGradientStart / 100);\n    const endY = this._view._height * (color.linearGradientEnd / 100);\n\n    this._shape.fillLinearGradientStartPointY(startY);\n    this._shape.fillLinearGradientEndPointY(endY);\n    this._shape.fillLinearGradientColorStops([\n      0, color.linearGradientColorStops[0],\n      1, color.linearGradientColorStops[1]\n    ]);\n  }\n  else {\n    throw new TypeError('Unknown type for color property');\n  }\n};\n\nWaveformShape.prototype.fitToView = function() {\n  this.setWaveformColor(this._color);\n};\n\nWaveformShape.prototype._sceneFunc = function(context) {\n  const frameOffset = this._view.getFrameOffset();\n  const width = this._view.getWidth();\n  const height = this._view.getHeight();\n\n  this._drawWaveform(\n    context,\n    this._view.getWaveformData(),\n    frameOffset,\n    this._segment ? this._view.timeToPixels(this._segment.startTime) : frameOffset,\n    this._segment ? this._view.timeToPixels(this._segment.endTime)   : frameOffset + width,\n    width,\n    height\n  );\n};\n\n/**\n * Draws a waveform on a canvas context.\n *\n * @param {Konva.Context} context The canvas context to draw on.\n * @param {WaveformData} waveformData The waveform data to draw.\n * @param {Number} frameOffset The start position of the waveform shown\n *   in the view, in pixels.\n * @param {Number} startPixels The start position of the waveform to draw,\n *   in pixels.\n * @param {Number} endPixels The end position of the waveform to draw,\n *   in pixels.\n * @param {Number} width The width of the waveform area, in pixels.\n * @param {Number} height The height of the waveform area, in pixels.\n */\n\nWaveformShape.prototype._drawWaveform = function(context, waveformData,\n    frameOffset, startPixels, endPixels, width, height) {\n  if (startPixels < frameOffset) {\n    startPixels = frameOffset;\n  }\n\n  const limit = frameOffset + width;\n\n  if (endPixels > limit) {\n    endPixels = limit;\n  }\n\n  if (endPixels > waveformData.length - 1) {\n    endPixels = waveformData.length - 1;\n  }\n\n  const channels = waveformData.channels;\n\n  let waveformTop = 0;\n  let waveformHeight = Math.floor(height / channels);\n\n  for (let i = 0; i < channels; i++) {\n    if (i === channels - 1) {\n      waveformHeight = height - (channels - 1) * waveformHeight;\n    }\n\n    this._drawChannel(\n      context,\n      waveformData.channel(i),\n      frameOffset,\n      startPixels,\n      endPixels,\n      waveformTop,\n      waveformHeight\n    );\n\n    waveformTop += waveformHeight;\n  }\n};\n\n/**\n * Draws a single waveform channel on a canvas context.\n *\n * @param {Konva.Context} context The canvas context to draw on.\n * @param {WaveformDataChannel} channel The waveform data to draw.\n * @param {Number} frameOffset The start position of the waveform shown\n *   in the view, in pixels.\n * @param {Number} startPixels The start position of the waveform to draw,\n *   in pixels.\n * @param {Number} endPixels The end position of the waveform to draw,\n *   in pixels.\n * @param {Number} top The top of the waveform channel area, in pixels.\n * @param {Number} height The height of the waveform channel area, in pixels.\n */\n\nWaveformShape.prototype._drawChannel = function(context, channel,\n    frameOffset, startPixels, endPixels, top, height) {\n  let x, amplitude;\n\n  const amplitudeScale = this._view.getAmplitudeScale();\n\n  let lineX, lineY;\n\n  context.beginPath();\n\n  for (x = startPixels; x <= endPixels; x++) {\n    amplitude = channel.min_sample(x);\n\n    lineX = x - frameOffset + 0.5;\n    lineY = top + WaveformShape.scaleY(amplitude, height, amplitudeScale) + 0.5;\n\n    context.lineTo(lineX, lineY);\n  }\n\n  for (x = endPixels; x >= startPixels; x--) {\n    amplitude = channel.max_sample(x);\n\n    lineX = x - frameOffset + 0.5;\n    lineY = top + WaveformShape.scaleY(amplitude, height, amplitudeScale) + 1.0;\n\n    context.lineTo(lineX, lineY);\n  }\n\n  context.closePath();\n\n  context.fillShape(this._shape);\n};\n\nWaveformShape.prototype.addToLayer = function(layer) {\n  layer.add(this._shape);\n};\n\nWaveformShape.prototype.destroy = function() {\n  this._shape.destroy();\n  this._shape = null;\n};\n\nWaveformShape.prototype.on = function(event, handler) {\n  this._shape.on(event, handler);\n};\n\nWaveformShape.prototype.off = function(event, handler) {\n  this._shape.off(event, handler);\n};\n\n/**\n * Scales the waveform data for drawing on a canvas context.\n *\n * @see {@link https://stats.stackexchange.com/questions/281162}\n *\n * @todo Assumes 8-bit waveform data (-128 to 127 range)\n *\n * @param {Number} amplitude The waveform data point amplitude.\n * @param {Number} height The height of the waveform, in pixels.\n * @param {Number} scale Amplitude scaling factor.\n * @returns {Number} The scaled waveform data point.\n */\n\nWaveformShape.scaleY = function(amplitude, height, scale) {\n  const y = -(height - 1) * (amplitude * scale + 128) / 255 + (height - 1);\n\n  return clamp(Math.floor(y), 0, height - 1);\n};\n\nexport default WaveformShape;\n","/**\n * @file\n *\n * Defines the {@link SegmentShape} class.\n *\n * @module segment-shape\n */\n\nimport Konva from 'konva/lib/Core';\n\nimport OverlaySegmentMarker from './overlay-segment-marker';\nimport SegmentMarker from './segment-marker';\nimport WaveformShape from './waveform-shape';\nimport { clamp } from './utils';\n\nconst defaultFontFamily = 'sans-serif';\nconst defaultFontSize = 10;\nconst defaultFontShape = 'normal';\n\n/**\n * Options that control segments' visual appearance\n *\n * @typedef {Object} SegmentDisplayOptions\n * @global\n * @property {Boolean} markers\n * @property {Boolean} overlay\n * @property {String} startMarkerColor\n * @property {String} endMarkerColor\n * @property {String} waveformColor\n * @property {String} overlayColor\n * @property {Number} overlayOpacity\n * @property {String} overlayBorderColor\n * @property {Number} overlayBorderWidth\n * @property {Number} overlayCornerRadius\n * @property {Number} overlayOffset\n * @property {String} overlayLabelAlign\n * @property {String} overlayLabelVerticalAlign\n * @property {Number} overlayLabelPadding\n * @property {String} overlayLabelColor\n * @property {String} overlayFontFamily\n * @property {Number} overlayFontSize\n * @property {String} overlayFontStyle\n */\n\n/**\n * Creates a waveform segment shape with optional start and end markers.\n *\n * @class\n * @alias SegmentShape\n *\n * @param {Segment} segment\n * @param {Peaks} peaks\n * @param {SegmentsLayer} layer\n * @param {WaveformOverview|WaveformZoomView} view\n */\n\nfunction SegmentShape(segment, peaks, layer, view) {\n  this._segment     = segment;\n  this._peaks       = peaks;\n  this._layer       = layer;\n  this._view        = view;\n  this._label       = null;\n  this._startMarker = null;\n  this._endMarker   = null;\n  this._color       = segment.color;\n  this._borderColor = segment.borderColor;\n  this._draggable   = this._segment.editable && this._view.isSegmentDraggingEnabled();\n  this._dragging    = false;\n\n  const segmentOptions = view.getViewOptions().segmentOptions;\n\n  this._overlayOffset = segmentOptions.overlayOffset;\n\n  if (!segmentOptions.overlay) {\n    this._waveformShape = new WaveformShape({\n      color:   segment.color,\n      view:    view,\n      segment: segment\n    });\n  }\n\n  this._onMouseEnter  = this._onMouseEnter.bind(this);\n  this._onMouseLeave  = this._onMouseLeave.bind(this);\n  this._onMouseDown   = this._onMouseDown.bind(this);\n  this._onMouseUp     = this._onMouseUp.bind(this);\n\n  this._dragBoundFunc      = this._dragBoundFunc.bind(this);\n  this._onSegmentDragStart = this._onSegmentDragStart.bind(this);\n  this._onSegmentDragMove  = this._onSegmentDragMove.bind(this);\n  this._onSegmentDragEnd   = this._onSegmentDragEnd.bind(this);\n\n  // Event handlers for markers\n  this._onSegmentMarkerDragStart   = this._onSegmentMarkerDragStart.bind(this);\n  this._onSegmentMarkerDragMove    = this._onSegmentMarkerDragMove.bind(this);\n  this._onSegmentMarkerDragEnd     = this._onSegmentMarkerDragEnd.bind(this);\n  this._segmentMarkerDragBoundFunc = this._segmentMarkerDragBoundFunc.bind(this);\n\n  this._label = this._peaks.options.createSegmentLabel({\n    segment:    segment,\n    view:       this._view.getName(),\n    layer:      this._layer,\n    fontFamily: this._peaks.options.fontFamily,\n    fontSize:   this._peaks.options.fontSize,\n    fontStyle:  this._peaks.options.fontStyle\n  });\n\n  if (this._label) {\n    this._label.hide();\n  }\n\n  // Create with default y and height, the real values are set in fitToView().\n  const segmentStartOffset = this._view.timeToPixelOffset(this._segment.startTime);\n  const segmentEndOffset   = this._view.timeToPixelOffset(this._segment.endTime);\n\n  const overlayRectHeight = clamp(0, this._view.getHeight() - 2 * this._overlayOffset);\n\n  // The clip rectangle prevents text in the overlay from appearing\n  // outside the overlay.\n\n  this._overlay = new Konva.Group({\n    name:          'segment-overlay',\n    segment:       this._segment,\n    x:             segmentStartOffset,\n    y:             0,\n    width:         segmentEndOffset - segmentStartOffset,\n    height:        this._view.getHeight(),\n    clipX:         0,\n    clipY:         this._overlayOffset,\n    clipWidth:     segmentEndOffset - segmentStartOffset,\n    clipHeight:    overlayRectHeight,\n    draggable:     this._draggable,\n    dragBoundFunc: this._dragBoundFunc\n  });\n\n  let overlayBorderColor, overlayBorderWidth, overlayColor, overlayOpacity, overlayCornerRadius;\n\n  if (segmentOptions.overlay) {\n    overlayBorderColor  = this._borderColor || segmentOptions.overlayBorderColor;\n    overlayBorderWidth  = segmentOptions.overlayBorderWidth;\n    overlayColor        = this._color || segmentOptions.overlayColor;\n    overlayOpacity      = segmentOptions.overlayOpacity;\n    overlayCornerRadius = segmentOptions.overlayCornerRadius;\n  }\n\n  this._overlayRect = new Konva.Rect({\n    x:            0,\n    y:            this._overlayOffset,\n    width:        segmentEndOffset - segmentStartOffset,\n    stroke:       overlayBorderColor,\n    strokeWidth:  overlayBorderWidth,\n    height:       overlayRectHeight,\n    fill:         overlayColor,\n    opacity:      overlayOpacity,\n    cornerRadius: overlayCornerRadius\n  });\n\n  this._overlay.add(this._overlayRect);\n\n  if (segmentOptions.overlay) {\n    this._overlayText = new Konva.Text({\n      x:             0,\n      y:             this._overlayOffset,\n      text:          this._segment.labelText,\n      fontFamily:    segmentOptions.overlayFontFamily,\n      fontSize:      segmentOptions.overlayFontSize,\n      fontStyle:     segmentOptions.overlayFontStyle,\n      fill:          segmentOptions.overlayLabelColor,\n      listening:     false,\n      align:         segmentOptions.overlayLabelAlign,\n      width:         segmentEndOffset - segmentStartOffset,\n      verticalAlign: segmentOptions.overlayLabelVerticalAlign,\n      height:        overlayRectHeight,\n      padding:       segmentOptions.overlayLabelPadding\n    });\n\n    this._overlay.add(this._overlayText);\n  }\n\n  // Set up event handlers to show/hide the segment label text when the user\n  // hovers the mouse over the segment.\n  this._overlay.on('mouseenter', this._onMouseEnter);\n  this._overlay.on('mouseleave', this._onMouseLeave);\n\n  this._overlay.on('mousedown', this._onMouseDown);\n  this._overlay.on('mouseup', this._onMouseUp);\n\n  if (this._draggable) {\n    this._overlay.on('dragstart', this._onSegmentDragStart);\n    this._overlay.on('dragmove', this._onSegmentDragMove);\n    this._overlay.on('dragend', this._onSegmentDragEnd);\n  }\n\n  this._createMarkers();\n}\n\nSegmentShape.prototype._dragBoundFunc = function(pos) {\n  // Allow the segment to be moved horizontally but not vertically.\n  return {\n    x: pos.x,\n    y: 0\n  };\n};\n\n/**\n * Update the segment shape after the segment's attributes have changed.\n */\n\nSegmentShape.prototype.update = function(options) {\n  const segmentStartOffset = this._view.timeToPixelOffset(this._segment.startTime);\n  const segmentEndOffset   = this._view.timeToPixelOffset(this._segment.endTime);\n  const width = segmentEndOffset - segmentStartOffset;\n  let marker;\n\n  if ((marker = this.getStartMarker())) {\n    marker.setX(segmentStartOffset - marker.getWidth());\n\n    if (options) {\n      marker.update(options);\n    }\n  }\n\n  if ((marker = this.getEndMarker())) {\n    marker.setX(segmentEndOffset);\n\n    if (options) {\n      marker.update(options);\n    }\n  }\n\n  this._color = this._segment.color;\n  this._borderColor = this._segment.bordercolor;\n\n  if (this._overlayText) {\n    this._overlayText.text(this._segment.labelText);\n  }\n\n  const segmentOptions = this._view.getViewOptions().segmentOptions;\n\n  if (segmentOptions.overlay) {\n    if (this._color) {\n      this._overlayRect.fill(this._color);\n    }\n\n    if (this._borderColor) {\n      this._overlayRect.stroke(this._borderColor);\n    }\n  }\n  else {\n    this._waveformShape.setWaveformColor(this._segment.color);\n  }\n\n  // While dragging, the overlay position is controlled in _onSegmentDragMove().\n\n  if (!this._dragging) {\n    if (this._overlay) {\n      this._overlay.setAttrs({\n        x:         segmentStartOffset,\n        width:     width,\n        clipWidth: width < 1 ? 1 : width\n      });\n\n      this._overlayRect.setAttrs({\n        x:     0,\n        width: width\n      });\n\n      if (this._overlayText) {\n        this._overlayText.setAttrs({\n          width: width\n        });\n      }\n    }\n  }\n};\n\nSegmentShape.prototype.getSegment = function() {\n  return this._segment;\n};\n\nSegmentShape.prototype.getStartMarker = function() {\n  return this._startMarker;\n};\n\nSegmentShape.prototype.getEndMarker = function() {\n  return this._endMarker;\n};\n\nSegmentShape.prototype.addToLayer = function(layer) {\n  if (this._waveformShape) {\n    this._waveformShape.addToLayer(layer);\n  }\n\n  if (this._label) {\n    layer.add(this._label);\n  }\n\n  if (this._overlay) {\n    layer.add(this._overlay);\n  }\n\n  if (this._startMarker) {\n    this._startMarker.addToLayer(layer);\n  }\n\n  if (this._endMarker) {\n    this._endMarker.addToLayer(layer);\n  }\n};\n\nSegmentShape.prototype.isDragging = function() {\n  return this._dragging;\n};\n\nfunction createOverlayMarker(options) {\n  return new OverlaySegmentMarker(options);\n}\n\nSegmentShape.prototype._createMarkers = function() {\n  const editable = this._layer.isEditingEnabled() && this._segment.editable;\n\n  if (!editable) {\n    return;\n  }\n\n  const segmentOptions = this._view.getViewOptions().segmentOptions;\n\n  const createSegmentMarker = segmentOptions.markers ?\n    this._peaks.options.createSegmentMarker :\n    createOverlayMarker;\n\n  const startMarker = createSegmentMarker({\n    segment:        this._segment,\n    draggable:      editable,\n    startMarker:    true,\n    color:          segmentOptions.startMarkerColor,\n    fontFamily:     this._peaks.options.fontFamily || defaultFontFamily,\n    fontSize:       this._peaks.options.fontSize || defaultFontSize,\n    fontStyle:      this._peaks.options.fontStyle || defaultFontShape,\n    layer:          this._layer,\n    view:           this._view.getName(),\n    segmentOptions: this._view.getViewOptions().segmentOptions\n  });\n\n  if (startMarker) {\n    this._startMarker = new SegmentMarker({\n      segment:       this._segment,\n      segmentShape:  this,\n      draggable:     editable,\n      startMarker:   true,\n      marker:        startMarker,\n      onDragStart:   this._onSegmentMarkerDragStart,\n      onDragMove:    this._onSegmentMarkerDragMove,\n      onDragEnd:     this._onSegmentMarkerDragEnd,\n      dragBoundFunc: this._segmentMarkerDragBoundFunc\n    });\n  }\n\n  const endMarker = createSegmentMarker({\n    segment:        this._segment,\n    draggable:      editable,\n    startMarker:    false,\n    color:          segmentOptions.endMarkerColor,\n    fontFamily:     this._peaks.options.fontFamily || defaultFontFamily,\n    fontSize:       this._peaks.options.fontSize || defaultFontSize,\n    fontStyle:      this._peaks.options.fontStyle || defaultFontShape,\n    layer:          this._layer,\n    view:           this._view.getName(),\n    segmentOptions: this._view.getViewOptions().segmentOptions\n  });\n\n  if (endMarker) {\n    this._endMarker = new SegmentMarker({\n      segment:       this._segment,\n      segmentShape:  this,\n      draggable:     editable,\n      startMarker:   false,\n      marker:        endMarker,\n      onDragStart:   this._onSegmentMarkerDragStart,\n      onDragMove:    this._onSegmentMarkerDragMove,\n      onDragEnd:     this._onSegmentMarkerDragEnd,\n      dragBoundFunc: this._segmentMarkerDragBoundFunc\n    });\n  }\n};\n\nSegmentShape.prototype._onMouseEnter = function(event) {\n  if (this._label) {\n    this._label.moveToTop();\n    this._label.show();\n  }\n\n  this._peaks.emit('segments.mouseenter', {\n    segment: this._segment,\n    evt: event.evt\n  });\n};\n\nSegmentShape.prototype._onMouseLeave = function(event) {\n  if (this._label) {\n    this._label.hide();\n  }\n\n  this._peaks.emit('segments.mouseleave', {\n    segment: this._segment,\n    evt: event.evt\n  });\n};\n\nSegmentShape.prototype._onMouseDown = function(event) {\n  this._peaks.emit('segments.mousedown', {\n    segment: this._segment,\n    evt: event.evt\n  });\n};\n\nSegmentShape.prototype._onMouseUp = function(event) {\n  this._peaks.emit('segments.mouseup', {\n    segment: this._segment,\n    evt: event.evt\n  });\n};\n\nSegmentShape.prototype.segmentClicked = function(eventName, event) {\n  this._moveToTop();\n\n  this._peaks.emit('segments.' + eventName, event);\n};\n\nSegmentShape.prototype._moveToTop = function() {\n  this._overlay.moveToTop();\n\n  this._layer.moveSegmentMarkersToTop();\n};\n\nSegmentShape.prototype.enableSegmentDragging = function(enable) {\n  if (!this._segment.editable) {\n    return;\n  }\n\n  if (!this._draggable && enable) {\n    this._overlay.on('dragstart', this._onSegmentDragStart);\n    this._overlay.on('dragmove', this._onSegmentDragMove);\n    this._overlay.on('dragend', this._onSegmentDragEnd);\n  }\n  else if (this._draggable && !enable) {\n    this._overlay.off('dragstart', this._onSegmentDragStart);\n    this._overlay.off('dragmove', this._onSegmentDragMove);\n    this._overlay.off('dragend', this._onSegmentDragEnd);\n  }\n\n  this._overlay.draggable(enable);\n  this._draggable = enable;\n};\n\nSegmentShape.prototype._setPreviousAndNextSegments = function() {\n  if (this._view.getSegmentDragMode() !== 'overlap') {\n    this._nextSegment = this._peaks.segments.findNextSegment(this._segment);\n    this._previousSegment = this._peaks.segments.findPreviousSegment(this._segment);\n  }\n  else {\n    this._nextSegment = null;\n    this._previousSegment = null;\n  }\n};\n\nSegmentShape.prototype._onSegmentDragStart = function(event) {\n  this._setPreviousAndNextSegments();\n\n  this._dragging = true;\n  this._dragStartX = this._overlay.getX();\n  this._dragStartTime = this._segment.startTime;\n  this._dragEndTime = this._segment.endTime;\n\n  this._peaks.emit('segments.dragstart', {\n    segment: this._segment,\n    marker: false,\n    startMarker: false,\n    evt: event.evt\n  });\n};\n\nSegmentShape.prototype._onSegmentDragMove = function(event) {\n  const x = this._overlay.getX();\n  const offsetX = x - this._dragStartX;\n  const timeOffset = this._view.pixelsToTime(offsetX);\n\n  // The WaveformShape for a segment fills the canvas width\n  // but only draws a subset of the horizontal range. When dragged\n  // we need to keep the shape object in its position but\n  // update the segment start and end time so that the right\n  // subset is drawn.\n\n  // Calculate new segment start/end time based on drag position. We'll\n  // correct this later based on the drag mode, to prevent overlapping\n  // segments or to compress the adjacent segment.\n\n  let startTime = this._dragStartTime + timeOffset;\n  let endTime = this._dragEndTime + timeOffset;\n  const segmentDuration = this._segment.endTime - this._segment.startTime;\n  let dragMode;\n  const minSegmentWidth = this._view.getMinSegmentDragWidth();\n  const minSegmentDuration = this._view.pixelsToTime(minSegmentWidth);\n  let previousSegmentUpdated = false;\n  let nextSegmentUpdated = false;\n\n  // Prevent the segment from being dragged beyond the start of the waveform.\n\n  if (startTime < 0) {\n    startTime = 0;\n    endTime = segmentDuration;\n    this._overlay.setX(this._view.timeToPixelOffset(startTime));\n  }\n\n  // Adjust segment position if it now overlaps the previous segment?\n\n  if (this._previousSegment) {\n    let previousSegmentEndX = this._view.timeToPixelOffset(this._previousSegment.endTime);\n\n    if (startTime < this._previousSegment.endTime) {\n      dragMode = this._view.getSegmentDragMode();\n\n      if (dragMode === 'no-overlap' ||\n          (dragMode === 'compress' && !this._previousSegment.editable)) {\n        startTime = this._previousSegment.endTime;\n        endTime = startTime + segmentDuration;\n        this._overlay.setX(previousSegmentEndX);\n      }\n      else if (dragMode === 'compress') {\n        let previousSegmentEndTime = startTime;\n\n        const minPreviousSegmentEndTime = this._previousSegment.startTime + minSegmentDuration;\n\n        if (previousSegmentEndTime < minPreviousSegmentEndTime) {\n          previousSegmentEndTime = minPreviousSegmentEndTime;\n\n          previousSegmentEndX = this._view.timeToPixelOffset(previousSegmentEndTime);\n\n          this._overlay.setX(previousSegmentEndX);\n\n          startTime = previousSegmentEndTime;\n          endTime = startTime + segmentDuration;\n        }\n\n        this._previousSegment.update({ endTime: previousSegmentEndTime });\n\n        previousSegmentUpdated = true;\n      }\n    }\n  }\n\n  // Adjust segment position if it now overlaps the following segment?\n\n  if (this._nextSegment) {\n    let nextSegmentStartX = this._view.timeToPixelOffset(this._nextSegment.startTime);\n\n    if (endTime > this._nextSegment.startTime) {\n      dragMode = this._view.getSegmentDragMode();\n\n      if (dragMode === 'no-overlap' ||\n          (dragMode === 'compress' && !this._nextSegment.editable)) {\n        endTime = this._nextSegment.startTime;\n        startTime = endTime - segmentDuration;\n        this._overlay.setX(nextSegmentStartX - this._overlay.getWidth());\n      }\n      else if (dragMode === 'compress') {\n        let nextSegmentStartTime = endTime;\n\n        const maxNextSegmentStartTime = this._nextSegment.endTime - minSegmentDuration;\n\n        if (nextSegmentStartTime > maxNextSegmentStartTime) {\n          nextSegmentStartTime = maxNextSegmentStartTime;\n\n          nextSegmentStartX = this._view.timeToPixelOffset(nextSegmentStartTime);\n\n          this._overlay.setX(nextSegmentStartX - this._overlay.getWidth());\n\n          endTime = nextSegmentStartTime;\n          startTime = endTime - segmentDuration;\n        }\n\n        this._nextSegment.update({ startTime: nextSegmentStartTime });\n\n        nextSegmentUpdated = true;\n      }\n    }\n  }\n\n  this._segment._setStartTime(startTime);\n  this._segment._setEndTime(endTime);\n\n  this._peaks.emit('segments.dragged', {\n    segment: this._segment,\n    marker: false,\n    startMarker: false,\n    evt: event.evt\n  });\n\n  if (previousSegmentUpdated) {\n    this._peaks.emit('segments.dragged', {\n      segment: this._previousSegment,\n      marker: false,\n      startMarker: false,\n      evt: event.evt\n    });\n  }\n  else if (nextSegmentUpdated) {\n    this._peaks.emit('segments.dragged', {\n      segment: this._nextSegment,\n      marker: false,\n      startMarker: false,\n      evt: event.evt\n    });\n  }\n};\n\nSegmentShape.prototype._onSegmentDragEnd = function(event) {\n  this._dragging = false;\n\n  this._peaks.emit('segments.dragend', {\n    segment: this._segment,\n    marker: false,\n    startMarker: false,\n    evt: event.evt\n  });\n};\n\nSegmentShape.prototype.moveMarkersToTop = function() {\n  if (this._startMarker) {\n    this._startMarker.moveToTop();\n  }\n\n  if (this._endMarker) {\n    this._endMarker.moveToTop();\n  }\n};\n\nSegmentShape.prototype.startDrag = function() {\n  if (this._endMarker) {\n    this._endMarker.startDrag();\n  }\n};\n\nSegmentShape.prototype.stopDrag = function() {\n  if (this._endMarker) {\n    this._endMarker.stopDrag();\n  }\n};\n\n/**\n * @param {SegmentMarker} segmentMarker\n */\n\nSegmentShape.prototype._onSegmentMarkerDragStart = function(segmentMarker, event) {\n  this._setPreviousAndNextSegments();\n\n  // Move this segment to the top of the z-order, so that it remains on top\n  // of any adjacent segments that the marker is dragged over.\n  this._moveToTop();\n\n  this._startMarkerX = this._startMarker.getX();\n  this._endMarkerX = this._endMarker.getX();\n\n  this._peaks.emit('segments.dragstart', {\n    segment: this._segment,\n    marker: true,\n    startMarker: segmentMarker.isStartMarker(),\n    evt: event.evt\n  });\n};\n\n/**\n * @param {SegmentMarker} segmentMarker\n */\n\nSegmentShape.prototype._onSegmentMarkerDragMove = function(segmentMarker, event) {\n  if (segmentMarker.isStartMarker()) {\n    this._segmentStartMarkerDragMove(segmentMarker, event);\n    segmentMarker.update({ startTime: this._segment.startTime });\n  }\n  else {\n    this._segmentEndMarkerDragMove(segmentMarker, event);\n    segmentMarker.update({ endTime: this._segment.endTime });\n  }\n};\n\nfunction getDuration(segment) {\n  return segment.endTime - segment.startTime;\n}\n\nSegmentShape.prototype._segmentStartMarkerDragMove = function(segmentMarker, event) {\n  const width = this._view.getWidth();\n\n  let startMarkerX = this._startMarker.getX();\n  const endMarkerX = this._endMarker.getX();\n\n  let minSegmentDuration = this._view.pixelsToTime(50);\n  const minSegmentWidth = this._view.getMinSegmentDragWidth();\n\n  let upperLimit = this._endMarker.getX() - minSegmentWidth;\n\n  if (upperLimit > width) {\n    upperLimit = width;\n  }\n\n  let previousSegmentVisible = false;\n  let previousSegmentUpdated = false;\n  let previousSegmentEndX;\n\n  if (this._previousSegment) {\n    previousSegmentEndX = this._view.timeToPixelOffset(this._previousSegment.endTime);\n    previousSegmentVisible = previousSegmentEndX >= 0;\n  }\n\n  if (startMarkerX > upperLimit) {\n    segmentMarker.setX(upperLimit);\n    this._overlay.clipWidth(upperLimit - endMarkerX);\n\n    if (minSegmentWidth === 0 && upperLimit < width) {\n      this._segment._setStartTime(this._segment.endTime);\n    }\n    else {\n      this._segment._setStartTime(this._view.pixelOffsetToTime(upperLimit));\n    }\n  }\n  else if (this._previousSegment && previousSegmentVisible) {\n    const dragMode = this._view.getSegmentDragMode();\n\n    const fixedPreviousSegment = dragMode === 'no-overlap' ||\n      (dragMode === 'compress' && !this._previousSegment.editable);\n\n    const compressPreviousSegment = dragMode === 'compress' && this._previousSegment.editable;\n\n    if (startMarkerX <= previousSegmentEndX) {\n      if (fixedPreviousSegment) {\n        segmentMarker.setX(previousSegmentEndX);\n        this._overlay.clipWidth(previousSegmentEndX - endMarkerX);\n\n        this._segment._setStartTime(this._previousSegment.endTime);\n      }\n      else if (compressPreviousSegment) {\n        const previousSegmentDuration = getDuration(this._previousSegment);\n\n        if (previousSegmentDuration < minSegmentDuration) {\n          minSegmentDuration = previousSegmentDuration;\n        }\n\n        const lowerLimit = this._view.timeToPixelOffset(\n          this._previousSegment.startTime + minSegmentDuration\n        );\n\n        if (startMarkerX < lowerLimit) {\n          startMarkerX = lowerLimit;\n        }\n\n        segmentMarker.setX(startMarkerX);\n        this._overlay.clipWidth(endMarkerX - startMarkerX);\n\n        this._segment._setStartTime(this._view.pixelOffsetToTime(startMarkerX));\n\n        this._previousSegment.update({\n          endTime: this._view.pixelOffsetToTime(startMarkerX)\n        });\n\n        previousSegmentUpdated = true;\n      }\n    }\n    else {\n      if (startMarkerX < 0) {\n        startMarkerX = 0;\n      }\n\n      segmentMarker.setX(startMarkerX);\n      this._overlay.clipWidth(endMarkerX - startMarkerX);\n\n      this._segment._setStartTime(this._view.pixelOffsetToTime(startMarkerX));\n    }\n  }\n  else {\n    if (startMarkerX < 0) {\n      startMarkerX = 0;\n    }\n\n    segmentMarker.setX(startMarkerX);\n    this._overlay.clipWidth(endMarkerX - startMarkerX);\n\n    this._segment._setStartTime(this._view.pixelOffsetToTime(startMarkerX));\n  }\n\n  this._peaks.emit('segments.dragged', {\n    segment: this._segment,\n    marker: true,\n    startMarker: true,\n    evt: event.evt\n  });\n\n  if (previousSegmentUpdated) {\n    this._peaks.emit('segments.dragged', {\n      segment: this._previousSegment,\n      marker: true,\n      startMarker: false,\n      evt: event.evt\n    });\n  }\n};\n\nSegmentShape.prototype._segmentEndMarkerDragMove = function(segmentMarker, event) {\n  const width = this._view.getWidth();\n\n  const startMarkerX = this._startMarker.getX();\n  let endMarkerX = this._endMarker.getX();\n\n  let minSegmentDuration = this._view.pixelsToTime(50);\n  const minSegmentWidth = this._view.getMinSegmentDragWidth();\n\n  let lowerLimit = this._startMarker.getX() + minSegmentWidth;\n\n  if (lowerLimit < 0) {\n    lowerLimit = 0;\n  }\n\n  let nextSegmentVisible = false;\n  let nextSegmentUpdated = false;\n  let nextSegmentStartX;\n\n  if (this._nextSegment) {\n    nextSegmentStartX = this._view.timeToPixelOffset(this._nextSegment.startTime);\n    nextSegmentVisible = nextSegmentStartX < width;\n  }\n\n  if (endMarkerX < lowerLimit) {\n    segmentMarker.setX(lowerLimit);\n    this._overlay.clipWidth(lowerLimit - startMarkerX);\n\n    if (minSegmentWidth === 0 && lowerLimit > 0) {\n      this._segment._setEndTime(this._segment.startTime);\n    }\n    else {\n      this._segment._setEndTime(this._view.pixelOffsetToTime(lowerLimit));\n    }\n  }\n  else if (this._nextSegment && nextSegmentVisible) {\n    const dragMode = this._view.getSegmentDragMode();\n\n    const fixedNextSegment = dragMode === 'no-overlap' ||\n      (dragMode === 'compress' && !this._nextSegment.editable);\n\n    const compressNextSegment = dragMode === 'compress' && this._nextSegment.editable;\n\n    if (endMarkerX >= nextSegmentStartX) {\n      if (fixedNextSegment) {\n        segmentMarker.setX(nextSegmentStartX);\n        this._overlay.clipWidth(nextSegmentStartX - startMarkerX);\n\n        this._segment._setEndTime(this._nextSegment.startTime);\n      }\n      else if (compressNextSegment) {\n        const nextSegmentDuration = getDuration(this._nextSegment);\n\n        if (nextSegmentDuration < minSegmentDuration) {\n          minSegmentDuration = nextSegmentDuration;\n        }\n\n        const upperLimit = this._view.timeToPixelOffset(\n          this._nextSegment.endTime - minSegmentDuration\n        );\n\n        if (endMarkerX > upperLimit) {\n          endMarkerX = upperLimit;\n        }\n\n        segmentMarker.setX(endMarkerX);\n        this._overlay.clipWidth(endMarkerX - startMarkerX);\n\n        this._segment._setEndTime(this._view.pixelOffsetToTime(endMarkerX));\n\n        this._nextSegment.update({\n          startTime: this._view.pixelOffsetToTime(endMarkerX)\n        });\n\n        nextSegmentUpdated = true;\n      }\n    }\n    else {\n      if (endMarkerX > width) {\n        endMarkerX = width;\n      }\n\n      segmentMarker.setX(endMarkerX);\n      this._overlay.clipWidth(endMarkerX - startMarkerX);\n\n      this._segment._setEndTime(this._view.pixelOffsetToTime(endMarkerX));\n    }\n  }\n  else {\n    if (endMarkerX > width) {\n      endMarkerX = width;\n    }\n\n    segmentMarker.setX(endMarkerX);\n    this._overlay.clipWidth(endMarkerX - startMarkerX);\n\n    this._segment._setEndTime(this._view.pixelOffsetToTime(endMarkerX));\n  }\n\n  this._peaks.emit('segments.dragged', {\n    segment: this._segment,\n    marker: true,\n    startMarker: false,\n    evt: event.evt\n  });\n\n  if (nextSegmentUpdated) {\n    this._peaks.emit('segments.dragged', {\n      segment: this._nextSegment,\n      marker: true,\n      startMarker: true,\n      evt: event.evt\n    });\n  }\n};\n\n/**\n * @param {SegmentMarker} segmentMarker\n */\n\nSegmentShape.prototype._onSegmentMarkerDragEnd = function(segmentMarker, event) {\n  this._nextSegment = null;\n  this._previousSegment = null;\n\n  const startMarker = segmentMarker.isStartMarker();\n\n  this._peaks.emit('segments.dragend', {\n    segment: this._segment,\n    marker: true,\n    startMarker: startMarker,\n    evt: event.evt\n  });\n};\n\n// eslint-disable-next-line no-unused-vars\nSegmentShape.prototype._segmentMarkerDragBoundFunc = function(segmentMarker, pos) {\n  // Allow the marker to be moved horizontally but not vertically.\n  return {\n    x: pos.x,\n    y: segmentMarker.getAbsolutePosition().y\n  };\n};\n\nSegmentShape.prototype.fitToView = function() {\n  if (this._startMarker) {\n    this._startMarker.fitToView();\n  }\n\n  if (this._endMarker) {\n    this._endMarker.fitToView();\n  }\n\n  if (this._overlay) {\n    const height = this._view.getHeight();\n\n    const overlayRectHeight = clamp(0, height - (this._overlayOffset * 2));\n\n    this._overlay.setAttrs({\n      y:          0,\n      height:     height,\n      clipY:      this._overlayOffset,\n      clipHeight: overlayRectHeight\n    });\n\n    this._overlayRect.setAttrs({\n      y:      this._overlayOffset,\n      height: overlayRectHeight\n    });\n\n    if (this._overlayText) {\n      this._overlayText.setAttrs({\n        y:      this._overlayOffset,\n        height: overlayRectHeight\n      });\n    }\n  }\n};\n\nSegmentShape.prototype.destroy = function() {\n  if (this._waveformShape) {\n    this._waveformShape.destroy();\n  }\n\n  if (this._label) {\n    this._label.destroy();\n  }\n\n  if (this._startMarker) {\n    this._startMarker.destroy();\n  }\n\n  if (this._endMarker) {\n    this._endMarker.destroy();\n  }\n\n  if (this._overlay) {\n    this._overlay.destroy();\n  }\n};\n\nexport default SegmentShape;","/**\n * @file\n *\n * Defines the {@link SegmentsLayer} class.\n *\n * @module segments-layer\n */\n\nimport SegmentShape from './segment-shape';\nimport { objectHasProperty } from './utils';\nimport Konva from 'konva/lib/Core';\n\n/**\n * Creates a Konva.Layer that displays segment markers against the audio\n * waveform.\n *\n * @class\n * @alias SegmentsLayer\n *\n * @param {Peaks} peaks\n * @param {WaveformOverview|WaveformZoomView} view\n * @param {Boolean} allowEditing\n */\n\nfunction SegmentsLayer(peaks, view, allowEditing) {\n  this._peaks         = peaks;\n  this._view          = view;\n  this._allowEditing  = allowEditing;\n  this._segmentShapes = {};\n  this._layer         = new Konva.Layer();\n\n  this._onSegmentsUpdate    = this._onSegmentsUpdate.bind(this);\n  this._onSegmentsAdd       = this._onSegmentsAdd.bind(this);\n  this._onSegmentsRemove    = this._onSegmentsRemove.bind(this);\n  this._onSegmentsRemoveAll = this._onSegmentsRemoveAll.bind(this);\n  this._onSegmentsDragged   = this._onSegmentsDragged.bind(this);\n\n  this._peaks.on('segments.update', this._onSegmentsUpdate);\n  this._peaks.on('segments.add', this._onSegmentsAdd);\n  this._peaks.on('segments.remove', this._onSegmentsRemove);\n  this._peaks.on('segments.remove_all', this._onSegmentsRemoveAll);\n  this._peaks.on('segments.dragged', this._onSegmentsDragged);\n}\n\n/**\n * Adds the layer to the given {Konva.Stage}.\n *\n * @param {Konva.Stage} stage\n */\n\nSegmentsLayer.prototype.addToStage = function(stage) {\n  stage.add(this._layer);\n};\n\nSegmentsLayer.prototype.enableEditing = function(enable) {\n  this._allowEditing = enable;\n};\n\nSegmentsLayer.prototype.isEditingEnabled = function() {\n  return this._allowEditing;\n};\n\nSegmentsLayer.prototype.enableSegmentDragging = function(enable) {\n  for (const segmentId in this._segmentShapes) {\n    if (objectHasProperty(this._segmentShapes, segmentId)) {\n      this._segmentShapes[segmentId].enableSegmentDragging(enable);\n    }\n  }\n};\n\nSegmentsLayer.prototype.getSegmentShape = function(segmentId) {\n  return this._segmentShapes[segmentId];\n};\n\nSegmentsLayer.prototype.formatTime = function(time) {\n  return this._view.formatTime(time);\n};\n\nSegmentsLayer.prototype._onSegmentsUpdate = function(segment, options) {\n  const frameStartTime = this._view.getStartTime();\n  const frameEndTime = this._view.getEndTime();\n\n  let segmentShape = this._segmentShapes[segment.id];\n  const isVisible = segment.isVisible(frameStartTime, frameEndTime);\n\n  if (segmentShape && !isVisible) {\n    // Remove segment shape that is no longer visible.\n\n    if (!segmentShape.isDragging()) {\n      this._removeSegment(segment);\n    }\n  }\n  else if (!segmentShape && isVisible) {\n    // Add segment shape for visible segment.\n    // segmentShape = this._addSegmentShape(segment);\n    segmentShape = this._updateSegment(segment);\n  }\n  else if (segmentShape && isVisible) {\n    // Update the segment shape with the changed attributes.\n    segmentShape.update(options);\n  }\n};\n\nSegmentsLayer.prototype._onSegmentsAdd = function(segments) {\n  const self = this;\n\n  const frameStartTime = self._view.getStartTime();\n  const frameEndTime   = self._view.getEndTime();\n\n  segments.forEach(function(segment) {\n    if (segment.isVisible(frameStartTime, frameEndTime)) {\n      const segmentShape = self._addSegmentShape(segment);\n\n      segmentShape.update();\n    }\n  });\n};\n\nSegmentsLayer.prototype._onSegmentsRemove = function(segments) {\n  const self = this;\n\n  segments.forEach(function(segment) {\n    self._removeSegment(segment);\n  });\n};\n\nSegmentsLayer.prototype._onSegmentsRemoveAll = function() {\n  this._layer.removeChildren();\n  this._segmentShapes = {};\n};\n\nSegmentsLayer.prototype._onSegmentsDragged = function(event) {\n  this._updateSegment(event.segment);\n};\n\n/**\n * Creates the Konva UI objects for a given segment.\n *\n * @private\n * @param {Segment} segment\n * @returns {SegmentShape}\n */\n\nSegmentsLayer.prototype._createSegmentShape = function(segment) {\n  return new SegmentShape(segment, this._peaks, this, this._view);\n};\n\n/**\n * Adds a Konva UI object to the layer for a given segment.\n *\n * @private\n * @param {Segment} segment\n * @returns {SegmentShape}\n */\n\nSegmentsLayer.prototype._addSegmentShape = function(segment) {\n  const segmentShape = this._createSegmentShape(segment);\n\n  segmentShape.addToLayer(this._layer);\n\n  this._segmentShapes[segment.id] = segmentShape;\n\n  return segmentShape;\n};\n\n/**\n * Updates the positions of all displayed segments in the view.\n *\n * @param {Number} startTime The start of the visible range in the view,\n *   in seconds.\n * @param {Number} endTime The end of the visible range in the view,\n *   in seconds.\n */\n\nSegmentsLayer.prototype.updateSegments = function(startTime, endTime) {\n  // Update segments in visible time range.\n  const segments = this._peaks.segments.find(startTime, endTime);\n\n  segments.forEach(this._updateSegment.bind(this));\n\n  // TODO: In the overview all segments are visible, so no need to do this.\n  this._removeInvisibleSegments(startTime, endTime);\n};\n\n/**\n * @private\n * @param {Segment} segment\n */\n\nSegmentsLayer.prototype._updateSegment = function(segment) {\n  const segmentShape = this._findOrAddSegmentShape(segment);\n\n  segmentShape.update();\n};\n\n/**\n * @private\n * @param {Segment} segment\n */\n\nSegmentsLayer.prototype._findOrAddSegmentShape = function(segment) {\n  let segmentShape = this._segmentShapes[segment.id];\n\n  if (!segmentShape) {\n    segmentShape = this._addSegmentShape(segment);\n  }\n\n  return segmentShape;\n};\n\n/**\n * Removes any segments that are not visible, i.e., are not within and do not\n * overlap the given time range.\n *\n * @private\n * @param {Number} startTime The start of the visible time range, in seconds.\n * @param {Number} endTime The end of the visible time range, in seconds.\n */\n\nSegmentsLayer.prototype._removeInvisibleSegments = function(startTime, endTime) {\n  for (const segmentId in this._segmentShapes) {\n    if (objectHasProperty(this._segmentShapes, segmentId)) {\n      const segment = this._segmentShapes[segmentId].getSegment();\n\n      if (!segment.isVisible(startTime, endTime)) {\n        this._removeSegment(segment);\n      }\n    }\n  }\n};\n\n/**\n * Removes the given segment from the view.\n *\n * @param {Segment} segment\n */\n\nSegmentsLayer.prototype._removeSegment = function(segment) {\n  const segmentShape = this._segmentShapes[segment.id];\n\n  if (segmentShape) {\n    segmentShape.destroy();\n    delete this._segmentShapes[segment.id];\n  }\n};\n\n/**\n * Toggles visibility of the segments layer.\n *\n * @param {Boolean} visible\n */\n\nSegmentsLayer.prototype.setVisible = function(visible) {\n  this._layer.setVisible(visible);\n};\n\nSegmentsLayer.prototype.segmentClicked = function(eventName, event) {\n  const segmentShape = this._segmentShapes[event.segment.id];\n\n  if (segmentShape) {\n    segmentShape.segmentClicked(eventName, event);\n  }\n};\n\nSegmentsLayer.prototype.destroy = function() {\n  this._peaks.off('segments.update', this._onSegmentsUpdate);\n  this._peaks.off('segments.add', this._onSegmentsAdd);\n  this._peaks.off('segments.remove', this._onSegmentsRemove);\n  this._peaks.off('segments.remove_all', this._onSegmentsRemoveAll);\n  this._peaks.off('segments.dragged', this._onSegmentsDragged);\n};\n\nSegmentsLayer.prototype.fitToView = function() {\n  for (const segmentId in this._segmentShapes) {\n    if (objectHasProperty(this._segmentShapes, segmentId)) {\n      const segmentShape = this._segmentShapes[segmentId];\n\n      segmentShape.fitToView();\n    }\n  }\n};\n\nSegmentsLayer.prototype.draw = function() {\n  this._layer.draw();\n};\n\nSegmentsLayer.prototype.getHeight = function() {\n  return this._layer.getHeight();\n};\n\nexport default SegmentsLayer;\n","/**\n * @file\n *\n * Defines the {@link WaveformAxis} class.\n *\n * @module waveform-axis\n */\n\nimport { formatTime, roundUpToNearest } from './utils';\nimport Konva from 'konva/lib/Core';\n\n/**\n * Creates the waveform axis shapes and adds them to the given view layer.\n *\n * @class\n * @alias WaveformAxis\n *\n * @param {WaveformOverview|WaveformZoomView} view\n * @param {Object} options\n * @param {String} options.axisGridlineColor\n * @param {String} options.axisLabelColor\n * @param {Boolean} options.showAxisLabels\n * @param {Function} options.formatAxisTime\n * @param {String} options.fontFamily\n * @param {Number} options.fontSize\n * @param {String} options.fontStyle\n */\n\nfunction WaveformAxis(view, options) {\n  const self = this;\n\n  self._axisGridlineColor = options.axisGridlineColor;\n  self._axisLabelColor    = options.axisLabelColor;\n  self._showAxisLabels    = options.showAxisLabels;\n\n  if (options.formatAxisTime) {\n    self._formatAxisTime = options.formatAxisTime;\n  }\n  else {\n    self._formatAxisTime = function(time) {\n      // precision = 0, drops the fractional seconds\n      return formatTime(time, 0);\n    };\n  }\n\n  self._axisLabelFont = WaveformAxis._buildFontString(\n    options.fontFamily,\n    options.fontSize,\n    options.fontStyle\n  );\n\n  self._axisShape = new Konva.Shape({\n    sceneFunc: function(context) {\n      self._drawAxis(context, view);\n    }\n  });\n}\n\nWaveformAxis._buildFontString = function(fontFamily, fontSize, fontStyle) {\n  if (!fontSize) {\n    fontSize = 11;\n  }\n\n  if (!fontFamily) {\n    fontFamily = 'sans-serif';\n  }\n\n  if (!fontStyle) {\n    fontStyle = 'normal';\n  }\n\n  return fontStyle + ' ' + fontSize + 'px ' + fontFamily;\n};\n\nWaveformAxis.prototype.addToLayer = function(layer) {\n  layer.add(this._axisShape);\n};\n\nWaveformAxis.prototype.showAxisLabels = function(show) {\n  this._showAxisLabels = show;\n};\n\n/**\n * Returns number of seconds for each x-axis marker, appropriate for the\n * current zoom level, ensuring that markers are not too close together\n * and that markers are placed at intuitive time intervals (i.e., every 1,\n * 2, 5, 10, 20, 30 seconds, then every 1, 2, 5, 10, 20, 30 minutes, then\n * every 1, 2, 5, 10, 20, 30 hours).\n *\n * @param {WaveformOverview|WaveformZoomView} view\n * @returns {Number}\n */\n\nWaveformAxis.prototype._getAxisLabelScale = function(view) {\n  let baseSecs = 1; // seconds\n  const steps = [1, 2, 5, 10, 20, 30];\n  const minSpacing = 60;\n  let index = 0;\n\n  let secs;\n\n  for (;;) {\n    secs = baseSecs * steps[index];\n    const pixels = view.timeToPixels(secs);\n\n    if (pixels < minSpacing) {\n      if (++index === steps.length) {\n        baseSecs *= 60; // seconds -> minutes -> hours\n        index = 0;\n      }\n    }\n    else {\n      break;\n    }\n  }\n\n  return secs;\n};\n\n/**\n * Draws the time axis and labels onto a view.\n *\n * @param {Konva.Context} context The context to draw on.\n * @param {WaveformOverview|WaveformZoomView} view\n */\n\nWaveformAxis.prototype._drawAxis = function(context, view) {\n  const currentFrameStartTime = view.getStartTime();\n\n  // Draw axis markers\n  const markerHeight = 10;\n\n  // Time interval between axis markers (seconds)\n  const axisLabelIntervalSecs = this._getAxisLabelScale(view);\n\n  // Time of first axis marker (seconds)\n  const firstAxisLabelSecs = roundUpToNearest(currentFrameStartTime, axisLabelIntervalSecs);\n\n  // Distance between waveform start time and first axis marker (seconds)\n  const axisLabelOffsetSecs = firstAxisLabelSecs - currentFrameStartTime;\n\n  // Distance between waveform start time and first axis marker (pixels)\n  const axisLabelOffsetPixels = view.timeToPixels(axisLabelOffsetSecs);\n\n  context.setAttr('strokeStyle', this._axisGridlineColor);\n  context.setAttr('lineWidth', 1);\n\n  // Set text style\n  context.setAttr('font', this._axisLabelFont);\n  context.setAttr('fillStyle', this._axisLabelColor);\n  context.setAttr('textAlign', 'left');\n  context.setAttr('textBaseline', 'bottom');\n\n  const width  = view.getWidth();\n  // const height = view.getHeight();\n\n  let secs = firstAxisLabelSecs;\n\n  for (;;) {\n    // Position of axis marker (pixels)\n    const x = axisLabelOffsetPixels + view.timeToPixels(secs - firstAxisLabelSecs);\n\n    if (x >= width) {\n      break;\n    }\n\n    context.beginPath();\n    context.moveTo(x + 0.5, 0);\n    context.lineTo(x + 0.5, 0 + markerHeight);\n    // context.moveTo(x + 0.5, height);\n    // context.lineTo(x + 0.5, height - markerHeight);\n    context.stroke();\n\n    if (this._showAxisLabels) {\n      const label      = this._formatAxisTime(secs);\n      const labelWidth = context.measureText(label).width;\n      const labelX     = x - labelWidth / 2;\n      const labelY     = 15 + markerHeight;\n\n      if (labelX >= 0) {\n        context.fillText(label, labelX, labelY);\n      }\n    }\n\n    secs += axisLabelIntervalSecs;\n  }\n};\n\nexport default WaveformAxis;\n","/**\n * @file\n *\n * Defines the {@link WaveformOverview} class.\n *\n * @module waveform-overview\n */\n\nimport HighlightLayer from './highlight-layer';\nimport MouseDragHandler from './mouse-drag-handler';\nimport PlayheadLayer from './playhead-layer';\nimport PointsLayer from './points-layer';\nimport SegmentsLayer from './segments-layer';\nimport WaveformAxis from './waveform-axis';\nimport WaveformShape from './waveform-shape';\nimport { clamp, formatTime, getMarkerObject, isFinite, isNumber } from './utils';\nimport Konva from 'konva/lib/Core';\n\n/**\n * Creates the overview waveform view.\n *\n * @class\n * @alias WaveformOverview\n *\n * @param {WaveformData} waveformData\n * @param {HTMLElement} container\n * @param {Peaks} peaks\n */\n\nfunction WaveformOverview(waveformData, container, peaks) {\n  const self = this;\n\n  self._originalWaveformData = waveformData;\n  self._container = container;\n  self._peaks = peaks;\n  self._options = peaks.options;\n  self._viewOptions = peaks.options.overview;\n\n  // Bind event handlers\n  self._onTimeUpdate = self._onTimeUpdate.bind(this);\n  self._onPlaying = self._onPlaying.bind(this);\n  self._onPause = self._onPause.bind(this);\n  self._onZoomviewDisplaying = self._onZoomviewDisplaying.bind(this);\n  self._onWindowResize = self._onWindowResize.bind(this);\n\n  // Register event handlers\n  peaks.on('player.timeupdate', self._onTimeUpdate);\n  peaks.on('player.playing', self._onPlaying);\n  peaks.on('player.pause', self._onPause);\n  peaks.on('zoomview.displaying', self._onZoomviewDisplaying);\n  peaks.on('window_resize', self._onWindowResize);\n\n  self._amplitudeScale = 1.0;\n  self._timeLabelPrecision = self._viewOptions.timeLabelPrecision;\n  self._enableSeek = true;\n\n  if (self._viewOptions.formatPlayheadTime) {\n    self._formatPlayheadTime = self._viewOptions.formatPlayheadTime;\n  }\n  else {\n    self._formatPlayheadTime = function(time) {\n      return formatTime(time, self._timeLabelPrecision);\n    };\n  }\n\n  self._width = container.clientWidth;\n  self._height = container.clientHeight;\n\n  self._data = waveformData;\n\n  if (self._width !== 0) {\n    try {\n      self._data = waveformData.resample({ width: self._width });\n    }\n    catch (error) {\n      // This error usually indicates that the waveform length\n      // is less than the container width\n    }\n  }\n\n  // Disable warning: The stage has 6 layers.\n  // Recommended maximum number of layers is 3-5.\n  Konva.showWarnings = false;\n\n  self._resizeTimeoutId = null;\n\n  self._stage = new Konva.Stage({\n    container: container,\n    width: self._width,\n    height: self._height\n  });\n\n  self._waveformColor = self._viewOptions.waveformColor;\n  self._playedWaveformColor = self._viewOptions.playedWaveformColor;\n\n  self._createWaveform();\n\n  self._segmentsLayer = new SegmentsLayer(peaks, self, false);\n  self._segmentsLayer.addToStage(self._stage);\n\n  self._pointsLayer = new PointsLayer(peaks, self, false);\n  self._pointsLayer.addToStage(self._stage);\n\n  self._highlightLayer = new HighlightLayer(\n    self,\n    self._viewOptions\n  );\n  self._highlightLayer.addToStage(self._stage);\n\n  self._createAxisLabels();\n\n  self._playheadLayer = new PlayheadLayer({\n    player: self._peaks.player,\n    view: self,\n    showPlayheadTime: self._viewOptions.showPlayheadTime,\n    playheadColor: self._viewOptions.playheadColor,\n    playheadTextColor: self._viewOptions.playheadTextColor,\n    playheadFontFamily: self._viewOptions.fontFamily,\n    playheadFontSize: self._viewOptions.fontSize,\n    playheadFontStyle: self._viewOptions.fontStyle\n  });\n\n  self._playheadLayer.addToStage(self._stage);\n\n  const time = self._peaks.player.getCurrentTime();\n\n  this._playheadLayer.updatePlayheadTime(time);\n\n  self._createMouseDragHandler();\n\n  self._onClick = self._onClick.bind(this);\n  self._onDblClick = self._onDblClick.bind(this);\n  self._onContextMenu = self._onContextMenu.bind(this);\n\n  self._stage.on('click', self._onClick);\n  self._stage.on('dblclick', self._onDblClick);\n  self._stage.on('contextmenu', self._onContextMenu);\n}\n\nWaveformOverview.prototype._createMouseDragHandler = function() {\n  const self = this;\n\n  self._mouseDragHandler = new MouseDragHandler(self._stage, {\n    onMouseDown: function(mousePosX) {\n      this._seek(mousePosX);\n    },\n\n    onMouseMove: function(mousePosX) {\n      this._seek(mousePosX);\n    },\n\n    _seek: function(mousePosX) {\n      if (!self._enableSeek) {\n        return;\n      }\n\n      mousePosX = clamp(mousePosX, 0, self._width);\n\n      let time = self.pixelsToTime(mousePosX);\n      const duration = self._getDuration();\n\n      // Prevent the playhead position from jumping by limiting click\n      // handling to the waveform duration.\n      if (time > duration) {\n        time = duration;\n      }\n\n      // Update the playhead position. This gives a smoother visual update\n      // than if we only use the player.timeupdate event.\n      self._playheadLayer.updatePlayheadTime(time);\n\n      self._peaks.player.seek(time);\n    }\n  });\n};\n\nWaveformOverview.prototype.enableSeek = function(enable) {\n  this._enableSeek = enable;\n};\n\nWaveformOverview.prototype._onClick = function(event) {\n  this._clickHandler(event, 'click');\n};\n\nWaveformOverview.prototype._onDblClick = function(event) {\n  this._clickHandler(event, 'dblclick');\n};\n\nWaveformOverview.prototype._onContextMenu = function(event) {\n  this._clickHandler(event, 'contextmenu');\n};\n\nWaveformOverview.prototype._clickHandler = function(event, eventName) {\n  let emitViewEvent = true;\n\n  if (event.target !== this._stage) {\n    const marker = getMarkerObject(event.target);\n\n    if (marker) {\n      if (marker.attrs.name === 'point-marker') {\n        const point = marker.getAttr('point');\n\n        if (point) {\n          this._peaks.emit('points.' + eventName, {\n            point: point,\n            evt: event.evt,\n            preventViewEvent: function() {\n              emitViewEvent = false;\n            }\n          });\n        }\n      }\n      else if (marker.attrs.name === 'segment-overlay') {\n        const segment = marker.getAttr('segment');\n\n        if (segment) {\n          const clickEvent = {\n            segment: segment,\n            evt: event.evt,\n            preventViewEvent: function() {\n              emitViewEvent = false;\n            }\n          };\n\n          this._segmentsLayer.segmentClicked(eventName, clickEvent);\n        }\n      }\n    }\n  }\n\n  if (emitViewEvent) {\n    const pixelIndex = event.evt.layerX;\n    const time = this.pixelsToTime(pixelIndex);\n\n    this._peaks.emit('overview.' + eventName, {\n      time: time,\n      evt: event.evt\n    });\n  }\n};\n\nWaveformOverview.prototype.isSegmentDraggingEnabled = function() {\n  return false;\n};\n\nWaveformOverview.prototype.getName = function() {\n  return 'overview';\n};\n\nWaveformOverview.prototype._onTimeUpdate = function(time) {\n  this._playheadLayer.updatePlayheadTime(time);\n};\n\nWaveformOverview.prototype._onPlaying = function(time) {\n  this._playheadLayer.updatePlayheadTime(time);\n};\n\nWaveformOverview.prototype._onPause = function(time) {\n  this._playheadLayer.stop(time);\n};\n\nWaveformOverview.prototype._onZoomviewDisplaying = function(startTime, endTime) {\n  this.showHighlight(startTime, endTime);\n};\n\nWaveformOverview.prototype.showHighlight = function(startTime, endTime) {\n  this._highlightLayer.showHighlight(startTime, endTime);\n};\n\nWaveformOverview.prototype._onWindowResize = function() {\n  const self = this;\n\n  if (self._resizeTimeoutId) {\n    clearTimeout(self._resizeTimeoutId);\n    self._resizeTimeoutId = null;\n  }\n\n  // Avoid resampling waveform data to zero width\n  if (self._container.clientWidth !== 0) {\n    self._width = self._container.clientWidth;\n    self._stage.setWidth(self._width);\n\n    self._resizeTimeoutId = setTimeout(function() {\n      self._width = self._container.clientWidth;\n      self._data = self._originalWaveformData.resample({ width: self._width });\n      self._stage.setWidth(self._width);\n\n      self._updateWaveform();\n    }, 500);\n  }\n};\n\nWaveformOverview.prototype.setWaveformData = function(waveformData) {\n  this._originalWaveformData = waveformData;\n\n  if (this._width !== 0) {\n    this._data = waveformData.resample({ width: this._width });\n  }\n  else {\n    this._data = waveformData;\n  }\n\n  this._updateWaveform();\n};\n\nWaveformOverview.prototype.playheadPosChanged = function(time) {\n  if (this._playedWaveformShape) {\n    this._playedSegment.endTime = time;\n    this._unplayedSegment.startTime = time;\n\n    this._waveformLayer.draw();\n  }\n};\n\n/**\n * Returns the pixel index for a given time, for the current zoom level.\n *\n * @param {Number} time Time, in seconds.\n * @returns {Number} Pixel index.\n */\n\nWaveformOverview.prototype.timeToPixels = function(time) {\n  return Math.floor(time * this._data.sample_rate / this._data.scale);\n};\n\nWaveformOverview.prototype.timeToPixelOffset = WaveformOverview.prototype.timeToPixels;\n\n/**\n * Returns the time for a given pixel index, for the current zoom level.\n *\n * @param {Number} pixels Pixel index.\n * @returns {Number} Time, in seconds.\n */\n\nWaveformOverview.prototype.pixelsToTime = function(pixels) {\n  return pixels * this._data.scale / this._data.sample_rate;\n};\n\n/**\n * Returns the time for a given pixel index, for the current zoom level.\n * (This is presented for symmetry with WaveformZoomview. Since WaveformOverview\n * doesn't scroll, its pixelOffsetToTime & pixelsToTime methods are identical.)\n *\n * @param {Number} pixels Pixel index.\n * @returns {Number} Time, in seconds.\n */\n\nWaveformOverview.prototype.pixelOffsetToTime = WaveformOverview.prototype.pixelsToTime;\n\n/**\n * @returns {Number} The start position of the waveform shown in the view,\n *   in pixels.\n */\n\nWaveformOverview.prototype.getFrameOffset = function() {\n  return 0;\n};\n\n/**\n * @returns {Number} The time at the leftmost edge\n */\n\nWaveformOverview.prototype.getStartTime = function() {\n  return 0;\n};\n\n/**\n * @returns {Number} The time at the rightmost edge\n */\n\nWaveformOverview.prototype.getEndTime = function() {\n  return this._getDuration();\n};\n\n/**\n * @returns {Number} The width of the view, in pixels.\n */\n\nWaveformOverview.prototype.getWidth = function() {\n  return this._width;\n};\n\n/**\n * @returns {Number} The height of the view, in pixels.\n */\n\nWaveformOverview.prototype.getHeight = function() {\n  return this._height;\n};\n\n/**\n * @returns {Number} The media duration, in seconds.\n */\n\nWaveformOverview.prototype._getDuration = function() {\n  return this._peaks.player.getDuration();\n};\n\n/**\n * Adjusts the amplitude scale of waveform shown in the view, which allows\n * users to zoom the waveform vertically.\n *\n * @param {Number} scale The new amplitude scale factor\n */\n\nWaveformOverview.prototype.setAmplitudeScale = function(scale) {\n  if (!isNumber(scale) || !isFinite(scale)) {\n    throw new Error('view.setAmplitudeScale(): Scale must be a valid number');\n  }\n\n  this._amplitudeScale = scale;\n\n  this._waveformLayer.draw();\n  this._segmentsLayer.draw();\n};\n\nWaveformOverview.prototype.getAmplitudeScale = function() {\n  return this._amplitudeScale;\n};\n\n/**\n * @returns {WaveformData} The view's waveform data.\n */\n\nWaveformOverview.prototype.getWaveformData = function() {\n  return this._data;\n};\n\nWaveformOverview.prototype._createWaveformShapes = function() {\n  if (!this._waveformShape) {\n    this._waveformShape = new WaveformShape({\n      color: this._waveformColor,\n      view: this\n    });\n\n    this._waveformShape.addToLayer(this._waveformLayer);\n  }\n\n  if (this._playedWaveformColor && !this._playedWaveformShape) {\n    const time = this._peaks.player.getCurrentTime();\n\n    this._playedSegment = {\n      startTime: 0,\n      endTime: time\n    };\n\n    this._unplayedSegment = {\n      startTime: time,\n      endTime: this._getDuration()\n    };\n\n    this._waveformShape.setSegment(this._unplayedSegment);\n\n    this._playedWaveformShape = new WaveformShape({\n      color: this._playedWaveformColor,\n      view: this,\n      segment: this._playedSegment\n    });\n\n    this._playedWaveformShape.addToLayer(this._waveformLayer);\n  }\n};\n\nWaveformOverview.prototype._destroyPlayedWaveformShape = function() {\n  this._waveformShape.setSegment(null);\n\n  this._playedWaveformShape.destroy();\n  this._playedWaveformShape = null;\n\n  this._playedSegment = null;\n  this._unplayedSegment = null;\n};\n\nWaveformOverview.prototype._createWaveform = function() {\n  this._waveformLayer = new Konva.Layer({ listening: false });\n\n  this._createWaveformShapes();\n\n  this._stage.add(this._waveformLayer);\n};\n\nWaveformOverview.prototype._createAxisLabels = function() {\n  this._axisLayer = new Konva.Layer({ listening: false });\n  this._axis = new WaveformAxis(this, this._viewOptions);\n\n  this._axis.addToLayer(this._axisLayer);\n  this._stage.add(this._axisLayer);\n};\n\nWaveformOverview.prototype.removeHighlightRect = function() {\n  this._highlightLayer.removeHighlight();\n};\n\nWaveformOverview.prototype._updateWaveform = function() {\n  this._waveformLayer.draw();\n  this._axisLayer.draw();\n\n  const playheadTime = this._peaks.player.getCurrentTime();\n\n  this._playheadLayer.updatePlayheadTime(playheadTime);\n\n  this._highlightLayer.updateHighlight();\n\n  const frameStartTime = 0;\n  const frameEndTime   = this.pixelsToTime(this._width);\n\n  this._pointsLayer.updatePoints(frameStartTime, frameEndTime);\n  this._segmentsLayer.updateSegments(frameStartTime, frameEndTime);\n};\n\nWaveformOverview.prototype.setWaveformColor = function(color) {\n  this._waveformColor = color;\n  this._waveformShape.setWaveformColor(color);\n};\n\nWaveformOverview.prototype.setPlayedWaveformColor = function(color) {\n  this._playedWaveformColor = color;\n\n  if (color) {\n    if (!this._playedWaveformShape) {\n      this._createWaveformShapes();\n    }\n\n    this._playedWaveformShape.setWaveformColor(color);\n  }\n  else {\n    if (this._playedWaveformShape) {\n      this._destroyPlayedWaveformShape();\n    }\n  }\n};\n\nWaveformOverview.prototype.showPlayheadTime = function(show) {\n  this._playheadLayer.showPlayheadTime(show);\n};\n\nWaveformOverview.prototype.setTimeLabelPrecision = function(precision) {\n  this._timeLabelPrecision = precision;\n  this._playheadLayer.updatePlayheadText();\n};\n\nWaveformOverview.prototype.formatTime = function(time) {\n  return this._formatPlayheadTime(time);\n};\n\nWaveformOverview.prototype.showAxisLabels = function(show) {\n  this._axis.showAxisLabels(show);\n  this._axisLayer.draw();\n};\n\nWaveformOverview.prototype.enableMarkerEditing = function(enable) {\n  this._segmentsLayer.enableEditing(enable);\n  this._pointsLayer.enableEditing(enable);\n};\n\nWaveformOverview.prototype.fitToContainer = function() {\n  if (this._container.clientWidth === 0 && this._container.clientHeight === 0) {\n    return;\n  }\n\n  let updateWaveform = false;\n\n  if (this._container.clientWidth !== this._width) {\n    this._width = this._container.clientWidth;\n    this._stage.setWidth(this._width);\n\n    try {\n      this._data = this._originalWaveformData.resample({ width: this._width });\n      updateWaveform = true;\n    }\n    catch (error) {\n      // Ignore, and leave this._data as it was\n    }\n  }\n\n  this._height = this._container.clientHeight;\n  this._stage.setHeight(this._height);\n\n  this._waveformShape.fitToView();\n  this._playheadLayer.fitToView();\n  this._segmentsLayer.fitToView();\n  this._pointsLayer.fitToView();\n  this._highlightLayer.fitToView();\n\n  if (updateWaveform) {\n    this._updateWaveform();\n  }\n\n  this._stage.draw();\n};\n\nWaveformOverview.prototype.getViewOptions = function() {\n  return this._viewOptions;\n};\n\nWaveformOverview.prototype.destroy = function() {\n  if (this._resizeTimeoutId) {\n    clearTimeout(this._resizeTimeoutId);\n    this._resizeTimeoutId = null;\n  }\n\n  this._peaks.off('player.playing', this._onPlaying);\n  this._peaks.off('player.pause', this._onPause);\n  this._peaks.off('player.timeupdate', this._onTimeUpdate);\n  this._peaks.off('zoomview.displaying', this._onZoomviewDisplaying);\n  this._peaks.off('window_resize', this._onWindowResize);\n\n  this._playheadLayer.destroy();\n  this._segmentsLayer.destroy();\n  this._pointsLayer.destroy();\n\n  if (this._stage) {\n    this._stage.destroy();\n    this._stage = null;\n  }\n};\n\nexport default WaveformOverview;\n","/**\n * @file\n *\n * Defines the {@link WaveformZoomView} class.\n *\n * @module waveform-zoomview\n */\n\nimport MouseDragHandler from './mouse-drag-handler';\nimport PlayheadLayer from './playhead-layer';\nimport PointsLayer from './points-layer';\nimport SegmentsLayer from './segments-layer';\nimport WaveformAxis from './waveform-axis';\nimport WaveformShape from './waveform-shape';\nimport { clamp, formatTime, getMarkerObject, isFinite, isNumber, isValidTime,\n  objectHasProperty } from './utils';\n\nimport Konva from 'konva/lib/Core';\n\n/**\n * Creates a zoomable waveform view.\n *\n * @class\n * @alias WaveformZoomView\n *\n * @param {WaveformData} waveformData\n * @param {HTMLElement} container\n * @param {Peaks} peaks\n */\n\nfunction WaveformZoomView(waveformData, container, peaks) {\n  const self = this;\n\n  self._container = container;\n  self._peaks = peaks;\n  self._options = peaks.options;\n  self._viewOptions = self._options.zoomview;\n  self._enableWaveformCache = self._options.waveformCache;\n  self._originalWaveformData = waveformData;\n  self._initWaveformCache();\n\n  // Bind event handlers\n  self._onTimeUpdate = self._onTimeUpdate.bind(self);\n  self._onPlaying = self._onPlaying.bind(self);\n  self._onPause = self._onPause.bind(self);\n  self._onWindowResize = self._onWindowResize.bind(self);\n  self._onKeyboardLeft = self._onKeyboardLeft.bind(self);\n  self._onKeyboardRight = self._onKeyboardRight.bind(self);\n  self._onKeyboardShiftLeft  = self._onKeyboardShiftLeft.bind(self);\n  self._onKeyboardShiftRight = self._onKeyboardShiftRight.bind(self);\n\n  // Register event handlers\n  self._peaks.on('player.timeupdate', self._onTimeUpdate);\n  self._peaks.on('player.playing', self._onPlaying);\n  self._peaks.on('player.pause', self._onPause);\n  self._peaks.on('window_resize', self._onWindowResize);\n  self._peaks.on('keyboard.left', self._onKeyboardLeft);\n  self._peaks.on('keyboard.right', self._onKeyboardRight);\n  self._peaks.on('keyboard.shift_left', self._onKeyboardShiftLeft);\n  self._peaks.on('keyboard.shift_right', self._onKeyboardShiftRight);\n\n  self._autoScroll = self._viewOptions.autoScroll;\n  self._autoScrollOffset = self._viewOptions.autoScrollOffset;\n\n  self._amplitudeScale = 1.0;\n  self._timeLabelPrecision = self._viewOptions.timeLabelPrecision;\n  self._enableSeek = true;\n  self._enableSegmentDragging = false;\n  self._segmentDragMode = 'overlap';\n  self._minSegmentDragWidth = 0;\n  self._waveformDragMode = 'scroll';\n  self._insertSegmentShape = null;\n\n  if (self._viewOptions.formatPlayheadTime) {\n    self._formatPlayheadTime = self._viewOptions.formatPlayheadTime;\n  }\n  else {\n    self._formatPlayheadTime = function(time) {\n      return formatTime(time, self._timeLabelPrecision);\n    };\n  }\n\n  self._playheadClickTolerance = self._viewOptions.playheadClickTolerance;\n\n  self._data = null;\n  self._pixelLength = 0;\n\n  const initialZoomLevel = peaks.zoom.getZoomLevel();\n\n  self._zoomLevelAuto = false;\n  self._zoomLevelSeconds = null;\n\n  self._resizeTimeoutId = null;\n  self._resampleData({ scale: initialZoomLevel });\n\n  self._width = container.clientWidth;\n  self._height = container.clientHeight;\n\n  // The pixel offset of the current frame being displayed\n  self._frameOffset = 0;\n\n  self._stage = new Konva.Stage({\n    container: container,\n    width: self._width,\n    height: self._height\n  });\n\n  self._waveformColor = self._viewOptions.waveformColor;\n  self._playedWaveformColor = self._viewOptions.playedWaveformColor;\n\n  self._createWaveform();\n\n  if (self._viewOptions.enableSegments) {\n    self._segmentsLayer = new SegmentsLayer(peaks, self, true);\n    self._segmentsLayer.addToStage(self._stage);\n  }\n\n  if (self._viewOptions.enablePoints) {\n    self._pointsLayer = new PointsLayer(peaks, self, true);\n    self._pointsLayer.addToStage(self._stage);\n  }\n\n  self._createAxisLabels();\n\n  self._playheadLayer = new PlayheadLayer({\n    player: self._peaks.player,\n    view: self,\n    showPlayheadTime: self._viewOptions.showPlayheadTime,\n    playheadColor: self._viewOptions.playheadColor,\n    playheadTextColor: self._viewOptions.playheadTextColor,\n    playheadFontFamily: self._viewOptions.fontFamily,\n    playheadFontSize: self._viewOptions.fontSize,\n    playheadFontStyle: self._viewOptions.fontStyle\n  });\n\n  self._playheadLayer.addToStage(self._stage);\n\n  const time = self._peaks.player.getCurrentTime();\n\n  self._syncPlayhead(time);\n\n  self._createMouseDragHandler();\n\n  self._onWheel = self._onWheel.bind(self);\n  self._onWheelCaptureVerticalScroll = self._onWheelCaptureVerticalScroll.bind(self);\n  self.setWheelMode(self._viewOptions.wheelMode);\n\n  self._onClick = self._onClick.bind(this);\n  self._onDblClick = self._onDblClick.bind(this);\n  self._onContextMenu = self._onContextMenu.bind(this);\n\n  self._stage.on('click', self._onClick);\n  self._stage.on('dblclick', self._onDblClick);\n  self._stage.on('contextmenu', self._onContextMenu);\n}\n\nWaveformZoomView.prototype._initWaveformCache = function() {\n  if (this._enableWaveformCache) {\n    this._waveformData = new Map();\n    this._waveformData.set(this._originalWaveformData.scale, this._originalWaveformData);\n    this._waveformScales = [this._originalWaveformData.scale];\n  }\n};\n\nWaveformZoomView.prototype._createMouseDragHandler = function() {\n  const self = this;\n\n  self._mouseDragHandler = new MouseDragHandler(self._stage, {\n    onMouseDown: function(mousePosX, segment) {\n      if (self._waveformDragMode === 'insert-segment') {\n        const time = self.pixelsToTime(mousePosX + self._frameOffset);\n\n        const segment = self._peaks.segments.add({\n          startTime: time,\n          endTime: time,\n          editable: true\n        });\n\n        self._insertSegmentShape = self._segmentsLayer.getSegmentShape(segment.id);\n\n        if (self._insertSegmentShape) {\n          self._insertSegmentShape.moveMarkersToTop();\n          self._insertSegmentShape.startDrag();\n        }\n      }\n      else {\n        this._seeking = false;\n        this._segment = segment;\n\n        const playheadOffset = self._playheadLayer.getPlayheadOffset();\n\n        if (self._enableSeek &&\n            Math.abs(mousePosX - playheadOffset) <= self._playheadClickTolerance) {\n          this._seeking = true;\n\n          // The user has clicked near the playhead, and the playhead is within\n          // a segment. In this case we want to allow the playhead to move, but\n          // prevent the segment from being dragged. So we temporarily make the\n          // segment non-draggable, and restore its draggable state in onMouseUp().\n          if (this._segment) {\n            this._segmentIsDraggable = this._segment.draggable();\n            this._segment.draggable(false);\n          }\n        }\n\n        if (this._seeking) {\n          this._seek(mousePosX);\n        }\n        else {\n          this.initialFrameOffset = self._frameOffset;\n          this.mouseDownX = mousePosX;\n        }\n      }\n    },\n\n    onMouseMove: function(mousePosX) {\n      if (self._waveformDragMode === 'scroll') {\n        // Prevent scrolling the waveform if the user is dragging a segment.\n        if (this._segment && !this._seeking) {\n          return;\n        }\n\n        if (this._seeking) {\n          this._seek(mousePosX);\n        }\n        else {\n          // Moving the mouse to the left increases the time position of the\n          // left-hand edge of the visible waveform.\n          const diff = this.mouseDownX - mousePosX;\n          const newFrameOffset = this.initialFrameOffset + diff;\n\n          if (newFrameOffset !== this.initialFrameOffset) {\n            self.updateWaveform(newFrameOffset);\n          }\n        }\n      }\n    },\n\n    onMouseUp: function(/* mousePosX */) {\n      if (self._waveformDragMode === 'insert-segment') {\n        if (self._insertSegmentShape) {\n          self._insertSegmentShape.stopDrag();\n          self._insertSegmentShape = null;\n        }\n      }\n      else {\n        if (!this._seeking) {\n          // Set playhead position only on click release, when not dragging.\n          if (self._enableSeek && !self._mouseDragHandler.isDragging()) {\n            let time = self.pixelOffsetToTime(this.mouseDownX);\n            const duration = self._getDuration();\n\n            // Prevent the playhead position from jumping by limiting click\n            // handling to the waveform duration.\n            if (time > duration) {\n              time = duration;\n            }\n\n            self._playheadLayer.updatePlayheadTime(time);\n\n            self._peaks.player.seek(time);\n          }\n        }\n\n        // If the user was dragging the playhead while the playhead is within\n        // a segment, restore the segment's original draggable state.\n        if (this._segment && this._seeking) {\n          if (this._segmentIsDraggable) {\n            this._segment.draggable(true);\n          }\n        }\n      }\n    },\n\n    _seek: function(mousePosX) {\n      mousePosX = clamp(mousePosX, 0, self._width);\n\n      let time = self.pixelsToTime(mousePosX + self._frameOffset);\n      const duration = self._getDuration();\n\n      // Prevent the playhead position from jumping by limiting click\n      // handling to the waveform duration.\n      if (time > duration) {\n        time = duration;\n      }\n\n      // Update the playhead position. This gives a smoother visual update\n      // than if we only use the player.timeupdate event.\n      self._playheadLayer.updatePlayheadTime(time);\n\n      self._peaks.player.seek(time);\n    }\n  });\n};\n\nWaveformZoomView.prototype.enableSeek = function(enable) {\n  this._enableSeek = enable;\n};\n\nWaveformZoomView.prototype._onClick = function(event) {\n  this._clickHandler(event, 'click');\n};\n\nWaveformZoomView.prototype._onDblClick = function(event) {\n  this._clickHandler(event, 'dblclick');\n};\n\nWaveformZoomView.prototype._onContextMenu = function(event) {\n  this._clickHandler(event, 'contextmenu');\n};\n\nWaveformZoomView.prototype._clickHandler = function(event, eventName) {\n  let emitViewEvent = true;\n\n  if (event.target !== this._stage) {\n    const marker = getMarkerObject(event.target);\n\n    if (marker) {\n      if (marker.attrs.name === 'point-marker') {\n        const point = marker.getAttr('point');\n\n        if (point) {\n          this._peaks.emit('points.' + eventName, {\n            point: point,\n            evt: event.evt,\n            preventViewEvent: function() {\n              emitViewEvent = false;\n            }\n          });\n        }\n      }\n      else if (marker.attrs.name === 'segment-overlay') {\n        const segment = marker.getAttr('segment');\n\n        if (segment) {\n          const clickEvent = {\n            segment: segment,\n            evt: event.evt,\n            preventViewEvent: function() {\n              emitViewEvent = false;\n            }\n          };\n\n          if (this._segmentsLayer) {\n            this._segmentsLayer.segmentClicked(eventName, clickEvent);\n          }\n        }\n      }\n    }\n  }\n\n  if (emitViewEvent) {\n    const mousePosX = event.evt.layerX;\n    const time = this.pixelOffsetToTime(mousePosX);\n\n    this._peaks.emit('zoomview.' + eventName, {\n      time: time,\n      evt: event.evt\n    });\n  }\n};\n\nWaveformZoomView.prototype.setWheelMode = function(mode, options) {\n  if (!options) {\n    options = {};\n  }\n\n  if (mode !== this._wheelMode ||\n      options.captureVerticalScroll !== this._captureVerticalScroll) {\n    this._stage.off('wheel');\n\n    this._wheelMode = mode;\n    this._captureVerticalScroll = options.captureVerticalScroll;\n\n    switch (mode) {\n      case 'scroll':\n        if (options.captureVerticalScroll) {\n          this._stage.on('wheel', this._onWheelCaptureVerticalScroll);\n        }\n        else {\n          this._stage.on('wheel', this._onWheel);\n        }\n        break;\n    }\n  }\n};\n\nWaveformZoomView.prototype._onWheel = function(event) {\n  const wheelEvent = event.evt;\n  let delta;\n\n  if (wheelEvent.shiftKey) {\n    if (wheelEvent.deltaY !== 0) {\n      delta = wheelEvent.deltaY;\n    }\n    else if (wheelEvent.deltaX !== 0) {\n      delta = wheelEvent.deltaX;\n    }\n    else {\n      return;\n    }\n  }\n  else {\n    // Ignore the event if it looks like the user is scrolling vertically\n    // down the page\n    if (Math.abs(wheelEvent.deltaX) < Math.abs(wheelEvent.deltaY)) {\n      return;\n    }\n\n    delta = wheelEvent.deltaX;\n  }\n\n  if (wheelEvent.deltaMode === WheelEvent.DOM_DELTA_PAGE) {\n    delta *= this._width;\n  }\n\n  wheelEvent.preventDefault();\n\n  const newFrameOffset = clamp(\n    this._frameOffset + Math.floor(delta), 0, this._pixelLength - this._width\n  );\n\n  this.updateWaveform(newFrameOffset);\n};\n\nWaveformZoomView.prototype._onWheelCaptureVerticalScroll = function(event) {\n  const wheelEvent = event.evt;\n\n  const delta = Math.abs(wheelEvent.deltaX) < Math.abs(wheelEvent.deltaY) ?\n    wheelEvent.deltaY : wheelEvent.deltaX;\n\n  wheelEvent.preventDefault();\n\n  const newFrameOffset = clamp(\n    this._frameOffset + Math.floor(delta), 0, this._pixelLength - this._width\n  );\n\n  this.updateWaveform(newFrameOffset);\n};\n\nWaveformZoomView.prototype.setWaveformDragMode = function(mode) {\n  this._waveformDragMode = mode;\n};\n\nWaveformZoomView.prototype.enableSegmentDragging = function(enable) {\n  this._enableSegmentDragging = enable;\n\n  // Update all existing segments\n  if (this._segmentsLayer) {\n    this._segmentsLayer.enableSegmentDragging(enable);\n  }\n};\n\nWaveformZoomView.prototype.isSegmentDraggingEnabled = function() {\n  return this._enableSegmentDragging;\n};\n\nWaveformZoomView.prototype.setSegmentDragMode = function(mode) {\n  this._segmentDragMode = mode;\n};\n\nWaveformZoomView.prototype.getSegmentDragMode = function() {\n  return this._segmentDragMode;\n};\n\nWaveformZoomView.prototype.getName = function() {\n  return 'zoomview';\n};\n\nWaveformZoomView.prototype._onTimeUpdate = function(time) {\n  if (this._mouseDragHandler.isDragging()) {\n    return;\n  }\n\n  this._syncPlayhead(time);\n};\n\nWaveformZoomView.prototype._onPlaying = function(time) {\n  this._playheadLayer.updatePlayheadTime(time);\n};\n\nWaveformZoomView.prototype._onPause = function(time) {\n  this._playheadLayer.stop(time);\n};\n\nWaveformZoomView.prototype._onWindowResize = function() {\n  const self = this;\n\n  const width = self._container.clientWidth;\n\n  if (!self._zoomLevelAuto) {\n    if (width !== 0) {\n      self._width = width;\n      self._stage.width(width);\n      self.updateWaveform(self._frameOffset);\n    }\n  }\n  else {\n    if (self._resizeTimeoutId) {\n      clearTimeout(self._resizeTimeoutId);\n      self._resizeTimeoutId = null;\n    }\n\n    // Avoid resampling waveform data to zero width\n    if (width !== 0) {\n      self._width = width;\n      self._stage.width(width);\n\n      self._resizeTimeoutId = setTimeout(function() {\n        self._width = width;\n        self._data = self._originalWaveformData.resample(width);\n        self._stage.width(width);\n\n        self.updateWaveform(self._frameOffset);\n      }, 500);\n    }\n  }\n};\n\nWaveformZoomView.prototype._onKeyboardLeft = function() {\n  this._keyboardScroll(-1, false);\n};\n\nWaveformZoomView.prototype._onKeyboardRight = function() {\n  this._keyboardScroll(1, false);\n};\n\nWaveformZoomView.prototype._onKeyboardShiftLeft = function() {\n  this._keyboardScroll(-1, true);\n};\n\nWaveformZoomView.prototype._onKeyboardShiftRight = function() {\n  this._keyboardScroll(1, true);\n};\n\nWaveformZoomView.prototype._keyboardScroll = function(direction, large) {\n  let increment;\n\n  if (large) {\n    increment = direction * this._width;\n  }\n  else {\n    increment = direction * this.timeToPixels(this._options.nudgeIncrement);\n  }\n\n  this.scrollWaveform({ pixels: increment });\n};\n\nWaveformZoomView.prototype.setWaveformData = function(waveformData) {\n  this._originalWaveformData = waveformData;\n  // Clear cached waveforms\n  this._initWaveformCache();\n\n  // Don't update the UI here, call setZoom().\n};\n\nWaveformZoomView.prototype.playheadPosChanged = function(time) {\n  if (this._playedWaveformShape) {\n    this._playedSegment.endTime = time;\n    this._unplayedSegment.startTime = time;\n\n    this._drawWaveformLayer();\n  }\n};\n\nWaveformZoomView.prototype._syncPlayhead = function(time) {\n  this._playheadLayer.updatePlayheadTime(time);\n\n  if (this._autoScroll) {\n    // Check for the playhead reaching the right-hand side of the window.\n\n    const pixelIndex = this.timeToPixels(time);\n\n    // TODO: move this code to animation function?\n    // TODO: don't scroll if user has positioned view manually (e.g., using\n    // the keyboard)\n    const endThreshold = this._frameOffset + this._width - this._autoScrollOffset;\n\n    if (pixelIndex >= endThreshold || pixelIndex < this._frameOffset) {\n      // Put the playhead at 100 pixels from the left edge\n      this._frameOffset = pixelIndex - this._autoScrollOffset;\n\n      if (this._frameOffset < 0) {\n        this._frameOffset = 0;\n      }\n\n      this.updateWaveform(this._frameOffset);\n    }\n  }\n};\n\nWaveformZoomView.prototype._getScale = function(duration) {\n  return duration * this._data.sample_rate / this._width;\n};\n\nfunction isAutoScale(options) {\n  return ((objectHasProperty(options, 'scale') && options.scale === 'auto') ||\n          (objectHasProperty(options, 'seconds') && options.seconds === 'auto'));\n}\n\n/**\n * Options for [WaveformZoomView.setZoom]{@link WaveformZoomView#setZoom}.\n *\n * @typedef {Object} SetZoomOptions\n * @global\n * @property {Number|String} scale Zoom level, in samples per pixel, or 'auto'\n *   to fit the entire waveform to the view width\n * @property {Number|String} seconds Number of seconds to fit to the view width,\n *   or 'auto' to fit the entire waveform to the view width\n */\n\n/**\n * Changes the zoom level.\n *\n * @param {SetZoomOptions} options\n * @returns {Boolean}\n */\n\nWaveformZoomView.prototype.setZoom = function(options) {\n  let scale;\n\n  if (isAutoScale(options)) {\n    const seconds = this._peaks.player.getDuration();\n\n    if (!isValidTime(seconds)) {\n      return false;\n    }\n\n    this._zoomLevelAuto = true;\n    this._zoomLevelSeconds = null;\n    scale = this._getScale(seconds);\n  }\n  else {\n    if (objectHasProperty(options, 'scale')) {\n      this._zoomLevelSeconds = null;\n      scale = options.scale;\n    }\n    else if (objectHasProperty(options, 'seconds')) {\n      if (!isValidTime(options.seconds)) {\n        return false;\n      }\n\n      this._zoomLevelSeconds = options.seconds;\n      scale = this._getScale(options.seconds);\n    }\n\n    this._zoomLevelAuto = false;\n  }\n\n  if (scale < this._originalWaveformData.scale) {\n    // eslint-disable-next-line max-len\n    this._peaks._logger('peaks.zoomview.setZoom(): zoom level must be at least ' + this._originalWaveformData.scale);\n    scale = this._originalWaveformData.scale;\n  }\n\n  const currentTime = this._peaks.player.getCurrentTime();\n  let apexTime;\n  let playheadOffsetPixels = this._playheadLayer.getPlayheadOffset();\n\n  if (playheadOffsetPixels >= 0 && playheadOffsetPixels < this._width) {\n    // Playhead is visible. Change the zoom level while keeping the\n    // playhead at the same position in the window.\n    apexTime = currentTime;\n  }\n  else {\n    // Playhead is not visible. Change the zoom level while keeping the\n    // centre of the window at the same position in the waveform.\n    playheadOffsetPixels = Math.floor(this._width / 2);\n    apexTime = this.pixelOffsetToTime(playheadOffsetPixels);\n  }\n\n  const prevScale = this._scale;\n\n  this._resampleData({ scale: scale });\n\n  const apexPixel = this.timeToPixels(apexTime);\n\n  this._frameOffset = apexPixel - playheadOffsetPixels;\n\n  this.updateWaveform(this._frameOffset);\n\n  this._playheadLayer.zoomLevelChanged();\n\n  // Update the playhead position after zooming.\n  this._playheadLayer.updatePlayheadTime(currentTime);\n\n  this._peaks.emit('zoom.update', scale, prevScale);\n\n  return true;\n};\n\nWaveformZoomView.prototype._resampleData = function(options) {\n  const scale = options.scale;\n\n  if (this._enableWaveformCache) {\n    if (!this._waveformData.has(scale)) {\n      let sourceWaveform = this._originalWaveformData;\n\n      // Resample from the next lowest available zoom level\n\n      for (let i = 0; i < this._waveformScales.length; i++) {\n        if (this._waveformScales[i] < scale) {\n          sourceWaveform = this._waveformData.get(this._waveformScales[i]);\n        }\n        else {\n          break;\n        }\n      }\n\n      this._waveformData.set(scale, sourceWaveform.resample(options));\n\n      this._waveformScales.push(scale);\n      this._waveformScales.sort(function(a, b) {\n        return a - b; // Ascending order\n      });\n    }\n\n    this._data = this._waveformData.get(scale);\n  }\n  else {\n    this._data = this._originalWaveformData.resample(options);\n  }\n\n  this._scale = this._data.scale;\n  this._pixelLength = this._data.length;\n};\n\nWaveformZoomView.prototype.getStartTime = function() {\n  return this.pixelOffsetToTime(0);\n};\n\nWaveformZoomView.prototype.getEndTime = function() {\n  return this.pixelOffsetToTime(this._width);\n};\n\nWaveformZoomView.prototype.setStartTime = function(time) {\n  if (time < 0) {\n    time = 0;\n  }\n\n  if (this._zoomLevelAuto) {\n    time = 0;\n  }\n\n  this.updateWaveform(this.timeToPixels(time));\n};\n\n/**\n * Returns the pixel index for a given time, for the current zoom level.\n *\n * @param {Number} time Time, in seconds.\n * @returns {Number} Pixel index.\n */\n\nWaveformZoomView.prototype.timeToPixels = function(time) {\n  return Math.floor(time * this._data.sample_rate / this._data.scale);\n};\n\n/**\n * Returns the time for a given pixel index, for the current zoom level.\n *\n * @param {Number} pixels Pixel index.\n * @returns {Number} Time, in seconds.\n */\n\nWaveformZoomView.prototype.pixelsToTime = function(pixels) {\n  return pixels * this._data.scale / this._data.sample_rate;\n};\n\n/**\n * Returns the time for a given pixel offset (relative to the\n * current scroll position), for the current zoom level.\n *\n * @param {Number} offset Offset from left-visible-edge of view\n * @returns {Number} Time, in seconds.\n */\n\nWaveformZoomView.prototype.pixelOffsetToTime = function(offset) {\n  const pixels = this._frameOffset + offset;\n\n  return pixels * this._data.scale / this._data.sample_rate;\n};\n\nWaveformZoomView.prototype.timeToPixelOffset = function(time) {\n  return Math.floor(time * this._data.sample_rate / this._data.scale) - this._frameOffset;\n};\n\n/**\n * @returns {Number} The start position of the waveform shown in the view,\n *   in pixels.\n */\n\nWaveformZoomView.prototype.getFrameOffset = function() {\n  return this._frameOffset;\n};\n\n/**\n * @returns {Number} The width of the view, in pixels.\n */\n\nWaveformZoomView.prototype.getWidth = function() {\n  return this._width;\n};\n\n/**\n * @returns {Number} The height of the view, in pixels.\n */\n\nWaveformZoomView.prototype.getHeight = function() {\n  return this._height;\n};\n\n/**\n * @returns {Number} The length of the waveform, in pixels.\n */\nWaveformZoomView.prototype.getPixelLength = function() {\n  return this._pixelLength;\n};\n\n/**\n * @returns {Number} The media duration, in seconds.\n */\n\nWaveformZoomView.prototype._getDuration = function() {\n  return this._peaks.player.getDuration();\n};\n\n/**\n * Adjusts the amplitude scale of waveform shown in the view, which allows\n * users to zoom the waveform vertically.\n *\n * @param {Number} scale The new amplitude scale factor\n */\n\nWaveformZoomView.prototype.setAmplitudeScale = function(scale) {\n  if (!isNumber(scale) || !isFinite(scale)) {\n    throw new Error('view.setAmplitudeScale(): Scale must be a valid number');\n  }\n\n  this._amplitudeScale = scale;\n\n  this._drawWaveformLayer();\n\n  if (this._segmentsLayer) {\n    this._segmentsLayer.draw();\n  }\n};\n\nWaveformZoomView.prototype.getAmplitudeScale = function() {\n  return this._amplitudeScale;\n};\n\n/**\n * @returns {WaveformData} The view's waveform data.\n */\n\nWaveformZoomView.prototype.getWaveformData = function() {\n  return this._data;\n};\n\nWaveformZoomView.prototype._createWaveformShapes = function() {\n  if (!this._waveformShape) {\n    this._waveformShape = new WaveformShape({\n      color: this._waveformColor,\n      view: this\n    });\n\n    this._waveformShape.addToLayer(this._waveformLayer);\n  }\n\n  if (this._playedWaveformColor && !this._playedWaveformShape) {\n    const time = this._peaks.player.getCurrentTime();\n\n    this._playedSegment = {\n      startTime: 0,\n      endTime: time\n    };\n\n    this._unplayedSegment = {\n      startTime: time,\n      endTime: this._getDuration()\n    };\n\n    this._waveformShape.setSegment(this._unplayedSegment);\n\n    this._playedWaveformShape = new WaveformShape({\n      color: this._playedWaveformColor,\n      view: this,\n      segment: this._playedSegment\n    });\n\n    this._playedWaveformShape.addToLayer(this._waveformLayer);\n  }\n};\n\nWaveformZoomView.prototype._destroyPlayedWaveformShape = function() {\n  this._waveformShape.setSegment(null);\n\n  this._playedWaveformShape.destroy();\n  this._playedWaveformShape = null;\n\n  this._playedSegment = null;\n  this._unplayedSegment = null;\n};\n\nWaveformZoomView.prototype._createWaveform = function() {\n  this._waveformLayer = new Konva.Layer({ listening: false });\n\n  this._createWaveformShapes();\n\n  this._stage.add(this._waveformLayer);\n\n  this._peaks.emit('zoomview.displaying', 0, this.getEndTime());\n};\n\nWaveformZoomView.prototype._createAxisLabels = function() {\n  this._axisLayer = new Konva.Layer({ listening: false });\n  this._axis = new WaveformAxis(this, this._viewOptions);\n\n  this._axis.addToLayer(this._axisLayer);\n  this._stage.add(this._axisLayer);\n};\n\n/**\n * Scrolls the region of waveform shown in the view.\n *\n * @param {Number} scrollAmount How far to scroll, in pixels\n */\n\nWaveformZoomView.prototype.scrollWaveform = function(options) {\n  let scrollAmount;\n\n  if (objectHasProperty(options, 'pixels')) {\n    scrollAmount = Math.floor(options.pixels);\n  }\n  else if (objectHasProperty(options, 'seconds')) {\n    scrollAmount = this.timeToPixels(options.seconds);\n  }\n  else {\n    throw new TypeError('view.scrollWaveform(): Missing umber of pixels or seconds');\n  }\n\n  this.updateWaveform(this._frameOffset + scrollAmount);\n};\n\n/**\n * Updates the region of waveform shown in the view.\n *\n * @param {Number} frameOffset The new frame offset, in pixels.\n */\n\nWaveformZoomView.prototype.updateWaveform = function(frameOffset) {\n  let upperLimit;\n\n  if (this._pixelLength < this._width) {\n    // Total waveform is shorter than viewport, so reset the offset to 0.\n    frameOffset = 0;\n    upperLimit = this._width;\n  }\n  else {\n    // Calculate the very last possible position.\n    upperLimit = this._pixelLength - this._width;\n  }\n\n  frameOffset = clamp(frameOffset, 0, upperLimit);\n\n  this._frameOffset = frameOffset;\n\n  // Display playhead if it is within the zoom frame width.\n  const playheadPixel = this._playheadLayer.getPlayheadPixel();\n\n  this._playheadLayer.updatePlayheadTime(this.pixelsToTime(playheadPixel));\n\n  this._drawWaveformLayer();\n  this._axisLayer.draw();\n\n  const frameStartTime = this.getStartTime();\n  const frameEndTime   = this.getEndTime();\n\n  if (this._pointsLayer) {\n    this._pointsLayer.updatePoints(frameStartTime, frameEndTime);\n  }\n\n  if (this._segmentsLayer) {\n    this._segmentsLayer.updateSegments(frameStartTime, frameEndTime);\n  }\n\n  this._peaks.emit('zoomview.displaying', frameStartTime, frameEndTime);\n};\n\nWaveformZoomView.prototype._drawWaveformLayer = function() {\n  this._waveformLayer.draw();\n};\n\nWaveformZoomView.prototype.setWaveformColor = function(color) {\n  this._waveformColor = color;\n  this._waveformShape.setWaveformColor(color);\n};\n\nWaveformZoomView.prototype.setPlayedWaveformColor = function(color) {\n  this._playedWaveformColor = color;\n\n  if (color) {\n    if (!this._playedWaveformShape) {\n      this._createWaveformShapes();\n    }\n\n    this._playedWaveformShape.setWaveformColor(color);\n  }\n  else {\n    if (this._playedWaveformShape) {\n      this._destroyPlayedWaveformShape();\n    }\n  }\n};\n\nWaveformZoomView.prototype.showPlayheadTime = function(show) {\n  this._playheadLayer.showPlayheadTime(show);\n};\n\nWaveformZoomView.prototype.setTimeLabelPrecision = function(precision) {\n  this._timeLabelPrecision = precision;\n  this._playheadLayer.updatePlayheadText();\n};\n\nWaveformZoomView.prototype.formatTime = function(time) {\n  return this._formatPlayheadTime(time);\n};\n\nWaveformZoomView.prototype.showAxisLabels = function(show) {\n  this._axis.showAxisLabels(show);\n  this._axisLayer.draw();\n};\n\nWaveformZoomView.prototype.enableAutoScroll = function(enable, options) {\n  this._autoScroll = enable;\n\n  if (objectHasProperty(options, 'offset')) {\n    this._autoScrollOffset = options.offset;\n  }\n};\n\nWaveformZoomView.prototype.enableMarkerEditing = function(enable) {\n  if (this._segmentsLayer) {\n    this._segmentsLayer.enableEditing(enable);\n  }\n\n  if (this._pointsLayer) {\n    this._pointsLayer.enableEditing(enable);\n  }\n};\n\nWaveformZoomView.prototype.getMinSegmentDragWidth = function() {\n  return this._insertSegmentShape ? 0 : this._minSegmentDragWidth;\n};\n\nWaveformZoomView.prototype.setMinSegmentDragWidth = function(width) {\n  this._minSegmentDragWidth = width;\n};\n\nWaveformZoomView.prototype.fitToContainer = function() {\n  if (this._container.clientWidth === 0 && this._container.clientHeight === 0) {\n    return;\n  }\n\n  let updateWaveform = false;\n\n  if (this._container.clientWidth !== this._width) {\n    this._width = this._container.clientWidth;\n    this._stage.width(this._width);\n\n    let resample = false;\n    let resampleOptions;\n\n    if (this._zoomLevelAuto) {\n      resample = true;\n      resampleOptions = { width: this._width };\n    }\n    else if (this._zoomLevelSeconds !== null) {\n      resample = true;\n      resampleOptions = { scale: this._getScale(this._zoomLevelSeconds) };\n    }\n\n    if (resample) {\n      try {\n        this._resampleData(resampleOptions);\n        updateWaveform = true;\n      }\n      catch (error) {\n        // Ignore, and leave this._data as it was\n      }\n    }\n  }\n\n  this._height = this._container.clientHeight;\n  this._stage.height(this._height);\n\n  this._waveformShape.fitToView();\n  this._playheadLayer.fitToView();\n\n  if (this._segmentsLayer) {\n    this._segmentsLayer.fitToView();\n  }\n\n  if (this._pointsLayer) {\n    this._pointsLayer.fitToView();\n  }\n\n  if (updateWaveform) {\n    this.updateWaveform(this._frameOffset);\n  }\n\n  this._stage.draw();\n};\n\nWaveformZoomView.prototype.getViewOptions = function() {\n  return this._viewOptions;\n};\n\nWaveformZoomView.prototype.destroy = function() {\n  if (this._resizeTimeoutId) {\n    clearTimeout(this._resizeTimeoutId);\n    this._resizeTimeoutId = null;\n  }\n\n  // Unregister event handlers\n  this._peaks.off('player.timeupdate', this._onTimeUpdate);\n  this._peaks.off('player.playing', this._onPlaying);\n  this._peaks.off('player.pause', this._onPause);\n  this._peaks.off('window_resize', this._onWindowResize);\n  this._peaks.off('keyboard.left', this._onKeyboardLeft);\n  this._peaks.off('keyboard.right', this._onKeyboardRight);\n  this._peaks.off('keyboard.shift_left', this._onKeyboardShiftLeft);\n  this._peaks.off('keyboard.shift_right', this._onKeyboardShiftRight);\n\n  this._playheadLayer.destroy();\n\n  if (this._segmentsLayer) {\n    this._segmentsLayer.destroy();\n  }\n\n  if (this._pointsLayer) {\n    this._pointsLayer.destroy();\n  }\n\n  if (this._stage) {\n    this._stage.destroy();\n    this._stage = null;\n  }\n};\n\nexport default WaveformZoomView;","/**\n * @file\n *\n * Defines the {@link ViewController} class.\n *\n * @module view-controller\n */\n\nimport WaveformOverview from './waveform-overview';\nimport WaveformZoomView from './waveform-zoomview';\nimport { isNullOrUndefined } from './utils';\n\n/**\n * Creates an object that allows users to create and manage waveform views.\n *\n * @class\n * @alias ViewController\n *\n * @param {Peaks} peaks\n */\n\nfunction ViewController(peaks) {\n  this._peaks = peaks;\n  this._overview = null;\n  this._zoomview = null;\n}\n\nViewController.prototype.createOverview = function(container) {\n  if (this._overview) {\n    return this._overview;\n  }\n\n  const waveformData = this._peaks.getWaveformData();\n\n  this._overview = new WaveformOverview(\n    waveformData,\n    container,\n    this._peaks\n  );\n\n  if (this._zoomview) {\n    this._overview.showHighlight(\n      this._zoomview.getStartTime(),\n      this._zoomview.getEndTime()\n    );\n  }\n\n  return this._overview;\n};\n\nViewController.prototype.createZoomview = function(container) {\n  if (this._zoomview) {\n    return this._zoomview;\n  }\n\n  const waveformData = this._peaks.getWaveformData();\n\n  this._zoomview = new WaveformZoomView(\n    waveformData,\n    container,\n    this._peaks\n  );\n\n  return this._zoomview;\n};\n\nViewController.prototype.destroyOverview = function() {\n  if (!this._overview) {\n    return;\n  }\n\n  if (!this._zoomview) {\n    return;\n  }\n\n  this._overview.destroy();\n  this._overview = null;\n};\n\nViewController.prototype.destroyZoomview = function() {\n  if (!this._zoomview) {\n    return;\n  }\n\n  if (!this._overview) {\n    return;\n  }\n\n  this._zoomview.destroy();\n  this._zoomview = null;\n\n  this._overview.removeHighlightRect();\n};\n\nViewController.prototype.destroy = function() {\n  if (this._overview) {\n    this._overview.destroy();\n    this._overview = null;\n  }\n\n  if (this._zoomview) {\n    this._zoomview.destroy();\n    this._zoomview = null;\n  }\n};\n\nViewController.prototype.getView = function(name) {\n  if (isNullOrUndefined(name)) {\n    if (this._overview && this._zoomview) {\n      return null;\n    }\n    else if (this._overview) {\n      return this._overview;\n    }\n    else if (this._zoomview) {\n      return this._zoomview;\n    }\n    else {\n      return null;\n    }\n  }\n  else {\n    switch (name) {\n      case 'overview':\n        return this._overview;\n\n      case 'zoomview':\n        return this._zoomview;\n\n      default:\n        return null;\n    }\n  }\n};\n\nexport default ViewController;\n","/**\n * @file\n *\n * Defines the {@link ZoomController} class.\n *\n * @module zoom-controller\n */\n\n/**\n * Creates an object to control zoom levels in a {@link WaveformZoomView}.\n *\n * @class\n * @alias ZoomController\n *\n * @param {Peaks} peaks\n * @param {Array<Integer>} zoomLevels\n */\n\nfunction ZoomController(peaks, zoomLevels) {\n  this._peaks = peaks;\n  this._zoomLevels = zoomLevels;\n  this._zoomLevelIndex = 0;\n}\n\nZoomController.prototype.setZoomLevels = function(zoomLevels) {\n  this._zoomLevels = zoomLevels;\n  this.setZoom(0, true);\n};\n\n/**\n * Zoom in one level.\n */\n\nZoomController.prototype.zoomIn = function() {\n  this.setZoom(this._zoomLevelIndex - 1);\n};\n\n/**\n * Zoom out one level.\n */\n\nZoomController.prototype.zoomOut = function() {\n  this.setZoom(this._zoomLevelIndex + 1);\n};\n\n/**\n * Given a particular zoom level, triggers a resampling of the data in the\n * zoomed view.\n *\n * @param {number} zoomLevelIndex An index into the options.zoomLevels array.\n */\n\nZoomController.prototype.setZoom = function(zoomLevelIndex, forceUpdate) {\n  if (zoomLevelIndex >= this._zoomLevels.length) {\n    zoomLevelIndex = this._zoomLevels.length - 1;\n  }\n\n  if (zoomLevelIndex < 0) {\n    zoomLevelIndex = 0;\n  }\n\n  if (!forceUpdate && (zoomLevelIndex === this._zoomLevelIndex)) {\n    // Nothing to do.\n    return;\n  }\n\n  this._zoomLevelIndex = zoomLevelIndex;\n\n  const zoomview = this._peaks.views.getView('zoomview');\n\n  if (!zoomview) {\n    return;\n  }\n\n  zoomview.setZoom({ scale: this._zoomLevels[zoomLevelIndex] });\n};\n\n/**\n * Returns the current zoom level index.\n *\n * @returns {Number}\n */\n\nZoomController.prototype.getZoom = function() {\n  return this._zoomLevelIndex;\n};\n\n/**\n * Returns the current zoom level, in samples per pixel.\n *\n * @returns {Number}\n */\n\nZoomController.prototype.getZoomLevel = function() {\n  return this._zoomLevels[this._zoomLevelIndex];\n};\n\nexport default ZoomController;\n","/**\n * @file\n *\n * Defines the {@link WaveformBuilder} class.\n *\n * @module waveform-builder\n */\n\nimport { isArrayBuffer, isObject, isString } from './utils';\nimport WaveformData from 'waveform-data';\n\nconst isXhr2 = ('withCredentials' in new XMLHttpRequest());\n\n/**\n * Creates and returns a WaveformData object, either by requesting the\n * waveform data from the server, or by creating the waveform data using the\n * Web Audio API.\n *\n * @class\n * @alias WaveformBuilder\n *\n * @param {Peaks} peaks\n */\n\nfunction WaveformBuilder(peaks) {\n  this._peaks = peaks;\n}\n\n/**\n * Options for requesting remote waveform data.\n *\n * @typedef {Object} RemoteWaveformDataOptions\n * @global\n * @property {String=} arraybuffer\n * @property {String=} json\n */\n\n/**\n * Options for supplying local waveform data.\n *\n * @typedef {Object} LocalWaveformDataOptions\n * @global\n * @property {ArrayBuffer=} arraybuffer\n * @property {Object=} json\n */\n\n/**\n * Options for the Web Audio waveform builder.\n *\n * @typedef {Object} WaveformBuilderWebAudioOptions\n * @global\n * @property {AudioContext} audioContext\n * @property {AudioBuffer=} audioBuffer\n * @property {Number=} scale\n * @property {Boolean=} multiChannel\n */\n\n/**\n * Options for [WaveformBuilder.init]{@link WaveformBuilder#init}.\n *\n * @typedef {Object} WaveformBuilderInitOptions\n * @global\n * @property {RemoteWaveformDataOptions=} dataUri\n * @property {LocalWaveformDataOptions=} waveformData\n * @property {WaveformBuilderWebAudioOptions=} webAudio\n * @property {Boolean=} withCredentials\n * @property {Array<Number>=} zoomLevels\n */\n\n/**\n * Callback for receiving the waveform data.\n *\n * @callback WaveformBuilderInitCallback\n * @global\n * @param {Error} error\n * @param {WaveformData} waveformData\n */\n\n/**\n * Loads or creates the waveform data.\n *\n * @private\n * @param {WaveformBuilderInitOptions} options\n * @param {WaveformBuilderInitCallback} callback\n */\n\nWaveformBuilder.prototype.init = function(options, callback) {\n  if ((options.dataUri && (options.webAudio || options.audioContext)) ||\n      (options.waveformData && (options.webAudio || options.audioContext)) ||\n      (options.dataUri && options.waveformData)) {\n    // eslint-disable-next-line max-len\n    callback(new TypeError('Peaks.init(): You may only pass one source (webAudio, dataUri, or waveformData) to render waveform data.'));\n    return;\n  }\n\n  if (options.audioContext) {\n    // eslint-disable-next-line max-len\n    this._peaks._logger('Peaks.init(): The audioContext option is deprecated, please pass a webAudio object instead');\n\n    options.webAudio = {\n      audioContext: options.audioContext\n    };\n  }\n\n  if (options.dataUri) {\n    return this._getRemoteWaveformData(options, callback);\n  }\n  else if (options.waveformData) {\n    return this._buildWaveformFromLocalData(options, callback);\n  }\n  else if (options.webAudio) {\n    if (options.webAudio.audioBuffer) {\n      return this._buildWaveformDataFromAudioBuffer(options, callback);\n    }\n    else {\n      return this._buildWaveformDataUsingWebAudio(options, callback);\n    }\n  }\n  else {\n    // eslint-disable-next-line max-len\n    callback(new Error('Peaks.init(): You must pass an audioContext, or dataUri, or waveformData to render waveform data'));\n  }\n};\n\n/* eslint-disable max-len */\n\n/**\n * Fetches waveform data, based on the given options.\n *\n * @private\n * @param {Object} options\n * @param {String|Object} options.dataUri\n * @param {String} options.dataUri.arraybuffer Waveform data URL\n *   (binary format)\n * @param {String} options.dataUri.json Waveform data URL (JSON format)\n * @param {String} options.defaultUriFormat Either 'arraybuffer' (for binary\n *   data) or 'json'\n * @param {WaveformBuilderInitCallback} callback\n *\n * @see Refer to the <a href=\"https://github.com/bbc/audiowaveform/blob/master/doc/DataFormat.md\">data format documentation</a>\n *   for details of the binary and JSON waveform data formats.\n */\n\n/* eslint-enable max-len */\n\nWaveformBuilder.prototype._getRemoteWaveformData = function(options, callback) {\n  const self = this;\n\n  let dataUri = null;\n  let requestType = null;\n  let url;\n\n  if (isObject(options.dataUri)) {\n    dataUri = options.dataUri;\n  }\n  else if (isString(options.dataUri)) {\n    // Backward compatibility\n    dataUri = {};\n    dataUri[options.dataUriDefaultFormat || 'json'] = options.dataUri;\n  }\n  else {\n    callback(new TypeError('Peaks.init(): The dataUri option must be an object'));\n    return;\n  }\n\n  ['ArrayBuffer', 'JSON'].some(function(connector) {\n    if (window[connector]) {\n      requestType = connector.toLowerCase();\n      url = dataUri[requestType];\n\n      return Boolean(url);\n    }\n  });\n\n  if (!url) {\n    // eslint-disable-next-line max-len\n    callback(new Error('Peaks.init(): Unable to determine a compatible dataUri format for this browser'));\n    return;\n  }\n\n  self._xhr = self._createXHR(url, requestType, options.withCredentials, function(event) {\n    if (this.readyState !== 4) {\n      return;\n    }\n\n    if (this.status !== 200) {\n      callback(\n        new Error('Unable to fetch remote data. HTTP status ' + this.status)\n      );\n\n      return;\n    }\n\n    self._xhr = null;\n\n    const waveformData = WaveformData.create(event.target.response);\n\n    if (waveformData.channels !== 1 && waveformData.channels !== 2) {\n      callback(new Error('Peaks.init(): Only mono or stereo waveforms are currently supported'));\n      return;\n    }\n    else if (waveformData.bits !== 8) {\n      callback(new Error('Peaks.init(): 16-bit waveform data is not supported'));\n      return;\n    }\n\n    callback(null, waveformData);\n  },\n  function() {\n    callback(new Error('XHR failed'));\n  },\n  function() {\n    callback(new Error('XHR aborted'));\n  });\n\n  self._xhr.send();\n};\n\n/* eslint-disable max-len */\n\n/**\n * Creates a waveform from given data, based on the given options.\n *\n * @private\n * @param {Object} options\n * @param {Object} options.waveformData\n * @param {ArrayBuffer} options.waveformData.arraybuffer Waveform data (binary format)\n * @param {Object} options.waveformData.json Waveform data (JSON format)\n * @param {WaveformBuilderInitCallback} callback\n *\n * @see Refer to the <a href=\"https://github.com/bbc/audiowaveform/blob/master/doc/DataFormat.md\">data format documentation</a>\n *   for details of the binary and JSON waveform data formats.\n */\n\n/* eslint-enable max-len */\n\nWaveformBuilder.prototype._buildWaveformFromLocalData = function(options, callback) {\n  let waveformData = null;\n  let data = null;\n\n  if (isObject(options.waveformData)) {\n    waveformData = options.waveformData;\n  }\n  else {\n    callback(new Error('Peaks.init(): The waveformData option must be an object'));\n    return;\n  }\n\n  if (isObject(waveformData.json)) {\n    data = waveformData.json;\n  }\n  else if (isArrayBuffer(waveformData.arraybuffer)) {\n    data = waveformData.arraybuffer;\n  }\n\n  if (!data) {\n    // eslint-disable-next-line max-len\n    callback(new Error('Peaks.init(): Unable to determine a compatible waveformData format'));\n    return;\n  }\n\n  try {\n    const createdWaveformData = WaveformData.create(data);\n\n    if (createdWaveformData.channels !== 1 && createdWaveformData.channels !== 2) {\n      callback(new Error('Peaks.init(): Only mono or stereo waveforms are currently supported'));\n      return;\n    }\n    else if (createdWaveformData.bits !== 8) {\n      callback(new Error('Peaks.init(): 16-bit waveform data is not supported'));\n      return;\n    }\n\n    callback(null, createdWaveformData);\n  }\n  catch (err) {\n    callback(err);\n  }\n};\n\n/**\n * Creates waveform data using the Web Audio API.\n *\n * @private\n * @param {Object} options\n * @param {AudioContext} options.audioContext\n * @param {HTMLMediaElement} options.mediaElement\n * @param {WaveformBuilderInitCallback} callback\n */\n\nWaveformBuilder.prototype._buildWaveformDataUsingWebAudio = function(options, callback) {\n  const self = this;\n\n  const audioContext = window.AudioContext || window.webkitAudioContext;\n\n  if (!(options.webAudio.audioContext instanceof audioContext)) {\n    // eslint-disable-next-line max-len\n    callback(new TypeError('Peaks.init(): The webAudio.audioContext option must be a valid AudioContext'));\n    return;\n  }\n\n  const webAudioOptions = options.webAudio;\n\n  if (webAudioOptions.scale !== options.zoomLevels[0]) {\n    webAudioOptions.scale = options.zoomLevels[0];\n  }\n\n  // If the media element has already selected which source to play, its\n  // currentSrc attribute will contain the source media URL. Otherwise,\n  // we wait for a canplay event to tell us when the media is ready.\n\n  const mediaSourceUrl = self._peaks.options.mediaElement.currentSrc;\n\n  if (mediaSourceUrl) {\n    self._requestAudioAndBuildWaveformData(\n      mediaSourceUrl,\n      webAudioOptions,\n      options.withCredentials,\n      callback\n    );\n  }\n  else {\n    self._peaks.once('player.canplay', function() {\n      self._requestAudioAndBuildWaveformData(\n        self._peaks.options.mediaElement.currentSrc,\n        webAudioOptions,\n        options.withCredentials,\n        callback\n      );\n    });\n  }\n};\n\nWaveformBuilder.prototype._buildWaveformDataFromAudioBuffer = function(options, callback) {\n  const webAudioOptions = options.webAudio;\n\n  if (webAudioOptions.scale !== options.zoomLevels[0]) {\n    webAudioOptions.scale = options.zoomLevels[0];\n  }\n\n  const webAudioBuilderOptions = {\n    audio_buffer: webAudioOptions.audioBuffer,\n    split_channels: webAudioOptions.multiChannel,\n    scale: webAudioOptions.scale,\n    disable_worker: true\n  };\n\n  WaveformData.createFromAudio(webAudioBuilderOptions, callback);\n};\n\n/**\n * Fetches the audio content, based on the given options, and creates waveform\n * data using the Web Audio API.\n *\n * @private\n * @param {url} The media source URL\n * @param {WaveformBuilderWebAudioOptions} webAudio\n * @param {Boolean} withCredentials\n * @param {WaveformBuilderInitCallback} callback\n */\n\nWaveformBuilder.prototype._requestAudioAndBuildWaveformData = function(url,\n    webAudio, withCredentials, callback) {\n  const self = this;\n\n  if (!url) {\n    self._peaks._logger('Peaks.init(): The mediaElement src is invalid');\n    return;\n  }\n\n  self._xhr = self._createXHR(url, 'arraybuffer', withCredentials, function(event) {\n    if (this.readyState !== 4) {\n      return;\n    }\n\n    if (this.status !== 200) {\n      callback(\n        new Error('Unable to fetch remote data. HTTP status ' + this.status)\n      );\n\n      return;\n    }\n\n    self._xhr = null;\n\n    const webAudioBuilderOptions = {\n      audio_context: webAudio.audioContext,\n      array_buffer: event.target.response,\n      split_channels: webAudio.multiChannel,\n      scale: webAudio.scale\n    };\n\n    WaveformData.createFromAudio(webAudioBuilderOptions, callback);\n  },\n  function() {\n    callback(new Error('XHR failed'));\n  },\n  function() {\n    callback(new Error('XHR aborted'));\n  });\n\n  self._xhr.send();\n};\n\nWaveformBuilder.prototype.abort = function() {\n  if (this._xhr) {\n    this._xhr.abort();\n  }\n};\n\n/**\n * @private\n * @param {String} url\n * @param {String} requestType\n * @param {Boolean} withCredentials\n * @param {Function} onLoad\n * @param {Function} onError\n *\n * @returns {XMLHttpRequest}\n */\n\nWaveformBuilder.prototype._createXHR = function(url, requestType,\n    withCredentials, onLoad, onError, onAbort) {\n  const xhr = new XMLHttpRequest();\n\n  // open an XHR request to the data source file\n  xhr.open('GET', url, true);\n\n  if (isXhr2) {\n    try {\n      xhr.responseType = requestType;\n    }\n    catch (e) {\n      // Some browsers like Safari 6 do handle XHR2 but not the json\n      // response type, doing only a try/catch fails in IE9\n    }\n  }\n\n  xhr.onload = onLoad;\n  xhr.onerror = onError;\n\n  if (isXhr2 && withCredentials) {\n    xhr.withCredentials = true;\n  }\n\n  xhr.addEventListener('abort', onAbort);\n\n  return xhr;\n};\n\nexport default WaveformBuilder;\n","/**\n * @file\n *\n * Defines the {@link Peaks} class.\n *\n * @module main\n */\n\nimport EventEmitter from 'eventemitter3';\nimport CueEmitter from './cue-emitter';\nimport WaveformPoints from './waveform-points';\nimport WaveformSegments from './waveform-segments';\nimport KeyboardHandler from './keyboard-handler';\nimport MediaElementPlayer from './mediaelement-player';\nimport Player from './player';\nimport { createPointMarker, createSegmentMarker, createSegmentLabel } from './marker-factories';\nimport Scrollbar from './scrollbar';\nimport ViewController from './view-controller';\nimport ZoomController from './zoom-controller';\nimport WaveformBuilder from './waveform-builder';\nimport {\n  isHTMLElement, isFunction, isInAscendingOrder, isObject,\n  objectHasProperty,\n  extend\n} from './utils';\n\n/**\n * Initialises a new Peaks instance with default option settings.\n *\n * @class\n * @alias Peaks\n *\n * @param {Object} opts Configuration options\n */\n\nfunction Peaks() {\n  EventEmitter.call(this);\n\n  // Set default options\n  this.options = {\n    zoomLevels:              [512, 1024, 2048, 4096],\n    waveformCache:           true,\n\n    mediaElement:            null,\n    mediaUrl:                null,\n\n    dataUri:                 null,\n    dataUriDefaultFormat:    'json',\n    withCredentials:         false,\n\n    waveformData:            null,\n    webAudio:                null,\n\n    nudgeIncrement:          1.0,\n\n    pointMarkerColor:        '#39cccc',\n\n    createSegmentMarker:     createSegmentMarker,\n    createSegmentLabel:      createSegmentLabel,\n    createPointMarker:       createPointMarker,\n\n    // eslint-disable-next-line no-console\n    logger:                  console.error.bind(console)\n  };\n\n  return this;\n}\n\nPeaks.prototype = Object.create(EventEmitter.prototype);\n\nconst defaultViewOptions = {\n  playheadColor:       '#111111',\n  playheadTextColor:   '#aaaaaa',\n  axisGridlineColor:   '#cccccc',\n  showAxisLabels:      true,\n  axisLabelColor:      '#aaaaaa',\n  fontFamily:          'sans-serif',\n  fontSize:            11,\n  fontStyle:           'normal',\n  timeLabelPrecision:  2\n};\n\nconst defaultZoomviewOptions = {\n  // showPlayheadTime:    true,\n  playheadClickTolerance: 3,\n  waveformColor:          'rgba(0, 225, 128, 1)',\n  wheelMode:              'none'\n  // zoomAdapter:         'static'\n};\n\nconst defaultOverviewOptions = {\n  // showPlayheadTime:    false,\n  waveformColor:          'rgba(0, 0, 0, 0.2)',\n  highlightColor:         '#aaaaaa',\n  highlightStrokeColor:   'transparent',\n  highlightOpacity:       0.3,\n  highlightOffset:        11,\n  highlightCornerRadius:  2\n};\n\nconst defaultSegmentOptions = {\n  overlay:                   false,\n  markers:                   true,\n  startMarkerColor:          '#aaaaaa',\n  endMarkerColor:            '#aaaaaa',\n  waveformColor:             '#0074d9',\n  overlayColor:              '#ff0000',\n  overlayOpacity:            0.3,\n  overlayBorderColor:        '#ff0000',\n  overlayBorderWidth:        2,\n  overlayCornerRadius:       5,\n  overlayOffset:             25,\n  overlayLabelAlign:         'left',\n  overlayLabelVerticalAlign: 'top',\n  overlayLabelPadding:       8,\n  overlayLabelColor:         '#000000',\n  overlayFontFamily:         'sans-serif',\n  overlayFontSize:           12,\n  overlayFontStyle:          'normal'\n};\n\nconst defaultScrollbarOptions = {\n  color: '#888888',\n  minWidth: 50\n};\n\nfunction getOverviewOptions(opts) {\n  const overviewOptions = {};\n\n  if (opts.overview && opts.overview.showPlayheadTime) {\n    overviewOptions.showPlayheadTime = opts.overview.showPlayheadTime;\n  }\n\n  const optNames = [\n    'container',\n    'waveformColor',\n    'playedWaveformColor',\n    'playheadColor',\n    'playheadTextColor',\n    'formatPlayheadTime',\n    'timeLabelPrecision',\n    'axisGridlineColor',\n    'showAxisLabels',\n    'axisLabelColor',\n    'formatAxisTime',\n    'fontFamily',\n    'fontSize',\n    'fontStyle',\n    'highlightColor',\n    'highlightStrokeColor',\n    'highlightOpacity',\n    'highlightCornerRadius',\n    'highlightOffset'\n  ];\n\n  optNames.forEach(function(optName) {\n    if (opts.overview && objectHasProperty(opts.overview, optName)) {\n      overviewOptions[optName] = opts.overview[optName];\n    }\n    else if (objectHasProperty(opts, optName)) {\n      overviewOptions[optName] = opts[optName];\n    }\n    else if (!objectHasProperty(overviewOptions, optName)) {\n      if (objectHasProperty(defaultOverviewOptions, optName)) {\n        overviewOptions[optName] = defaultOverviewOptions[optName];\n      }\n      else if (objectHasProperty(defaultViewOptions, optName)) {\n        overviewOptions[optName] = defaultViewOptions[optName];\n      }\n    }\n  });\n\n  return overviewOptions;\n}\n\nfunction getZoomviewOptions(opts) {\n  const zoomviewOptions = {};\n\n  if (opts.showPlayheadTime) {\n    zoomviewOptions.showPlayheadTime = opts.showPlayheadTime;\n  }\n  else if (opts.zoomview && opts.zoomview.showPlayheadTime) {\n    zoomviewOptions.showPlayheadTime = opts.zoomview.showPlayheadTime;\n  }\n\n  const optNames = [\n    'container',\n    'waveformColor',\n    'playedWaveformColor',\n    'playheadColor',\n    'playheadTextColor',\n    'formatPlayheadTime',\n    'playheadClickTolerance',\n    'timeLabelPrecision',\n    'axisGridlineColor',\n    'showAxisLabels',\n    'axisLabelColor',\n    'formatAxisTime',\n    'fontFamily',\n    'fontSize',\n    'fontStyle',\n    'wheelMode'\n  ];\n\n  optNames.forEach(function(optName) {\n    if (opts.zoomview && objectHasProperty(opts.zoomview, optName)) {\n      zoomviewOptions[optName] = opts.zoomview[optName];\n    }\n    else if (objectHasProperty(opts, optName)) {\n      zoomviewOptions[optName] = opts[optName];\n    }\n    else if (!objectHasProperty(zoomviewOptions, optName)) {\n      if (objectHasProperty(defaultZoomviewOptions, optName)) {\n        zoomviewOptions[optName] = defaultZoomviewOptions[optName];\n      }\n      else if (objectHasProperty(defaultViewOptions, optName)) {\n        zoomviewOptions[optName] = defaultViewOptions[optName];\n      }\n    }\n  });\n\n  return zoomviewOptions;\n}\n\nfunction getScrollbarOptions(opts) {\n  if (!objectHasProperty(opts, 'scrollbar')) {\n    return null;\n  }\n\n  const scrollbarOptions = {};\n\n  const optNames = [\n    'container',\n    'color',\n    'minWidth'\n  ];\n\n  optNames.forEach(function(optName) {\n    if (objectHasProperty(opts.scrollbar, optName)) {\n      scrollbarOptions[optName] = opts.scrollbar[optName];\n    }\n    else {\n      scrollbarOptions[optName] = defaultScrollbarOptions[optName];\n    }\n  });\n\n  return scrollbarOptions;\n}\n\nfunction extendOptions(to, from) {\n  for (const key in from) {\n    if (objectHasProperty(from, key) &&\n        objectHasProperty(to, key)) {\n      to[key] = from[key];\n    }\n  }\n\n  return to;\n}\n\nfunction addSegmentOptions(options, opts) {\n  options.segmentOptions = {};\n\n  extend(options.segmentOptions, defaultSegmentOptions);\n\n  if (opts.segmentOptions) {\n    extendOptions(options.segmentOptions, opts.segmentOptions);\n  }\n\n  options.zoomview.segmentOptions = {};\n  extend(options.zoomview.segmentOptions, options.segmentOptions);\n\n  if (opts.zoomview && opts.zoomview.segmentOptions) {\n    extendOptions(options.zoomview.segmentOptions, opts.zoomview.segmentOptions);\n  }\n\n  options.overview.segmentOptions = {};\n  extend(options.overview.segmentOptions, options.segmentOptions);\n\n  if (opts.overview && opts.overview.segmentOptions) {\n    extendOptions(options.overview.segmentOptions, opts.overview.segmentOptions);\n  }\n}\n\nfunction checkContainerElements(options) {\n  const zoomviewContainer = options.zoomview.container;\n  const overviewContainer = options.overview.container;\n\n  if (!isHTMLElement(zoomviewContainer) &&\n      !isHTMLElement(overviewContainer)) {\n    // eslint-disable-next-line max-len\n    return new TypeError('Peaks.init(): The zoomview and/or overview container options must be valid HTML elements');\n  }\n\n  if (zoomviewContainer &&\n      (zoomviewContainer.clientWidth  <= 0 ||\n       zoomviewContainer.clientHeight <= 0)) {\n    // eslint-disable-next-line max-len\n    return new Error('Peaks.init(): Please ensure that the zoomview container is visible and has non-zero width and height');\n  }\n\n  if (overviewContainer &&\n      (overviewContainer.clientWidth  <= 0 ||\n       overviewContainer.clientHeight <= 0)) {\n    // eslint-disable-next-line max-len\n    return new Error('Peaks.init(): Please ensure that the overview container is visible and has non-zero width and height');\n  }\n}\n\n/**\n * Creates and initialises a new Peaks instance with the given options.\n *\n * @param {Object} opts Configuration options\n *\n * @return {Peaks}\n */\n\nPeaks.init = function(opts, callback) {\n  const instance = new Peaks();\n\n  let err = instance._setOptions(opts);\n\n  if (err) {\n    callback(err);\n    return;\n  }\n\n  err = checkContainerElements(instance.options);\n\n  if (err) {\n    callback(err);\n    return;\n  }\n\n  let scrollbarContainer = null;\n\n  if (instance.options.scrollbar) {\n    scrollbarContainer = instance.options.scrollbar.container;\n\n    if (!isHTMLElement(scrollbarContainer)) {\n      // eslint-disable-next-line max-len\n      callback(new TypeError('Peaks.init(): The scrollbar container option must be a valid HTML element'));\n      return;\n    }\n\n    if (scrollbarContainer.clientWidth <= 0) {\n      // eslint-disable-next-line max-len\n      callback(new TypeError('Peaks.init(): Please ensure that the scrollbar container is visible and has non-zero width'));\n      return;\n    }\n  }\n\n  if (opts.keyboard) {\n    instance._keyboardHandler = new KeyboardHandler(instance);\n  }\n\n  const player = opts.player ?\n    opts.player :\n    new MediaElementPlayer(instance.options.mediaElement);\n\n  instance.player = new Player(instance, player);\n  instance.segments = new WaveformSegments(instance);\n  instance.points = new WaveformPoints(instance);\n  instance.zoom = new ZoomController(instance, instance.options.zoomLevels);\n  instance.views = new ViewController(instance);\n\n  // Setup the UI components\n  instance._waveformBuilder = new WaveformBuilder(instance);\n\n  instance.player.init(instance)\n    .then(function() {\n      instance._waveformBuilder.init(instance.options, function(err, waveformData) {\n        if (err) {\n          if (callback) {\n            callback(err);\n          }\n\n          return;\n        }\n\n        err = checkContainerElements(instance.options);\n\n        if (err) {\n          if (callback) {\n            callback(err);\n          }\n\n          return;\n        }\n\n        instance._waveformBuilder = null;\n        instance._waveformData = waveformData;\n\n        const zoomviewContainer = instance.options.zoomview.container;\n        const overviewContainer = instance.options.overview.container;\n\n        if (overviewContainer) {\n          instance.views.createOverview(overviewContainer);\n        }\n\n        if (zoomviewContainer) {\n          instance.views.createZoomview(zoomviewContainer);\n        }\n\n        if (scrollbarContainer) {\n          instance.createScrollbar(scrollbarContainer);\n        }\n\n        instance._addWindowResizeHandler();\n\n        if (opts.segments) {\n          instance.segments.add(opts.segments);\n        }\n\n        if (opts.points) {\n          instance.points.add(opts.points);\n        }\n\n        if (opts.emitCueEvents) {\n          instance._cueEmitter = new CueEmitter(instance);\n        }\n\n        // Allow applications to attach event handlers before emitting events,\n        // when initialising with local waveform data.\n\n        setTimeout(function() {\n          instance.emit('peaks.ready');\n        }, 0);\n\n        callback(null, instance);\n      });\n    })\n    .catch(function(err) {\n      if (callback) {\n        callback(err);\n      }\n    });\n\n  return instance;\n};\n\nPeaks.prototype._setOptions = function(opts) {\n  if (!isObject(opts)) {\n    return new TypeError('Peaks.init(): The options parameter should be an object');\n  }\n\n  if (!opts.player) {\n    if (!opts.mediaElement) {\n      return new Error('Peaks.init(): Missing mediaElement option');\n    }\n\n    if (!(opts.mediaElement instanceof HTMLMediaElement)) {\n      // eslint-disable-next-line max-len\n      return new TypeError('Peaks.init(): The mediaElement option should be an HTMLMediaElement');\n    }\n  }\n\n  if (opts.logger && !isFunction(opts.logger)) {\n    // eslint-disable-next-line max-len\n    return new TypeError('Peaks.init(): The logger option should be a function');\n  }\n\n  if (opts.segments && !Array.isArray(opts.segments)) {\n    // eslint-disable-next-line max-len\n    return new TypeError('Peaks.init(): options.segments must be an array of segment objects');\n  }\n\n  if (opts.points && !Array.isArray(opts.points)) {\n    // eslint-disable-next-line max-len\n    return new TypeError('Peaks.init(): options.points must be an array of point objects');\n  }\n\n  extendOptions(this.options, opts);\n\n  this.options.overview = getOverviewOptions(opts);\n  this.options.zoomview = getZoomviewOptions(opts);\n  this.options.scrollbar = getScrollbarOptions(opts);\n\n  addSegmentOptions(this.options, opts);\n\n  if (!Array.isArray(this.options.zoomLevels)) {\n    return new TypeError('Peaks.init(): The zoomLevels option should be an array');\n  }\n  else if (this.options.zoomLevels.length === 0) {\n    return new Error('Peaks.init(): The zoomLevels array must not be empty');\n  }\n  else {\n    if (!isInAscendingOrder(this.options.zoomLevels)) {\n      return new Error('Peaks.init(): The zoomLevels array must be sorted in ascending order');\n    }\n  }\n\n  this._logger = this.options.logger;\n};\n\n/**\n * Remote waveform data options for [Peaks.setSource]{@link Peaks#setSource}.\n *\n * @typedef {Object} RemoteWaveformDataOptions\n * @global\n * @property {String=} arraybuffer\n * @property {String=} json\n */\n\n/**\n * Local waveform data options for [Peaks.setSource]{@link Peaks#setSource}.\n *\n * @typedef {Object} LocalWaveformDataOptions\n * @global\n * @property {ArrayBuffer=} arraybuffer\n * @property {Object=} json\n */\n\n/**\n * Web Audio options for [Peaks.setSource]{@link Peaks#setSource}.\n *\n * @typedef {Object} WebAudioOptions\n * @global\n * @property {AudioContext=} audioContext\n * @property {AudioBuffer=} audioBuffer\n * @property {Number=} scale\n * @property {Boolean=} multiChannel\n */\n\n/**\n * Options for [Peaks.setSource]{@link Peaks#setSource}.\n *\n * @typedef {Object} PeaksSetSourceOptions\n * @global\n * @property {String=} mediaUrl\n * @property {RemoteWaveformDataOptions=} dataUri\n * @property {LocalWaveformDataOptions=} waveformData\n * @property {WebAudioOptions=} webAudio\n * @property {Boolean=} withCredentials\n * @property {Array<Number>=} zoomLevels\n */\n\n/**\n * Changes the audio or video media source associated with the {@link Peaks}\n * instance.\n *\n * @see SetSourceHandler\n *\n * @param {PeaksSetSourceOptions} options\n * @param {Function} callback\n */\n\nPeaks.prototype.setSource = function(options, callback) {\n  const self = this;\n\n  self.player._setSource(options)\n    .then(function() {\n      if (!options.zoomLevels) {\n        options.zoomLevels = self.options.zoomLevels;\n      }\n\n      self._waveformBuilder = new WaveformBuilder(self);\n\n      self._waveformBuilder.init(options, function(err, waveformData) {\n        if (err) {\n          callback(err);\n          return;\n        }\n\n        self._waveformBuilder = null;\n        self._waveformData = waveformData;\n\n        ['overview', 'zoomview'].forEach(function(viewName) {\n          const view = self.views.getView(viewName);\n\n          if (view) {\n            view.setWaveformData(waveformData);\n          }\n        });\n\n        self.zoom.setZoomLevels(options.zoomLevels);\n\n        callback();\n      });\n    })\n    .catch(function(err) {\n      callback(err);\n    });\n};\n\nPeaks.prototype.getWaveformData = function() {\n  return this._waveformData;\n};\n\nPeaks.prototype.createScrollbar = function(container) {\n  const waveformData = this.getWaveformData();\n\n  this._scrollbar = new Scrollbar(\n    waveformData,\n    container,\n    this\n  );\n\n  return this._scrollbar;\n};\n\nPeaks.prototype._addWindowResizeHandler = function() {\n  this._onResize = this._onResize.bind(this);\n  window.addEventListener('resize', this._onResize);\n};\n\nPeaks.prototype._onResize = function() {\n  this.emit('window_resize');\n};\n\nPeaks.prototype._removeWindowResizeHandler = function() {\n  window.removeEventListener('resize', this._onResize);\n};\n\n/**\n * Cleans up a Peaks instance after use.\n */\n\nPeaks.prototype.destroy = function() {\n  this._removeWindowResizeHandler();\n\n  if (this._waveformBuilder) {\n    this._waveformBuilder.abort();\n  }\n\n  if (this._keyboardHandler) {\n    this._keyboardHandler.destroy();\n  }\n\n  if (this.views) {\n    this.views.destroy();\n  }\n\n  if (this._scrollbar) {\n    this._scrollbar.destroy();\n    this._scrollbar = null;\n  }\n\n  if (this.player) {\n    this.player.destroy();\n  }\n\n  if (this._cueEmitter) {\n    this._cueEmitter.destroy();\n  }\n};\n\nexport default Peaks;\n"],"names":["has","Object","prototype","hasOwnProperty","prefix","Events","EE","fn","context","once","this","addListener","emitter","event","TypeError","listener","evt","_events","push","_eventsCount","clearEvent","EventEmitter","create","__proto__","eventNames","events","name","names","call","slice","getOwnPropertySymbols","concat","listeners","handlers","i","l","length","ee","Array","listenerCount","emit","a1","a2","a3","a4","a5","args","len","arguments","removeListener","undefined","apply","j","on","removeAllListeners","off","prefixed","module","exports","Cue","time","type","id","zeroPad","number","precision","toString","formatTime","result","fractionSeconds","Math","floor","pow","seconds","minutes","hours","join","clamp","value","min","max","objectHasProperty","object","field","extend","to","from","key","isNumber","isFinite","Infinity","isValidTime","Number","isObject","_typeof","isArray","isString","isNullOrUndefined","isBoolean","isHTMLElement","HTMLElement","isLinearGradientColor","linearGradientStart","linearGradientEnd","linearGradientColorStops","getMarkerObject","obj","parent","Konva","Layer","POINT","SEGMENT_START","SEGMENT_END","sorter","a","b","isHeadless","test","navigator","userAgent","requestAnimationFrame","window","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame","cancelAnimationFrame","mozCancelAnimationFrame","webkitCancelAnimationFrame","msCancelAnimationFrame","eventTypes","forward","reverse","getPointOrSegment","peaks","cue","points","getPoint","segments","getSegment","Error","CueEmitter","_cues","_peaks","_previousTime","_updateCues","bind","_onPlaying","onPlaying","_onSeeked","onSeeked","_onTimeUpdate","onTimeUpdate","_onAnimationFrame","onAnimationFrame","_rAFHandle","_activeSegments","_attachEventHandlers","getSegmentIdComparator","segment","self","getPoints","getSegments","forEach","point","startTime","endTime","sort","player","getCurrentTime","_updateActiveSegments","_onUpdate","previousTime","start","end","step","isForward","marker","eventType","webdriver","document","visibilityState","isPlaying","isSeeking","activeSegments","getSegmentsAtTime","find","_detachEventHandlers","destroy","pointOptions","invalidOptions","validatePointOptions","options","updating","RangeError","labelText","editable","color","Point","_setUserData","WaveformPoints","_points","_pointsById","_pointIdCounter","indexOf","defineProperties","enumerable","get","_id","_time","_labelText","_color","_editable","update","isVisible","_setTime","_getNextPointId","_addPoint","_createPoint","setDefaultPointOptions","filter","add","arrayArgs","map","_findPoint","predicate","indexes","_removeIndexes","removed","index","itemRemoved","splice","_removePoints","remove","p","removeById","pointId","removeByTime","removeAll","segmentOptions","validateSegmentOptions","borderColor","Segment","_startTime","_endTime","_borderColor","WaveformSegments","_segments","_segmentsById","_segmentIdCounter","_setStartTime","_setEndTime","_getNextSegmentId","_addSegment","_createSegment","globalSegmentOptions","overlay","overlayColor","waveformColor","overlayBorderColor","setDefaultSegmentOptions","_getSortedSegments","findPreviousSegment","sortedSegments","findIndex","s","findNextSegment","_findSegment","_removeSegments","segmentId","nodes","keys","KeyboardHandler","eventEmitter","_handleKeyEvent","addEventListener","MediaElementPlayer","mediaElement","_mediaElement","SetSourceHandler","_eventEmitter","_playerCanPlayHandler","_playerErrorHandler","validateAdapter","adapter","allProperties","getOwnPropertyNames","getPrototypeOf","getAllPropertiesFrom","method","includes","Player","_playingSegment","_segment","_loop","_playSegmentTimerCallback","_adapter","DefaultPointMarker","_options","DefaultSegmentMarker","createSegmentMarker","view","createSegmentLabel","Text","x","y","text","textAlign","fontFamily","fontSize","fontStyle","fill","createPointMarker","Scrollbar","waveformData","container","_waveformData","_container","scrollbar","_zoomview","views","getView","_dragBoundFunc","_onScrollboxDragStart","_onScrollboxDragMove","_onScrollboxDragEnd","_onZoomviewDisplaying","_onScrollbarClick","_onWindowResize","_width","clientWidth","_height","_stage","Stage","width","height","_layer","_scrollboxX","_minScrollboxWidth","minWidth","_offsetY","_scrollbox","Group","draggable","dragBoundFunc","_scrollboxRect","Rect","cornerRadius","_setScrollboxWidth","draw","HighlightLayer","_view","_offset","highlightOffset","highlightColor","listening","_highlightRect","_strokeColor","highlightStrokeColor","_opacity","highlightOpacity","_cornerRadius","highlightCornerRadius","MouseDragHandler","stage","_handlers","_dragging","_mouseDown","_mouseUp","_mouseMove","_lastMouseClientX","PlayheadLayer","_player","_playheadPixel","_playheadLineAnimation","_playheadVisible","_playheadColor","playheadColor","_playheadTextColor","playheadTextColor","_playheadFontFamily","playheadFontFamily","_playheadFontSize","playheadFontSize","_playheadFontStyle","playheadFontStyle","_playheadLayer","_createPlayhead","showPlayheadTime","_createPlayheadText","fitToView","zoomLevelChanged","PointMarker","_point","_marker","_draggable","_onDragStart","onDragStart","_onDragMove","onDragMove","_onDragEnd","onDragEnd","_onMouseEnter","onMouseEnter","_onMouseLeave","onMouseLeave","_group","_bindDefaultEventHandlers","init","target","nodeName","preventDefault","keyCode","shiftKey","removeEventListener","_addMediaListener","callback","_listeners","_duration","getDuration","error","_interval","src","querySelector","Promise","resolve","reject","eventHandler","readyState","HTMLMediaElement","HAVE_NOTHING","load","play","pause","paused","seeking","currentTime","duration","seek","setSource","_callback","_resolve","_reject","setAttribute","mediaUrl","_reset","err","_logger","playSegment","loop","_setSource","group","_label","_handle","_line","Line","stroke","strokeWidth","layer","hide","bindEventHandlers","setX","getWidth","show","getHeight","timeUpdated","setText","_this","handleX","startMarker","xPosition","handleLineColor","handleColor","_handleLineOne","_handleLineTwo","_handleLineSingle","visible","setTimeout","focusedSegmentShape","segmentShapes","_segmentShapes","_i","_Object$entries","entries","segmentShape","_slicedToArray","_endMarker","segmentShapeWidth","_overlay","markerInfo","getMarkerInfo","updateMarkersSmall","body","style","cursor","endMarkerHandleLineSingle","startMarkerHandleLineSingle","newHandleWidth","endMarker","attrs","endMarkerHandleLines","line","startMarkerHandleLines","_startMarker","endMarkerGroupChildren","children","startMarkerGroupChildren","child","_i2","_Object$entries2","_scrollboxWidth","pixelsToTime","_getScrollbarRange","pos","range","_updateWaveform","_updateScrollbarWidthAndPosition","getStartTime","zoomviewRange","getPixelLength","scrollBoxPos","timeToPixels","layerX","offset","updateWaveform","fitToContainer","clientHeight","addToStage","showHighlight","_createHighlightRect","_update","startOffset","endOffset","setAttrs","opacity","removeHighlight","updateHighlight","button","touches","clientX","onMouseDown","mouseDownPosX","_getMousePosX","capture","passive","changedTouches","onMouseMove","mousePosX","cancelable","onMouseUp","getContainer","getBoundingClientRect","left","isDragging","pixelsPerSecond","_useAnimation","_start","stop","_playheadLine","_playheadText","_playheadGroup","align","updatePlayheadTime","_syncPlayhead","pixelIndex","frameOffset","getFrameOffset","playheadX","playheadTextWidth","getTextWidth","playheadPosChanged","lastPlayheadPosition","Animation","playheadPosition","getPlayheadOffset","getPlayheadPixel","updatePlayheadText","addToLayer","getX","getAbsolutePosition","destroyChildren","PointsLayer","allowEditing","_allowEditing","_pointMarkers","_onPointsDrag","_onPointMarkerDragStart","_onPointMarkerDragMove","_onPointMarkerDragEnd","_pointMarkerDragBoundFunc","_onPointMarkerMouseEnter","_onPointMarkerMouseLeave","_onPointsUpdate","_onPointsAdd","_onPointsRemove","_onPointsRemoveAll","OverlaySegmentMarker","SegmentMarker","_segmentShape","WaveformShape","shapeOptions","startY","endY","fillLinearGradientStartPointY","fillLinearGradientEndPointY","fillLinearGradientColorStops","_shape","Shape","sceneFunc","_sceneFunc","enableEditing","enable","frameStartTime","frameEndTime","getEndTime","pointMarker","_removePoint","_updatePoint","pointMarkerX","removeChildren","_createPointMarker","pointMarkerColor","getName","_addPointMarker","pixelOffsetToTime","_dragPointMarker","updatePoints","_removeInvisiblePoints","_findOrAddPointMarker","setVisible","viewHeight","overlayOffset","overlayRectHeight","moveToTop","isStartMarker","startDrag","stopDrag","setSegment","setWaveformColor","_drawWaveform","getWaveformData","startPixels","endPixels","limit","channels","waveformTop","waveformHeight","_drawChannel","channel","top","amplitude","lineX","lineY","amplitudeScale","getAmplitudeScale","beginPath","min_sample","scaleY","lineTo","max_sample","closePath","fillShape","handler","scale","defaultFontFamily","defaultFontShape","SegmentShape","isSegmentDraggingEnabled","getViewOptions","_overlayOffset","_waveformShape","_onMouseDown","_onMouseUp","_onSegmentDragStart","_onSegmentDragMove","_onSegmentDragEnd","_onSegmentMarkerDragStart","_onSegmentMarkerDragMove","_onSegmentMarkerDragEnd","_segmentMarkerDragBoundFunc","overlayBorderWidth","overlayOpacity","overlayCornerRadius","segmentStartOffset","timeToPixelOffset","segmentEndOffset","clipX","clipY","clipWidth","clipHeight","_overlayRect","_overlayText","overlayFontFamily","overlayFontSize","overlayFontStyle","overlayLabelColor","overlayLabelAlign","verticalAlign","overlayLabelVerticalAlign","padding","overlayLabelPadding","_createMarkers","createOverlayMarker","SegmentsLayer","_onSegmentsUpdate","_onSegmentsAdd","_onSegmentsRemove","_onSegmentsRemoveAll","_onSegmentsDragged","WaveformAxis","_axisGridlineColor","axisGridlineColor","_axisLabelColor","axisLabelColor","_showAxisLabels","showAxisLabels","formatAxisTime","_formatAxisTime","_axisLabelFont","_buildFontString","_axisShape","_drawAxis","WaveformOverview","_originalWaveformData","_viewOptions","overview","_onPause","_amplitudeScale","_timeLabelPrecision","timeLabelPrecision","_enableSeek","formatPlayheadTime","_formatPlayheadTime","_data","resample","showWarnings","_resizeTimeoutId","_waveformColor","_playedWaveformColor","playedWaveformColor","_createWaveform","_segmentsLayer","_pointsLayer","_highlightLayer","_createAxisLabels","_createMouseDragHandler","_onClick","_onDblClick","_onContextMenu","WaveformZoomView","zoomview","_enableWaveformCache","waveformCache","_initWaveformCache","_onKeyboardLeft","_onKeyboardRight","_onKeyboardShiftLeft","_onKeyboardShiftRight","_autoScroll","autoScroll","_autoScrollOffset","autoScrollOffset","_enableSegmentDragging","_segmentDragMode","_minSegmentDragWidth","_waveformDragMode","_insertSegmentShape","_playheadClickTolerance","playheadClickTolerance","_pixelLength","initialZoomLevel","zoom","getZoomLevel","_zoomLevelAuto","_zoomLevelSeconds","_resampleData","_frameOffset","enableSegments","enablePoints","_onWheel","_onWheelCaptureVerticalScroll","setWheelMode","wheelMode","ViewController","_overview","ZoomController","zoomLevels","_zoomLevels","_zoomLevelIndex","getStartMarker","getEndMarker","bordercolor","isEditingEnabled","markers","startMarkerColor","endMarkerColor","segmentClicked","eventName","_moveToTop","moveSegmentMarkersToTop","enableSegmentDragging","_setPreviousAndNextSegments","getSegmentDragMode","_nextSegment","_previousSegment","_dragStartX","_dragStartTime","_dragEndTime","dragMode","offsetX","timeOffset","segmentDuration","minSegmentWidth","getMinSegmentDragWidth","minSegmentDuration","previousSegmentUpdated","nextSegmentUpdated","previousSegmentEndX","previousSegmentEndTime","minPreviousSegmentEndTime","nextSegmentStartX","nextSegmentStartTime","maxNextSegmentStartTime","moveMarkersToTop","segmentMarker","_startMarkerX","_endMarkerX","_segmentStartMarkerDragMove","_segmentEndMarkerDragMove","startMarkerX","endMarkerX","upperLimit","previousSegmentVisible","fixedPreviousSegment","compressPreviousSegment","previousSegmentDuration","lowerLimit","nextSegmentVisible","fixedNextSegment","compressNextSegment","nextSegmentDuration","getSegmentShape","_removeSegment","_updateSegment","_addSegmentShape","_createSegmentShape","updateSegments","_removeInvisibleSegments","_findOrAddSegmentShape","_getAxisLabelScale","secs","baseSecs","steps","currentFrameStartTime","axisLabelIntervalSecs","firstAxisLabelSecs","multiple","multiplier","ceil","roundUpToNearest","axisLabelOffsetSecs","axisLabelOffsetPixels","setAttr","moveTo","label","labelX","measureText","fillText","_mouseDragHandler","_seek","_getDuration","enableSeek","_clickHandler","emitViewEvent","getAttr","preventViewEvent","clickEvent","clearTimeout","setWidth","setWaveformData","_playedWaveformShape","_playedSegment","_unplayedSegment","_waveformLayer","sample_rate","pixels","setAmplitudeScale","_createWaveformShapes","_destroyPlayedWaveformShape","_axisLayer","_axis","removeHighlightRect","playheadTime","setPlayedWaveformColor","setTimeLabelPrecision","enableMarkerEditing","setHeight","Map","set","_waveformScales","_seeking","playheadOffset","abs","_segmentIsDraggable","initialFrameOffset","mouseDownX","diff","newFrameOffset","mode","_wheelMode","captureVerticalScroll","_captureVerticalScroll","delta","wheelEvent","deltaY","deltaX","deltaMode","WheelEvent","DOM_DELTA_PAGE","setWaveformDragMode","setSegmentDragMode","_keyboardScroll","direction","large","increment","nudgeIncrement","scrollWaveform","_drawWaveformLayer","_getScale","setZoom","isAutoScale","apexTime","playheadOffsetPixels","prevScale","_scale","apexPixel","sourceWaveform","setStartTime","scrollAmount","playheadPixel","enableAutoScroll","setMinSegmentDragWidth","resampleOptions","createOverview","createZoomview","destroyOverview","destroyZoomview","setZoomLevels","zoomIn","zoomOut","zoomLevelIndex","forceUpdate","getZoom","isXhr2","XMLHttpRequest","WaveformBuilder","Peaks","dataUri","dataUriDefaultFormat","withCredentials","webAudio","logger","console","audioContext","_getRemoteWaveformData","_buildWaveformFromLocalData","audioBuffer","_buildWaveformDataFromAudioBuffer","_buildWaveformDataUsingWebAudio","url","requestType","some","connector","toLowerCase","Boolean","_xhr","_createXHR","status","WaveformData","response","bits","send","data","json","arraybuffer","createdWaveformData","AudioContext","webkitAudioContext","webAudioOptions","mediaSourceUrl","currentSrc","_requestAudioAndBuildWaveformData","webAudioBuilderOptions","audio_buffer","split_channels","multiChannel","disable_worker","createFromAudio","audio_context","array_buffer","abort","onLoad","onError","onAbort","xhr","open","responseType","e","onload","onerror","defaultViewOptions","defaultZoomviewOptions","defaultOverviewOptions","defaultSegmentOptions","defaultScrollbarOptions","extendOptions","checkContainerElements","zoomviewContainer","overviewContainer","opts","instance","_setOptions","scrollbarContainer","keyboard","_keyboardHandler","_waveformBuilder","then","createScrollbar","_addWindowResizeHandler","emitCueEvents","_cueEmitter","catch","overviewOptions","optName","getOverviewOptions","zoomviewOptions","getZoomviewOptions","scrollbarOptions","getScrollbarOptions","addSegmentOptions","array","isInAscendingOrder","viewName","_scrollbar","_onResize","_removeWindowResizeHandler"],"mappings":"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"}