{"version":3,"file":"peaks.ext.min.js","sources":["../node_modules/eventemitter3/index.js","../src/cue.js","../src/utils.js","../src/cue-emitter.js","../src/point.js","../src/waveform-points.js","../src/segment.js","../src/waveform-segments.js","../src/keyboard-handler.js","../src/mediaelement-player.js","../src/player.js","../src/default-point-marker.js","../src/default-segment-marker.js","../src/marker-factories.js","../src/highlight-layer.js","../src/playhead-layer.js","../src/point-marker.js","../src/points-layer.js","../src/overlay-segment-marker.js","../src/segment-marker.js","../src/waveform-shape.js","../src/segment-shape.js","../src/segments-layer.js","../src/waveform-axis.js","../src/mouse-drag-handler.js","../src/seek-mouse-drag-handler.js","../src/waveform-overview.js","../src/insert-segment-mouse-drag-handler.js","../src/scroll-mouse-drag-handler.js","../src/waveform-zoomview.js","../src/scrollbar.js","../src/view-controller.js","../src/zoom-controller.js","../src/waveform-builder.js","../src/main.js"],"sourcesContent":["'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","/**\n * @file\n *\n * Defines the {@link Cue} class.\n *\n * @module cue\n */\n\n/**\n * A cue represents an event to be triggered at some point on the media\n * timeline.\n *\n * @class\n * @alias Cue\n *\n * @param {Number} time Cue time, in seconds.\n * @param {Number} type Cue mark type, either <code>Cue.POINT</code>,\n *   <code>Cue.SEGMENT_START</code>, or <code>Cue.SEGMENT_END</code>.\n * @param {String} id The id of the {@link Point} or {@link Segment}.\n */\n\nfunction Cue(time, type, id) {\n  this.time = time;\n  this.type = type;\n  this.id = id;\n}\n\n/**\n  * @constant\n  * @type {Number}\n  */\n\nCue.POINT = 0;\nCue.SEGMENT_START = 1;\nCue.SEGMENT_END = 2;\n\n/**\n * Callback function for use with Array.prototype.sort().\n *\n * @static\n * @param {Cue} a\n * @param {Cue} b\n * @return {Number}\n */\n\nCue.sorter = function(a, b) {\n  return a.time - b.time;\n};\n\nexport default Cue;\n","import Konva from 'konva/lib/Core';\n\nfunction zeroPad(number, precision) {\n  number = number.toString();\n\n  while (number.length < precision) {\n    number = '0' + number;\n  }\n\n  return number;\n}\n\n/**\n * Returns a formatted time string.\n *\n * @param {Number} time The time to be formatted, in seconds.\n * @param {Number} precision Decimal places to which time is displayed\n * @returns {String}\n */\n\nexport function formatTime(time, precision) {\n  let result = [];\n\n  const fractionSeconds = Math.floor((time % 1) * Math.pow(10, precision));\n  const seconds = Math.floor(time);\n  const minutes = Math.floor(seconds / 60);\n  const hours = Math.floor(minutes / 60);\n\n  if (hours > 0) {\n    result.push(hours); // Hours\n  }\n  result.push(minutes % 60); // Mins\n  result.push(seconds % 60); // Seconds\n\n  for (let i = 0; i < result.length; i++) {\n    result[i] = zeroPad(result[i], 2);\n  }\n\n  result = result.join(':');\n\n  if (precision > 0) {\n    result += '.' + zeroPad(fractionSeconds, precision);\n  }\n\n  return result;\n}\n\n/**\n * Rounds the given value up to the nearest given multiple.\n *\n * @param {Number} value\n * @param {Number} multiple\n * @returns {Number}\n *\n * @example\n * roundUpToNearest(5.5, 3); // returns 6\n * roundUpToNearest(141.0, 10); // returns 150\n * roundUpToNearest(-5.5, 3); // returns -6\n */\n\nexport function roundUpToNearest(value, multiple) {\n  if (multiple === 0) {\n    return 0;\n  }\n\n  let multiplier = 1;\n\n  if (value < 0.0) {\n    multiplier = -1;\n    value = -value;\n  }\n\n  const roundedUp = Math.ceil(value);\n\n  return multiplier * (((roundedUp + multiple - 1) / multiple) | 0) * multiple;\n}\n\nexport function clamp(value, min, max) {\n  if (value < min) {\n    return min;\n  }\n  else if (value > max) {\n    return max;\n  }\n  else {\n    return value;\n  }\n}\n\nexport function objectHasProperty(object, field) {\n  return Object.prototype.hasOwnProperty.call(object, field);\n}\n\nexport function extend(to, from) {\n  for (const key in from) {\n    if (objectHasProperty(from, key)) {\n      to[key] = from[key];\n    }\n  }\n\n  return to;\n}\n\n/**\n * Checks whether the given array contains values in ascending order.\n *\n * @param {Array<Number>} array The array to test\n * @returns {Boolean}\n */\n\nexport function isInAscendingOrder(array) {\n  if (array.length === 0) {\n    return true;\n  }\n\n  let value = array[0];\n\n  for (let i = 1; i < array.length; i++) {\n    if (value >= array[i]) {\n      return false;\n    }\n\n    value = array[i];\n  }\n\n  return true;\n}\n\n/**\n * Checks whether the given value is a number.\n *\n * @param {Number} value The value to test\n * @returns {Boolean}\n */\n\nexport function isNumber(value) {\n  return typeof value === 'number';\n}\n\n/**\n * Checks whether the given value is a finite number.\n *\n * @param {Number} value The value to test\n * @returns {Boolean}\n */\n\nexport function isFinite(value) {\n  if (typeof value !== 'number') {\n    return false;\n  }\n\n  // Check for NaN and infinity\n  // eslint-disable-next-line no-self-compare\n  if (value !== value || value === Infinity || value === -Infinity) {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Checks whether the given value is a valid timestamp.\n *\n * @param {Number} value The value to test\n * @returns {Boolean}\n */\n\nexport function isValidTime(value) {\n  return (typeof value === 'number') && Number.isFinite(value);\n}\n\n/**\n * Checks whether the given value is a valid object.\n *\n * @param {Object|Array} value The value to test\n * @returns {Boolean}\n */\n\nexport function isObject(value) {\n  return (value !== null) && (typeof value === 'object')\n    && !Array.isArray(value);\n}\n\n/**\n * Checks whether the given value is a valid string.\n *\n * @param {String} value The value to test\n * @returns {Boolean}\n */\n\nexport function isString(value) {\n  return typeof value === 'string';\n}\n\n/**\n * Checks whether the given value is a valid ArrayBuffer.\n *\n * @param {ArrayBuffer} value The value to test\n * @returns {Boolean}\n */\n\nexport function isArrayBuffer(value) {\n  return Object.prototype.toString.call(value).includes('ArrayBuffer');\n}\n\n/**\n * Checks whether the given value is null or undefined.\n *\n * @param {Object} value The value to test\n * @returns {Boolean}\n */\n\nexport function isNullOrUndefined(value) {\n  return value === undefined || value === null;\n}\n\n/**\n * Checks whether the given value is a function.\n *\n * @param {Function} value The value to test\n * @returns {Boolean}\n */\n\nexport function isFunction(value) {\n  return typeof value === 'function';\n}\n\n/**\n * Checks whether the given value is a boolean.\n *\n * @param {Function} value The value to test\n * @returns {Boolean}\n */\n\nexport function isBoolean(value) {\n  return value === true || value === false;\n}\n\n/**\n * Checks whether the given value is a valid HTML element.\n *\n * @param {HTMLElement} value The value to test\n * @returns {Boolean}\n */\n\nexport function isHTMLElement(value) {\n  return value instanceof HTMLElement;\n}\n\n/**\n * Checks whether the given value is an array\n *\n * @param {Function} value The value to test\n * @returns {Boolean}\n */\n\nexport function isArray(value) {\n  return Array.isArray(value);\n}\n\n/**\n * Checks whether the given value is a valid linear gradient color\n *\n * @param {Function} value The value to test\n * @returns {Boolean}\n */\n\nexport function isLinearGradientColor(value) {\n  return isObject(value) &&\n    objectHasProperty(value, 'linearGradientStart') &&\n    objectHasProperty(value, 'linearGradientEnd') &&\n    objectHasProperty(value, 'linearGradientColorStops') &&\n    isNumber(value.linearGradientStart) &&\n    isNumber(value.linearGradientEnd) &&\n    isArray(value.linearGradientColorStops) &&\n    value.linearGradientColorStops.length === 2;\n}\n\nexport function getMarkerObject(obj) {\n  while (obj.parent !== null) {\n    if (obj.parent instanceof Konva.Layer) {\n      return obj;\n    }\n\n    obj = obj.parent;\n  }\n\n  return null;\n}\n","/**\n * @file\n *\n * Defines the {@link CueEmitter} class.\n *\n * @module cue-emitter\n */\n\nimport Cue from './cue';\nimport { objectHasProperty } from './utils';\n\nconst isHeadless = /HeadlessChrome/.test(navigator.userAgent);\n\nfunction windowIsVisible() {\n  if (isHeadless || navigator.webdriver) {\n    return false;\n  }\n\n  return (typeof document === 'object') &&\n    ('visibilityState' in document) &&\n    (document.visibilityState === 'visible');\n}\n\nconst requestAnimationFrame =\n  window.requestAnimationFrame ||\n  window.mozRequestAnimationFrame ||\n  window.webkitRequestAnimationFrame ||\n  window.msRequestAnimationFrame;\n\nconst cancelAnimationFrame =\n  window.cancelAnimationFrame ||\n  window.mozCancelAnimationFrame ||\n  window.webkitCancelAnimationFrame ||\n  window.msCancelAnimationFrame;\n\nconst eventTypes = {\n  forward: {},\n  reverse: {}\n};\n\nconst EVENT_TYPE_POINT = 0;\nconst EVENT_TYPE_SEGMENT_ENTER = 1;\nconst EVENT_TYPE_SEGMENT_EXIT = 2;\n\neventTypes.forward[Cue.POINT] = EVENT_TYPE_POINT;\neventTypes.forward[Cue.SEGMENT_START] = EVENT_TYPE_SEGMENT_ENTER;\neventTypes.forward[Cue.SEGMENT_END] = EVENT_TYPE_SEGMENT_EXIT;\n\neventTypes.reverse[Cue.POINT] = EVENT_TYPE_POINT;\neventTypes.reverse[Cue.SEGMENT_START] = EVENT_TYPE_SEGMENT_EXIT;\neventTypes.reverse[Cue.SEGMENT_END] = EVENT_TYPE_SEGMENT_ENTER;\n\nconst eventNames = {};\n\neventNames[EVENT_TYPE_POINT] = 'points.enter';\neventNames[EVENT_TYPE_SEGMENT_ENTER] = 'segments.enter';\neventNames[EVENT_TYPE_SEGMENT_EXIT] = 'segments.exit';\n\nconst eventAttributes = {};\n\neventAttributes[EVENT_TYPE_POINT] = 'point';\neventAttributes[EVENT_TYPE_SEGMENT_ENTER] = 'segment';\neventAttributes[EVENT_TYPE_SEGMENT_EXIT] = 'segment';\n\n/**\n * Given a cue instance, returns the corresponding {@link Point}\n * {@link Segment}.\n *\n * @param {Peaks} peaks\n * @param {Cue} cue\n * @return {Point|Segment}\n * @throws {Error}\n */\n\nfunction getPointOrSegment(peaks, cue) {\n  switch (cue.type) {\n    case Cue.POINT:\n      return peaks.points.getPoint(cue.id);\n\n    case Cue.SEGMENT_START:\n    case Cue.SEGMENT_END:\n      return peaks.segments.getSegment(cue.id);\n\n    default:\n      throw new Error('getPointOrSegment: id not found?');\n  }\n}\n\n/**\n * CueEmitter is responsible for emitting <code>points.enter</code>,\n * <code>segments.enter</code>, and <code>segments.exit</code> events.\n *\n * @class\n * @alias CueEmitter\n *\n * @param {Peaks} peaks Parent {@link Peaks} instance.\n */\n\nfunction CueEmitter(peaks) {\n  this._cues = [];\n  this._peaks = peaks;\n  this._previousTime = -1;\n  this._updateCues = this._updateCues.bind(this);\n  this._onPlaying = this._onPlaying.bind(this);\n  this._onSeeked = this._onSeeked.bind(this);\n  this._onTimeUpdate = this._onTimeUpdate.bind(this);\n  this._onAnimationFrame = this._onAnimationFrame.bind(this);\n  this._rAFHandle = null;\n  this._activeSegments = {};\n  this._attachEventHandlers();\n}\n\n/**\n * This function is bound to all {@link Peaks} events relating to mutated\n * [Points]{@link Point} or [Segments]{@link Segment}, and updates the\n * list of cues accordingly.\n *\n * @private\n */\n\nCueEmitter.prototype._updateCues = function() {\n  const self = this;\n\n  const points = self._peaks.points.getPoints();\n  const segments = self._peaks.segments.getSegments();\n\n  self._cues.length = 0;\n\n  points.forEach(function(point) {\n    self._cues.push(new Cue(point.time, Cue.POINT, point.id));\n  });\n\n  segments.forEach(function(segment) {\n    self._cues.push(new Cue(segment.startTime, Cue.SEGMENT_START, segment.id));\n    self._cues.push(new Cue(segment.endTime, Cue.SEGMENT_END, segment.id));\n  });\n\n  self._cues.sort(Cue.sorter);\n\n  const time = self._peaks.player.getCurrentTime();\n\n  self._updateActiveSegments(time);\n};\n\n/**\n * Emits events for any cues passed through during media playback.\n *\n * @param {Number} time The current time on the media timeline.\n * @param {Number} previousTime The previous time on the media timeline when\n *   this function was called.\n */\n\nCueEmitter.prototype._onUpdate = function(time, previousTime) {\n  const isForward = time > previousTime;\n  let start;\n  let end;\n  let step;\n\n  if (isForward) {\n    start = 0;\n    end = this._cues.length;\n    step = 1;\n  }\n  else {\n    start = this._cues.length - 1;\n    end = -1;\n    step = -1;\n  }\n\n  // Cues are sorted.\n\n  for (let i = start; isForward ? i < end : i > end; i += step) {\n    const cue = this._cues[i];\n\n    if (isForward ? cue.time > previousTime : cue.time < previousTime) {\n      if (isForward ? cue.time > time : cue.time < time) {\n        break;\n      }\n\n      // Cue falls between time and previousTime.\n\n      const marker = getPointOrSegment(this._peaks, cue);\n\n      const eventType = isForward ? eventTypes.forward[cue.type] :\n                                    eventTypes.reverse[cue.type];\n\n      if (eventType === EVENT_TYPE_SEGMENT_ENTER) {\n        this._activeSegments[marker.id] = marker;\n      }\n      else if (eventType === EVENT_TYPE_SEGMENT_EXIT) {\n        delete this._activeSegments[marker.id];\n      }\n\n      const event = {\n        time: time\n      };\n\n      event[eventAttributes[eventType]] = marker;\n\n      this._peaks.emit(eventNames[eventType], event);\n    }\n  }\n};\n\n// The next handler and onAnimationFrame are bound together\n// when the window isn't in focus, rAF is throttled\n// falling back to timeUpdate.\n\nCueEmitter.prototype._onTimeUpdate = function(time) {\n  if (windowIsVisible()) {\n    return;\n  }\n\n  if (this._peaks.player.isPlaying() && !this._peaks.player.isSeeking()) {\n    this._onUpdate(time, this._previousTime);\n  }\n\n  this._previousTime = time;\n};\n\nCueEmitter.prototype._onAnimationFrame = function() {\n  const time = this._peaks.player.getCurrentTime();\n\n  if (!this._peaks.player.isSeeking()) {\n    this._onUpdate(time, this._previousTime);\n  }\n\n  this._previousTime = time;\n\n  if (this._peaks.player.isPlaying()) {\n    this._rAFHandle = requestAnimationFrame(this._onAnimationFrame);\n  }\n};\n\nCueEmitter.prototype._onPlaying = function() {\n  this._previousTime = this._peaks.player.getCurrentTime();\n  this._rAFHandle = requestAnimationFrame(this._onAnimationFrame);\n};\n\nCueEmitter.prototype._onSeeked = function(time) {\n  this._previousTime = time;\n\n  this._updateActiveSegments(time);\n};\n\nfunction getSegmentIdComparator(id) {\n  return function compareSegmentIds(segment) {\n    return segment.id === id;\n  };\n}\n\n/**\n * The active segments is the set of all segments which overlap the current\n * playhead position. This function updates that set and emits\n * <code>segments.enter</code> and <code>segments.exit</code> events.\n */\n\nCueEmitter.prototype._updateActiveSegments = function(time) {\n  const self = this;\n\n  const activeSegments = self._peaks.segments.getSegmentsAtTime(time);\n\n  // Remove any segments no longer active.\n\n  for (const id in self._activeSegments) {\n    if (objectHasProperty(self._activeSegments, id)) {\n      const segment = activeSegments.find(getSegmentIdComparator(id));\n\n      if (!segment) {\n        self._peaks.emit('segments.exit', {\n          segment: self._activeSegments[id],\n          time: time\n        });\n\n        delete self._activeSegments[id];\n      }\n    }\n  }\n\n  // Add new active segments.\n\n  activeSegments.forEach(function(segment) {\n    if (!(segment.id in self._activeSegments)) {\n      self._activeSegments[segment.id] = segment;\n\n      self._peaks.emit('segments.enter', {\n        segment: segment,\n        time: time\n      });\n    }\n  });\n};\n\nconst events = [\n  'points.update',\n  'points.dragmove',\n  'points.add',\n  'points.remove',\n  'points.remove_all',\n  'segments.update',\n  'segments.dragged',\n  'segments.add',\n  'segments.remove',\n  'segments.remove_all'\n];\n\nCueEmitter.prototype._attachEventHandlers = function() {\n  this._peaks.on('player.timeupdate', this._onTimeUpdate);\n  this._peaks.on('player.playing', this._onPlaying);\n  this._peaks.on('player.seeked', this._onSeeked);\n\n  for (let i = 0; i < events.length; i++) {\n    this._peaks.on(events[i], this._updateCues);\n  }\n\n  this._updateCues();\n};\n\nCueEmitter.prototype._detachEventHandlers = function() {\n  this._peaks.off('player.timeupdate', this._onTimeUpdate);\n  this._peaks.off('player.playing', this._onPlaying);\n  this._peaks.off('player.seeked', this._onSeeked);\n\n  for (let i = 0; i < events.length; i++) {\n    this._peaks.off(events[i], this._updateCues);\n  }\n};\n\nCueEmitter.prototype.destroy = function() {\n  if (this._rAFHandle) {\n    cancelAnimationFrame(this._rAFHandle);\n    this._rAFHandle = null;\n  }\n\n  this._detachEventHandlers();\n\n  this._previousTime = -1;\n};\n\nexport default CueEmitter;\n","/**\n * @file\n *\n * Defines the {@link Point} class.\n *\n * @module point\n */\n\nimport {\n  isBoolean, isLinearGradientColor, isNullOrUndefined, isString,\n  isValidTime, objectHasProperty\n} from './utils';\n\nconst pointOptions = [\n  'id', 'pid', 'time', 'labelText', 'color', 'editable'\n];\n\nconst invalidOptions = [\n  'update', 'isVisible', 'peaks', 'pid'\n];\n\nfunction setDefaultPointOptions(options, peaksOptions) {\n  if (isNullOrUndefined(options.labelText)) {\n    options.labelText = '';\n  }\n\n  if (isNullOrUndefined(options.editable)) {\n    options.editable = false;\n  }\n\n  if (isNullOrUndefined(options.color)) {\n    options.color = peaksOptions.pointMarkerColor;\n  }\n}\n\nfunction validatePointOptions(options, updating) {\n  const context = updating ? 'update()' : 'add()';\n\n  if (!updating || (updating && objectHasProperty(options, 'time'))) {\n    if (!isValidTime(options.time)) {\n      // eslint-disable-next-line max-len\n      throw new TypeError('peaks.points.' + context + ': time should be a numeric value');\n    }\n  }\n\n  if (options.time < 0) {\n    // eslint-disable-next-line max-len\n    throw new RangeError('peaks.points.' + context + ': time should not be negative');\n  }\n\n  if (objectHasProperty(options, 'labelText') && !isString(options.labelText)) {\n    throw new TypeError('peaks.points.' + context + ': labelText must be a string');\n  }\n\n  if (objectHasProperty(options, 'editable') && !isBoolean(options.editable)) {\n    throw new TypeError('peaks.points.' + context + ': editable must be true or false');\n  }\n\n  if (objectHasProperty(options, 'color') &&\n    !isString(options.color) &&\n    !isLinearGradientColor(options.color)) {\n    // eslint-disable-next-line max-len\n    throw new TypeError('peaks.points.' + context + ': color must be a string or a valid linear gradient object');\n  }\n\n  invalidOptions.forEach(function(name) {\n    if (objectHasProperty(options, name)) {\n      throw new Error('peaks.points.' + context + ': invalid option name: ' + name);\n    }\n  });\n\n  pointOptions.forEach(function(name) {\n    if (objectHasProperty(options, '_' + name)) {\n      throw new Error('peaks.points.' + context + ': invalid option name: _' + name);\n    }\n  });\n}\n\n/**\n * A point is a single instant of time, with associated label and color.\n *\n * @class\n * @alias Point\n *\n * @param {Peaks} peaks A reference to the Peaks instance.\n * @param {Number} pid An internal unique identifier for the point.\n * @param {PointOptions} options User specified point attributes.\n */\n\nfunction Point(peaks, pid, options) {\n  this._peaks = peaks;\n  this._pid = pid;\n  this._setUserData(options);\n}\n\nPoint.prototype._setUserData = function(options) {\n  for (const key in options) {\n    if (objectHasProperty(options, key)) {\n      if (pointOptions.indexOf(key) === -1) {\n        this[key] = options[key];\n      }\n      else {\n        this['_' + key] = options[key];\n      }\n    }\n  }\n};\n\nObject.defineProperties(Point.prototype, {\n  id: {\n    enumerable: true,\n    get: function() {\n      return this._id;\n    }\n  },\n  pid: {\n    enumerable: true,\n    get: function() {\n      return this._pid;\n    }\n  },\n  time: {\n    enumerable: true,\n    get: function() {\n      return this._time;\n    }\n  },\n  labelText: {\n    get: function() {\n      return this._labelText;\n    }\n  },\n  color: {\n    enumerable: true,\n    get: function() {\n      return this._color;\n    }\n  },\n  editable: {\n    enumerable: true,\n    get: function() {\n      return this._editable;\n    }\n  }\n});\n\nPoint.prototype.update = function(options) {\n  validatePointOptions(options, true);\n\n  if (objectHasProperty(options, 'id')) {\n    if (isNullOrUndefined(options.id)) {\n      throw new TypeError('point.update(): invalid id');\n    }\n\n    this._peaks.points.updatePointId(this, options.id);\n  }\n\n  this._setUserData(options);\n\n  this._peaks.emit('points.update', this, options);\n};\n\n/**\n * Returns <code>true</code> if the point lies with in a given time range.\n *\n * @param {Number} startTime The start of the time region, in seconds.\n * @param {Number} endTime The end of the time region, in seconds.\n * @returns {Boolean}\n */\n\nPoint.prototype.isVisible = function(startTime, endTime) {\n  return this.time >= startTime && this.time < endTime;\n};\n\nPoint.prototype._setTime = function(time) {\n  this._time = time;\n};\n\nexport { Point, setDefaultPointOptions, validatePointOptions };\n","/**\n * @file\n *\n * Defines the {@link WaveformPoints} class.\n *\n * @module waveform-points\n */\n\nimport { Point, setDefaultPointOptions, validatePointOptions } from './point';\nimport { extend, isNullOrUndefined, objectHasProperty } from './utils';\n\n/**\n * Point parameters.\n *\n * @typedef {Object} PointOptions\n * @global\n * @property {Number} time Point time, in seconds.\n * @property {Boolean=} editable If <code>true</code> the point time can be\n *   adjusted via the user interface.\n *   Default: <code>false</code>.\n * @property {String=} color Point marker color.\n *   Default: a random color.\n * @property {String=} labelText Point label text.\n *   Default: an empty string.\n * @property {String=} id A unique point identifier.\n *   Default: an automatically generated identifier.\n * @property {*} data Optional application-specific data.\n */\n\n/**\n * Handles all functionality related to the adding, removing and manipulation\n * of points. A point is a single instant of time.\n *\n * @class\n * @alias WaveformPoints\n *\n * @param {Peaks} peaks The parent Peaks object.\n */\n\nfunction WaveformPoints(peaks) {\n  this._peaks = peaks;\n  this._points = [];\n  this._pointsById = {};\n  this._pointsByPid = {};\n  this._pointIdCounter = 0;\n  this._pointPid = 0;\n}\n\n/**\n * Returns a new unique point id value.\n *\n * @returns {String}\n */\n\nWaveformPoints.prototype._getNextPointId = function() {\n  return 'peaks.point.' + this._pointIdCounter++;\n};\n\n/**\n * Returns a new unique point id value, for internal use within\n * Peaks.js only.\n *\n * @returns {Number}\n */\n\nWaveformPoints.prototype._getNextPid = function() {\n  return this._pointPid++;\n};\n\n/**\n * Adds a new point object.\n *\n * @private\n * @param {Point} point\n */\n\nWaveformPoints.prototype._addPoint = function(point) {\n  this._points.push(point);\n\n  this._pointsById[point.id] = point;\n  this._pointsByPid[point.pid] = point;\n};\n\n/**\n * Creates a new point object.\n *\n * @private\n * @param {PointOptions} options\n * @returns {Point}\n */\n\nWaveformPoints.prototype._createPoint = function(options) {\n  const pointOptions = {};\n\n  extend(pointOptions, options);\n\n  if (isNullOrUndefined(pointOptions.id)) {\n    pointOptions.id = this._getNextPointId();\n  }\n\n  const pid = this._getNextPid();\n\n  setDefaultPointOptions(pointOptions, this._peaks.options);\n\n  validatePointOptions(pointOptions, false);\n\n  return new Point(this._peaks, pid, pointOptions);\n};\n\n/**\n * Returns all points.\n *\n * @returns {Array<Point>}\n */\n\nWaveformPoints.prototype.getPoints = function() {\n  return this._points;\n};\n\n/**\n * Returns the point with the given id, or <code>undefined</code> if not found.\n *\n * @param {String} id\n * @returns {Point}\n */\n\nWaveformPoints.prototype.getPoint = function(id) {\n  return this._pointsById[id];\n};\n\n/**\n * Returns all points within a given time region.\n *\n * @param {Number} startTime The start of the time region, in seconds.\n * @param {Number} endTime The end of the time region, in seconds.\n * @returns {Array<Point>}\n */\n\nWaveformPoints.prototype.find = function(startTime, endTime) {\n  return this._points.filter(function(point) {\n    return point.isVisible(startTime, endTime);\n  });\n};\n\n/**\n * Adds one or more points to the timeline.\n *\n * @param {PointOptions|Array<PointOptions>} pointOrPoints\n *\n * @returns Point|Array<Point>\n */\n\nWaveformPoints.prototype.add = function(/* pointOrPoints */) {\n  const self = this;\n\n  const arrayArgs = Array.isArray(arguments[0]);\n  let points = arrayArgs ?\n               arguments[0] :\n               Array.prototype.slice.call(arguments);\n\n  points = points.map(function(pointOptions) {\n    const point = self._createPoint(pointOptions);\n\n    if (objectHasProperty(self._pointsById, point.id)) {\n      throw new Error('peaks.points.add(): duplicate id');\n    }\n\n    return point;\n  });\n\n  points.forEach(function(point) {\n    self._addPoint(point);\n  });\n\n  this._peaks.emit('points.add', {\n    points: points\n  });\n\n  return arrayArgs ? points : points[0];\n};\n\nWaveformPoints.prototype.updatePointId = function(point, newPointId) {\n  if (this._pointsById[point.id]) {\n    if (this._pointsById[newPointId]) {\n      throw new Error('point.update(): duplicate id');\n    }\n    else {\n      delete this._pointsById[point.id];\n      this._pointsById[newPointId] = point;\n    }\n  }\n};\n\n/**\n * Returns the indexes of points that match the given predicate.\n *\n * @private\n * @param {Function} predicate Predicate function to find matching points.\n * @returns {Array<Number>} An array of indexes into the points array of\n *   the matching elements.\n */\n\nWaveformPoints.prototype._findPoint = function(predicate) {\n  const indexes = [];\n\n  for (let i = 0, length = this._points.length; i < length; i++) {\n    if (predicate(this._points[i])) {\n      indexes.push(i);\n    }\n  }\n\n  return indexes;\n};\n\n/**\n * Removes the points at the given array indexes.\n *\n * @private\n * @param {Array<Number>} indexes The array indexes to remove.\n * @returns {Array<Point>} The removed {@link Point} objects.\n */\n\nWaveformPoints.prototype._removeIndexes = function(indexes) {\n  const removed = [];\n\n  for (let i = 0; i < indexes.length; i++) {\n    const index = indexes[i] - removed.length;\n\n    const itemRemoved = this._points.splice(index, 1)[0];\n\n    delete this._pointsById[itemRemoved.id];\n    delete this._pointsByPid[itemRemoved.pid];\n\n    removed.push(itemRemoved);\n  }\n\n  return removed;\n};\n\n/**\n * Removes all points that match a given predicate function.\n *\n * After removing the points, this function emits a\n * <code>points.remove</code> event with the removed {@link Point}\n * objects.\n *\n * @private\n * @param {Function} predicate A predicate function that identifies which\n *   points to remove.\n * @returns {Array<Point>} The removed {@link Points} objects.\n */\n\nWaveformPoints.prototype._removePoints = function(predicate) {\n  const indexes = this._findPoint(predicate);\n\n  const removed = this._removeIndexes(indexes);\n\n  this._peaks.emit('points.remove', {\n    points: removed\n  });\n\n  return removed;\n};\n\n/**\n * Removes the given point.\n *\n * @param {Point} point The point to remove.\n * @returns {Array<Point>} The removed points.\n */\n\nWaveformPoints.prototype.remove = function(point) {\n  return this._removePoints(function(p) {\n    return p === point;\n  });\n};\n\n/**\n * Removes any points with the given id.\n *\n * @param {String} id\n * @returns {Array<Point>} The removed {@link Point} objects.\n */\n\nWaveformPoints.prototype.removeById = function(pointId) {\n  return this._removePoints(function(point) {\n    return point.id === pointId;\n  });\n};\n\n/**\n * Removes any points at the given time.\n *\n * @param {Number} time\n * @returns {Array<Point>} The removed {@link Point} objects.\n */\n\nWaveformPoints.prototype.removeByTime = function(time) {\n  return this._removePoints(function(point) {\n    return point.time === time;\n  });\n};\n\n/**\n * Removes all points.\n *\n * After removing the points, this function emits a\n * <code>points.remove_all</code> event.\n */\n\nWaveformPoints.prototype.removeAll = function() {\n  this._points = [];\n  this._pointsById = {};\n  this._pointsByPid = {};\n  this._peaks.emit('points.remove_all');\n};\n\nexport default WaveformPoints;\n","/**\n * @file\n *\n * Defines the {@link Segment} class.\n *\n * @module segment\n */\n\nimport {\n  isBoolean, isNullOrUndefined, isLinearGradientColor,\n  isString, isValidTime, objectHasProperty\n} from './utils';\n\nconst segmentOptions = [\n  'id', 'pid', 'startTime', 'endTime', 'labelText', 'color', 'borderColor', 'editable'\n];\n\nconst invalidOptions = [\n  'update', 'isVisible', 'peaks', 'pid'\n];\n\nfunction setDefaultSegmentOptions(options, globalSegmentOptions) {\n  if (isNullOrUndefined(options.color)) {\n    if (globalSegmentOptions.overlay) {\n      options.color = globalSegmentOptions.overlayColor;\n    }\n    else {\n      options.color = globalSegmentOptions.waveformColor;\n    }\n  }\n\n  if (isNullOrUndefined(options.borderColor)) {\n    options.borderColor = globalSegmentOptions.overlayBorderColor;\n  }\n\n  if (isNullOrUndefined(options.labelText)) {\n    options.labelText = '';\n  }\n\n  if (isNullOrUndefined(options.editable)) {\n    options.editable = false;\n  }\n}\n\nfunction validateSegmentOptions(options, updating) {\n  const context = updating ? 'update()' : 'add()';\n\n  if (objectHasProperty(options, 'startTime') && !isValidTime(options.startTime)) {\n    // eslint-disable-next-line max-len\n    throw new TypeError('peaks.segments.' + context + ': startTime should be a valid number');\n  }\n\n  if (objectHasProperty(options, 'endTime') && !isValidTime(options.endTime)) {\n    // eslint-disable-next-line max-len\n    throw new TypeError('peaks.segments.' + context + ': endTime should be a valid number');\n  }\n\n  if (!updating) {\n    if (!objectHasProperty(options, 'startTime') || !objectHasProperty(options, 'endTime')) {\n      throw new TypeError('peaks.segments.' + context + ': missing startTime or endTime');\n    }\n  }\n\n  if (options.startTime < 0) {\n    // eslint-disable-next-line max-len\n    throw new RangeError('peaks.segments.' + context + ': startTime should not be negative');\n  }\n\n  if (options.endTime < 0) {\n    // eslint-disable-next-line max-len\n    throw new RangeError('peaks.segments.' + context + ': endTime should not be negative');\n  }\n\n  if (options.endTime < options.startTime) {\n    // eslint-disable-next-line max-len\n    throw new RangeError('peaks.segments.' + context + ': endTime should not be less than startTime');\n  }\n\n  if (objectHasProperty(options, 'labelText') && !isString(options.labelText)) {\n    throw new TypeError('peaks.segments.' + context + ': labelText must be a string');\n  }\n\n  if (objectHasProperty(options, 'editable') && !isBoolean(options.editable)) {\n    throw new TypeError('peaks.segments.' + context + ': editable must be true or false');\n  }\n\n  if (objectHasProperty(options, 'color') &&\n    !isString(options.color) &&\n    !isLinearGradientColor(options.color)) {\n    // eslint-disable-next-line max-len\n    throw new TypeError('peaks.segments.' + context + ': color must be a string or a valid linear gradient object');\n  }\n\n  if (objectHasProperty(options, 'borderColor') && !isString(options.borderColor)) {\n    // eslint-disable-next-line max-len\n    throw new TypeError('peaks.segments.' + context + ': borderColor must be a string');\n  }\n\n  invalidOptions.forEach(function(name) {\n    if (objectHasProperty(options, name)) {\n      throw new Error('peaks.segments.' + context + ': invalid option name: ' + name);\n    }\n  });\n\n  segmentOptions.forEach(function(name) {\n    if (objectHasProperty(options, '_' + name)) {\n      throw new Error('peaks.segments.' + context + ': invalid option name: _' + name);\n    }\n  });\n}\n\n/**\n * A segment is a region of time, with associated label and color.\n *\n * @class\n * @alias Segment\n *\n * @param {Peaks} peaks A reference to the Peaks instance.\n * @param {Number} pid An internal unique identifier for the segment.\n * @param {SegmentOptions} options User specified segment attributes.\n */\n\nfunction Segment(peaks, pid, options) {\n  this._peaks       = peaks;\n  this._pid         = pid;\n  this._id          = options.id;\n  this._startTime   = options.startTime;\n  this._endTime     = options.endTime;\n  this._labelText   = options.labelText;\n  this._color       = options.color;\n  this._borderColor = options.borderColor;\n  this._editable    = options.editable;\n\n  this._setUserData(options);\n}\n\nSegment.prototype._setUserData = function(options) {\n  for (const key in options) {\n    if (objectHasProperty(options, key)) {\n      if (segmentOptions.indexOf(key) === -1) {\n        this[key] = options[key];\n      }\n      else {\n        this['_' + key] = options[key];\n      }\n    }\n  }\n};\n\nObject.defineProperties(Segment.prototype, {\n  id: {\n    enumerable: true,\n    get: function() {\n      return this._id;\n    }\n  },\n  pid: {\n    enumerable: true,\n    get: function() {\n      return this._pid;\n    }\n  },\n  startTime: {\n    enumerable: true,\n    get: function() {\n      return this._startTime;\n    }\n  },\n  endTime: {\n    enumerable: true,\n    get: function() {\n      return this._endTime;\n    }\n  },\n  labelText: {\n    enumerable: true,\n    get: function() {\n      return this._labelText;\n    }\n  },\n  color: {\n    enumerable: true,\n    get: function() {\n      return this._color;\n    }\n  },\n  borderColor: {\n    enumerable: true,\n    get: function() {\n      return this._borderColor;\n    }\n  },\n  editable: {\n    enumerable: true,\n    get: function() {\n      return this._editable;\n    }\n  }\n});\n\nSegment.prototype.update = function(options) {\n  validateSegmentOptions(options, true);\n\n  if (objectHasProperty(options, 'id')) {\n    if (isNullOrUndefined(options.id)) {\n      throw new TypeError('segment.update(): invalid id');\n    }\n\n    this._peaks.segments.updateSegmentId(this, options.id);\n  }\n\n  this._setUserData(options);\n\n  this._peaks.emit('segments.update', this, options);\n};\n\n/**\n * Returns <code>true</code> if the segment overlaps a given time region.\n *\n * @param {Number} startTime The start of the time region, in seconds.\n * @param {Number} endTime The end of the time region, in seconds.\n * @returns {Boolean}\n *\n * @see http://wiki.c2.com/?TestIfDateRangesOverlap\n */\n\nSegment.prototype.isVisible = function(startTime, endTime) {\n  return this.startTime < endTime && startTime < this.endTime;\n};\n\nSegment.prototype._setStartTime = function(time) {\n  this._startTime = time;\n};\n\nSegment.prototype._setEndTime = function(time) {\n  this._endTime = time;\n};\n\nexport { Segment, setDefaultSegmentOptions, validateSegmentOptions };\n","/**\n * @file\n *\n * Defines the {@link WaveformSegments} class.\n *\n * @module waveform-segments\n */\n\nimport { Segment, setDefaultSegmentOptions, validateSegmentOptions } from './segment';\nimport { extend, isNullOrUndefined, objectHasProperty } from './utils';\n\n/**\n * Segment parameters.\n *\n * @typedef {Object} SegmentOptions\n * @global\n * @property {Number} startTime Segment start time, in seconds.\n * @property {Number} endTime Segment end time, in seconds.\n * @property {Boolean=} editable If <code>true</code> the segment start and\n *   end times can be adjusted via the user interface.\n *   Default: <code>false</code>.\n * @property {String=} color Segment waveform color.\n *   Default: Set by the <code>segmentOptions.waveformColor</code> option\n *   or the <code>segmentOptions.overlayColor</code> option.\n * @property {String=} borderColor Segment border color.\n *   Default: Set by the <code>segmentOptions.overlayBorderColor</code> option.\n * @property {String=} labelText Segment label text.\n *   Default: an empty string.\n * @property {String=} id A unique segment identifier.\n *   Default: an automatically generated identifier.\n * @property {*} data Optional application specific data.\n */\n\n/**\n * Handles all functionality related to the adding, removing and manipulation\n * of segments.\n *\n * @class\n * @alias WaveformSegments\n *\n * @param {Peaks} peaks The parent Peaks object.\n */\n\nfunction WaveformSegments(peaks) {\n  this._peaks = peaks;\n  this._segments = [];\n  this._segmentsById = {};\n  this._segmentsByPid = {};\n  this._segmentIdCounter = 0;\n  this._segmentPid = 0;\n  this._isInserting = false;\n}\n\n/**\n * Returns a new unique segment id value.\n *\n * @private\n * @returns {String}\n */\n\nWaveformSegments.prototype._getNextSegmentId = function() {\n  return 'peaks.segment.' + this._segmentIdCounter++;\n};\n\n/**\n * Returns a new unique segment id value, for internal use within\n * Peaks.js only.\n *\n * @private\n * @returns {Number}\n */\n\nWaveformSegments.prototype._getNextPid = function() {\n  return this._segmentPid++;\n};\n\n/**\n * Adds a new segment object.\n *\n * @private\n * @param {Segment} segment\n */\n\nWaveformSegments.prototype._addSegment = function(segment) {\n  this._segments.push(segment);\n\n  this._segmentsById[segment.id] = segment;\n  this._segmentsByPid[segment.pid] = segment;\n};\n\n/**\n * Creates a new segment object.\n *\n * @private\n * @param {SegmentOptions} options\n * @return {Segment}\n */\n\nWaveformSegments.prototype._createSegment = function(options) {\n  const segmentOptions = {};\n\n  extend(segmentOptions, options);\n\n  if (isNullOrUndefined(segmentOptions.id)) {\n    segmentOptions.id = this._getNextSegmentId();\n  }\n\n  const pid = this._getNextPid();\n\n  setDefaultSegmentOptions(segmentOptions, this._peaks.options.segmentOptions);\n\n  validateSegmentOptions(segmentOptions, false);\n\n  return new Segment(this._peaks, pid, segmentOptions);\n};\n\n/**\n * Returns all segments.\n *\n * @returns {Array<Segment>}\n */\n\nWaveformSegments.prototype.getSegments = function() {\n  return this._segments;\n};\n\n/**\n * Returns the segment with the given id, or <code>undefined</code> if not found.\n *\n * @param {String} id\n * @returns {Segment}\n */\n\nWaveformSegments.prototype.getSegment = function(id) {\n  return this._segmentsById[id];\n};\n\n/**\n * Returns all segments that overlap a given point in time.\n *\n * @param {Number} time\n * @returns {Array<Segment>}\n */\n\nWaveformSegments.prototype.getSegmentsAtTime = function(time) {\n  return this._segments.filter(function(segment) {\n    return time >= segment.startTime && time < segment.endTime;\n  });\n};\n\n/**\n * Returns all segments that overlap a given time region.\n *\n * @param {Number} startTime The start of the time region, in seconds.\n * @param {Number} endTime The end of the time region, in seconds.\n *\n * @returns {Array<Segment>}\n */\n\nWaveformSegments.prototype.find = function(startTime, endTime) {\n  return this._segments.filter(function(segment) {\n    return segment.isVisible(startTime, endTime);\n  });\n};\n\n/**\n * Returns a copy of the segments array, sorted by ascending segment start time.\n *\n * @returns {Array<Segment>}\n */\n\nWaveformSegments.prototype._getSortedSegments = function() {\n  return this._segments.slice().sort(function(a, b) {\n    return a.startTime - b.startTime;\n  });\n};\n\nWaveformSegments.prototype.findPreviousSegment = function(segment) {\n  const sortedSegments = this._getSortedSegments();\n\n  const index = sortedSegments.findIndex(function(s) {\n    return s.id === segment.id;\n  });\n\n  if (index !== -1) {\n    return sortedSegments[index - 1];\n  }\n\n  return undefined;\n};\n\nWaveformSegments.prototype.findNextSegment = function(segment) {\n  const sortedSegments = this._getSortedSegments();\n\n  const index = sortedSegments.findIndex(function(s) {\n    return s.id === segment.id;\n  });\n\n  if (index !== -1) {\n    return sortedSegments[index + 1];\n  }\n\n  return undefined;\n};\n\n/**\n * Adds one or more segments to the timeline.\n *\n * @param {SegmentOptions|Array<SegmentOptions>} segmentOrSegments\n *\n * @returns Segment|Array<Segment>\n */\n\nWaveformSegments.prototype.add = function(/* segmentOrSegments */) {\n  const self = this;\n\n  const arrayArgs = Array.isArray(arguments[0]);\n  let segments = arrayArgs ?\n                 arguments[0] :\n                 Array.prototype.slice.call(arguments);\n\n  segments = segments.map(function(segmentOptions) {\n    const segment = self._createSegment(segmentOptions);\n\n    if (objectHasProperty(self._segmentsById, segment.id)) {\n      throw new Error('peaks.segments.add(): duplicate id');\n    }\n\n    return segment;\n  });\n\n  segments.forEach(function(segment) {\n    self._addSegment(segment);\n  });\n\n  this._peaks.emit('segments.add', {\n    segments: segments,\n    insert: this._isInserting\n  });\n\n  return arrayArgs ? segments : segments[0];\n};\n\nWaveformSegments.prototype.updateSegmentId = function(segment, newSegmentId) {\n  if (this._segmentsById[segment.id]) {\n    if (this._segmentsById[newSegmentId]) {\n      throw new Error('segment.update(): duplicate id');\n    }\n    else {\n      delete this._segmentsById[segment.id];\n      this._segmentsById[newSegmentId] = segment;\n    }\n  }\n};\n\n/**\n * Returns the indexes of segments that match the given predicate.\n *\n * @private\n * @param {Function} predicate Predicate function to find matching segments.\n * @returns {Array<Number>} An array of indexes into the segments array of\n *   the matching elements.\n */\n\nWaveformSegments.prototype._findSegment = function(predicate) {\n  const indexes = [];\n\n  for (let i = 0, length = this._segments.length; i < length; i++) {\n    if (predicate(this._segments[i])) {\n      indexes.push(i);\n    }\n  }\n\n  return indexes;\n};\n\n/**\n * Removes the segments at the given array indexes.\n *\n * @private\n * @param {Array<Number>} indexes The array indexes to remove.\n * @returns {Array<Segment>} The removed {@link Segment} objects.\n */\n\nWaveformSegments.prototype._removeIndexes = function(indexes) {\n  const removed = [];\n\n  for (let i = 0; i < indexes.length; i++) {\n    const index = indexes[i] - removed.length;\n\n    const itemRemoved = this._segments.splice(index, 1)[0];\n\n    delete this._segmentsById[itemRemoved.id];\n    delete this._segmentsByPid[itemRemoved.pid];\n\n    removed.push(itemRemoved);\n  }\n\n  return removed;\n};\n\n/**\n * Removes all segments that match a given predicate function.\n *\n * After removing the segments, this function also emits a\n * <code>segments.remove</code> event with the removed {@link Segment}\n * objects.\n *\n * @private\n * @param {Function} predicate A predicate function that identifies which\n *   segments to remove.\n * @returns {Array<Segment>} The removed {@link Segment} objects.\n */\n\nWaveformSegments.prototype._removeSegments = function(predicate) {\n  const indexes = this._findSegment(predicate);\n\n  const removed = this._removeIndexes(indexes);\n\n  this._peaks.emit('segments.remove', {\n    segments: removed\n  });\n\n  return removed;\n};\n\n/**\n * Removes the given segment.\n *\n * @param {Segment} segment The segment to remove.\n * @returns {Array<Segment>} The removed segment.\n */\n\nWaveformSegments.prototype.remove = function(segment) {\n  return this._removeSegments(function(s) {\n    return s === segment;\n  });\n};\n\n/**\n * Removes any segments with the given id.\n *\n * @param {String} id\n * @returns {Array<Segment>} The removed {@link Segment} objects.\n */\n\nWaveformSegments.prototype.removeById = function(segmentId) {\n  return this._removeSegments(function(segment) {\n    return segment.id === segmentId;\n  });\n};\n\n/**\n * Removes any segments with the given start time, and optional end time.\n *\n * @param {Number} startTime Segments with this start time are removed.\n * @param {Number?} endTime If present, only segments with both the given\n *   start time and end time are removed.\n * @returns {Array<Segment>} The removed {@link Segment} objects.\n */\n\nWaveformSegments.prototype.removeByTime = function(startTime, endTime) {\n  endTime = (typeof endTime === 'number') ? endTime : 0;\n\n  let filter;\n\n  if (endTime > 0) {\n    filter = function(segment) {\n      return segment.startTime === startTime && segment.endTime === endTime;\n    };\n  }\n  else {\n    filter = function(segment) {\n      return segment.startTime === startTime;\n    };\n  }\n\n  return this._removeSegments(filter);\n};\n\n/**\n * Removes all segments.\n *\n * After removing the segments, this function emits a\n * <code>segments.remove_all</code> event.\n */\n\nWaveformSegments.prototype.removeAll = function() {\n  this._segments = [];\n  this._segmentsById = {};\n  this._segmentsByPid = {};\n  this._peaks.emit('segments.remove_all');\n};\n\nWaveformSegments.prototype.setInserting = function(value) {\n  this._isInserting = value;\n};\n\nWaveformSegments.prototype.isInserting = function() {\n  return this._isInserting;\n};\n\nexport default WaveformSegments;\n","/**\n * @file\n *\n * Defines the {@link KeyboardHandler} class.\n *\n * @module keyboard-handler\n */\n\nconst nodes = ['OBJECT', 'TEXTAREA', 'INPUT', 'SELECT', 'OPTION'];\n\nconst SPACE = 32,\n    TAB = 9,\n    LEFT_ARROW = 37,\n    RIGHT_ARROW = 39;\n\nconst keys = [SPACE, TAB, LEFT_ARROW, RIGHT_ARROW];\n\n/**\n * Configures keyboard event handling.\n *\n * @class\n * @alias KeyboardHandler\n *\n * @param {EventEmitter} eventEmitter\n */\n\nfunction KeyboardHandler(eventEmitter) {\n  this.eventEmitter = eventEmitter;\n\n  this._handleKeyEvent = this._handleKeyEvent.bind(this);\n\n  document.addEventListener('keydown', this._handleKeyEvent);\n  document.addEventListener('keypress', this._handleKeyEvent);\n  document.addEventListener('keyup', this._handleKeyEvent);\n}\n\n/**\n * Keyboard event handler function.\n *\n * @note Arrow keys only triggered on keydown, not keypress.\n *\n * @param {KeyboardEvent} event\n * @private\n */\n\nKeyboardHandler.prototype._handleKeyEvent = function handleKeyEvent(event) {\n  if (nodes.indexOf(event.target.nodeName) === -1) {\n    if (keys.indexOf(event.type) > -1) {\n      event.preventDefault();\n    }\n\n    if (event.type === 'keydown' || event.type === 'keypress') {\n      switch (event.keyCode) {\n        case SPACE:\n          this.eventEmitter.emit('keyboard.space');\n          break;\n\n        case TAB:\n          this.eventEmitter.emit('keyboard.tab');\n          break;\n      }\n    }\n    else if (event.type === 'keyup') {\n      switch (event.keyCode) {\n        case LEFT_ARROW:\n          if (event.shiftKey) {\n            this.eventEmitter.emit('keyboard.shift_left');\n          }\n          else {\n            this.eventEmitter.emit('keyboard.left');\n          }\n          break;\n\n        case RIGHT_ARROW:\n          if (event.shiftKey) {\n            this.eventEmitter.emit('keyboard.shift_right');\n          }\n          else {\n            this.eventEmitter.emit('keyboard.right');\n          }\n          break;\n      }\n    }\n  }\n};\n\nKeyboardHandler.prototype.destroy = function() {\n  document.removeEventListener('keydown', this._handleKeyEvent);\n  document.removeEventListener('keypress', this._handleKeyEvent);\n  document.removeEventListener('keyup', this._handleKeyEvent);\n};\n\nexport default KeyboardHandler;\n","/**\n * @file\n *\n * Implementation of {@link Player} adapter based on the HTML5 media element.\n *\n * @module mediaelement-player\n */\n\n/**\n * Checks whether the given HTMLMediaElement has either a src attribute\n * or any child <code>&lt;source&gt;</code> nodes\n */\n\nfunction mediaElementHasSource(mediaElement) {\n  if (mediaElement.src) {\n    return true;\n  }\n\n  if (mediaElement.querySelector('source')) {\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * A wrapper for interfacing with the HTML5 media element API.\n * Initializes the player for a given media element.\n *\n * @class\n * @alias MediaElementPlayer\n * @param {HTMLMediaElement} mediaElement The HTML <code>&lt;audio&gt;</code>\n *   or <code>&lt;video&gt;</code> element to associate with the\n *   {@link Peaks} instance.\n */\n\nfunction MediaElementPlayer(mediaElement) {\n  this._mediaElement = mediaElement;\n}\n\n/**\n * Adds an event listener to the media element.\n *\n * @private\n * @param {String} type The event type to listen for.\n * @param {Function} callback An event handler function.\n */\n\nMediaElementPlayer.prototype._addMediaListener = function(type, callback) {\n  this._listeners.push({ type: type, callback: callback });\n  this._mediaElement.addEventListener(type, callback);\n};\n\nMediaElementPlayer.prototype.init = function(eventEmitter) {\n  const self = this;\n\n  self._eventEmitter = eventEmitter;\n  self._listeners = [];\n  self._duration = self.getDuration();\n\n  self._addMediaListener('timeupdate', function() {\n    self._eventEmitter.emit('player.timeupdate', self.getCurrentTime());\n  });\n\n  self._addMediaListener('playing', function() {\n    self._eventEmitter.emit('player.playing', self.getCurrentTime());\n  });\n\n  self._addMediaListener('pause', function() {\n    self._eventEmitter.emit('player.pause', self.getCurrentTime());\n  });\n\n  self._addMediaListener('ended', function() {\n    self._eventEmitter.emit('player.ended');\n  });\n\n  self._addMediaListener('seeked', function() {\n    self._eventEmitter.emit('player.seeked', self.getCurrentTime());\n  });\n\n  self._addMediaListener('canplay', function() {\n    self._eventEmitter.emit('player.canplay');\n  });\n\n  self._addMediaListener('error', function(event) {\n    self._eventEmitter.emit('player.error', event.target.error);\n  });\n\n  self._interval = null;\n\n  if (!mediaElementHasSource(self._mediaElement)) {\n    return Promise.resolve();\n  }\n\n  return new Promise(function(resolve, reject) {\n    function eventHandler(event) {\n      self._mediaElement.removeEventListener('loadedmetadata', eventHandler);\n      self._mediaElement.removeEventListener('error', eventHandler);\n\n      if (event.type === 'loadedmetadata') {\n        resolve();\n      }\n      else {\n        reject(event.target.error);\n      }\n    }\n\n    // If the media element has preload=\"none\", clicking to seek in the\n    // waveform won't work, so here we force the media to load.\n    if (self._mediaElement.readyState === HTMLMediaElement.HAVE_NOTHING) {\n      // Wait for the readyState to change to HAVE_METADATA so we know the\n      // duration is valid, otherwise it could be NaN.\n      self._mediaElement.addEventListener('loadedmetadata', eventHandler);\n      self._mediaElement.addEventListener('error', eventHandler);\n      self._mediaElement.load();\n    }\n    else {\n      resolve();\n    }\n  });\n};\n\n/**\n * Cleans up the player object, removing all event listeners from the\n * associated media element.\n */\n\nMediaElementPlayer.prototype.destroy = function() {\n  for (let i = 0; i < this._listeners.length; i++) {\n    const listener = this._listeners[i];\n\n    this._mediaElement.removeEventListener(\n      listener.type,\n      listener.callback\n    );\n  }\n\n  this._listeners.length = 0;\n\n  this._mediaElement = null;\n};\n\nMediaElementPlayer.prototype.play = function() {\n  return this._mediaElement.play();\n};\n\nMediaElementPlayer.prototype.pause = function() {\n  this._mediaElement.pause();\n};\n\nMediaElementPlayer.prototype.isPlaying = function() {\n  return !this._mediaElement.paused;\n};\n\nMediaElementPlayer.prototype.isSeeking = function() {\n  return this._mediaElement.seeking;\n};\n\nMediaElementPlayer.prototype.getCurrentTime = function() {\n  return this._mediaElement.currentTime;\n};\n\nMediaElementPlayer.prototype.getDuration = function() {\n  return this._mediaElement.duration;\n};\n\nMediaElementPlayer.prototype.seek = function(time) {\n  this._mediaElement.currentTime = time;\n};\n\nfunction SetSourceHandler(eventEmitter, mediaElement) {\n  this._eventEmitter = eventEmitter;\n  this._mediaElement = mediaElement;\n  this._playerCanPlayHandler = this._playerCanPlayHandler.bind(this);\n  this._playerErrorHandler = this._playerErrorHandler.bind(this);\n}\n\nSetSourceHandler.prototype.setSource = function(options, callback) {\n  const self = this;\n\n  self._options = options;\n  self._callback = callback;\n\n  self._eventEmitter.on('player.canplay', self._playerCanPlayHandler);\n  self._eventEmitter.on('player.error', self._playerErrorHandler);\n\n  return new Promise(function(resolve, reject) {\n    self._resolve = resolve;\n    self._reject = reject;\n\n    self._eventEmitter.on('player.canplay', self._playerCanPlayHandler);\n    self._eventEmitter.on('player.error', self._playerErrorHandler);\n\n    self._mediaElement.setAttribute('src', options.mediaUrl);\n\n    // Force the media element to load, in case the media element\n    // has preload=\"none\".\n    if (self._mediaElement.readyState === HTMLMediaElement.HAVE_NOTHING) {\n      self._mediaElement.load();\n    }\n  });\n};\n\nSetSourceHandler.prototype._reset = function() {\n  this._eventEmitter.removeListener('player.canplay', this._playerCanPlayHandler);\n  this._eventEmitter.removeListener('player.error', this._playerErrorHandler);\n};\n\nSetSourceHandler.prototype._playerCanPlayHandler = function() {\n  this._reset();\n\n  this._resolve();\n};\n\nSetSourceHandler.prototype._playerErrorHandler = function(err) {\n  this._reset();\n\n  // Return the MediaError object from the media element\n  this._reject(err);\n};\n\nMediaElementPlayer.prototype.setSource = function(options) {\n  if (!options.mediaUrl) {\n    // eslint-disable-next-line max-len\n    return Promise.reject(new Error('peaks.setSource(): options must contain a mediaUrl when using mediaElement'));\n  }\n\n  const setSourceHandler = new SetSourceHandler(this._eventEmitter, this._mediaElement);\n\n  return setSourceHandler.setSource(options);\n};\n\nexport default MediaElementPlayer;\n","/**\n * @file\n *\n * A general audio player class which interfaces with external audio players.\n * The default audio player in Peaks.js is {@link MediaElementPlayer}.\n *\n * @module player\n */\n\nimport { isValidTime } from './utils';\n\nfunction getAllPropertiesFrom(adapter) {\n  const allProperties = [];\n  let obj = adapter;\n\n  while (obj) {\n    Object.getOwnPropertyNames(obj).forEach(function(p) {\n      allProperties.push(p);\n    });\n\n    obj = Object.getPrototypeOf(obj);\n  }\n\n  return allProperties;\n}\n\nfunction validateAdapter(adapter) {\n  const publicAdapterMethods = [\n    'init',\n    'destroy',\n    'play',\n    'pause',\n    'isPlaying',\n    'isSeeking',\n    'getCurrentTime',\n    'getDuration',\n    'seek'\n  ];\n\n  const allProperties = getAllPropertiesFrom(adapter);\n\n  publicAdapterMethods.forEach(function(method) {\n    if (!allProperties.includes(method)) {\n      throw new TypeError('Peaks.init(): Player method ' + method + ' is undefined');\n    }\n\n    if ((typeof adapter[method]) !== 'function') {\n      throw new TypeError('Peaks.init(): Player method ' + method + ' is not a function');\n    }\n  });\n}\n\n/**\n * A wrapper for interfacing with an external player API.\n *\n * @class\n * @alias Player\n *\n * @param {Peaks} peaks The parent {@link Peaks} object.\n * @param {Adapter} adapter The player adapter.\n */\n\nfunction Player(peaks, adapter) {\n  this._peaks = peaks;\n\n  this._playingSegment = false;\n  this._segment = null;\n  this._loop = false;\n  this._playSegmentTimerCallback = this._playSegmentTimerCallback.bind(this);\n\n  validateAdapter(adapter);\n  this._adapter = adapter;\n}\n\nPlayer.prototype.init = function() {\n  return this._adapter.init(this._peaks);\n};\n\n/**\n * Cleans up the player object.\n */\n\nPlayer.prototype.destroy = function() {\n  this._adapter.destroy();\n};\n\n/**\n * Starts playback.\n * @returns {Promise}\n */\n\nPlayer.prototype.play = function() {\n  return this._adapter.play();\n};\n\n/**\n * Pauses playback.\n */\n\nPlayer.prototype.pause = function() {\n  this._adapter.pause();\n};\n\n/**\n * @returns {Boolean} <code>true</code> if playing, <code>false</code>\n * otherwise.\n */\n\nPlayer.prototype.isPlaying = function() {\n  return this._adapter.isPlaying();\n};\n\n/**\n * @returns {boolean} <code>true</code> if seeking\n */\n\nPlayer.prototype.isSeeking = function() {\n  return this._adapter.isSeeking();\n};\n\n/**\n * Returns the current playback time position, in seconds.\n *\n * @returns {Number}\n */\n\nPlayer.prototype.getCurrentTime = function() {\n  return this._adapter.getCurrentTime();\n};\n\n/**\n * Returns the media duration, in seconds.\n *\n * @returns {Number}\n */\n\nPlayer.prototype.getDuration = function() {\n  return this._adapter.getDuration();\n};\n\n/**\n * Seeks to a given time position within the media.\n *\n * @param {Number} time The time position, in seconds.\n */\n\nPlayer.prototype.seek = function(time) {\n  if (!isValidTime(time)) {\n    this._peaks._logger('peaks.player.seek(): parameter must be a valid time, in seconds');\n    return;\n  }\n\n  this._adapter.seek(time);\n};\n\n/**\n * Plays the given segment.\n *\n * @param {Segment} segment The segment denoting the time region to play.\n * @param {Boolean} loop If true, playback is looped.\n */\n\nPlayer.prototype.playSegment = function(segment, loop) {\n  const self = this;\n\n  if (!segment ||\n    !isValidTime(segment.startTime) ||\n    !isValidTime(segment.endTime)) {\n    return Promise.reject(\n      new Error('peaks.player.playSegment(): parameter must be a segment object')\n    );\n  }\n\n  self._segment = segment;\n  self._loop = loop;\n\n  // Set audio time to segment start time\n  self.seek(segment.startTime);\n\n  self._peaks.once('player.playing', function() {\n    if (!self._playingSegment) {\n      self._playingSegment = true;\n\n      // We need to use requestAnimationFrame here as the timeupdate event\n      // doesn't fire often enough.\n      window.requestAnimationFrame(self._playSegmentTimerCallback);\n    }\n  });\n\n  // Start playing audio\n  return self.play();\n};\n\nPlayer.prototype._playSegmentTimerCallback = function() {\n  if (!this.isPlaying()) {\n    this._playingSegment = false;\n    return;\n  }\n  else if (this.getCurrentTime() >= this._segment.endTime) {\n    if (this._loop) {\n      this.seek(this._segment.startTime);\n    }\n    else {\n      this.pause();\n      this._peaks.emit('player.ended');\n      this._playingSegment = false;\n      return;\n    }\n  }\n\n  window.requestAnimationFrame(this._playSegmentTimerCallback);\n};\n\nPlayer.prototype._setSource = function(options) {\n  return this._adapter.setSource(options);\n};\n\nexport default Player;\n","/**\n * @file\n *\n * Defines the {@link DefaultPointMarker} class.\n *\n * @module default-point-marker\n */\n\nimport { Line } from 'konva/lib/shapes/Line';\nimport { Rect } from 'konva/lib/shapes/Rect';\nimport { Text } from 'konva/lib/shapes/Text';\n\n/**\n * Creates a point marker handle.\n *\n * @class\n * @alias DefaultPointMarker\n *\n * @param {CreatePointMarkerOptions} options\n */\n\nfunction DefaultPointMarker(options) {\n  this._options = options;\n  this._draggable = options.editable;\n}\n\nDefaultPointMarker.prototype.init = function(group) {\n  const handleWidth  = 10;\n  const handleHeight = 20;\n  const handleX      = -(handleWidth / 2) + 0.5; // Place in the middle of the marker\n\n  // Label\n\n  if (this._options.view === 'zoomview') {\n    // Label - create with default y, the real value is set in fitToView().\n    this._label = new Text({\n      x:          2,\n      y:          0,\n      text:       this._options.point.labelText,\n      textAlign:  'left',\n      fontFamily: this._options.fontFamily || 'sans-serif',\n      fontSize:   this._options.fontSize || 10,\n      fontStyle:  this._options.fontStyle || 'normal',\n      fill:       '#000'\n    });\n  }\n\n  // Handle - create with default y, the real value is set in fitToView().\n\n  this._handle = new Rect({\n    x:       handleX,\n    y:       0,\n    width:   handleWidth,\n    height:  handleHeight,\n    fill:    this._options.color,\n    visible: this._draggable\n  });\n\n  // Line - create with default y and points, the real values\n  // are set in fitToView().\n  this._line = new Line({\n    x:           0,\n    y:           0,\n    stroke:      this._options.color,\n    strokeWidth: 1\n  });\n\n  // Time label - create with default y, the real value is set\n  // in fitToView().\n  this._time = new Text({\n    x:          -24,\n    y:          0,\n    text:       this._options.layer.formatTime(this._options.point.time),\n    fontFamily: this._options.fontFamily,\n    fontSize:   this._options.fontSize,\n    fontStyle:  this._options.fontStyle,\n    fill:       '#000',\n    textAlign:  'center'\n  });\n\n  this._time.hide();\n\n  group.add(this._handle);\n\n  group.add(this._line);\n\n  if (this._label) {\n    group.add(this._label);\n  }\n\n  group.add(this._time);\n\n  this.fitToView();\n\n  this.bindEventHandlers(group);\n};\n\nDefaultPointMarker.prototype.bindEventHandlers = function(group) {\n  const self = this;\n\n  self._handle.on('mouseover touchstart', function() {\n    if (self._draggable) {\n      // Position text to the left of the marker\n      self._time.setX(-24 - self._time.getWidth());\n      self._time.show();\n    }\n  });\n\n  self._handle.on('mouseout touchend', function() {\n    if (self._draggable) {\n      self._time.hide();\n    }\n  });\n\n  group.on('dragstart', function() {\n    self._time.setX(-24 - self._time.getWidth());\n    self._time.show();\n  });\n\n  group.on('dragend', function() {\n    self._time.hide();\n  });\n};\n\nDefaultPointMarker.prototype.fitToView = function() {\n  const height = this._options.layer.getHeight();\n\n  this._line.points([0.5, 0, 0.5, height]);\n\n  if (this._label) {\n    this._label.y(12);\n  }\n\n  if (this._handle) {\n    this._handle.y(height / 2 - 10.5);\n  }\n\n  if (this._time) {\n    this._time.y(height / 2 - 5);\n  }\n};\n\nDefaultPointMarker.prototype.update = function(options) {\n  if (options.time !== undefined) {\n    if (this._time) {\n      this._time.setText(this._options.layer.formatTime(options.time));\n    }\n  }\n\n  if (options.labelText !== undefined) {\n    if (this._label) {\n      this._label.text(options.labelText);\n    }\n  }\n\n  if (options.color !== undefined) {\n    if (this._handle) {\n      this._handle.fill(options.color);\n    }\n\n    this._line.stroke(options.color);\n  }\n\n  if (options.editable !== undefined) {\n    this._draggable = options.editable;\n\n    this._handle.visible(this._draggable);\n  }\n};\n\nexport default DefaultPointMarker;\n","/**\n * @file\n *\n * Defines the {@link DefaultSegmentMarker} class.\n *\n * @module default-segment-marker\n */\n\nimport { Line } from 'konva/lib/shapes/Line';\nimport { Rect } from 'konva/lib/shapes/Rect';\nimport { Text } from 'konva/lib/shapes/Text';\n\n/**\n * Creates a segment marker handle.\n *\n * @class\n * @alias DefaultSegmentMarker\n *\n * @param {CreateSegmentMarkerOptions} options\n */\n\nfunction DefaultSegmentMarker(options) {\n  this._options = options;\n  this._editable = options.editable;\n}\n\nDefaultSegmentMarker.prototype.init = function(group) {\n  const handleWidth  = 15;\n  const handleHeight = 48;\n  let handleX      = -(handleWidth / 2) - 8; // Place off to the side of the segment\n\n  handleX = this._options.startMarker ? (handleX * -1) - 14.9 : handleX;\n\n  const xPosition = this._options.startMarker ? -24 : 24;\n\n  const time = this._options.startMarker ? this._options.segment.startTime :\n                                           this._options.segment.endTime;\n\n  const handleLineColor = this._options.segment.borderColor;\n\n  const handleColor = this._options.segment.handleColor;\n\n  // Label - create with default y, the real value is set in fitToView().\n  this._label = new Text({\n    x:          xPosition,\n    y:          0,\n    text:       this._options.layer.formatTime(time),\n    fontFamily: this._options.fontFamily,\n    fontSize:   this._options.fontSize,\n    fontStyle:  this._options.fontStyle,\n    fill:       '#000',\n    textAlign:  'center',\n    visible:    this._editable\n  });\n\n  this._label.hide();\n\n  // Handle - create with default y, the real value is set in fitToView().\n  this._handle = new Rect({\n    x:           handleX,\n    y:           0,\n    width:       handleWidth,\n    height:      handleHeight,\n    fill:        handleColor,\n    stroke:      handleColor,\n    strokeWidth: 0\n  });\n\n  this._handleLineOne = new Rect({\n    name: 'handleLineOne',\n    x: handleX + 4.5,\n    y: 0,\n    width: 0.5,\n    height: 16,\n    fill: handleLineColor,\n    stroke: handleLineColor,\n    strokeWidth: 1\n  });\n\n  this._handleLineTwo = new Rect({\n    name: 'handleLineTwo',\n    x: handleX + 9.5,\n    y: 0,\n    width: 0.5,\n    height: 16,\n    fill: handleLineColor,\n    stroke: handleLineColor,\n    strokeWidth: 1\n  });\n\n  this._handleLineSingle = new Rect({\n    name: 'handleLineSingle',\n    x: handleX + 7,\n    y: 0,\n    width: 0.5,\n    height: 16,\n    fill: handleLineColor,\n    stroke: handleLineColor,\n    strokeWidth: 1,\n    cornerRadius: 2,\n    visible:     this._editable\n  });\n\n  // Vertical Line - create with default y and points, the real values\n  // are set in fitToView().\n  this._line = new Line({\n    x:           0,\n    y:           0,\n    stroke:      this._options.color,\n    strokeWidth: 1,\n    visible:     this._editable\n  });\n\n  group.add(this._label);\n  // group.add(this._line);\n  group.add(this._handleLineOne);\n  group.add(this._handleLineTwo);\n  group.add(this._handleLineSingle);\n  group.add(this._handle);\n\n  this.fitToView();\n\n  this.bindEventHandlers(group);\n\n  setTimeout(() => {\n    let focusedSegmentShape;\n    const segmentShapes = this._options.layer._segmentShapes;\n\n    for (const [value] of Object.entries(segmentShapes)) {\n      const segmentShape = segmentShapes[value];\n\n      if (segmentShape._endMarker !== null) {\n        focusedSegmentShape = segmentShape;\n        break;\n      }\n    }\n\n    const segmentShapeWidth = focusedSegmentShape._overlay.width();\n\n    if (segmentShapeWidth <= 32.5) {\n      const markerInfo = this.getMarkerInfo(focusedSegmentShape);\n\n      this.updateMarkersSmall(segmentShapeWidth, markerInfo);\n    }\n  }, 0);\n};\n\nDefaultSegmentMarker.prototype.bindEventHandlers = function(group) {\n  const self = this;\n\n  // const xPosition = self._options.startMarker ? -24 : 24;\n\n  if (self._options.draggable) {\n    group.on('dragstart', function() {\n      // self._handle.attrs.fill = '#3641414D'; // neutral-800 .30a\n      // self._handle.attrs.stroke = '#3641414D'; // neutral-800 .30a\n      // if (self._options.startMarker) {\n      //   self._label.setX(xPosition - self._label.getWidth());\n      // }\n\n      // self._label.show();\n    });\n\n    group.on('dragend', function() {\n      // self._label.hide();\n    });\n  }\n\n  self._handle.on('mouseover touchstart', function() {\n    document.body.style.cursor = 'col-resize';\n    // self._handle.attrs.fill = '#3641414D'; // neutral-800 .30a\n    // self._handle.attrs.stroke = '#3641414D'; // neutral-800 .30a\n    // if (self._options.startMarker) {\n    //   self._label.setX(xPosition - self._label.getWidth());\n    // }\n\n    // self._label.show();\n    this.parent.parent.draw();\n  });\n\n  self._handle.on('mouseout touchend', function() {\n    document.body.style.cursor = 'default';\n    // self._handle.attrs.fill = '#6E797A4D'; // neutral-600 .30a\n    // self._handle.attrs.stroke = '#6E797A4D'; // neutral-600 .30a\n    // self._label.hide();\n    this.parent.parent.draw();\n  });\n};\n\nDefaultSegmentMarker.prototype.fitToView = function() {\n  const height = this._options.layer.getHeight();\n\n  this._label.y(height / 2 - 5);\n  this._handle.y(height / 2 + 45);\n  this._handleLineOne.y(height / 2 + 61);\n  this._handleLineTwo.y(height / 2 + 61);\n  this._handleLineSingle.y(height / 2 + 61);\n  // this._line.points([0.5, 0, 0.5, height]);\n};\n\nDefaultSegmentMarker.prototype.updateMarkersSmall = function(segmentShapeWidth, markerInfo) {\n  const { endMarkerHandleLineSingle, startMarkerHandleLineSingle } = markerInfo;\n  const newHandleWidth = (segmentShapeWidth / 2) - 0.5;\n\n  markerInfo.endMarker._handle.x(-newHandleWidth + 1);\n  markerInfo.startMarker._handle.attrs.width = newHandleWidth;\n  markerInfo.endMarker._handle.attrs.width = newHandleWidth;\n\n  markerInfo.endMarkerHandleLines.forEach(line => line.hide());\n  endMarkerHandleLineSingle.show();\n  endMarkerHandleLineSingle.x((newHandleWidth / 2) - newHandleWidth);\n  markerInfo.startMarkerHandleLines.forEach(line => line.hide());\n  startMarkerHandleLineSingle.show();\n  startMarkerHandleLineSingle.x(newHandleWidth / 2);\n};\n\nDefaultSegmentMarker.prototype.getMarkerInfo = function(segmentShape) {\n  const { _endMarker, _startMarker } = segmentShape;\n  const endMarker = _endMarker._marker;\n  const endMarkerGroupChildren = _endMarker._group.children;\n  const startMarker = _startMarker._marker;\n  const startMarkerGroupChildren = _startMarker._group.children;\n\n  const endMarkerHandleLines = endMarkerGroupChildren.filter(\n    child => child.attrs.name === 'handleLineOne' || child.attrs.name === 'handleLineTwo');\n  const endMarkerHandleLineSingle = endMarkerGroupChildren.find(\n    child => child.attrs.name === 'handleLineSingle');\n  const startMarkerHandleLines = startMarkerGroupChildren.filter(\n    child => child.attrs.name === 'handleLineOne' || child.attrs.name === 'handleLineTwo');\n  const startMarkerHandleLineSingle = startMarkerGroupChildren.find(\n    child => child.attrs.name === 'handleLineSingle');\n\n  return {\n    endMarker,\n    startMarker,\n    endMarkerHandleLines,\n    endMarkerHandleLineSingle,\n    startMarkerHandleLines,\n    startMarkerHandleLineSingle\n  };\n};\n\nDefaultSegmentMarker.prototype.update = function(options) {\n  if (options.startTime !== undefined && this._options.startMarker) {\n    let focusedSegmentShape;\n    const segmentShapes = this._options.layer._segmentShapes;\n\n    for (const [value] of Object.entries(segmentShapes)) {\n      const segmentShape = segmentShapes[value];\n\n      if (segmentShape._endMarker !== null) {\n        focusedSegmentShape = segmentShape;\n        break;\n      }\n    }\n\n    const markerInfo = this.getMarkerInfo(focusedSegmentShape);\n\n    const segmentShapeWidth = focusedSegmentShape._overlay.width();\n\n    if (segmentShapeWidth <= 32.5) {\n      this.updateMarkersSmall(segmentShapeWidth, markerInfo);\n    }\n    else {\n      const handleX = -(15 / 2) - 8;\n      const startHandleX = handleX * -1 - 14.9;\n      const endHandleX = handleX;\n\n      markerInfo.endMarker._handle.x(endHandleX);\n      markerInfo.startMarker._handle.x(startHandleX);\n\n      markerInfo.startMarker._handle.attrs.width = 15;\n      markerInfo.endMarker._handle.attrs.width = 15;\n\n      markerInfo.endMarkerHandleLines.forEach(line => line.show());\n      markerInfo.endMarkerHandleLineSingle.hide();\n      markerInfo.startMarkerHandleLines.forEach(line => line.show());\n      markerInfo.startMarkerHandleLineSingle.hide();\n    }\n\n    this._label.text(this._options.layer.formatTime(options.startTime));\n  }\n\n  if (options.endTime !== undefined && !this._options.startMarker) {\n    this._label.text(this._options.layer.formatTime(options.endTime));\n  }\n\n  if (options.editable !== undefined) {\n    this._editable = options.editable;\n\n    this._label.visible(this._editable);\n    this._handle.visible(this._editable);\n    this._line.visible(this._editable);\n  }\n};\n\nexport default DefaultSegmentMarker;\n","/**\n * @file\n *\n * Factory functions for creating point and segment marker handles.\n *\n * @module marker-factories\n */\n\nimport DefaultPointMarker from './default-point-marker';\nimport DefaultSegmentMarker from './default-segment-marker';\nimport { Text } from 'konva/lib/shapes/Text';\n\n/**\n * Parameters for the {@link createSegmentMarker} function.\n *\n * @typedef {Object} CreateSegmentMarkerOptions\n * @global\n * @property {Segment} segment\n * @property {Boolean} draggable If true, marker is draggable.\n * @property {Boolean} startMarker\n * @property {String} color\n * @property {String} fontFamily\n * @property {Number} fontSize\n * @property {String} fontStyle\n * @property {Layer} layer\n * @property {String} view\n * @property {SegmentDisplayOptions} segmentOptions\n */\n\n/**\n * Creates a left or right side segment marker handle.\n *\n * @param {CreateSegmentMarkerOptions} options\n * @returns {Marker}\n */\n\nexport function createSegmentMarker(options) {\n  if (options.view === 'zoomview') {\n    return new DefaultSegmentMarker(options);\n  }\n\n  return null;\n}\n\n/**\n * Parameters for the {@link createSegmentLabel} function.\n *\n * @typedef {Object} SegmentLabelOptions\n * @global\n * @property {Segment} segment The {@link Segment} object associated with this\n *   label.\n * @property {String} view The name of the view that the label is being\n *   created in, either <code>zoomview</code> or <code>overview</code>.\n * @property {SegmentsLayer} layer\n * @property {String} fontFamily\n * @property {Number} fontSize\n * @property {String} fontStyle\n */\n\n/**\n * Creates a Konva object that renders information about a segment, such as\n * its label text.\n *\n * @param {SegmentLabelOptions} options\n * @returns {Konva.Text}\n */\n\nexport function createSegmentLabel(options) {\n  return new Text({\n    x:          12,\n    y:          12,\n    text:       options.segment.labelText,\n    textAlign:  'center',\n    fontFamily: options.fontFamily || 'sans-serif',\n    fontSize:   options.fontSize || 12,\n    fontStyle:  options.fontStyle || 'normal',\n    fill:       '#000'\n  });\n}\n\n/**\n * Parameters for the {@link createPointMarker} function.\n *\n * @typedef {Object} CreatePointMarkerOptions\n * @global\n * @property {Point} point\n * @property {Boolean} editable If true, marker is draggable.\n * @property {String} color\n * @property {Layer} layer\n * @property {String} view\n * @property {String} fontFamily\n * @property {Number} fontSize\n * @property {String} fontStyle\n */\n\n/**\n * Creates a point marker handle.\n *\n * @param {CreatePointMarkerOptions} options\n * @returns {Marker}\n */\n\nexport function createPointMarker(options) {\n  return new DefaultPointMarker(options);\n}\n","/**\n * @file\n *\n * Defines the {@link HighlightLayer} class.\n *\n * @module highlight-layer\n */\n\nimport Konva from 'konva/lib/Core';\nimport { Rect } from 'konva/lib/shapes/Rect';\n\nimport { clamp } from  './utils';\n\n/**\n * Highlight layer options\n *\n * @typedef {Object} HighlightLayerOptions\n * @global\n * @property {Number} highlightOffset\n * @property {String} highlightColor\n * @property {String} highlightStrokeColor\n * @property {Number} highlightOpacity\n * @property {Number} highlightCornerRadius\n */\n\n/**\n * Creates the highlight region that shows the position of the zoomable\n * waveform view in the overview waveform.\n *\n * @class\n * @alias HighlightLayer\n *\n * @param {WaveformOverview} view\n * @param {HighlightLayerOptions} options\n */\n\nfunction HighlightLayer(view, options) {\n  this._view          = view;\n  this._offset        = options.highlightOffset;\n  this._color         = options.highlightColor;\n  this._layer         = new Konva.Layer({ listening: false });\n  this._highlightRect = null;\n  this._startTime     = null;\n  this._endTime       = null;\n  this._strokeColor   = options.highlightStrokeColor;\n  this._opacity       = options.highlightOpacity;\n  this._cornerRadius  = options.highlightCornerRadius;\n}\n\nHighlightLayer.prototype.addToStage = function(stage) {\n  stage.add(this._layer);\n};\n\nHighlightLayer.prototype.showHighlight = function(startTime, endTime) {\n  if (!this._highlightRect) {\n    this._createHighlightRect(startTime, endTime);\n  }\n\n  this._update(startTime, endTime);\n};\n\n/**\n * Updates the position of the highlight region.\n *\n * @param {Number} startTime The start of the highlight region, in seconds.\n * @param {Number} endTime The end of the highlight region, in seconds.\n */\n\nHighlightLayer.prototype._update = function(startTime, endTime) {\n  this._startTime = startTime;\n  this._endTime = endTime;\n\n  const startOffset = this._view.timeToPixels(startTime);\n  const endOffset   = this._view.timeToPixels(endTime);\n\n  this._highlightRect.setAttrs({\n    x:     startOffset,\n    width: endOffset - startOffset\n  });\n};\n\nHighlightLayer.prototype._createHighlightRect = function(startTime, endTime) {\n  this._startTime = startTime;\n  this._endTime   = endTime;\n\n  const startOffset = this._view.timeToPixels(startTime);\n  const endOffset   = this._view.timeToPixels(endTime);\n\n  // Create with default y and height, the real values are set in fitToView().\n  this._highlightRect = new Rect({\n    x:            startOffset,\n    y:            0,\n    width:        endOffset - startOffset,\n    height:       0,\n    stroke:       this._strokeColor,\n    strokeWidth:  1,\n    fill:         this._color,\n    opacity:      this._opacity,\n    cornerRadius: this._cornerRadius\n  });\n\n  this.fitToView();\n\n  this._layer.add(this._highlightRect);\n};\n\nHighlightLayer.prototype.removeHighlight = function() {\n  if (this._highlightRect) {\n    this._highlightRect.destroy();\n    this._highlightRect = null;\n  }\n};\n\nHighlightLayer.prototype.updateHighlight = function() {\n  if (this._highlightRect) {\n    this._update(this._startTime, this._endTime);\n  }\n};\n\nHighlightLayer.prototype.fitToView = function() {\n  if (this._highlightRect) {\n    const height = this._view.getHeight();\n    const offset = clamp(this._offset, 0, Math.floor(height / 2));\n\n    this._highlightRect.setAttrs({\n      y: offset,\n      height: height - (offset * 2)\n    });\n  }\n};\n\nexport default HighlightLayer;\n","/**\n * @file\n *\n * Defines the {@link PlayheadLayer} class.\n *\n * @module playhead-layer\n */\n\nimport Konva from 'konva/lib/Core';\nimport { Animation } from 'konva/lib/Animation';\nimport { Line } from 'konva/lib/shapes/Line';\nimport { Text } from 'konva/lib/shapes/Text';\n\n/**\n * Creates a Konva.Layer that displays a playhead marker.\n *\n * @class\n * @alias PlayheadLayer\n *\n * @param {Object} options\n * @param {Player} options.player\n * @param {WaveformOverview|WaveformZoomView} options.view\n * @param {Boolean} options.showPlayheadTime If <code>true</code> The playback time position\n *   is shown next to the playhead.\n * @param {String} options.playheadColor\n * @param {String} options.playheadTextColor\n * @param {String} options.playheadFontFamily\n * @param {Number} options.playheadFontSize\n * @param {String} options.playheadFontStyle\n */\n\nfunction PlayheadLayer(options) {\n  this._player = options.player;\n  this._view = options.view;\n  this._playheadPixel = 0;\n  this._playheadLineAnimation = null;\n  this._playheadVisible = false;\n  this._playheadColor = options.playheadColor;\n  this._playheadTextColor = options.playheadTextColor;\n\n  this._playheadFontFamily = options.playheadFontFamily;\n  this._playheadFontSize = options.playheadFontSize;\n  this._playheadFontStyle = options.playheadFontStyle;\n\n  this._playheadLayer = new Konva.Layer();\n\n  this._createPlayhead(this._playheadColor);\n\n  if (options.showPlayheadTime) {\n    this._createPlayheadText(this._playheadTextColor);\n  }\n\n  this.fitToView();\n\n  this.zoomLevelChanged();\n}\n\n/**\n * Adds the layer to the given {Konva.Stage}.\n *\n * @param {Konva.Stage} stage\n */\n\nPlayheadLayer.prototype.addToStage = function(stage) {\n  stage.add(this._playheadLayer);\n};\n\n/**\n * Decides whether to use an animation to update the playhead position.\n *\n * If the zoom level is such that the number of pixels per second of audio is\n * low, we can use timeupdate events from the HTMLMediaElement to\n * set the playhead position. Otherwise, we use an animation to update the\n * playhead position more smoothly. The animation is CPU intensive, so we\n * avoid using it where possible.\n */\n\nPlayheadLayer.prototype.zoomLevelChanged = function() {\n  const pixelsPerSecond = this._view.timeToPixels(1.0);\n\n  this._useAnimation = pixelsPerSecond >= 5;\n\n  if (this._useAnimation) {\n    if (this._player.isPlaying() && !this._playheadLineAnimation) {\n      // Start the animation\n      this._start();\n    }\n  }\n  else {\n    if (this._playheadLineAnimation) {\n      // Stop the animation\n      const time = this._player.getCurrentTime();\n\n      this.stop(time);\n    }\n  }\n};\n\n/**\n * Resizes the playhead UI objects to fit the available space in the\n * view.\n */\n\nPlayheadLayer.prototype.fitToView = function() {\n  const height = this._view.getHeight();\n\n  this._playheadLine.points([0.5, 0, 0.5, height]);\n\n  if (this._playheadText) {\n    this._playheadText.y(12);\n  }\n};\n\n/**\n * Creates the playhead UI objects.\n *\n * @private\n * @param {String} color\n */\n\nPlayheadLayer.prototype._createPlayhead = function(color) {\n  // Create with default points, the real values are set in fitToView().\n  this._playheadLine = new Line({\n    stroke:      color,\n    strokeWidth: 1\n  });\n\n  this._playheadGroup = new Konva.Group({\n    x: 0,\n    y: 0\n  });\n\n  this._playheadGroup.add(this._playheadLine);\n  this._playheadLayer.add(this._playheadGroup);\n};\n\nPlayheadLayer.prototype._createPlayheadText = function(color) {\n  const time = this._player.getCurrentTime();\n  const text = this._view.formatTime(time);\n\n  // Create with default y, the real value is set in fitToView().\n  this._playheadText = new Text({\n    x: 2,\n    y: 0,\n    text: text,\n    fontSize: this._playheadFontSize,\n    fontFamily: this._playheadFontFamily,\n    fontStyle: this._playheadFontStyle,\n    fill: color,\n    align: 'right'\n  });\n\n  this._playheadGroup.add(this._playheadText);\n};\n\n/**\n * Updates the playhead position.\n *\n * @param {Number} time Current playhead position, in seconds.\n */\n\nPlayheadLayer.prototype.updatePlayheadTime = function(time) {\n  this._syncPlayhead(time);\n\n  if (this._player.isPlaying()) {\n    this._start();\n  }\n};\n\n/**\n * Updates the playhead position.\n *\n * @private\n * @param {Number} time Current playhead position, in seconds.\n */\n\nPlayheadLayer.prototype._syncPlayhead = function(time) {\n  const pixelIndex = this._view.timeToPixels(time);\n\n  const frameOffset = this._view.getFrameOffset();\n  const width = this._view.getWidth();\n\n  const isVisible = (pixelIndex >= frameOffset) &&\n                    (pixelIndex <= frameOffset + width);\n\n  this._playheadPixel = pixelIndex;\n\n  if (isVisible) {\n    const playheadX = this._playheadPixel - frameOffset;\n\n    if (!this._playheadVisible) {\n      this._playheadVisible = true;\n      this._playheadGroup.show();\n    }\n\n    this._playheadGroup.setX(playheadX);\n\n    if (this._playheadText) {\n      const text = this._view.formatTime(time);\n      const playheadTextWidth = this._playheadText.getTextWidth();\n\n      this._playheadText.setText(text);\n\n      if (playheadTextWidth + playheadX > width - 2) {\n        this._playheadText.setX(-playheadTextWidth - 2);\n      }\n      else if (playheadTextWidth + playheadX < width) {\n        this._playheadText.setX(2);\n      }\n    }\n  }\n  else {\n    if (this._playheadVisible) {\n      this._playheadVisible = false;\n      this._playheadGroup.hide();\n    }\n  }\n\n  if (this._view.playheadPosChanged) {\n    this._view.playheadPosChanged(time);\n  }\n};\n\n/**\n * Starts a playhead animation in sync with the media playback.\n *\n * @private\n */\n\nPlayheadLayer.prototype._start = function() {\n  const self = this;\n\n  if (self._playheadLineAnimation) {\n    self._playheadLineAnimation.stop();\n    self._playheadLineAnimation = null;\n  }\n\n  if (!self._useAnimation) {\n    return;\n  }\n\n  let lastPlayheadPosition = null;\n\n  self._playheadLineAnimation = new Animation(function() {\n    const time = self._player.getCurrentTime();\n    const playheadPosition = self._view.timeToPixels(time);\n\n    if (playheadPosition !== lastPlayheadPosition) {\n      self._syncPlayhead(time);\n      lastPlayheadPosition = playheadPosition;\n    }\n  }, self._playheadLayer);\n\n  self._playheadLineAnimation.start();\n};\n\nPlayheadLayer.prototype.stop = function(time) {\n  if (this._playheadLineAnimation) {\n    this._playheadLineAnimation.stop();\n    this._playheadLineAnimation = null;\n  }\n\n  this._syncPlayhead(time);\n};\n\nPlayheadLayer.prototype.getPlayheadPixel = function() {\n  return this._playheadPixel;\n};\n\nPlayheadLayer.prototype.showPlayheadTime = function(show) {\n  if (show) {\n    if (!this._playheadText) {\n      // Create it\n      this._createPlayheadText(this._playheadTextColor);\n      this.fitToView();\n    }\n  }\n  else {\n    if (this._playheadText) {\n      this._playheadText.remove();\n      this._playheadText.destroy();\n      this._playheadText = null;\n    }\n  }\n};\n\nPlayheadLayer.prototype.updatePlayheadText = function() {\n  if (this._playheadText) {\n    const time = this._player.getCurrentTime();\n    const text = this._view.formatTime(time);\n\n    this._playheadText.setText(text);\n  }\n};\n\nPlayheadLayer.prototype.destroy = function() {\n  if (this._playheadLineAnimation) {\n    this._playheadLineAnimation.stop();\n    this._playheadLineAnimation = null;\n  }\n};\n\nexport default PlayheadLayer;\n","/**\n * @file\n *\n * Defines the {@link PointMarker} class.\n *\n * @module point-marker\n */\n\nimport Konva from 'konva/lib/Core';\n\n/**\n * Parameters for the {@link PointMarker} constructor.\n *\n * @typedef {Object} PointMarkerOptions\n * @global\n * @property {Point} point Point object with timestamp.\n * @property {Boolean} editable If true, marker is draggable.\n * @property {Marker} marker\n * @property {Function} onclick\n * @property {Function} onDblClick\n * @property {Function} onDragStart\n * @property {Function} onDragMove Callback during mouse drag operations.\n * @property {Function} onDragEnd\n * @property {Function} dragBoundFunc\n * @property {Function} onMouseEnter\n * @property {Function} onMouseLeave\n * @property {Function} onContextMenu\n */\n\n/**\n * Creates a point marker handle.\n *\n * @class\n * @alias PointMarker\n *\n * @param {PointMarkerOptions} options\n */\n\nfunction PointMarker(options) {\n  this._point     = options.point;\n  this._marker    = options.marker;\n  this._draggable = options.draggable;\n\n  this._onDragStart   = options.onDragStart;\n  this._onDragMove    = options.onDragMove;\n  this._onDragEnd     = options.onDragEnd;\n  this._dragBoundFunc = options.dragBoundFunc;\n  this._onMouseEnter  = options.onMouseEnter;\n  this._onMouseLeave  = options.onMouseLeave;\n\n  this._group = new Konva.Group({\n    name:          'point-marker',\n    point:         this._point,\n    draggable:     this._draggable,\n    dragBoundFunc: options.dragBoundFunc\n  });\n\n  this._bindDefaultEventHandlers();\n\n  this._marker.init(this._group);\n}\n\nPointMarker.prototype._bindDefaultEventHandlers = function() {\n  const self = this;\n\n  self._group.on('dragstart', function(event) {\n    self._onDragStart(event, self._point);\n  });\n\n  self._group.on('dragmove', function(event) {\n    self._onDragMove(event, self._point);\n  });\n\n  self._group.on('dragend', function(event) {\n    self._onDragEnd(event, self._point);\n  });\n\n  self._group.on('mouseenter', function(event) {\n    self._onMouseEnter(event, self._point);\n  });\n\n  self._group.on('mouseleave', function(event) {\n    self._onMouseLeave(event, self._point);\n  });\n};\n\n/**\n * @param {Konva.Layer} layer\n */\n\nPointMarker.prototype.addToLayer = function(layer) {\n  layer.add(this._group);\n};\n\nPointMarker.prototype.fitToView = function() {\n  this._marker.fitToView();\n};\n\nPointMarker.prototype.getPoint = function() {\n  return this._point;\n};\n\nPointMarker.prototype.getX = function() {\n  return this._group.getX();\n};\n\nPointMarker.prototype.setX = function(x) {\n  this._group.setX(x);\n};\n\nPointMarker.prototype.getWidth = function() {\n  return this._group.getWidth();\n};\n\nPointMarker.prototype.getAbsolutePosition = function() {\n  return this._group.getAbsolutePosition();\n};\n\nPointMarker.prototype.update = function(options) {\n  if (options.editable !== undefined) {\n    this._group.draggable(options.editable);\n  }\n\n  if (this._marker.update) {\n    this._marker.update(options);\n  }\n};\n\nPointMarker.prototype.destroy = function() {\n  if (this._marker.destroy) {\n    this._marker.destroy();\n  }\n\n  this._group.destroyChildren();\n  this._group.destroy();\n};\n\nexport default PointMarker;\n","/**\n * @file\n *\n * Defines the {@link PointsLayer} class.\n *\n * @module points-layer\n */\n\nimport PointMarker from './point-marker';\nimport { clamp, objectHasProperty } from './utils';\nimport Konva from 'konva/lib/Core';\n\nconst defaultFontFamily = 'sans-serif';\nconst defaultFontSize = 10;\nconst defaultFontShape = 'normal';\n\n/**\n * Creates a Konva.Layer that displays point markers against the audio\n * waveform.\n *\n * @class\n * @alias PointsLayer\n *\n * @param {Peaks} peaks\n * @param {WaveformOverview|WaveformZoomView} view\n * @param {Boolean} allowEditing\n */\n\nfunction PointsLayer(peaks, view, allowEditing) {\n  this._peaks        = peaks;\n  this._view         = view;\n  this._allowEditing = allowEditing;\n  this._pointMarkers = {};\n  this._layer        = new Konva.Layer();\n\n  this._onPointsDrag = this._onPointsDrag.bind(this);\n\n  this._onPointMarkerDragStart   = this._onPointMarkerDragStart.bind(this);\n  this._onPointMarkerDragMove    = this._onPointMarkerDragMove.bind(this);\n  this._onPointMarkerDragEnd     = this._onPointMarkerDragEnd.bind(this);\n  this._pointMarkerDragBoundFunc = this._pointMarkerDragBoundFunc.bind(this);\n  this._onPointMarkerMouseEnter  = this._onPointMarkerMouseEnter.bind(this);\n  this._onPointMarkerMouseLeave  = this._onPointMarkerMouseLeave.bind(this);\n\n  this._onPointsUpdate    = this._onPointsUpdate.bind(this);\n  this._onPointsAdd       = this._onPointsAdd.bind(this);\n  this._onPointsRemove    = this._onPointsRemove.bind(this);\n  this._onPointsRemoveAll = this._onPointsRemoveAll.bind(this);\n\n  this._peaks.on('points.update', this._onPointsUpdate);\n  this._peaks.on('points.add', this._onPointsAdd);\n  this._peaks.on('points.remove', this._onPointsRemove);\n  this._peaks.on('points.remove_all', this._onPointsRemoveAll);\n\n  this._peaks.on('points.dragstart', this._onPointsDrag);\n  this._peaks.on('points.dragmove', this._onPointsDrag);\n  this._peaks.on('points.dragend', this._onPointsDrag);\n}\n\n/**\n * Adds the layer to the given {Konva.Stage}.\n *\n * @param {Konva.Stage} stage\n */\n\nPointsLayer.prototype.addToStage = function(stage) {\n  stage.add(this._layer);\n};\n\nPointsLayer.prototype.enableEditing = function(enable) {\n  this._allowEditing = enable;\n};\n\nPointsLayer.prototype.getPointMarker = function(point) {\n  return this._pointMarkers[point.pid];\n};\n\nPointsLayer.prototype.formatTime = function(time) {\n  return this._view.formatTime(time);\n};\n\nPointsLayer.prototype._onPointsUpdate = function(point, options) {\n  const frameStartTime = this._view.getStartTime();\n  const frameEndTime   = this._view.getEndTime();\n\n  const pointMarker = this.getPointMarker(point);\n  const isVisible = point.isVisible(frameStartTime, frameEndTime);\n\n  if (pointMarker && !isVisible) {\n    // Remove point marker that is no longer visible.\n    this._removePoint(point);\n  }\n  else if (!pointMarker && isVisible) {\n    // Add point marker for visible point.\n    this._updatePoint(point);\n  }\n  else if (pointMarker && isVisible) {\n    // Update the point marker with the changed attributes.\n    if (objectHasProperty(options, 'time')) {\n      const pointMarkerOffset = this._view.timeToPixels(point.time);\n\n      const pointMarkerX = pointMarkerOffset - this._view.getFrameOffset();\n\n      pointMarker.setX(pointMarkerX);\n    }\n\n    pointMarker.update(options);\n  }\n};\n\nPointsLayer.prototype._onPointsAdd = function(event) {\n  const self = this;\n\n  const frameStartTime = self._view.getStartTime();\n  const frameEndTime   = self._view.getEndTime();\n\n  event.points.forEach(function(point) {\n    if (point.isVisible(frameStartTime, frameEndTime)) {\n      self._updatePoint(point);\n    }\n  });\n};\n\nPointsLayer.prototype._onPointsRemove = function(event) {\n  const self = this;\n\n  event.points.forEach(function(point) {\n    self._removePoint(point);\n  });\n};\n\nPointsLayer.prototype._onPointsRemoveAll = function() {\n  this._layer.removeChildren();\n  this._pointMarkers = {};\n};\n\n/**\n * Creates the Konva UI objects for a given point.\n *\n * @private\n * @param {Point} point\n * @returns {PointMarker}\n */\n\nPointsLayer.prototype._createPointMarker = function(point) {\n  const editable = this._allowEditing && point.editable;\n\n  const marker = this._peaks.options.createPointMarker({\n    point:      point,\n    editable:   editable,\n    color:      point.color,\n    fontFamily: this._peaks.options.fontFamily || defaultFontFamily,\n    fontSize:   this._peaks.options.fontSize || defaultFontSize,\n    fontStyle:  this._peaks.options.fontStyle || defaultFontShape,\n    layer:      this,\n    view:       this._view.getName()\n  });\n\n  return new PointMarker({\n    point:         point,\n    draggable:     editable,\n    marker:        marker,\n    onDragStart:   this._onPointMarkerDragStart,\n    onDragMove:    this._onPointMarkerDragMove,\n    onDragEnd:     this._onPointMarkerDragEnd,\n    dragBoundFunc: this._pointMarkerDragBoundFunc,\n    onMouseEnter:  this._onPointMarkerMouseEnter,\n    onMouseLeave:  this._onPointMarkerMouseLeave\n  });\n};\n\nPointsLayer.prototype.getHeight = function() {\n  return this._view.getHeight();\n};\n\n/**\n * Adds a Konva UI object to the layer for a given point.\n *\n * @private\n * @param {Point} point\n * @returns {PointMarker}\n */\n\nPointsLayer.prototype._addPointMarker = function(point) {\n  const pointMarker = this._createPointMarker(point);\n\n  this._pointMarkers[point.pid] = pointMarker;\n\n  pointMarker.addToLayer(this._layer);\n\n  return pointMarker;\n};\n\nPointsLayer.prototype._onPointsDrag = function(event) {\n  const pointMarker = this._updatePoint(event.point);\n\n  pointMarker.update({ time: event.point.time });\n};\n\n/**\n * @param {KonvaEventObject} event\n * @param {Point} point\n */\n\nPointsLayer.prototype._onPointMarkerMouseEnter = function(event, point) {\n  this._peaks.emit('points.mouseenter', {\n    point: point,\n    evt: event.evt\n  });\n};\n\n/**\n * @param {KonvaEventObject} event\n * @param {Point} point\n */\n\nPointsLayer.prototype._onPointMarkerMouseLeave = function(event, point) {\n  this._peaks.emit('points.mouseleave', {\n    point: point,\n    evt: event.evt\n  });\n};\n\n/**\n * @param {KonvaEventObject} event\n * @param {Point} point\n */\n\nPointsLayer.prototype._onPointMarkerDragStart = function(event, point) {\n  this._dragPointMarker = this.getPointMarker(point);\n\n  this._peaks.emit('points.dragstart', {\n    point: point,\n    evt: event.evt\n  });\n};\n\n/**\n * @param {KonvaEventObject} event\n * @param {Point} point\n */\n\nPointsLayer.prototype._onPointMarkerDragMove = function(event, point) {\n  const pointMarker = this._pointMarkers[point.pid];\n\n  const markerX = pointMarker.getX();\n\n  const offset = markerX + pointMarker.getWidth();\n\n  point._setTime(this._view.pixelOffsetToTime(offset));\n\n  this._peaks.emit('points.dragmove', {\n    point: point,\n    evt: event.evt\n  });\n};\n\n/**\n * @param {KonvaEventObject} event\n * @param {Point} point\n */\n\nPointsLayer.prototype._onPointMarkerDragEnd = function(event, point) {\n  this._dragPointMarker = null;\n\n  this._peaks.emit('points.dragend', {\n    point: point,\n    evt: event.evt\n  });\n};\n\nPointsLayer.prototype._pointMarkerDragBoundFunc = function(pos) {\n  // Allow the marker to be moved horizontally but not vertically.\n  return {\n    x: clamp(pos.x, 0, this._view.getWidth()),\n    y: this._dragPointMarker.getAbsolutePosition().y\n  };\n};\n\n/**\n * Updates the positions of all displayed points in the view.\n *\n * @param {Number} startTime The start of the visible range in the view,\n *   in seconds.\n * @param {Number} endTime The end of the visible range in the view,\n *   in seconds.\n */\n\nPointsLayer.prototype.updatePoints = function(startTime, endTime) {\n  // Update all points in the visible time range.\n  const points = this._peaks.points.find(startTime, endTime);\n\n  points.forEach(this._updatePoint.bind(this));\n\n  // TODO: In the overview all points are visible, so no need to do this.\n  this._removeInvisiblePoints(startTime, endTime);\n};\n\n/**\n * @private\n * @param {Point} point\n */\n\nPointsLayer.prototype._updatePoint = function(point) {\n  let pointMarker = this.getPointMarker(point);\n\n  if (!pointMarker) {\n    pointMarker = this._addPointMarker(point);\n  }\n\n  const pointMarkerOffset = this._view.timeToPixels(point.time);\n  const pointMarkerX = pointMarkerOffset - this._view.getFrameOffset();\n\n  pointMarker.setX(pointMarkerX);\n\n  return pointMarker;\n};\n\n/**\n * Remove any points that are not visible, i.e., are outside the given time\n * range.\n *\n * @private\n * @param {Number} startTime The start of the visible time range, in seconds.\n * @param {Number} endTime The end of the visible time range, in seconds.\n */\n\nPointsLayer.prototype._removeInvisiblePoints = function(startTime, endTime) {\n  for (const pointPid in this._pointMarkers) {\n    if (objectHasProperty(this._pointMarkers, pointPid)) {\n      const point = this._pointMarkers[pointPid].getPoint();\n\n      if (!point.isVisible(startTime, endTime)) {\n        this._removePoint(point);\n      }\n    }\n  }\n};\n\n/**\n * Removes the UI object for a given point.\n *\n * @private\n * @param {Point} point\n */\n\nPointsLayer.prototype._removePoint = function(point) {\n  const pointMarker = this.getPointMarker(point);\n\n  if (pointMarker) {\n    pointMarker.destroy();\n    delete this._pointMarkers[point.pid];\n  }\n};\n\n/**\n * Toggles visibility of the points layer.\n *\n * @param {Boolean} visible\n */\n\nPointsLayer.prototype.setVisible = function(visible) {\n  this._layer.setVisible(visible);\n};\n\nPointsLayer.prototype.destroy = function() {\n  this._peaks.off('points.update', this._onPointsUpdate);\n  this._peaks.off('points.add', this._onPointsAdd);\n  this._peaks.off('points.remove', this._onPointsRemove);\n  this._peaks.off('points.remove_all', this._onPointsRemoveAll);\n  this._peaks.off('points.dragstart', this._onPointsDrag);\n  this._peaks.off('points.dragmove', this._onPointsDrag);\n  this._peaks.off('points.dragend', this._onPointsDrag);\n};\n\nPointsLayer.prototype.fitToView = function() {\n  for (const pointPid in this._pointMarkers) {\n    if (objectHasProperty(this._pointMarkers, pointPid)) {\n      const pointMarker = this._pointMarkers[pointPid];\n\n      pointMarker.fitToView();\n    }\n  }\n};\n\nPointsLayer.prototype.draw = function() {\n  this._layer.draw();\n};\n\nexport default PointsLayer;\n","/**\n * @file\n *\n * Defines the {@link OverlaySegmentMarker} class.\n *\n * @module overlay-segment-marker\n */\n\nimport { Rect } from 'konva/lib/shapes/Rect';\nimport { Text } from 'konva/lib/shapes/Text';\n\nimport { clamp } from './utils';\n\n/**\n * Creates a segment marker handle.\n *\n * @class\n * @alias OverlaySegmentMarker\n *\n * @param {CreateSegmentMarkerOptions} options\n */\n\nfunction OverlaySegmentMarker(options) {\n  this._options = options;\n}\n\nOverlaySegmentMarker.prototype.init = function(group) {\n  const handleWidth  = 10;\n  const handleHeight = 20;\n  const handleX      = -(handleWidth / 2) + 0.5; // Place in the middle of the marker\n\n  const xPosition = this._options.startMarker ? -24 : 24;\n\n  const time = this._options.startMarker ? this._options.segment.startTime :\n                                           this._options.segment.endTime;\n\n  // Label - create with default y, the real value is set in fitToView().\n  this._label = new Text({\n    x:          xPosition,\n    y:          0,\n    text:       this._options.layer.formatTime(time),\n    fontFamily: this._options.fontFamily,\n    fontSize:   this._options.fontSize,\n    fontStyle:  this._options.fontStyle,\n    fill:       '#000',\n    textAlign:  'center',\n    visible:    false\n  });\n\n  // Handle - create with default y, the real value is set in fitToView().\n  this._handle = new Rect({\n    x:       handleX,\n    y:       0,\n    width:   handleWidth,\n    height:  handleHeight\n  });\n\n  group.add(this._label);\n  group.add(this._handle);\n\n  this.fitToView();\n\n  this.bindEventHandlers(group);\n};\n\nOverlaySegmentMarker.prototype.bindEventHandlers = function(group) {\n  const self = this;\n\n  const xPosition = self._options.startMarker ? -24 : 24;\n\n  group.on('dragstart', function() {\n    if (self._options.startMarker) {\n      self._label.setX(xPosition - self._label.getWidth());\n    }\n\n    self._label.show();\n  });\n\n  group.on('dragend', function() {\n    self._label.hide();\n  });\n\n  self._handle.on('mouseover touchstart', function() {\n    if (self._options.startMarker) {\n      self._label.setX(xPosition - self._label.getWidth());\n    }\n\n    self._label.show();\n\n    document.body.style.cursor = 'ew-resize';\n  });\n\n  self._handle.on('mouseout touchend', function() {\n    self._label.hide();\n\n    document.body.style.cursor = 'default';\n  });\n};\n\nOverlaySegmentMarker.prototype.fitToView = function() {\n  const viewHeight = this._options.layer.getHeight();\n\n  const overlayOffset = this._options.segmentOptions.overlayOffset;\n  const overlayRectHeight = clamp(0, viewHeight - 2 * overlayOffset);\n\n  this._label.y(viewHeight / 2 - 5);\n  this._handle.y(overlayOffset);\n  this._handle.height(overlayRectHeight);\n};\n\nOverlaySegmentMarker.prototype.update = function(options) {\n  if (options.startTime !== undefined && this._options.startMarker) {\n    this._label.text(this._options.layer.formatTime(options.startTime));\n  }\n\n  if (options.endTime !== undefined && !this._options.startMarker) {\n    this._label.text(this._options.layer.formatTime(options.endTime));\n  }\n};\n\nexport default OverlaySegmentMarker;\n","/**\n * @file\n *\n * Defines the {@link SegmentMarker} class.\n *\n * @module segment-marker\n */\n\nimport Konva from 'konva/lib/Core';\n\n/**\n * Parameters for the {@link SegmentMarker} constructor.\n *\n * @typedef {Object} SegmentMarkerOptions\n * @global\n * @property {Segment} segment\n * @property {SegmentShape} segmentShape\n * @property {Boolean} editable If true, marker is draggable.\n * @property {Boolean} startMarker If <code>true</code>, the marker indicates\n *   the start time of the segment. If <code>false</code>, the marker\n *   indicates the end time of the segment.\n * @property {Function} onDragStart\n * @property {Function} onDragMove\n * @property {Function} onDragEnd\n * @property {Function} dragBoundFunc\n */\n\n/**\n * Creates a segment handle marker for the start or end of a segment.\n *\n * @class\n * @alias SegmentMarker\n *\n * @param {SegmentMarkerOptions} options\n */\n\nfunction SegmentMarker(options) {\n  const self = this;\n\n  self._segment       = options.segment;\n  self._marker        = options.marker;\n  self._segmentShape  = options.segmentShape;\n  self._editable      = options.editable;\n  self._startMarker   = options.startMarker;\n\n  self._onDragStart   = options.onDragStart;\n  self._onDragMove    = options.onDragMove;\n  self._onDragEnd     = options.onDragEnd;\n\n  self._group = new Konva.Group({\n    name:          'segment-marker',\n    segment:       self._segment,\n    draggable:     self._editable,\n    visible:       self._editable,\n    dragBoundFunc: function(pos) {\n      return options.dragBoundFunc(self, pos);\n    }\n  });\n\n  self._bindDefaultEventHandlers();\n\n  self._marker.init(self._group);\n}\n\nSegmentMarker.prototype._bindDefaultEventHandlers = function() {\n  const self = this;\n\n  self._group.on('dragstart', function(event) {\n    self._onDragStart(self, event);\n  });\n\n  self._group.on('dragmove', function(event) {\n    self._onDragMove(self, event);\n  });\n\n  self._group.on('dragend', function(event) {\n    self._onDragEnd(self, event);\n  });\n};\n\nSegmentMarker.prototype.addToLayer = function(layer) {\n  layer.add(this._group);\n};\n\nSegmentMarker.prototype.moveToTop = function() {\n  this._group.moveToTop();\n};\n\nSegmentMarker.prototype.fitToView = function() {\n  this._marker.fitToView();\n};\n\nSegmentMarker.prototype.getSegment = function() {\n  return this._segment;\n};\n\nSegmentMarker.prototype.getX = function() {\n  return this._group.getX();\n};\n\nSegmentMarker.prototype.setX = function(x) {\n  this._group.setX(x);\n};\n\nSegmentMarker.prototype.getWidth = function() {\n  return this._group.getWidth();\n};\n\nSegmentMarker.prototype.getAbsolutePosition = function() {\n  return this._group.getAbsolutePosition();\n};\n\nSegmentMarker.prototype.isStartMarker = function() {\n  return this._startMarker;\n};\n\nSegmentMarker.prototype.update = function(options) {\n  if (options.editable !== undefined) {\n    this._group.visible(options.editable);\n    this._group.draggable(options.editable);\n  }\n\n  if (this._marker.update) {\n    this._marker.update(options);\n  }\n};\n\nSegmentMarker.prototype.destroy = function() {\n  if (this._marker.destroy) {\n    this._marker.destroy();\n  }\n\n  this._group.destroyChildren();\n  this._group.destroy();\n};\n\nSegmentMarker.prototype.startDrag = function() {\n  this._group.startDrag();\n};\n\nSegmentMarker.prototype.stopDrag = function() {\n  this._group.stopDrag();\n};\n\nexport default SegmentMarker;\n","/**\n * @file\n *\n * Defines the {@link WaveformShape} class.\n *\n * @module waveform-shape\n */\n\nimport { clamp, isLinearGradientColor, isString } from './utils';\nimport Konva from 'konva/lib/Core';\n\n/**\n * Waveform shape options.\n *\n * @typedef {Object} WaveformShapeOptions\n * @global\n * @property {String | LinearGradientColor} color Waveform color.\n * @property {WaveformOverview|WaveformZoomView} view The view object\n *   that contains the waveform shape.\n * @property {Segment?} segment If given, render a waveform image\n *   covering the segment's time range. Otherwise, render the entire\n *   waveform duration.\n */\n\n/**\n * Creates a Konva.Shape object that renders a waveform image.\n *\n * @class\n * @alias WaveformShape\n *\n * @param {WaveformShapeOptions} options\n */\n\nfunction WaveformShape(options) {\n  this._color = options.color;\n\n  const shapeOptions = {};\n\n  if (isString(options.color)) {\n    shapeOptions.fill = options.color;\n  }\n  else if (isLinearGradientColor(options.color)) {\n    const startY = options.view._height * (options.color.linearGradientStart / 100);\n    const endY = options.view._height * (options.color.linearGradientEnd / 100);\n\n    shapeOptions.fillLinearGradientStartPointY = startY;\n    shapeOptions.fillLinearGradientEndPointY = endY;\n    shapeOptions.fillLinearGradientColorStops = [\n      0, options.color.linearGradientColorStops[0],\n      1, options.color.linearGradientColorStops[1]\n    ];\n  }\n  else {\n    throw new TypeError('Unknown type for color property');\n  }\n\n  this._shape = new Konva.Shape(shapeOptions);\n  this._view = options.view;\n  this._segment = options.segment;\n\n  this._shape.sceneFunc(this._sceneFunc.bind(this));\n}\n\nWaveformShape.prototype.getX = function() {\n  return this._shape.getX();\n};\n\nWaveformShape.prototype.setX = function(x) {\n  return this._shape.setX(x);\n};\n\nWaveformShape.prototype.setSegment = function(segment) {\n  this._segment = segment;\n};\n\nWaveformShape.prototype.setWaveformColor = function(color) {\n  if (isString(color)) {\n    this._shape.fill(color);\n\n    this._shape.fillLinearGradientStartPointY(null);\n    this._shape.fillLinearGradientEndPointY(null);\n    this._shape.fillLinearGradientColorStops(null);\n  }\n  else if (isLinearGradientColor(color)) {\n    this._shape.fill(null);\n\n    const startY = this._view._height * (color.linearGradientStart / 100);\n    const endY = this._view._height * (color.linearGradientEnd / 100);\n\n    this._shape.fillLinearGradientStartPointY(startY);\n    this._shape.fillLinearGradientEndPointY(endY);\n    this._shape.fillLinearGradientColorStops([\n      0, color.linearGradientColorStops[0],\n      1, color.linearGradientColorStops[1]\n    ]);\n  }\n  else {\n    throw new TypeError('Unknown type for color property');\n  }\n};\n\nWaveformShape.prototype.fitToView = function() {\n  this.setWaveformColor(this._color);\n};\n\nWaveformShape.prototype._sceneFunc = function(context) {\n  const frameOffset = this._view.getFrameOffset();\n  const width = this._view.getWidth();\n  const height = this._view.getHeight();\n\n  this._drawWaveform(\n    context,\n    this._view.getWaveformData(),\n    frameOffset,\n    this._segment ? this._view.timeToPixels(this._segment.startTime) : frameOffset,\n    this._segment ? this._view.timeToPixels(this._segment.endTime)   : frameOffset + width,\n    width,\n    height\n  );\n};\n\n/**\n * Draws a waveform on a canvas context.\n *\n * @param {Konva.Context} context The canvas context to draw on.\n * @param {WaveformData} waveformData The waveform data to draw.\n * @param {Number} frameOffset The start position of the waveform shown\n *   in the view, in pixels.\n * @param {Number} startPixels The start position of the waveform to draw,\n *   in pixels.\n * @param {Number} endPixels The end position of the waveform to draw,\n *   in pixels.\n * @param {Number} width The width of the waveform area, in pixels.\n * @param {Number} height The height of the waveform area, in pixels.\n */\n\nWaveformShape.prototype._drawWaveform = function(context, waveformData,\n    frameOffset, startPixels, endPixels, width, height) {\n  if (startPixels < frameOffset) {\n    startPixels = frameOffset;\n  }\n\n  const limit = frameOffset + width;\n\n  if (endPixels > limit) {\n    endPixels = limit;\n  }\n\n  if (endPixels > waveformData.length - 1) {\n    endPixels = waveformData.length - 1;\n  }\n\n  const channels = waveformData.channels;\n\n  let waveformTop = 0;\n  let waveformHeight = Math.floor(height / channels);\n\n  for (let i = 0; i < channels; i++) {\n    if (i === channels - 1) {\n      waveformHeight = height - (channels - 1) * waveformHeight;\n    }\n\n    this._drawChannel(\n      context,\n      waveformData.channel(i),\n      frameOffset,\n      startPixels,\n      endPixels,\n      waveformTop,\n      waveformHeight\n    );\n\n    waveformTop += waveformHeight;\n  }\n};\n\n/**\n * Draws a single waveform channel on a canvas context.\n *\n * @param {Konva.Context} context The canvas context to draw on.\n * @param {WaveformDataChannel} channel The waveform data to draw.\n * @param {Number} frameOffset The start position of the waveform shown\n *   in the view, in pixels.\n * @param {Number} startPixels The start position of the waveform to draw,\n *   in pixels.\n * @param {Number} endPixels The end position of the waveform to draw,\n *   in pixels.\n * @param {Number} top The top of the waveform channel area, in pixels.\n * @param {Number} height The height of the waveform channel area, in pixels.\n */\n\nWaveformShape.prototype._drawChannel = function(context, channel,\n    frameOffset, startPixels, endPixels, top, height) {\n  let x, amplitude;\n\n  const amplitudeScale = this._view.getAmplitudeScale();\n\n  let lineX, lineY;\n\n  context.beginPath();\n\n  for (x = startPixels; x <= endPixels; x++) {\n    amplitude = channel.min_sample(x);\n\n    lineX = x - frameOffset + 0.5;\n    lineY = top + WaveformShape.scaleY(amplitude, height, amplitudeScale) + 0.5;\n\n    context.lineTo(lineX, lineY);\n  }\n\n  for (x = endPixels; x >= startPixels; x--) {\n    amplitude = channel.max_sample(x);\n\n    lineX = x - frameOffset + 0.5;\n    lineY = top + WaveformShape.scaleY(amplitude, height, amplitudeScale) + 1.0;\n\n    context.lineTo(lineX, lineY);\n  }\n\n  context.closePath();\n\n  context.fillShape(this._shape);\n};\n\nWaveformShape.prototype.addToLayer = function(layer) {\n  layer.add(this._shape);\n};\n\nWaveformShape.prototype.destroy = function() {\n  this._shape.destroy();\n  this._shape = null;\n};\n\nWaveformShape.prototype.on = function(event, handler) {\n  this._shape.on(event, handler);\n};\n\nWaveformShape.prototype.off = function(event, handler) {\n  this._shape.off(event, handler);\n};\n\n/**\n * Scales the waveform data for drawing on a canvas context.\n *\n * @see {@link https://stats.stackexchange.com/questions/281162}\n *\n * @todo Assumes 8-bit waveform data (-128 to 127 range)\n *\n * @param {Number} amplitude The waveform data point amplitude.\n * @param {Number} height The height of the waveform, in pixels.\n * @param {Number} scale Amplitude scaling factor.\n * @returns {Number} The scaled waveform data point.\n */\n\nWaveformShape.scaleY = function(amplitude, height, scale) {\n  const y = -(height - 1) * (amplitude * scale + 128) / 255 + (height - 1);\n\n  return clamp(Math.floor(y), 0, height - 1);\n};\n\nexport default WaveformShape;\n","/**\n * @file\n *\n * Defines the {@link SegmentShape} class.\n *\n * @module segment-shape\n */\n\nimport Konva from 'konva/lib/Core';\n\nimport OverlaySegmentMarker from './overlay-segment-marker';\nimport SegmentMarker from './segment-marker';\nimport WaveformShape from './waveform-shape';\nimport { clamp } from './utils';\n\nconst defaultFontFamily = 'sans-serif';\nconst defaultFontSize = 10;\nconst defaultFontShape = 'normal';\n\n/**\n * Options that control segments' visual appearance\n *\n * @typedef {Object} SegmentDisplayOptions\n * @global\n * @property {Boolean} markers\n * @property {Boolean} overlay\n * @property {String} startMarkerColor\n * @property {String} endMarkerColor\n * @property {String} waveformColor\n * @property {String} overlayColor\n * @property {Number} overlayOpacity\n * @property {String} overlayBorderColor\n * @property {Number} overlayBorderWidth\n * @property {Number} overlayCornerRadius\n * @property {Number} overlayOffset\n * @property {String} overlayLabelAlign\n * @property {String} overlayLabelVerticalAlign\n * @property {Number} overlayLabelPadding\n * @property {String} overlayLabelColor\n * @property {String} overlayFontFamily\n * @property {Number} overlayFontSize\n * @property {String} overlayFontStyle\n */\n\n/**\n * Creates a waveform segment shape with optional start and end markers.\n *\n * @class\n * @alias SegmentShape\n *\n * @param {Segment} segment\n * @param {Peaks} peaks\n * @param {SegmentsLayer} layer\n * @param {WaveformOverview|WaveformZoomView} view\n */\n\nfunction SegmentShape(segment, peaks, layer, view) {\n  this._segment     = segment;\n  this._peaks       = peaks;\n  this._layer       = layer;\n  this._view        = view;\n  this._label       = null;\n  this._startMarker = null;\n  this._endMarker   = null;\n  this._color       = segment.color;\n  this._borderColor = segment.borderColor;\n  this._draggable   = this._segment.editable && this._view.isSegmentDraggingEnabled();\n  this._dragging    = false;\n\n  const segmentOptions = view.getViewOptions().segmentOptions;\n\n  this._overlayOffset = segmentOptions.overlayOffset;\n\n  if (!segmentOptions.overlay) {\n    this._waveformShape = new WaveformShape({\n      color:   segment.color,\n      view:    view,\n      segment: segment\n    });\n  }\n\n  this._onMouseEnter  = this._onMouseEnter.bind(this);\n  this._onMouseLeave  = this._onMouseLeave.bind(this);\n  this._onMouseDown   = this._onMouseDown.bind(this);\n  this._onMouseUp     = this._onMouseUp.bind(this);\n\n  this._dragBoundFunc      = this._dragBoundFunc.bind(this);\n  this._onSegmentDragStart = this._onSegmentDragStart.bind(this);\n  this._onSegmentDragMove  = this._onSegmentDragMove.bind(this);\n  this._onSegmentDragEnd   = this._onSegmentDragEnd.bind(this);\n\n  // Event handlers for markers\n  this._onSegmentMarkerDragStart   = this._onSegmentMarkerDragStart.bind(this);\n  this._onSegmentMarkerDragMove    = this._onSegmentMarkerDragMove.bind(this);\n  this._onSegmentMarkerDragEnd     = this._onSegmentMarkerDragEnd.bind(this);\n  this._segmentMarkerDragBoundFunc = this._segmentMarkerDragBoundFunc.bind(this);\n\n  this._label = this._peaks.options.createSegmentLabel({\n    segment:    segment,\n    view:       this._view.getName(),\n    layer:      this._layer,\n    fontFamily: this._peaks.options.fontFamily,\n    fontSize:   this._peaks.options.fontSize,\n    fontStyle:  this._peaks.options.fontStyle\n  });\n\n  if (this._label) {\n    this._label.hide();\n  }\n\n  // Create with default y and height, the real values are set in fitToView().\n  const segmentStartOffset = this._view.timeToPixelOffset(this._segment.startTime);\n  const segmentEndOffset   = this._view.timeToPixelOffset(this._segment.endTime);\n\n  const overlayRectHeight = clamp(0, this._view.getHeight());\n\n  // The clip rectangle prevents text in the overlay from appearing\n  // outside the overlay.\n\n  this._overlay = new Konva.Group({\n    name:          'segment-overlay',\n    segment:       this._segment,\n    x:             segmentStartOffset,\n    y:             0,\n    width:         segmentEndOffset - segmentStartOffset,\n    height:        this._view.getHeight(),\n    clipX:         0,\n    clipY:         this._overlayOffset,\n    clipWidth:     segmentEndOffset - segmentStartOffset,\n    clipHeight:    overlayRectHeight,\n    draggable:     this._draggable,\n    dragBoundFunc: this._dragBoundFunc\n  });\n\n  let overlayBorderColor, overlayBorderWidth, overlayColor, overlayOpacity, overlayCornerRadius;\n\n  if (segmentOptions.overlay) {\n    overlayBorderColor  = this._borderColor || segmentOptions.overlayBorderColor;\n    overlayBorderWidth  = segmentOptions.overlayBorderWidth;\n    overlayColor        = this._color || segmentOptions.overlayColor;\n    overlayOpacity      = segmentOptions.overlayOpacity;\n    overlayCornerRadius = segmentOptions.overlayCornerRadius;\n  }\n\n  this._overlayRect = new Konva.Rect({\n    x:            0,\n    y:            this._overlayOffset,\n    width:        segmentEndOffset - segmentStartOffset,\n    stroke:       overlayBorderColor,\n    strokeWidth:  overlayBorderWidth,\n    height:       overlayRectHeight,\n    fill:         overlayColor,\n    opacity:      overlayOpacity,\n    cornerRadius: overlayCornerRadius\n  });\n\n  this._overlay.add(this._overlayRect);\n\n  if (segmentOptions.overlay) {\n    this._overlayText = new Konva.Text({\n      x:             0,\n      y:             this._overlayOffset,\n      text:          this._segment.labelText,\n      fontFamily:    segmentOptions.overlayFontFamily,\n      fontSize:      segmentOptions.overlayFontSize,\n      fontStyle:     segmentOptions.overlayFontStyle,\n      fill:          segmentOptions.overlayLabelColor,\n      listening:     false,\n      align:         segmentOptions.overlayLabelAlign,\n      width:         segmentEndOffset - segmentStartOffset,\n      verticalAlign: segmentOptions.overlayLabelVerticalAlign,\n      height:        overlayRectHeight,\n      padding:       segmentOptions.overlayLabelPadding\n    });\n\n    this._overlay.add(this._overlayText);\n  }\n\n  // Set up event handlers to show/hide the segment label text when the user\n  // hovers the mouse over the segment.\n  this._overlay.on('mouseenter', this._onMouseEnter);\n  this._overlay.on('mouseleave', this._onMouseLeave);\n\n  this._overlay.on('mousedown', this._onMouseDown);\n  this._overlay.on('mouseup', this._onMouseUp);\n\n  if (this._draggable) {\n    this._overlay.on('dragstart', this._onSegmentDragStart);\n    this._overlay.on('dragmove', this._onSegmentDragMove);\n    this._overlay.on('dragend', this._onSegmentDragEnd);\n  }\n\n  this._createMarkers();\n}\n\nfunction createOverlayMarker(options) {\n  return new OverlaySegmentMarker(options);\n}\n\nSegmentShape.prototype._createMarkers = function() {\n  const editable = this._layer.isEditingEnabled() && this._segment.editable;\n  const segmentOptions = this._view.getViewOptions().segmentOptions;\n\n  const createSegmentMarker = segmentOptions.markers ?\n    this._peaks.options.createSegmentMarker :\n    createOverlayMarker;\n\n  const startMarker = createSegmentMarker({\n    segment:        this._segment,\n    editable:       editable,\n    startMarker:    true,\n    color:          segmentOptions.startMarkerColor,\n    fontFamily:     this._peaks.options.fontFamily || defaultFontFamily,\n    fontSize:       this._peaks.options.fontSize || defaultFontSize,\n    fontStyle:      this._peaks.options.fontStyle || defaultFontShape,\n    layer:          this._layer,\n    view:           this._view.getName(),\n    segmentOptions: this._view.getViewOptions().segmentOptions\n  });\n\n  if (startMarker) {\n    this._startMarker = new SegmentMarker({\n      segment:       this._segment,\n      segmentShape:  this,\n      editable:      editable,\n      startMarker:   true,\n      marker:        startMarker,\n      onDragStart:   this._onSegmentMarkerDragStart,\n      onDragMove:    this._onSegmentMarkerDragMove,\n      onDragEnd:     this._onSegmentMarkerDragEnd,\n      dragBoundFunc: this._segmentMarkerDragBoundFunc\n    });\n  }\n\n  const endMarker = createSegmentMarker({\n    segment:        this._segment,\n    editable:       editable,\n    startMarker:    false,\n    color:          segmentOptions.endMarkerColor,\n    fontFamily:     this._peaks.options.fontFamily || defaultFontFamily,\n    fontSize:       this._peaks.options.fontSize || defaultFontSize,\n    fontStyle:      this._peaks.options.fontStyle || defaultFontShape,\n    layer:          this._layer,\n    view:           this._view.getName(),\n    segmentOptions: this._view.getViewOptions().segmentOptions\n  });\n\n  if (endMarker) {\n    this._endMarker = new SegmentMarker({\n      segment:       this._segment,\n      segmentShape:  this,\n      editable:      editable,\n      startMarker:   false,\n      marker:        endMarker,\n      onDragStart:   this._onSegmentMarkerDragStart,\n      onDragMove:    this._onSegmentMarkerDragMove,\n      onDragEnd:     this._onSegmentMarkerDragEnd,\n      dragBoundFunc: this._segmentMarkerDragBoundFunc\n    });\n  }\n};\n\nSegmentShape.prototype._dragBoundFunc = function(pos) {\n  // Allow the segment to be moved horizontally but not vertically.\n  return {\n    x: pos.x,\n    y: 0\n  };\n};\n\n/**\n * Update the segment shape after the segment's attributes have changed.\n */\n\nSegmentShape.prototype.update = function(options) {\n  const segmentStartOffset = this._view.timeToPixelOffset(this._segment.startTime);\n  const segmentEndOffset   = this._view.timeToPixelOffset(this._segment.endTime);\n  const width = segmentEndOffset - segmentStartOffset;\n  let marker;\n\n  if ((marker = this.getStartMarker())) {\n    marker.setX(segmentStartOffset - marker.getWidth());\n\n    if (options) {\n      marker.update(options);\n    }\n  }\n\n  if ((marker = this.getEndMarker())) {\n    marker.setX(segmentEndOffset);\n\n    if (options) {\n      marker.update(options);\n    }\n  }\n\n  this._color = this._segment.color;\n  this._borderColor = this._segment.bordercolor;\n\n  if (this._overlayText) {\n    const labelColor = this._segment.labelColor;\n\n    this._overlayText.fill(labelColor);\n    this._overlayText.text(this._segment.labelText);\n  }\n\n  const segmentOptions = this._view.getViewOptions().segmentOptions;\n\n  if (segmentOptions.overlay) {\n    if (this._color) {\n      this._overlayRect.fill(this._color);\n    }\n\n    if (this._borderColor) {\n      this._overlayRect.stroke(this._borderColor);\n    }\n  }\n  else {\n    this._waveformShape.setWaveformColor(this._segment.color);\n  }\n\n  // While dragging, the overlay position is controlled in _onSegmentDragMove().\n\n  if (!this._dragging) {\n    if (this._overlay) {\n      this._overlay.setAttrs({\n        x:         segmentStartOffset,\n        width:     width,\n        clipWidth: width < 1 ? 1 : width\n      });\n\n      this._overlayRect.setAttrs({\n        x:     0,\n        width: width\n      });\n\n      if (this._overlayText) {\n        this._overlayText.setAttrs({\n          width: width\n        });\n      }\n    }\n  }\n};\n\nSegmentShape.prototype.getSegment = function() {\n  return this._segment;\n};\n\nSegmentShape.prototype.getStartMarker = function() {\n  return this._startMarker;\n};\n\nSegmentShape.prototype.getEndMarker = function() {\n  return this._endMarker;\n};\n\nSegmentShape.prototype.addToLayer = function(layer) {\n  if (this._waveformShape) {\n    this._waveformShape.addToLayer(layer);\n  }\n\n  if (this._label) {\n    layer.add(this._label);\n  }\n\n  if (this._overlay) {\n    layer.add(this._overlay);\n  }\n\n  if (this._startMarker) {\n    this._startMarker.addToLayer(layer);\n  }\n\n  if (this._endMarker) {\n    this._endMarker.addToLayer(layer);\n  }\n};\n\nSegmentShape.prototype.isDragging = function() {\n  return this._dragging;\n};\n\nSegmentShape.prototype._onMouseEnter = function(event) {\n  if (this._label) {\n    // this._label.moveToTop();\n    // this._label.show();\n  }\n\n  this._peaks.emit('segments.mouseenter', {\n    segment: this._segment,\n    evt: event.evt\n  });\n};\n\nSegmentShape.prototype._onMouseLeave = function(event) {\n  if (this._label) {\n    this._label.hide();\n  }\n\n  this._peaks.emit('segments.mouseleave', {\n    segment: this._segment,\n    evt: event.evt\n  });\n};\n\nSegmentShape.prototype._onMouseDown = function(event) {\n  this._peaks.emit('segments.mousedown', {\n    segment: this._segment,\n    evt: event.evt\n  });\n};\n\nSegmentShape.prototype._onMouseUp = function(event) {\n  this._peaks.emit('segments.mouseup', {\n    segment: this._segment,\n    evt: event.evt\n  });\n};\n\nSegmentShape.prototype.segmentClicked = function(eventName, event) {\n  this._moveToTop();\n\n  this._peaks.emit('segments.' + eventName, event);\n};\n\nSegmentShape.prototype._moveToTop = function() {\n  this._overlay.moveToTop();\n\n  this._layer.moveSegmentMarkersToTop();\n};\n\nSegmentShape.prototype.enableSegmentDragging = function(enable) {\n  if (!this._segment.editable) {\n    return;\n  }\n\n  if (!this._draggable && enable) {\n    this._overlay.on('dragstart', this._onSegmentDragStart);\n    this._overlay.on('dragmove', this._onSegmentDragMove);\n    this._overlay.on('dragend', this._onSegmentDragEnd);\n  }\n  else if (this._draggable && !enable) {\n    this._overlay.off('dragstart', this._onSegmentDragStart);\n    this._overlay.off('dragmove', this._onSegmentDragMove);\n    this._overlay.off('dragend', this._onSegmentDragEnd);\n  }\n\n  this._overlay.draggable(enable);\n  this._draggable = enable;\n};\n\nSegmentShape.prototype._setPreviousAndNextSegments = function() {\n  if (this._view.getSegmentDragMode() !== 'overlap') {\n    this._nextSegment = this._peaks.segments.findNextSegment(this._segment);\n    this._previousSegment = this._peaks.segments.findPreviousSegment(this._segment);\n  }\n  else {\n    this._nextSegment = null;\n    this._previousSegment = null;\n  }\n};\n\nSegmentShape.prototype._onSegmentDragStart = function(event) {\n  this._setPreviousAndNextSegments();\n\n  this._dragging = true;\n  this._dragStartX = this._overlay.getX();\n  this._dragStartTime = this._segment.startTime;\n  this._dragEndTime = this._segment.endTime;\n\n  this._peaks.emit('segments.dragstart', {\n    segment: this._segment,\n    marker: false,\n    startMarker: false,\n    evt: event.evt\n  });\n};\n\nSegmentShape.prototype._onSegmentDragMove = function(event) {\n  const x = this._overlay.getX();\n  const offsetX = x - this._dragStartX;\n  const timeOffset = this._view.pixelsToTime(offsetX);\n\n  // The WaveformShape for a segment fills the canvas width\n  // but only draws a subset of the horizontal range. When dragged\n  // we need to keep the shape object in its position but\n  // update the segment start and end time so that the right\n  // subset is drawn.\n\n  // Calculate new segment start/end time based on drag position. We'll\n  // correct this later based on the drag mode, to prevent overlapping\n  // segments or to compress the adjacent segment.\n\n  let startTime = this._dragStartTime + timeOffset;\n  let endTime = this._dragEndTime + timeOffset;\n  const segmentDuration = this._segment.endTime - this._segment.startTime;\n  let dragMode;\n  const minSegmentWidth = this._view.getMinSegmentDragWidth();\n  const minSegmentDuration = this._view.pixelsToTime(minSegmentWidth);\n  let previousSegmentUpdated = false;\n  let nextSegmentUpdated = false;\n\n  // Prevent the segment from being dragged beyond the start of the waveform.\n\n  if (startTime < 0) {\n    startTime = 0;\n    endTime = segmentDuration;\n    this._overlay.setX(this._view.timeToPixelOffset(startTime));\n  }\n\n  // Adjust segment position if it now overlaps the previous segment?\n\n  if (this._previousSegment) {\n    let previousSegmentEndX = this._view.timeToPixelOffset(this._previousSegment.endTime);\n\n    if (startTime < this._previousSegment.endTime) {\n      dragMode = this._view.getSegmentDragMode();\n\n      if (dragMode === 'no-overlap' ||\n          (dragMode === 'compress' && !this._previousSegment.editable)) {\n        startTime = this._previousSegment.endTime;\n        endTime = startTime + segmentDuration;\n        this._overlay.setX(previousSegmentEndX);\n      }\n      else if (dragMode === 'compress') {\n        let previousSegmentEndTime = startTime;\n\n        const minPreviousSegmentEndTime = this._previousSegment.startTime + minSegmentDuration;\n\n        if (previousSegmentEndTime < minPreviousSegmentEndTime) {\n          previousSegmentEndTime = minPreviousSegmentEndTime;\n\n          previousSegmentEndX = this._view.timeToPixelOffset(previousSegmentEndTime);\n\n          this._overlay.setX(previousSegmentEndX);\n\n          startTime = previousSegmentEndTime;\n          endTime = startTime + segmentDuration;\n        }\n\n        this._previousSegment.update({ endTime: previousSegmentEndTime });\n\n        previousSegmentUpdated = true;\n      }\n    }\n  }\n\n  // Adjust segment position if it now overlaps the following segment?\n\n  if (this._nextSegment) {\n    let nextSegmentStartX = this._view.timeToPixelOffset(this._nextSegment.startTime);\n\n    if (endTime > this._nextSegment.startTime) {\n      dragMode = this._view.getSegmentDragMode();\n\n      if (dragMode === 'no-overlap' ||\n          (dragMode === 'compress' && !this._nextSegment.editable)) {\n        endTime = this._nextSegment.startTime;\n        startTime = endTime - segmentDuration;\n        this._overlay.setX(nextSegmentStartX - this._overlay.getWidth());\n      }\n      else if (dragMode === 'compress') {\n        let nextSegmentStartTime = endTime;\n\n        const maxNextSegmentStartTime = this._nextSegment.endTime - minSegmentDuration;\n\n        if (nextSegmentStartTime > maxNextSegmentStartTime) {\n          nextSegmentStartTime = maxNextSegmentStartTime;\n\n          nextSegmentStartX = this._view.timeToPixelOffset(nextSegmentStartTime);\n\n          this._overlay.setX(nextSegmentStartX - this._overlay.getWidth());\n\n          endTime = nextSegmentStartTime;\n          startTime = endTime - segmentDuration;\n        }\n\n        this._nextSegment.update({ startTime: nextSegmentStartTime });\n\n        nextSegmentUpdated = true;\n      }\n    }\n  }\n\n  this._segment._setStartTime(startTime);\n  this._segment._setEndTime(endTime);\n\n  this._peaks.emit('segments.dragged', {\n    segment: this._segment,\n    marker: false,\n    startMarker: false,\n    evt: event.evt\n  });\n\n  if (previousSegmentUpdated) {\n    this._peaks.emit('segments.dragged', {\n      segment: this._previousSegment,\n      marker: false,\n      startMarker: false,\n      evt: event.evt\n    });\n  }\n  else if (nextSegmentUpdated) {\n    this._peaks.emit('segments.dragged', {\n      segment: this._nextSegment,\n      marker: false,\n      startMarker: false,\n      evt: event.evt\n    });\n  }\n};\n\nSegmentShape.prototype._onSegmentDragEnd = function(event) {\n  this._dragging = false;\n\n  this._peaks.emit('segments.dragend', {\n    segment: this._segment,\n    marker: false,\n    startMarker: false,\n    evt: event.evt\n  });\n};\n\nSegmentShape.prototype.moveMarkersToTop = function() {\n  if (this._startMarker) {\n    this._startMarker.moveToTop();\n  }\n\n  if (this._endMarker) {\n    this._endMarker.moveToTop();\n  }\n};\n\nSegmentShape.prototype.startDrag = function() {\n  if (this._endMarker) {\n    this._endMarker.startDrag();\n  }\n};\n\nSegmentShape.prototype.stopDrag = function() {\n  if (this._endMarker) {\n    this._endMarker.stopDrag();\n  }\n};\n\n/**\n * @param {SegmentMarker} segmentMarker\n */\n\nSegmentShape.prototype._onSegmentMarkerDragStart = function(segmentMarker, event) {\n  this._setPreviousAndNextSegments();\n\n  // Move this segment to the top of the z-order, so that it remains on top\n  // of any adjacent segments that the marker is dragged over.\n  this._moveToTop();\n\n  this._startMarkerX = this._startMarker.getX();\n  this._endMarkerX = this._endMarker.getX();\n\n  this._peaks.emit('segments.dragstart', {\n    segment: this._segment,\n    marker: true,\n    startMarker: segmentMarker.isStartMarker(),\n    evt: event.evt\n  });\n};\n\n/**\n * @param {SegmentMarker} segmentMarker\n */\n\nSegmentShape.prototype._onSegmentMarkerDragMove = function(segmentMarker, event) {\n  if (segmentMarker.isStartMarker()) {\n    this._segmentStartMarkerDragMove(segmentMarker, event);\n    segmentMarker.update({ startTime: this._segment.startTime });\n  }\n  else {\n    this._segmentEndMarkerDragMove(segmentMarker, event);\n    segmentMarker.update({ endTime: this._segment.endTime });\n  }\n};\n\nfunction getDuration(segment) {\n  return segment.endTime - segment.startTime;\n}\n\nSegmentShape.prototype._segmentStartMarkerDragMove = function(segmentMarker, event) {\n  const width = this._view.getWidth();\n\n  let startMarkerX = this._startMarker.getX();\n  const endMarkerX = this._endMarker.getX();\n\n  let minSegmentDuration = this._view.pixelsToTime(50);\n  const minSegmentWidth = this._view.getMinSegmentDragWidth();\n\n  let upperLimit = this._endMarker.getX() - minSegmentWidth;\n\n  if (upperLimit > width) {\n    upperLimit = width;\n  }\n\n  let previousSegmentVisible = false;\n  let previousSegmentUpdated = false;\n  let previousSegmentEndX;\n\n  if (this._previousSegment) {\n    previousSegmentEndX = this._view.timeToPixelOffset(this._previousSegment.endTime);\n    previousSegmentVisible = previousSegmentEndX >= 0;\n  }\n\n  if (startMarkerX > upperLimit) {\n    segmentMarker.setX(upperLimit);\n    this._overlay.clipWidth(upperLimit - endMarkerX);\n\n    if (minSegmentWidth === 0 && upperLimit < width) {\n      this._segment._setStartTime(this._segment.endTime);\n    }\n    else {\n      this._segment._setStartTime(this._view.pixelOffsetToTime(upperLimit));\n    }\n  }\n  else if (this._previousSegment && previousSegmentVisible) {\n    const dragMode = this._view.getSegmentDragMode();\n\n    const fixedPreviousSegment = dragMode === 'no-overlap' ||\n      (dragMode === 'compress' && !this._previousSegment.editable);\n\n    const compressPreviousSegment = dragMode === 'compress' && this._previousSegment.editable;\n\n    if (startMarkerX <= previousSegmentEndX) {\n      if (fixedPreviousSegment) {\n        segmentMarker.setX(previousSegmentEndX);\n        this._overlay.clipWidth(previousSegmentEndX - endMarkerX);\n\n        this._segment._setStartTime(this._previousSegment.endTime);\n      }\n      else if (compressPreviousSegment) {\n        const previousSegmentDuration = getDuration(this._previousSegment);\n\n        if (previousSegmentDuration < minSegmentDuration) {\n          minSegmentDuration = previousSegmentDuration;\n        }\n\n        const lowerLimit = this._view.timeToPixelOffset(\n          this._previousSegment.startTime + minSegmentDuration\n        );\n\n        if (startMarkerX < lowerLimit) {\n          startMarkerX = lowerLimit;\n        }\n\n        segmentMarker.setX(startMarkerX);\n        this._overlay.clipWidth(endMarkerX - startMarkerX);\n\n        this._segment._setStartTime(this._view.pixelOffsetToTime(startMarkerX));\n\n        this._previousSegment.update({\n          endTime: this._view.pixelOffsetToTime(startMarkerX)\n        });\n\n        previousSegmentUpdated = true;\n      }\n    }\n    else {\n      if (startMarkerX < 0) {\n        startMarkerX = 0;\n      }\n\n      segmentMarker.setX(startMarkerX);\n      this._overlay.clipWidth(endMarkerX - startMarkerX);\n\n      this._segment._setStartTime(this._view.pixelOffsetToTime(startMarkerX));\n    }\n  }\n  else {\n    if (startMarkerX < 0) {\n      startMarkerX = 0;\n    }\n\n    segmentMarker.setX(startMarkerX);\n    this._overlay.clipWidth(endMarkerX - startMarkerX);\n\n    this._segment._setStartTime(this._view.pixelOffsetToTime(startMarkerX));\n  }\n\n  this._peaks.emit('segments.dragged', {\n    segment: this._segment,\n    marker: true,\n    startMarker: true,\n    evt: event.evt\n  });\n\n  if (previousSegmentUpdated) {\n    this._peaks.emit('segments.dragged', {\n      segment: this._previousSegment,\n      marker: true,\n      startMarker: false,\n      evt: event.evt\n    });\n  }\n};\n\nSegmentShape.prototype._segmentEndMarkerDragMove = function(segmentMarker, event) {\n  const width = this._view.getWidth();\n\n  const startMarkerX = this._startMarker.getX();\n  let endMarkerX = this._endMarker.getX();\n\n  let minSegmentDuration = this._view.pixelsToTime(50);\n  const minSegmentWidth = this._view.getMinSegmentDragWidth();\n\n  let lowerLimit = this._startMarker.getX() + minSegmentWidth;\n\n  if (lowerLimit < 0) {\n    lowerLimit = 0;\n  }\n\n  let nextSegmentVisible = false;\n  let nextSegmentUpdated = false;\n  let nextSegmentStartX;\n\n  if (this._nextSegment) {\n    nextSegmentStartX = this._view.timeToPixelOffset(this._nextSegment.startTime);\n    nextSegmentVisible = nextSegmentStartX < width;\n  }\n\n  if (endMarkerX < lowerLimit) {\n    segmentMarker.setX(lowerLimit);\n    this._overlay.clipWidth(lowerLimit - startMarkerX);\n\n    if (minSegmentWidth === 0 && lowerLimit > 0) {\n      this._segment._setEndTime(this._segment.startTime);\n    }\n    else {\n      this._segment._setEndTime(this._view.pixelOffsetToTime(lowerLimit));\n    }\n  }\n  else if (this._nextSegment && nextSegmentVisible) {\n    const dragMode = this._view.getSegmentDragMode();\n\n    const fixedNextSegment = dragMode === 'no-overlap' ||\n      (dragMode === 'compress' && !this._nextSegment.editable);\n\n    const compressNextSegment = dragMode === 'compress' && this._nextSegment.editable;\n\n    if (endMarkerX >= nextSegmentStartX) {\n      if (fixedNextSegment) {\n        segmentMarker.setX(nextSegmentStartX);\n        this._overlay.clipWidth(nextSegmentStartX - startMarkerX);\n\n        this._segment._setEndTime(this._nextSegment.startTime);\n      }\n      else if (compressNextSegment) {\n        const nextSegmentDuration = getDuration(this._nextSegment);\n\n        if (nextSegmentDuration < minSegmentDuration) {\n          minSegmentDuration = nextSegmentDuration;\n        }\n\n        const upperLimit = this._view.timeToPixelOffset(\n          this._nextSegment.endTime - minSegmentDuration\n        );\n\n        if (endMarkerX > upperLimit) {\n          endMarkerX = upperLimit;\n        }\n\n        segmentMarker.setX(endMarkerX);\n        this._overlay.clipWidth(endMarkerX - startMarkerX);\n\n        this._segment._setEndTime(this._view.pixelOffsetToTime(endMarkerX));\n\n        this._nextSegment.update({\n          startTime: this._view.pixelOffsetToTime(endMarkerX)\n        });\n\n        nextSegmentUpdated = true;\n      }\n    }\n    else {\n      if (endMarkerX > width) {\n        endMarkerX = width;\n      }\n\n      segmentMarker.setX(endMarkerX);\n      this._overlay.clipWidth(endMarkerX - startMarkerX);\n\n      this._segment._setEndTime(this._view.pixelOffsetToTime(endMarkerX));\n    }\n  }\n  else {\n    if (endMarkerX > width) {\n      endMarkerX = width;\n    }\n\n    segmentMarker.setX(endMarkerX);\n    this._overlay.clipWidth(endMarkerX - startMarkerX);\n\n    this._segment._setEndTime(this._view.pixelOffsetToTime(endMarkerX));\n  }\n\n  this._peaks.emit('segments.dragged', {\n    segment: this._segment,\n    marker: true,\n    startMarker: false,\n    evt: event.evt\n  });\n\n  if (nextSegmentUpdated) {\n    this._peaks.emit('segments.dragged', {\n      segment: this._nextSegment,\n      marker: true,\n      startMarker: true,\n      evt: event.evt\n    });\n  }\n};\n\n/**\n * @param {SegmentMarker} segmentMarker\n */\n\nSegmentShape.prototype._onSegmentMarkerDragEnd = function(segmentMarker, event) {\n  this._nextSegment = null;\n  this._previousSegment = null;\n\n  const startMarker = segmentMarker.isStartMarker();\n\n  this._peaks.emit('segments.dragend', {\n    segment: this._segment,\n    marker: true,\n    startMarker: startMarker,\n    evt: event.evt\n  });\n};\n\n// eslint-disable-next-line no-unused-vars\nSegmentShape.prototype._segmentMarkerDragBoundFunc = function(segmentMarker, pos) {\n  // Allow the marker to be moved horizontally but not vertically.\n  return {\n    x: pos.x,\n    y: segmentMarker.getAbsolutePosition().y\n  };\n};\n\nSegmentShape.prototype.fitToView = function() {\n  if (this._startMarker) {\n    this._startMarker.fitToView();\n  }\n\n  if (this._endMarker) {\n    this._endMarker.fitToView();\n  }\n\n  if (this._overlay) {\n    const height = this._view.getHeight();\n\n    const overlayRectHeight = clamp(0, height - (this._overlayOffset * 2));\n\n    this._overlay.setAttrs({\n      y:          0,\n      height:     height,\n      clipY:      this._overlayOffset,\n      clipHeight: overlayRectHeight\n    });\n\n    this._overlayRect.setAttrs({\n      y:      this._overlayOffset,\n      height: overlayRectHeight\n    });\n\n    if (this._overlayText) {\n      this._overlayText.setAttrs({\n        y:      this._overlayOffset,\n        height: overlayRectHeight\n      });\n    }\n  }\n};\n\nSegmentShape.prototype.destroy = function() {\n  if (this._waveformShape) {\n    this._waveformShape.destroy();\n  }\n\n  if (this._label) {\n    this._label.destroy();\n  }\n\n  if (this._startMarker) {\n    this._startMarker.destroy();\n  }\n\n  if (this._endMarker) {\n    this._endMarker.destroy();\n  }\n\n  if (this._overlay) {\n    this._overlay.destroy();\n  }\n};\n\nexport default SegmentShape;\n","/**\n * @file\n *\n * Defines the {@link SegmentsLayer} class.\n *\n * @module segments-layer\n */\n\nimport SegmentShape from './segment-shape';\nimport { objectHasProperty } from './utils';\nimport Konva from 'konva/lib/Core';\n\n/**\n * Creates a Konva.Layer that displays segment markers against the audio\n * waveform.\n *\n * @class\n * @alias SegmentsLayer\n *\n * @param {Peaks} peaks\n * @param {WaveformOverview|WaveformZoomView} view\n * @param {Boolean} allowEditing\n */\n\nfunction SegmentsLayer(peaks, view, allowEditing) {\n  this._peaks         = peaks;\n  this._view          = view;\n  this._allowEditing  = allowEditing;\n  this._segmentShapes = {};\n  this._layer         = new Konva.Layer();\n\n  this._onSegmentsUpdate    = this._onSegmentsUpdate.bind(this);\n  this._onSegmentsAdd       = this._onSegmentsAdd.bind(this);\n  this._onSegmentsRemove    = this._onSegmentsRemove.bind(this);\n  this._onSegmentsRemoveAll = this._onSegmentsRemoveAll.bind(this);\n  this._onSegmentsDragged   = this._onSegmentsDragged.bind(this);\n\n  this._peaks.on('segments.update', this._onSegmentsUpdate);\n  this._peaks.on('segments.add', this._onSegmentsAdd);\n  this._peaks.on('segments.remove', this._onSegmentsRemove);\n  this._peaks.on('segments.remove_all', this._onSegmentsRemoveAll);\n  this._peaks.on('segments.dragged', this._onSegmentsDragged);\n}\n\n/**\n * Adds the layer to the given {Konva.Stage}.\n *\n * @param {Konva.Stage} stage\n */\n\nSegmentsLayer.prototype.addToStage = function(stage) {\n  stage.add(this._layer);\n};\n\nSegmentsLayer.prototype.enableEditing = function(enable) {\n  this._allowEditing = enable;\n};\n\nSegmentsLayer.prototype.isEditingEnabled = function() {\n  return this._allowEditing;\n};\n\nSegmentsLayer.prototype.enableSegmentDragging = function(enable) {\n  for (const segmentPid in this._segmentShapes) {\n    if (objectHasProperty(this._segmentShapes, segmentPid)) {\n      this._segmentShapes[segmentPid].enableSegmentDragging(enable);\n    }\n  }\n};\n\nSegmentsLayer.prototype.getSegmentShape = function(segment) {\n  return this._segmentShapes[segment.pid];\n};\n\nSegmentsLayer.prototype.formatTime = function(time) {\n  return this._view.formatTime(time);\n};\n\nSegmentsLayer.prototype._onSegmentsUpdate = function(segment, options) {\n  const frameStartTime = this._view.getStartTime();\n  const frameEndTime = this._view.getEndTime();\n\n  let segmentShape = this.getSegmentShape(segment);\n  const isVisible = segment.isVisible(frameStartTime, frameEndTime);\n\n  if (segmentShape && !isVisible) {\n    // Remove segment shape that is no longer visible.\n\n    if (!segmentShape.isDragging()) {\n      this._removeSegment(segment);\n    }\n  }\n  else if (!segmentShape && isVisible) {\n    // Add segment shape for visible segment.\n    segmentShape = this._updateSegment(segment);\n  }\n  else if (segmentShape && isVisible) {\n    // Update the segment shape with the changed attributes.\n    segmentShape.update(options);\n  }\n};\n\nSegmentsLayer.prototype._onSegmentsAdd = function(event) {\n  const self = this;\n\n  const frameStartTime = self._view.getStartTime();\n  const frameEndTime   = self._view.getEndTime();\n\n  event.segments.forEach(function(segment) {\n    if (segment.isVisible(frameStartTime, frameEndTime)) {\n      const segmentShape = self._addSegmentShape(segment);\n\n      segmentShape.update();\n    }\n  });\n\n  // Ensure segment markers are always draggable.\n  this.moveSegmentMarkersToTop();\n};\n\nSegmentsLayer.prototype._onSegmentsRemove = function(event) {\n  const self = this;\n\n  event.segments.forEach(function(segment) {\n    self._removeSegment(segment);\n  });\n};\n\nSegmentsLayer.prototype._onSegmentsRemoveAll = function() {\n  this._layer.removeChildren();\n  this._segmentShapes = {};\n};\n\nSegmentsLayer.prototype._onSegmentsDragged = function(event) {\n  this._updateSegment(event.segment);\n};\n\n/**\n * Creates the Konva UI objects for a given segment.\n *\n * @private\n * @param {Segment} segment\n * @returns {SegmentShape}\n */\n\nSegmentsLayer.prototype._createSegmentShape = function(segment) {\n  return new SegmentShape(segment, this._peaks, this, this._view);\n};\n\n/**\n * Adds a Konva UI object to the layer for a given segment.\n *\n * @private\n * @param {Segment} segment\n * @returns {SegmentShape}\n */\n\nSegmentsLayer.prototype._addSegmentShape = function(segment) {\n  const segmentShape = this._createSegmentShape(segment);\n\n  segmentShape.addToLayer(this._layer);\n\n  this._segmentShapes[segment.pid] = segmentShape;\n\n  return segmentShape;\n};\n\n/**\n * Updates the positions of all displayed segments in the view.\n *\n * @param {Number} startTime The start of the visible range in the view,\n *   in seconds.\n * @param {Number} endTime The end of the visible range in the view,\n *   in seconds.\n */\n\nSegmentsLayer.prototype.updateSegments = function(startTime, endTime) {\n  // Update segments in visible time range.\n  const segments = this._peaks.segments.find(startTime, endTime);\n\n  segments.forEach(this._updateSegment.bind(this));\n\n  // TODO: In the overview all segments are visible, so no need to do this.\n  this._removeInvisibleSegments(startTime, endTime);\n};\n\n/**\n * @private\n * @param {Segment} segment\n */\n\nSegmentsLayer.prototype._updateSegment = function(segment) {\n  let segmentShape = this.getSegmentShape(segment);\n\n  if (!segmentShape) {\n    segmentShape = this._addSegmentShape(segment);\n  }\n\n  segmentShape.update();\n};\n\n/**\n * Removes any segments that are not visible, i.e., are not within and do not\n * overlap the given time range.\n *\n * @private\n * @param {Number} startTime The start of the visible time range, in seconds.\n * @param {Number} endTime The end of the visible time range, in seconds.\n */\n\nSegmentsLayer.prototype._removeInvisibleSegments = function(startTime, endTime) {\n  for (const segmentPid in this._segmentShapes) {\n    if (objectHasProperty(this._segmentShapes, segmentPid)) {\n      const segment = this._segmentShapes[segmentPid].getSegment();\n\n      if (!segment.isVisible(startTime, endTime)) {\n        this._removeSegment(segment);\n      }\n    }\n  }\n};\n\n/**\n * Removes the given segment from the view.\n *\n * @param {Segment} segment\n */\n\nSegmentsLayer.prototype._removeSegment = function(segment) {\n  const segmentShape = this._segmentShapes[segment.pid];\n\n  if (segmentShape) {\n    segmentShape.destroy();\n    delete this._segmentShapes[segment.pid];\n  }\n};\n\n/**\n * Moves all segment markers to the top of the z-order,\n * so the user can always drag them.\n */\n\nSegmentsLayer.prototype.moveSegmentMarkersToTop = function() {\n  for (const segmentPid in this._segmentShapes) {\n    if (objectHasProperty(this._segmentShapes, segmentPid)) {\n      this._segmentShapes[segmentPid].moveMarkersToTop();\n    }\n  }\n};\n\n/**\n * Toggles visibility of the segments layer.\n *\n * @param {Boolean} visible\n */\n\nSegmentsLayer.prototype.setVisible = function(visible) {\n  this._layer.setVisible(visible);\n};\n\nSegmentsLayer.prototype.segmentClicked = function(eventName, event) {\n  const segmentShape = this._segmentShapes[event.segment.pid];\n\n  if (segmentShape) {\n    segmentShape.segmentClicked(eventName, event);\n  }\n};\n\nSegmentsLayer.prototype.destroy = function() {\n  this._peaks.off('segments.update', this._onSegmentsUpdate);\n  this._peaks.off('segments.add', this._onSegmentsAdd);\n  this._peaks.off('segments.remove', this._onSegmentsRemove);\n  this._peaks.off('segments.remove_all', this._onSegmentsRemoveAll);\n  this._peaks.off('segments.dragged', this._onSegmentsDragged);\n};\n\nSegmentsLayer.prototype.fitToView = function() {\n  for (const segmentPid in this._segmentShapes) {\n    if (objectHasProperty(this._segmentShapes, segmentPid)) {\n      const segmentShape = this._segmentShapes[segmentPid];\n\n      segmentShape.fitToView();\n    }\n  }\n};\n\nSegmentsLayer.prototype.draw = function() {\n  this._layer.draw();\n};\n\nSegmentsLayer.prototype.getHeight = function() {\n  return this._layer.getHeight();\n};\n\nexport default SegmentsLayer;\n","/**\n * @file\n *\n * Defines the {@link WaveformAxis} class.\n *\n * @module waveform-axis\n */\n\nimport { formatTime, objectHasProperty, roundUpToNearest } from './utils';\nimport Konva from 'konva/lib/Core';\n\n/**\n * Creates the waveform axis shapes and adds them to the given view layer.\n *\n * @class\n * @alias WaveformAxis\n *\n * @param {WaveformOverview|WaveformZoomView} view\n * @param {Object} options\n * @param {String} options.axisGridlineColor\n * @param {String} options.axisLabelColor\n * @param {Boolean} options.showAxisLabels\n * @param {Function} options.formatAxisTime\n * @param {String} options.fontFamily\n * @param {Number} options.fontSize\n * @param {String} options.fontStyle\n */\n\nfunction WaveformAxis(view, options) {\n  const self = this;\n\n  self._axisGridlineColor      = options.axisGridlineColor;\n  self._axisLabelColor         = options.axisLabelColor;\n  self._showAxisLabels         = options.showAxisLabels;\n  self._axisTopMarkerHeight    = options.axisTopMarkerHeight;\n  self._axisBottomMarkerHeight = options.axisBottomMarkerHeight;\n\n  if (options.formatAxisTime) {\n    self._formatAxisTime = options.formatAxisTime;\n  }\n  else {\n    self._formatAxisTime = function(time) {\n      // precision = 0, drops the fractional seconds\n      return formatTime(time, 0);\n    };\n  }\n\n  self._axisLabelFont = WaveformAxis._buildFontString(\n    options.fontFamily,\n    options.fontSize,\n    options.fontStyle\n  );\n\n  self._axisShape = new Konva.Shape({\n    sceneFunc: function(context) {\n      self._drawAxis(context, view);\n    }\n  });\n}\n\nWaveformAxis._buildFontString = function(fontFamily, fontSize, fontStyle) {\n  if (!fontSize) {\n    fontSize = 11;\n  }\n\n  if (!fontFamily) {\n    fontFamily = 'sans-serif';\n  }\n\n  if (!fontStyle) {\n    fontStyle = 'normal';\n  }\n\n  return fontStyle + ' ' + fontSize + 'px ' + fontFamily;\n};\n\nWaveformAxis.prototype.addToLayer = function(layer) {\n  layer.add(this._axisShape);\n};\n\nWaveformAxis.prototype.showAxisLabels = function(show, options) {\n  this._showAxisLabels = show;\n\n  if (options) {\n    if (objectHasProperty(options, 'topMarkerHeight')) {\n      this._axisTopMarkerHeight = options.topMarkerHeight;\n    }\n\n    if (objectHasProperty(options, 'bottomMarkerHeight')) {\n      this._axisBottomMarkerHeight = options.bottomMarkerHeight;\n    }\n  }\n};\n\n/**\n * Returns number of seconds for each x-axis marker, appropriate for the\n * current zoom level, ensuring that markers are not too close together\n * and that markers are placed at intuitive time intervals (i.e., every 1,\n * 2, 5, 10, 20, 30 seconds, then every 1, 2, 5, 10, 20, 30 minutes, then\n * every 1, 2, 5, 10, 20, 30 hours).\n *\n * @param {WaveformOverview|WaveformZoomView} view\n * @returns {Number}\n */\n\nWaveformAxis.prototype._getAxisLabelScale = function(view) {\n  let baseSecs = 1; // seconds\n  const steps = [1, 2, 5, 10, 20, 30];\n  const minSpacing = 60;\n  let index = 0;\n\n  let secs;\n\n  for (;;) {\n    secs = baseSecs * steps[index];\n    const pixels = view.timeToPixels(secs);\n\n    if (pixels < minSpacing) {\n      if (++index === steps.length) {\n        baseSecs *= 60; // seconds -> minutes -> hours\n        index = 0;\n      }\n    }\n    else {\n      break;\n    }\n  }\n\n  return secs;\n};\n\n/**\n * Draws the time axis and labels onto a view.\n *\n * @param {Konva.Context} context The context to draw on.\n * @param {WaveformOverview|WaveformZoomView} view\n */\n\nWaveformAxis.prototype._drawAxis = function(context, view) {\n  const currentFrameStartTime = view.getStartTime();\n\n  // Time interval between axis markers (seconds)\n  const axisLabelIntervalSecs = this._getAxisLabelScale(view);\n\n  // Time of first axis marker (seconds)\n  const firstAxisLabelSecs = roundUpToNearest(currentFrameStartTime, axisLabelIntervalSecs);\n\n  // Distance between waveform start time and first axis marker (seconds)\n  const axisLabelOffsetSecs = firstAxisLabelSecs - currentFrameStartTime;\n\n  // Distance between waveform start time and first axis marker (pixels)\n  const axisLabelOffsetPixels = view.timeToPixels(axisLabelOffsetSecs);\n\n  context.setAttr('strokeStyle', this._axisGridlineColor);\n  context.setAttr('lineWidth', 1);\n\n  // Set text style\n  context.setAttr('font', this._axisLabelFont);\n  context.setAttr('fillStyle', this._axisLabelColor);\n  context.setAttr('textAlign', 'left');\n  context.setAttr('textBaseline', 'bottom');\n\n  const width  = view.getWidth();\n  // const height = view.getHeight();\n\n  let secs = firstAxisLabelSecs;\n\n  for (;;) {\n    // Position of axis marker (pixels)\n    const x = axisLabelOffsetPixels + view.timeToPixels(secs - firstAxisLabelSecs);\n\n    if (x >= width) {\n      break;\n    }\n\n    context.beginPath();\n    context.moveTo(x + 0.5, 0);\n    context.lineTo(x + 0.5, 0);\n    // context.moveTo(x + 0.5, height);\n    // context.lineTo(x + 0.5, height - markerHeight);\n    context.stroke();\n\n    if (this._showAxisLabels) {\n      const label      = this._formatAxisTime(secs);\n      const labelWidth = context.measureText(label).width;\n      const labelX     = x - labelWidth / 2;\n      const labelY     = 15;\n\n      if (labelX >= 0) {\n        context.fillText(label, labelX, labelY);\n      }\n    }\n\n    secs += axisLabelIntervalSecs;\n  }\n};\n\nexport default WaveformAxis;\n","/**\n * @file\n *\n * Defines the {@link MouseDragHandler} class.\n *\n * @module mouse-drag-handler\n */\n\nimport { getMarkerObject } from './utils';\n\n/**\n * An object to receive callbacks on mouse drag events. Each function is\n * called with the current mouse X position, relative to the stage's\n * container HTML element.\n *\n * @typedef {Object} MouseDragHandlers\n * @global\n * @property {Function} onMouseDown Mouse down event handler.\n * @property {Function} onMouseMove Mouse move event handler.\n * @property {Function} onMouseUp Mouse up event handler.\n */\n\n/**\n * Creates a handler for mouse events to allow interaction with the waveform\n * views by clicking and dragging the mouse.\n *\n * @class\n * @alias MouseDragHandler\n *\n * @param {Konva.Stage} stage\n * @param {MouseDragHandlers} handlers\n */\n\nfunction MouseDragHandler(stage, handlers) {\n  this._stage     = stage;\n  this._handlers  = handlers;\n  this._dragging  = false;\n  this._mouseDown = this._mouseDown.bind(this);\n  this._mouseUp   = this._mouseUp.bind(this);\n  this._mouseMove = this._mouseMove.bind(this);\n\n  this._stage.on('mousedown', this._mouseDown);\n  this._stage.on('touchstart', this._mouseDown);\n\n  this._lastMouseClientX = null;\n}\n\n/**\n * Mouse down event handler.\n *\n * @param {MouseEvent} event\n */\n\nMouseDragHandler.prototype._mouseDown = function(event) {\n  let segment = null;\n\n  if (event.type === 'mousedown' && event.evt.button !== 0) {\n    // Mouse drag only applies to the primary mouse button.\n    // The secondary button may be used to show a context menu\n    // and we don't want to also treat this as a mouse drag operation.\n    return;\n  }\n\n  const marker = getMarkerObject(event.target);\n\n  if (marker && marker.attrs.draggable) {\n    // Avoid interfering with drag/drop of point and segment markers.\n    if (marker.attrs.name === 'point-marker' ||\n        marker.attrs.name === 'segment-marker') {\n      return;\n    }\n\n    // Check if we're dragging a segment.\n    if (marker.attrs.name === 'segment-overlay') {\n      segment = marker;\n    }\n  }\n\n  this._lastMouseClientX = Math.floor(\n    event.type === 'touchstart' ? event.evt.touches[0].clientX : event.evt.clientX\n  );\n\n  if (this._handlers.onMouseDown) {\n    const mouseDownPosX = this._getMousePosX(this._lastMouseClientX);\n\n    this._handlers.onMouseDown(mouseDownPosX, segment);\n  }\n\n  // Use the window mousemove and mouseup handlers instead of the\n  // Konva.Stage ones so that we still receive events if the user moves the\n  // mouse outside the stage.\n  window.addEventListener('mousemove', this._mouseMove, { capture: false, passive: true });\n  window.addEventListener('touchmove', this._mouseMove, { capture: false, passive: true });\n  window.addEventListener('mouseup', this._mouseUp, { capture: false, passive: true });\n  window.addEventListener('touchend', this._mouseUp, { capture: false, passive: true });\n  window.addEventListener('blur', this._mouseUp, { capture: false, passive: true });\n};\n\n/**\n * Mouse move event handler.\n *\n * @param {MouseEvent} event\n */\n\nMouseDragHandler.prototype._mouseMove = function(event) {\n  const clientX = Math.floor(\n    event.type === 'touchmove' ? event.changedTouches[0].clientX : event.clientX\n  );\n\n  // Don't update on vertical mouse movement.\n  if (clientX === this._lastMouseClientX) {\n    return;\n  }\n\n  this._lastMouseClientX = clientX;\n\n  this._dragging = true;\n\n  if (this._handlers.onMouseMove) {\n    const mousePosX = this._getMousePosX(clientX);\n\n    this._handlers.onMouseMove(mousePosX);\n  }\n};\n\n/**\n * Mouse up event handler.\n *\n * @param {MouseEvent} event\n */\n\nMouseDragHandler.prototype._mouseUp = function(event) {\n  let clientX;\n\n  if (event.type === 'touchend') {\n    clientX = Math.floor(event.changedTouches[0].clientX);\n\n    if (event.cancelable) {\n      event.preventDefault();\n    }\n  }\n  else {\n    clientX = Math.floor(event.clientX);\n  }\n\n  if (this._handlers.onMouseUp) {\n    const mousePosX = this._getMousePosX(clientX);\n\n    this._handlers.onMouseUp(mousePosX);\n  }\n\n  window.removeEventListener('mousemove', this._mouseMove, { capture: false });\n  window.removeEventListener('touchmove', this._mouseMove, { capture: false });\n  window.removeEventListener('mouseup', this._mouseUp, { capture: false });\n  window.removeEventListener('touchend', this._mouseUp, { capture: false });\n  window.removeEventListener('blur', this._mouseUp, { capture: false });\n\n  this._dragging = false;\n};\n\n/**\n * @returns {Number} The mouse X position, relative to the container that\n * received the mouse down event.\n *\n * @private\n * @param {Number} clientX Mouse client X position.\n */\n\nMouseDragHandler.prototype._getMousePosX = function(clientX) {\n  const containerPos = this._stage.getContainer().getBoundingClientRect();\n\n  return clientX - containerPos.left;\n};\n\n/**\n * Returns <code>true</code> if the mouse is being dragged, i.e., moved with\n * the mouse button held down.\n *\n * @returns {Boolean}\n */\n\nMouseDragHandler.prototype.isDragging = function() {\n  return this._dragging;\n};\n\nMouseDragHandler.prototype.destroy = function() {\n  this._stage.off('mousedown', this._mouseDown);\n  this._stage.off('touchstart', this._mouseDown);\n};\n\nexport default MouseDragHandler;\n","/**\n * @file\n *\n * Defines the {@link SeekMouseDragHandler} class.\n *\n * @module seek-mouse-drag-handler\n */\n\nimport MouseDragHandler from './mouse-drag-handler';\nimport { clamp } from './utils';\n\n/**\n * Creates a handler for mouse events to allow seeking the waveform\n * views by clicking and dragging the mouse.\n *\n * @class\n * @alias SeekMouseDragHandler\n *\n * @param {Peaks} peaks\n * @param {WaveformOverview} view\n */\n\nfunction SeekMouseDragHandler(peaks, view) {\n  this._peaks = peaks;\n  this._view = view;\n\n  this._onMouseDown = this._onMouseDown.bind(this);\n  this._onMouseMove = this._onMouseMove.bind(this);\n\n  this._mouseDragHandler = new MouseDragHandler(view._stage, {\n    onMouseDown: this._onMouseDown,\n    onMouseMove: this._onMouseMove\n  });\n}\n\nSeekMouseDragHandler.prototype._onMouseDown = function(mousePosX) {\n  this._seek(mousePosX);\n};\n\nSeekMouseDragHandler.prototype._onMouseMove = function(mousePosX) {\n  this._seek(mousePosX);\n};\n\nSeekMouseDragHandler.prototype._seek = function(mousePosX) {\n  if (!this._view.isSeekEnabled()) {\n    return;\n  }\n\n  mousePosX = clamp(mousePosX, 0, this._width);\n\n  let time = this._view.pixelsToTime(mousePosX);\n  const duration = this._peaks.player.getDuration();\n\n  // Prevent the playhead position from jumping by limiting click\n  // handling to the waveform duration.\n  if (time > duration) {\n    time = duration;\n  }\n\n  // Update the playhead position. This gives a smoother visual update\n  // than if we only use the player.timeupdate event.\n  this._view.updatePlayheadTime(time);\n\n  this._peaks.player.seek(time);\n};\n\nSeekMouseDragHandler.prototype.destroy = function() {\n  this._mouseDragHandler.destroy();\n};\n\nexport default SeekMouseDragHandler;\n","/**\n * @file\n *\n * Defines the {@link WaveformOverview} class.\n *\n * @module waveform-overview\n */\n\nimport HighlightLayer from './highlight-layer';\nimport PlayheadLayer from './playhead-layer';\nimport PointsLayer from './points-layer';\nimport SegmentsLayer from './segments-layer';\nimport WaveformAxis from './waveform-axis';\nimport WaveformShape from './waveform-shape';\nimport SeekMouseDragHandler from './seek-mouse-drag-handler';\nimport { formatTime, getMarkerObject, isFinite, isNumber } from './utils';\n\nimport Konva from 'konva/lib/Core';\n\n/**\n * Creates the overview waveform view.\n *\n * @class\n * @alias WaveformOverview\n *\n * @param {WaveformData} waveformData\n * @param {HTMLElement} container\n * @param {Peaks} peaks\n */\n\nfunction WaveformOverview(waveformData, container, peaks) {\n  const self = this;\n\n  self._originalWaveformData = waveformData;\n  self._container = container;\n  self._peaks = peaks;\n  self._options = peaks.options;\n  self._viewOptions = peaks.options.overview;\n\n  // Bind event handlers\n  self._onTimeUpdate = self._onTimeUpdate.bind(this);\n  self._onPlaying = self._onPlaying.bind(this);\n  self._onPause = self._onPause.bind(this);\n  self._onZoomviewDisplaying = self._onZoomviewDisplaying.bind(this);\n\n  // Register event handlers\n  peaks.on('player.timeupdate', self._onTimeUpdate);\n  peaks.on('player.playing', self._onPlaying);\n  peaks.on('player.pause', self._onPause);\n  peaks.on('zoomview.displaying', self._onZoomviewDisplaying);\n\n  self._amplitudeScale = 1.0;\n  self._timeLabelPrecision = self._viewOptions.timeLabelPrecision;\n  self._enableSeek = true;\n\n  if (self._viewOptions.formatPlayheadTime) {\n    self._formatPlayheadTime = self._viewOptions.formatPlayheadTime;\n  }\n  else {\n    self._formatPlayheadTime = function(time) {\n      return formatTime(time, self._timeLabelPrecision);\n    };\n  }\n\n  self._width = container.clientWidth;\n  self._height = container.clientHeight;\n\n  self._data = waveformData;\n\n  if (self._width !== 0) {\n    self._resampleAndSetWaveformData(waveformData, self._width);\n  }\n\n  // Disable warning: The stage has 6 layers.\n  // Recommended maximum number of layers is 3-5.\n  Konva.showWarnings = false;\n\n  self._stage = new Konva.Stage({\n    container: container,\n    width: self._width,\n    height: self._height\n  });\n\n  self._waveformColor = self._viewOptions.waveformColor;\n  self._playedWaveformColor = self._viewOptions.playedWaveformColor;\n\n  self._createWaveform();\n\n  if (self._viewOptions.enableSegments) {\n    self._segmentsLayer = new SegmentsLayer(peaks, self, false);\n    self._segmentsLayer.addToStage(self._stage);\n  }\n\n  if (self._viewOptions.enablePoints) {\n    self._pointsLayer = new PointsLayer(peaks, self, false);\n    self._pointsLayer.addToStage(self._stage);\n  }\n\n  self._highlightLayer = new HighlightLayer(\n    self,\n    self._viewOptions\n  );\n  self._highlightLayer.addToStage(self._stage);\n\n  self._createAxisLabels();\n\n  self._playheadLayer = new PlayheadLayer({\n    player: self._peaks.player,\n    view: self,\n    showPlayheadTime: self._viewOptions.showPlayheadTime,\n    playheadColor: self._viewOptions.playheadColor,\n    playheadTextColor: self._viewOptions.playheadTextColor,\n    playheadFontFamily: self._viewOptions.fontFamily,\n    playheadFontSize: self._viewOptions.fontSize,\n    playheadFontStyle: self._viewOptions.fontStyle\n  });\n\n  self._playheadLayer.addToStage(self._stage);\n\n  const time = self._peaks.player.getCurrentTime();\n\n  self._playheadLayer.updatePlayheadTime(time);\n\n  self._mouseDragHandler = new SeekMouseDragHandler(peaks, self);\n\n  self._onClick = self._onClick.bind(self);\n  self._onDblClick = self._onDblClick.bind(self);\n  self._onContextMenu = self._onContextMenu.bind(self);\n\n  self._stage.on('click', self._onClick);\n  self._stage.on('dblclick', self._onDblClick);\n  self._stage.on('contextmenu', self._onContextMenu);\n}\n\nWaveformOverview.prototype.enableSeek = function(enable) {\n  this._enableSeek = enable;\n};\n\nWaveformOverview.prototype.isSeekEnabled = function() {\n  return this._enableSeek;\n};\n\nWaveformOverview.prototype._onClick = function(event) {\n  this._clickHandler(event, 'click');\n};\n\nWaveformOverview.prototype._onDblClick = function(event) {\n  this._clickHandler(event, 'dblclick');\n};\n\nWaveformOverview.prototype._onContextMenu = function(event) {\n  this._clickHandler(event, 'contextmenu');\n};\n\nWaveformOverview.prototype._clickHandler = function(event, eventName) {\n  let emitViewEvent = true;\n\n  if (event.target !== this._stage) {\n    const marker = getMarkerObject(event.target);\n\n    if (marker) {\n      if (marker.attrs.name === 'point-marker') {\n        const point = marker.getAttr('point');\n\n        if (point) {\n          this._peaks.emit('points.' + eventName, {\n            point: point,\n            evt: event.evt,\n            preventViewEvent: function() {\n              emitViewEvent = false;\n            }\n          });\n        }\n      }\n      else if (marker.attrs.name === 'segment-overlay') {\n        const segment = marker.getAttr('segment');\n\n        if (segment) {\n          const clickEvent = {\n            segment: segment,\n            evt: event.evt,\n            preventViewEvent: function() {\n              emitViewEvent = false;\n            }\n          };\n\n          if (this._segmentsLayer) {\n            this._segmentsLayer.segmentClicked(eventName, clickEvent);\n          }\n        }\n      }\n    }\n  }\n\n  if (emitViewEvent) {\n    const pixelIndex = event.evt.layerX;\n    const time = this.pixelsToTime(pixelIndex);\n\n    this._peaks.emit('overview.' + eventName, {\n      time: time,\n      evt: event.evt\n    });\n  }\n};\n\nWaveformOverview.prototype.isSegmentDraggingEnabled = function() {\n  return false;\n};\n\nWaveformOverview.prototype.getName = function() {\n  return 'overview';\n};\n\nWaveformOverview.prototype._onTimeUpdate = function(time) {\n  this._playheadLayer.updatePlayheadTime(time);\n};\n\nWaveformOverview.prototype._onPlaying = function(time) {\n  this._playheadLayer.updatePlayheadTime(time);\n};\n\nWaveformOverview.prototype._onPause = function(time) {\n  this._playheadLayer.stop(time);\n};\n\nWaveformOverview.prototype._onZoomviewDisplaying = function(startTime, endTime) {\n  this.showHighlight(startTime, endTime);\n};\n\nWaveformOverview.prototype.updatePlayheadTime = function(time) {\n  this._playheadLayer.updatePlayheadTime(time);\n};\n\nWaveformOverview.prototype.showHighlight = function(startTime, endTime) {\n  this._highlightLayer.showHighlight(startTime, endTime);\n};\n\nWaveformOverview.prototype.setWaveformData = function(waveformData) {\n  this._originalWaveformData = waveformData;\n\n  if (this._width !== 0) {\n    this._resampleAndSetWaveformData(waveformData, this._width);\n  }\n  else {\n    this._data = waveformData;\n  }\n\n  this._updateWaveform();\n};\n\nWaveformOverview.prototype._resampleAndSetWaveformData = function(waveformData, width) {\n  try {\n    this._data = waveformData.resample({ width: width });\n    return true;\n  }\n  catch (error) {\n    // This error usually indicates that the waveform length\n    // is less than the container width. Ignore, and use the\n    // given waveform data\n    this._data = waveformData;\n    return false;\n  }\n};\n\nWaveformOverview.prototype.playheadPosChanged = function(time) {\n  if (this._playedWaveformShape) {\n    this._playedSegment.endTime = time;\n    this._unplayedSegment.startTime = time;\n\n    this._waveformLayer.draw();\n  }\n};\n\n/**\n * Returns the pixel index for a given time, for the current zoom level.\n *\n * @param {Number} time Time, in seconds.\n * @returns {Number} Pixel index.\n */\n\nWaveformOverview.prototype.timeToPixels = function(time) {\n  return Math.floor(time * this._data.sample_rate / this._data.scale);\n};\n\nWaveformOverview.prototype.timeToPixelOffset = WaveformOverview.prototype.timeToPixels;\n\n/**\n * Returns the time for a given pixel index, for the current zoom level.\n *\n * @param {Number} pixels Pixel index.\n * @returns {Number} Time, in seconds.\n */\n\nWaveformOverview.prototype.pixelsToTime = function(pixels) {\n  return pixels * this._data.scale / this._data.sample_rate;\n};\n\n/**\n * Returns the time for a given pixel index, for the current zoom level.\n * (This is presented for symmetry with WaveformZoomview. Since WaveformOverview\n * doesn't scroll, its pixelOffsetToTime & pixelsToTime methods are identical.)\n *\n * @param {Number} pixels Pixel index.\n * @returns {Number} Time, in seconds.\n */\n\nWaveformOverview.prototype.pixelOffsetToTime = WaveformOverview.prototype.pixelsToTime;\n\n/**\n * @returns {Number} The start position of the waveform shown in the view,\n *   in pixels.\n */\n\nWaveformOverview.prototype.getFrameOffset = function() {\n  return 0;\n};\n\n/**\n * @returns {Number} The time at the leftmost edge\n */\n\nWaveformOverview.prototype.getStartTime = function() {\n  return 0;\n};\n\n/**\n * @returns {Number} The time at the rightmost edge\n */\n\nWaveformOverview.prototype.getEndTime = function() {\n  return this._getDuration();\n};\n\n/**\n * @returns {Number} The width of the view, in pixels.\n */\n\nWaveformOverview.prototype.getWidth = function() {\n  return this._width;\n};\n\n/**\n * @returns {Number} The height of the view, in pixels.\n */\n\nWaveformOverview.prototype.getHeight = function() {\n  return this._height;\n};\n\n/**\n * @returns {Number} The media duration, in seconds.\n */\n\nWaveformOverview.prototype._getDuration = function() {\n  return this._peaks.player.getDuration();\n};\n\n/**\n * Adjusts the amplitude scale of waveform shown in the view, which allows\n * users to zoom the waveform vertically.\n *\n * @param {Number} scale The new amplitude scale factor\n */\n\nWaveformOverview.prototype.setAmplitudeScale = function(scale) {\n  if (!isNumber(scale) || !isFinite(scale)) {\n    throw new Error('view.setAmplitudeScale(): Scale must be a valid number');\n  }\n\n  this._amplitudeScale = scale;\n\n  this._waveformLayer.draw();\n\n  if (this._segmentsLayer) {\n    this._segmentsLayer.draw();\n  }\n};\n\nWaveformOverview.prototype.getAmplitudeScale = function() {\n  return this._amplitudeScale;\n};\n\n/**\n * @returns {WaveformData} The view's waveform data.\n */\n\nWaveformOverview.prototype.getWaveformData = function() {\n  return this._data;\n};\n\nWaveformOverview.prototype._createWaveformShapes = function() {\n  if (!this._waveformShape) {\n    this._waveformShape = new WaveformShape({\n      color: this._waveformColor,\n      view: this\n    });\n\n    this._waveformShape.addToLayer(this._waveformLayer);\n  }\n\n  if (this._playedWaveformColor && !this._playedWaveformShape) {\n    const time = this._peaks.player.getCurrentTime();\n\n    this._playedSegment = {\n      startTime: 0,\n      endTime: time\n    };\n\n    this._unplayedSegment = {\n      startTime: time,\n      endTime: this._getDuration()\n    };\n\n    this._waveformShape.setSegment(this._unplayedSegment);\n\n    this._playedWaveformShape = new WaveformShape({\n      color: this._playedWaveformColor,\n      view: this,\n      segment: this._playedSegment\n    });\n\n    this._playedWaveformShape.addToLayer(this._waveformLayer);\n  }\n};\n\nWaveformOverview.prototype._destroyPlayedWaveformShape = function() {\n  this._waveformShape.setSegment(null);\n\n  this._playedWaveformShape.destroy();\n  this._playedWaveformShape = null;\n\n  this._playedSegment = null;\n  this._unplayedSegment = null;\n};\n\nWaveformOverview.prototype._createWaveform = function() {\n  this._waveformLayer = new Konva.Layer({ listening: false });\n\n  this._createWaveformShapes();\n\n  this._stage.add(this._waveformLayer);\n};\n\nWaveformOverview.prototype._createAxisLabels = function() {\n  this._axisLayer = new Konva.Layer({ listening: false });\n  this._axis = new WaveformAxis(this, this._viewOptions);\n\n  this._axis.addToLayer(this._axisLayer);\n  this._stage.add(this._axisLayer);\n};\n\nWaveformOverview.prototype.removeHighlightRect = function() {\n  this._highlightLayer.removeHighlight();\n};\n\nWaveformOverview.prototype._updateWaveform = function() {\n  this._waveformLayer.draw();\n  this._axisLayer.draw();\n\n  const playheadTime = this._peaks.player.getCurrentTime();\n\n  this._playheadLayer.updatePlayheadTime(playheadTime);\n\n  this._highlightLayer.updateHighlight();\n\n  const frameStartTime = 0;\n  const frameEndTime   = this.pixelsToTime(this._width);\n\n  if (this._pointsLayer) {\n    this._pointsLayer.updatePoints(frameStartTime, frameEndTime);\n  }\n\n  if (this._segmentsLayer) {\n    this._segmentsLayer.updateSegments(frameStartTime, frameEndTime);\n  }\n};\n\nWaveformOverview.prototype.setWaveformColor = function(color) {\n  this._waveformColor = color;\n  this._waveformShape.setWaveformColor(color);\n};\n\nWaveformOverview.prototype.setPlayedWaveformColor = function(color) {\n  this._playedWaveformColor = color;\n\n  if (color) {\n    if (!this._playedWaveformShape) {\n      this._createWaveformShapes();\n    }\n\n    this._playedWaveformShape.setWaveformColor(color);\n  }\n  else {\n    if (this._playedWaveformShape) {\n      this._destroyPlayedWaveformShape();\n    }\n  }\n};\n\nWaveformOverview.prototype.showPlayheadTime = function(show) {\n  this._playheadLayer.showPlayheadTime(show);\n};\n\nWaveformOverview.prototype.setTimeLabelPrecision = function(precision) {\n  this._timeLabelPrecision = precision;\n  this._playheadLayer.updatePlayheadText();\n};\n\nWaveformOverview.prototype.formatTime = function(time) {\n  return this._formatPlayheadTime(time);\n};\n\nWaveformOverview.prototype.showAxisLabels = function(show, options) {\n  this._axis.showAxisLabels(show, options);\n  this._axisLayer.draw();\n};\n\nWaveformOverview.prototype.enableMarkerEditing = function(enable) {\n  if (this._segmentsLayer) {\n    this._segmentsLayer.enableEditing(enable);\n  }\n\n  if (this._pointsLayer) {\n    this._pointsLayer.enableEditing(enable);\n  }\n};\n\nWaveformOverview.prototype.fitToContainer = function() {\n  if (this._container.clientWidth === 0 && this._container.clientHeight === 0) {\n    return;\n  }\n\n  let updateWaveform = false;\n\n  if (this._container.clientWidth !== this._width) {\n    this._width = this._container.clientWidth;\n    this._stage.setWidth(this._width);\n\n    if (this._resampleAndSetWaveformData(this._originalWaveformData, this._width)) {\n      updateWaveform = true;\n    }\n  }\n\n  if (this._container.clientHeight !== this._height) {\n    this._height = this._container.clientHeight;\n    this._stage.setHeight(this._height);\n\n    this._waveformShape.fitToView();\n    this._playheadLayer.fitToView();\n\n    if (this._segmentsLayer) {\n      this._segmentsLayer.fitToView();\n    }\n\n    if (this._pointsLayer) {\n      this._pointsLayer.fitToView();\n    }\n\n    this._highlightLayer.fitToView();\n  }\n\n  if (updateWaveform) {\n    this._updateWaveform();\n  }\n};\n\nWaveformOverview.prototype.getViewOptions = function() {\n  return this._viewOptions;\n};\n\nWaveformOverview.prototype.destroy = function() {\n  this._peaks.off('player.playing', this._onPlaying);\n  this._peaks.off('player.pause', this._onPause);\n  this._peaks.off('player.timeupdate', this._onTimeUpdate);\n  this._peaks.off('zoomview.displaying', this._onZoomviewDisplaying);\n\n  this._mouseDragHandler.destroy();\n\n  this._playheadLayer.destroy();\n\n  if (this._segmentsLayer) {\n    this._segmentsLayer.destroy();\n  }\n\n  if (this._pointsLayer) {\n    this._pointsLayer.destroy();\n  }\n\n  if (this._stage) {\n    this._stage.destroy();\n    this._stage = null;\n  }\n};\n\nexport default WaveformOverview;\n","/**\n * @file\n *\n * Defines the {@link InsertSegmentMouseDragHandler} class.\n *\n * @module insert-segment-mouse-drag-handler\n */\n\nimport MouseDragHandler from './mouse-drag-handler';\n\n/**\n * Creates a handler for mouse events to allow inserting new waveform\n * segments by clicking and dragging the mouse.\n *\n * @class\n * @alias InsertSegmentMouseDragHandler\n *\n * @param {Peaks} peaks\n * @param {WaveformZoomView} view\n */\n\nfunction InsertSegmentMouseDragHandler(peaks, view) {\n  this._peaks = peaks;\n  this._view = view;\n\n  this._onMouseDown = this._onMouseDown.bind(this);\n  this._onMouseMove = this._onMouseMove.bind(this);\n  this._onMouseUp = this._onMouseUp.bind(this);\n\n  this._mouseDragHandler = new MouseDragHandler(view._stage, {\n    onMouseDown: this._onMouseDown,\n    onMouseMove: this._onMouseMove,\n    onMouseUp: this._onMouseUp\n  });\n}\n\nInsertSegmentMouseDragHandler.prototype.isDragging = function() {\n  return this._mouseDragHandler.isDragging();\n};\n\nInsertSegmentMouseDragHandler.prototype._onMouseDown = function(mousePosX, segment) {\n  this._segment = segment;\n\n  if (this._segment) {\n    // The user has clicked within a segment. We want to prevent\n    // the segment from being dragged while the user inserts a new\n    // segment. So we temporarily make the segment non-draggable,\n    // and restore its draggable state in onMouseUp().\n    this._segmentIsDraggable = this._segment.draggable();\n    this._segment.draggable(false);\n  }\n\n  const time = this._view.pixelsToTime(mousePosX + this._view.getFrameOffset());\n\n  this._peaks.segments.setInserting(true);\n\n  this._insertSegment = this._peaks.segments.add({\n    startTime: time,\n    endTime: time,\n    editable: true\n  });\n\n  this._insertSegmentShape = this._view._segmentsLayer.getSegmentShape(this._insertSegment);\n\n  if (this._insertSegmentShape) {\n    this._insertSegmentShape.moveMarkersToTop();\n    this._insertSegmentShape.startDrag();\n  }\n};\n\nInsertSegmentMouseDragHandler.prototype._onMouseMove = function() {\n};\n\nInsertSegmentMouseDragHandler.prototype._onMouseUp = function() {\n  if (this._insertSegmentShape) {\n    this._insertSegmentShape.stopDrag();\n    this._insertSegmentShape = null;\n  }\n\n  // If the user was dragging within an existing segment,\n  // restore the segment's original draggable state.\n  if (this._segment && this._segmentIsDraggable) {\n    this._segment.draggable(true);\n  }\n\n  this._peaks.emit('segments.insert', {\n    segment: this._insertSegment\n  });\n\n  this._peaks.segments.setInserting(false);\n};\n\nInsertSegmentMouseDragHandler.prototype.destroy = function() {\n  this._mouseDragHandler.destroy();\n};\n\nexport default InsertSegmentMouseDragHandler;\n","/**\n * @file\n *\n * Defines the {@link ScrollMouseDragHandler} class.\n *\n * @module scroll-mouse-drag-handler\n */\n\nimport MouseDragHandler from './mouse-drag-handler';\nimport { clamp } from './utils';\n\n/**\n * Creates a handler for mouse events to allow scrolling the zoomable\n * waveform view by clicking and dragging the mouse.\n *\n * @class\n * @alias ScrollMouseDragHandler\n *\n * @param {Peaks} peaks\n * @param {WaveformZoomView} view\n */\n\nfunction ScrollMouseDragHandler(peaks, view) {\n  this._peaks = peaks;\n  this._view = view;\n\n  this._onMouseDown = this._onMouseDown.bind(this);\n  this._onMouseMove = this._onMouseMove.bind(this);\n  this._onMouseUp = this._onMouseUp.bind(this);\n\n  this._mouseDragHandler = new MouseDragHandler(view._stage, {\n    onMouseDown: this._onMouseDown,\n    onMouseMove: this._onMouseMove,\n    onMouseUp: this._onMouseUp\n  });\n}\n\nScrollMouseDragHandler.prototype.isDragging = function() {\n  return this._mouseDragHandler.isDragging();\n};\n\nScrollMouseDragHandler.prototype._onMouseDown = function(mousePosX, segment) {\n  this._segment = segment;\n  this._seeking = false;\n\n  const playheadOffset = this._view.getPlayheadOffset();\n\n  if (this._view.isSeekEnabled() &&\n      Math.abs(mousePosX - playheadOffset) <= this._view.getPlayheadClickTolerance()) {\n    this._seeking = true;\n\n    // The user has clicked near the playhead, and the playhead is within\n    // a segment. In this case we want to allow the playhead to move, but\n    // prevent the segment from being dragged. So we temporarily make the\n    // segment non-draggable, and restore its draggable state in onMouseUp().\n    if (this._segment) {\n      this._segmentIsDraggable = this._segment.draggable();\n      this._segment.draggable(false);\n    }\n  }\n\n  if (this._seeking) {\n    this._seek(mousePosX);\n  }\n  else {\n    this._initialFrameOffset = this._view.getFrameOffset();\n    this._mouseDownX = mousePosX;\n  }\n};\n\nScrollMouseDragHandler.prototype._onMouseMove = function(mousePosX) {\n  // Prevent scrolling the waveform if the user is dragging a segment.\n  if (this._segment && !this._seeking) {\n    return;\n  }\n\n  if (this._seeking) {\n    mousePosX = clamp(mousePosX, 0, this._view.getWidth());\n\n    const time = this._view.pixelsToTime(mousePosX + this._view.getFrameOffset());\n\n    this._seek(time);\n  }\n  else {\n    // Moving the mouse to the left increases the time position of the\n    // left-hand edge of the visible waveform.\n    const diff = this._mouseDownX - mousePosX;\n    const newFrameOffset = this._initialFrameOffset + diff;\n\n    if (newFrameOffset !== this._initialFrameOffset) {\n      this._view.updateWaveform(newFrameOffset);\n    }\n  }\n};\n\nScrollMouseDragHandler.prototype._onMouseUp = function() {\n  if (!this._seeking) {\n    // Set playhead position only on click release, when not dragging.\n    if (this._view._enableSeek && !this._mouseDragHandler.isDragging()) {\n      const time = this._view.pixelOffsetToTime(this._mouseDownX);\n\n      this._seek(time);\n    }\n  }\n\n  // If the user was dragging within an existing segment,\n  // restore the segment's original draggable state.\n  if (this._segment && this._seeking) {\n    if (this._segmentIsDraggable) {\n      this._segment.draggable(true);\n    }\n  }\n};\n\nScrollMouseDragHandler.prototype._seek = function(time) {\n  const duration = this._peaks.player.getDuration();\n\n  // Prevent the playhead position from jumping by limiting click\n  // handling to the waveform duration.\n  if (time > duration) {\n    time = duration;\n  }\n\n  // Update the playhead position. This gives a smoother visual update\n  // than if we only use the player.timeupdate event.\n  this._view.updatePlayheadTime(time);\n\n  this._peaks.player.seek(time);\n};\n\nScrollMouseDragHandler.prototype.destroy = function() {\n  this._mouseDragHandler.destroy();\n};\n\nexport default ScrollMouseDragHandler;\n","/**\n * @file\n *\n * Defines the {@link WaveformZoomView} class.\n *\n * @module waveform-zoomview\n */\n\nimport PlayheadLayer from './playhead-layer';\nimport PointsLayer from './points-layer';\nimport SegmentsLayer from './segments-layer';\nimport WaveformAxis from './waveform-axis';\nimport WaveformShape from './waveform-shape';\nimport InsertSegmentMouseDragHandler from './insert-segment-mouse-drag-handler';\nimport ScrollMouseDragHandler from './scroll-mouse-drag-handler';\nimport { clamp, formatTime, getMarkerObject, isFinite, isNumber, isValidTime,\n  objectHasProperty } from './utils';\n\nimport Konva from 'konva/lib/Core';\n\n/**\n * Creates a zoomable waveform view.\n *\n * @class\n * @alias WaveformZoomView\n *\n * @param {WaveformData} waveformData\n * @param {HTMLElement} container\n * @param {Peaks} peaks\n */\n\nfunction WaveformZoomView(waveformData, container, peaks) {\n  const self = this;\n\n  self._container = container;\n  self._peaks = peaks;\n  self._options = peaks.options;\n  self._viewOptions = self._options.zoomview;\n  self._enableWaveformCache = self._options.waveformCache;\n  self._originalWaveformData = waveformData;\n  self._initWaveformCache();\n\n  // Bind event handlers\n  self._onTimeUpdate = self._onTimeUpdate.bind(self);\n  self._onPlaying = self._onPlaying.bind(self);\n  self._onPause = self._onPause.bind(self);\n  self._onKeyboardLeft = self._onKeyboardLeft.bind(self);\n  self._onKeyboardRight = self._onKeyboardRight.bind(self);\n  self._onKeyboardShiftLeft  = self._onKeyboardShiftLeft.bind(self);\n  self._onKeyboardShiftRight = self._onKeyboardShiftRight.bind(self);\n\n  // Register event handlers\n  self._peaks.on('player.timeupdate', self._onTimeUpdate);\n  self._peaks.on('player.playing', self._onPlaying);\n  self._peaks.on('player.pause', self._onPause);\n  self._peaks.on('keyboard.left', self._onKeyboardLeft);\n  self._peaks.on('keyboard.right', self._onKeyboardRight);\n  self._peaks.on('keyboard.shift_left', self._onKeyboardShiftLeft);\n  self._peaks.on('keyboard.shift_right', self._onKeyboardShiftRight);\n\n  self._autoScroll = self._viewOptions.autoScroll;\n  self._autoScrollOffset = self._viewOptions.autoScrollOffset;\n\n  self._amplitudeScale = 1.0;\n  self._timeLabelPrecision = self._viewOptions.timeLabelPrecision;\n  self._enableSeek = true;\n  self._enableSegmentDragging = false;\n  self._segmentDragMode = 'overlap';\n  self._minSegmentDragWidth = 0;\n  self._insertSegmentShape = null;\n\n  if (self._viewOptions.formatPlayheadTime) {\n    self._formatPlayheadTime = self._viewOptions.formatPlayheadTime;\n  }\n  else {\n    self._formatPlayheadTime = function(time) {\n      return formatTime(time, self._timeLabelPrecision);\n    };\n  }\n\n  self._playheadClickTolerance = self._viewOptions.playheadClickTolerance;\n\n  self._data = null;\n  self._pixelLength = 0;\n\n  const initialZoomLevel = peaks.zoom.getZoomLevel();\n\n  self._zoomLevelAuto = false;\n  self._zoomLevelSeconds = null;\n\n  self._resampleData({ scale: initialZoomLevel });\n\n  self._width = container.clientWidth;\n  self._height = container.clientHeight;\n\n  // The pixel offset of the current frame being displayed\n  self._frameOffset = 0;\n\n  self._stage = new Konva.Stage({\n    container: container,\n    width: self._width,\n    height: self._height\n  });\n\n  self._waveformColor = self._viewOptions.waveformColor;\n  self._playedWaveformColor = self._viewOptions.playedWaveformColor;\n\n  self._createWaveform();\n\n  if (self._viewOptions.enableSegments) {\n    self._segmentsLayer = new SegmentsLayer(peaks, self, true);\n    self._segmentsLayer.addToStage(self._stage);\n  }\n\n  if (self._viewOptions.enablePoints) {\n    self._pointsLayer = new PointsLayer(peaks, self, true);\n    self._pointsLayer.addToStage(self._stage);\n  }\n\n  self._createAxisLabels();\n\n  self._playheadLayer = new PlayheadLayer({\n    player: self._peaks.player,\n    view: self,\n    showPlayheadTime: self._viewOptions.showPlayheadTime,\n    playheadColor: self._viewOptions.playheadColor,\n    playheadTextColor: self._viewOptions.playheadTextColor,\n    playheadFontFamily: self._viewOptions.fontFamily,\n    playheadFontSize: self._viewOptions.fontSize,\n    playheadFontStyle: self._viewOptions.fontStyle\n  });\n\n  self._playheadLayer.addToStage(self._stage);\n\n  const time = self._peaks.player.getCurrentTime();\n\n  self._syncPlayhead(time);\n\n  self._mouseDragHandler = new ScrollMouseDragHandler(self._peaks, self);\n\n  self._onWheel = self._onWheel.bind(self);\n  self._onWheelCaptureVerticalScroll = self._onWheelCaptureVerticalScroll.bind(self);\n  self.setWheelMode(self._viewOptions.wheelMode);\n\n  self._onClick = self._onClick.bind(self);\n  self._onDblClick = self._onDblClick.bind(self);\n  self._onMouseDown = self._onMouseDown.bind(self);\n  self._onContextMenu = self._onContextMenu.bind(self);\n\n  self._stage.on('click', self._onClick);\n  self._stage.on('dblclick', self._onDblClick);\n  self._stage.on('mousedown', self._onMouseDown);\n  self._stage.on('contextmenu', self._onContextMenu);\n}\n\nWaveformZoomView.prototype._initWaveformCache = function() {\n  if (this._enableWaveformCache) {\n    this._waveformData = new Map();\n    this._waveformData.set(this._originalWaveformData.scale, this._originalWaveformData);\n    this._waveformScales = [this._originalWaveformData.scale];\n  }\n};\n\nWaveformZoomView.prototype.enableSeek = function(enable) {\n  this._enableSeek = enable;\n};\n\nWaveformZoomView.prototype.isSeekEnabled = function() {\n  return this._enableSeek;\n};\n\nWaveformZoomView.prototype._onClick = function(event) {\n  this._clickHandler(event, 'click');\n};\n\nWaveformZoomView.prototype._onDblClick = function(event) {\n  this._clickHandler(event, 'dblclick');\n};\n\nWaveformZoomView.prototype._onMouseDown = function(event) {\n  this._clickHandler(event, 'mousedown');\n};\n\nWaveformZoomView.prototype._onContextMenu = function(event) {\n  this._clickHandler(event, 'contextmenu');\n};\n\nWaveformZoomView.prototype._clickHandler = function(event, eventName) {\n  let emitViewEvent = true;\n\n  if (event.target !== this._stage) {\n    const marker = getMarkerObject(event.target);\n\n    if (marker) {\n      if (marker.attrs.name === 'point-marker') {\n        const point = marker.getAttr('point');\n\n        if (point) {\n          this._peaks.emit('points.' + eventName, {\n            point: point,\n            evt: event.evt,\n            preventViewEvent: function() {\n              emitViewEvent = false;\n            }\n          });\n        }\n      }\n      else if (marker.attrs.name === 'segment-overlay') {\n        const segment = marker.getAttr('segment');\n\n        if (segment) {\n          const clickEvent = {\n            segment: segment,\n            evt: event.evt,\n            preventViewEvent: function() {\n              emitViewEvent = false;\n            }\n          };\n\n          if (this._segmentsLayer) {\n            this._segmentsLayer.segmentClicked(eventName, clickEvent);\n          }\n        }\n      }\n    }\n  }\n\n  if (emitViewEvent) {\n    const mousePosX = event.evt.layerX;\n    const time = this.pixelOffsetToTime(mousePosX);\n\n    this._peaks.emit('zoomview.' + eventName, {\n      time: time,\n      evt: event.evt\n    });\n  }\n};\n\nWaveformZoomView.prototype.setWheelMode = function(mode, options) {\n  if (!options) {\n    options = {};\n  }\n\n  if (mode !== this._wheelMode ||\n      options.captureVerticalScroll !== this._captureVerticalScroll) {\n    this._stage.off('wheel');\n\n    this._wheelMode = mode;\n    this._captureVerticalScroll = options.captureVerticalScroll;\n\n    switch (mode) {\n      case 'scroll':\n        if (options.captureVerticalScroll) {\n          this._stage.on('wheel', this._onWheelCaptureVerticalScroll);\n        }\n        else {\n          this._stage.on('wheel', this._onWheel);\n        }\n        break;\n    }\n  }\n};\n\nWaveformZoomView.prototype._onWheel = function(event) {\n  const wheelEvent = event.evt;\n  let delta;\n\n  if (wheelEvent.shiftKey) {\n    if (wheelEvent.deltaY !== 0) {\n      delta = wheelEvent.deltaY;\n    }\n    else if (wheelEvent.deltaX !== 0) {\n      delta = wheelEvent.deltaX;\n    }\n    else {\n      return;\n    }\n  }\n  else {\n    // Ignore the event if it looks like the user is scrolling vertically\n    // down the page\n    if (Math.abs(wheelEvent.deltaX) < Math.abs(wheelEvent.deltaY)) {\n      return;\n    }\n\n    delta = wheelEvent.deltaX;\n  }\n\n  if (wheelEvent.deltaMode === WheelEvent.DOM_DELTA_PAGE) {\n    delta *= this._width;\n  }\n\n  wheelEvent.preventDefault();\n\n  const newFrameOffset = clamp(\n    this._frameOffset + Math.floor(delta), 0, this._pixelLength - this._width\n  );\n\n  this.updateWaveform(newFrameOffset);\n};\n\nWaveformZoomView.prototype._onWheelCaptureVerticalScroll = function(event) {\n  const wheelEvent = event.evt;\n\n  const delta = Math.abs(wheelEvent.deltaX) < Math.abs(wheelEvent.deltaY) ?\n    wheelEvent.deltaY : wheelEvent.deltaX;\n\n  wheelEvent.preventDefault();\n\n  const newFrameOffset = clamp(\n    this._frameOffset + Math.floor(delta), 0, this._pixelLength - this._width\n  );\n\n  this.updateWaveform(newFrameOffset);\n};\n\nWaveformZoomView.prototype.setWaveformDragMode = function(mode) {\n  if (this._viewOptions.enableSegments) {\n    this._mouseDragHandler.destroy();\n\n    if (mode === 'insert-segment') {\n      this._mouseDragHandler = new InsertSegmentMouseDragHandler(this._peaks, this);\n    }\n    else {\n      this._mouseDragHandler = new ScrollMouseDragHandler(this._peaks, this);\n    }\n  }\n};\n\nWaveformZoomView.prototype.enableSegmentDragging = function(enable) {\n  this._enableSegmentDragging = enable;\n\n  // Update all existing segments\n  if (this._segmentsLayer) {\n    this._segmentsLayer.enableSegmentDragging(enable);\n  }\n};\n\nWaveformZoomView.prototype.isSegmentDraggingEnabled = function() {\n  return this._enableSegmentDragging;\n};\n\nWaveformZoomView.prototype.setSegmentDragMode = function(mode) {\n  this._segmentDragMode = mode;\n};\n\nWaveformZoomView.prototype.getSegmentDragMode = function() {\n  return this._segmentDragMode;\n};\n\nWaveformZoomView.prototype.getName = function() {\n  return 'zoomview';\n};\n\nWaveformZoomView.prototype._onTimeUpdate = function(time) {\n  if (this._mouseDragHandler.isDragging()) {\n    return;\n  }\n\n  this._syncPlayhead(time);\n};\n\nWaveformZoomView.prototype._onPlaying = function(time) {\n  this._playheadLayer.updatePlayheadTime(time);\n};\n\nWaveformZoomView.prototype._onPause = function(time) {\n  this._playheadLayer.stop(time);\n};\n\nWaveformZoomView.prototype._onKeyboardLeft = function() {\n  this._keyboardScroll(-1, false);\n};\n\nWaveformZoomView.prototype._onKeyboardRight = function() {\n  this._keyboardScroll(1, false);\n};\n\nWaveformZoomView.prototype._onKeyboardShiftLeft = function() {\n  this._keyboardScroll(-1, true);\n};\n\nWaveformZoomView.prototype._onKeyboardShiftRight = function() {\n  this._keyboardScroll(1, true);\n};\n\nWaveformZoomView.prototype._keyboardScroll = function(direction, large) {\n  let increment;\n\n  if (large) {\n    increment = direction * this._width;\n  }\n  else {\n    increment = direction * this.timeToPixels(this._options.nudgeIncrement);\n  }\n\n  this.scrollWaveform({ pixels: increment });\n};\n\nWaveformZoomView.prototype.setWaveformData = function(waveformData) {\n  this._originalWaveformData = waveformData;\n  // Clear cached waveforms\n  this._initWaveformCache();\n\n  // Don't update the UI here, call setZoom().\n};\n\n/**\n * Returns the position of the playhead marker, in pixels relative to the\n * left hand side of the waveform view.\n *\n * @return {Number}\n */\n\nWaveformZoomView.prototype.getPlayheadOffset = function() {\n  return this._playheadLayer.getPlayheadPixel() - this._frameOffset;\n};\n\nWaveformZoomView.prototype.getPlayheadClickTolerance = function() {\n  return this._playheadClickTolerance;\n};\n\nWaveformZoomView.prototype.playheadPosChanged = function(time) {\n  if (this._playedWaveformShape) {\n    this._playedSegment.endTime = time;\n    this._unplayedSegment.startTime = time;\n\n    this._drawWaveformLayer();\n  }\n};\n\nWaveformZoomView.prototype.updatePlayheadTime = function(time) {\n  this._playheadLayer.updatePlayheadTime(time);\n};\n\nWaveformZoomView.prototype._syncPlayhead = function(time) {\n  this._playheadLayer.updatePlayheadTime(time);\n\n  if (this._autoScroll) {\n    // Check for the playhead reaching the right-hand side of the window.\n\n    const pixelIndex = this.timeToPixels(time);\n\n    // TODO: move this code to animation function?\n    // TODO: don't scroll if user has positioned view manually (e.g., using\n    // the keyboard)\n    let endThreshold = this._frameOffset + this._width;\n    \n    endThreshold = endThreshold - (this._width / 2) - this._autoScrollOffset;\n\n    if (pixelIndex >= endThreshold || pixelIndex < this._frameOffset) {\n      this._frameOffset = pixelIndex - Math.round(this._width / 2) - this._autoScrollOffset;\n\n      if (this._frameOffset < 0) {\n        this._frameOffset = 0;\n      }\n\n      this.updateWaveform(this._frameOffset);\n    }\n  }\n};\n\nWaveformZoomView.prototype._getScale = function(duration) {\n  return duration * this._data.sample_rate / this._width;\n};\n\nfunction isAutoScale(options) {\n  return ((objectHasProperty(options, 'scale') && options.scale === 'auto') ||\n          (objectHasProperty(options, 'seconds') && options.seconds === 'auto'));\n}\n\n/**\n * Options for [WaveformZoomView.setZoom]{@link WaveformZoomView#setZoom}.\n *\n * @typedef {Object} SetZoomOptions\n * @global\n * @property {Number|String} scale Zoom level, in samples per pixel, or 'auto'\n *   to fit the entire waveform to the view width\n * @property {Number|String} seconds Number of seconds to fit to the view width,\n *   or 'auto' to fit the entire waveform to the view width\n */\n\n/**\n * Changes the zoom level.\n *\n * @param {SetZoomOptions} options\n * @returns {Boolean}\n */\n\nWaveformZoomView.prototype.setZoom = function(options) {\n  let scale;\n\n  if (isAutoScale(options)) {\n    const seconds = this._peaks.player.getDuration();\n\n    if (!isValidTime(seconds)) {\n      return false;\n    }\n\n    this._zoomLevelAuto = true;\n    this._zoomLevelSeconds = null;\n    scale = this._getScale(seconds);\n  }\n  else {\n    if (objectHasProperty(options, 'scale')) {\n      this._zoomLevelSeconds = null;\n      scale = options.scale;\n    }\n    else if (objectHasProperty(options, 'seconds')) {\n      if (!isValidTime(options.seconds)) {\n        return false;\n      }\n\n      this._zoomLevelSeconds = options.seconds;\n      scale = this._getScale(options.seconds);\n    }\n\n    this._zoomLevelAuto = false;\n  }\n\n  if (scale < this._originalWaveformData.scale) {\n    // eslint-disable-next-line max-len\n    this._peaks._logger('peaks.zoomview.setZoom(): zoom level must be at least ' + this._originalWaveformData.scale);\n    scale = this._originalWaveformData.scale;\n  }\n\n  const currentTime = this._peaks.player.getCurrentTime();\n  let apexTime;\n  let playheadOffsetPixels = this.getPlayheadOffset();\n\n  if (playheadOffsetPixels >= 0 && playheadOffsetPixels < this._width) {\n    // Playhead is visible. Change the zoom level while keeping the\n    // playhead at the same position in the window.\n    apexTime = currentTime;\n  }\n  else {\n    // Playhead is not visible. Change the zoom level while keeping the\n    // centre of the window at the same position in the waveform.\n    playheadOffsetPixels = Math.floor(this._width / 2);\n    apexTime = this.pixelOffsetToTime(playheadOffsetPixels);\n  }\n\n  const prevScale = this._scale;\n\n  this._resampleData({ scale: scale });\n\n  const apexPixel = this.timeToPixels(apexTime);\n\n  this._frameOffset = apexPixel - playheadOffsetPixels;\n\n  this.updateWaveform(this._frameOffset);\n\n  this._playheadLayer.zoomLevelChanged();\n\n  // Update the playhead position after zooming.\n  this._playheadLayer.updatePlayheadTime(currentTime);\n\n  this._peaks.emit('zoom.update', {\n    currentZoom: scale,\n    previousZoom: prevScale\n  });\n\n  return true;\n};\n\nWaveformZoomView.prototype._resampleData = function(options) {\n  const scale = options.scale;\n\n  if (this._enableWaveformCache) {\n    if (!this._waveformData.has(scale)) {\n      let sourceWaveform = this._originalWaveformData;\n\n      // Resample from the next lowest available zoom level\n\n      for (let i = 0; i < this._waveformScales.length; i++) {\n        if (this._waveformScales[i] < scale) {\n          sourceWaveform = this._waveformData.get(this._waveformScales[i]);\n        }\n        else {\n          break;\n        }\n      }\n\n      this._waveformData.set(scale, sourceWaveform.resample(options));\n\n      this._waveformScales.push(scale);\n      this._waveformScales.sort(function(a, b) {\n        return a - b; // Ascending order\n      });\n    }\n\n    this._data = this._waveformData.get(scale);\n  }\n  else {\n    this._data = this._originalWaveformData.resample(options);\n  }\n\n  this._scale = this._data.scale;\n  this._pixelLength = this._data.length;\n};\n\nWaveformZoomView.prototype.getStartTime = function() {\n  return this.pixelOffsetToTime(0);\n};\n\nWaveformZoomView.prototype.getEndTime = function() {\n  return this.pixelOffsetToTime(this._width);\n};\n\nWaveformZoomView.prototype.setStartTime = function(time) {\n  if (time < 0) {\n    time = 0;\n  }\n\n  if (this._zoomLevelAuto) {\n    time = 0;\n  }\n\n  this.updateWaveform(this.timeToPixels(time));\n};\n\n/**\n * Returns the pixel index for a given time, for the current zoom level.\n *\n * @param {Number} time Time, in seconds.\n * @returns {Number} Pixel index.\n */\n\nWaveformZoomView.prototype.timeToPixels = function(time) {\n  return Math.floor(time * this._data.sample_rate / this._data.scale);\n};\n\n/**\n * Returns the time for a given pixel index, for the current zoom level.\n *\n * @param {Number} pixels Pixel index.\n * @returns {Number} Time, in seconds.\n */\n\nWaveformZoomView.prototype.pixelsToTime = function(pixels) {\n  return pixels * this._data.scale / this._data.sample_rate;\n};\n\n/**\n * Returns the time for a given pixel offset (relative to the\n * current scroll position), for the current zoom level.\n *\n * @param {Number} offset Offset from left-visible-edge of view\n * @returns {Number} Time, in seconds.\n */\n\nWaveformZoomView.prototype.pixelOffsetToTime = function(offset) {\n  const pixels = this._frameOffset + offset;\n\n  return pixels * this._data.scale / this._data.sample_rate;\n};\n\nWaveformZoomView.prototype.timeToPixelOffset = function(time) {\n  return Math.floor(time * this._data.sample_rate / this._data.scale) - this._frameOffset;\n};\n\n/**\n * @returns {Number} The start position of the waveform shown in the view,\n *   in pixels.\n */\n\nWaveformZoomView.prototype.getFrameOffset = function() {\n  return this._frameOffset;\n};\n\n/**\n * @returns {Number} The width of the view, in pixels.\n */\n\nWaveformZoomView.prototype.getWidth = function() {\n  return this._width;\n};\n\n/**\n * @returns {Number} The height of the view, in pixels.\n */\n\nWaveformZoomView.prototype.getHeight = function() {\n  return this._height;\n};\n\n/**\n * @returns {Number} The length of the waveform, in pixels.\n */\nWaveformZoomView.prototype.getPixelLength = function() {\n  return this._pixelLength;\n};\n\n/**\n * @returns {Number} The media duration, in seconds.\n */\n\nWaveformZoomView.prototype._getDuration = function() {\n  return this._peaks.player.getDuration();\n};\n\n/**\n * Adjusts the amplitude scale of waveform shown in the view, which allows\n * users to zoom the waveform vertically.\n *\n * @param {Number} scale The new amplitude scale factor\n */\n\nWaveformZoomView.prototype.setAmplitudeScale = function(scale) {\n  if (!isNumber(scale) || !isFinite(scale)) {\n    throw new Error('view.setAmplitudeScale(): Scale must be a valid number');\n  }\n\n  this._amplitudeScale = scale;\n\n  this._drawWaveformLayer();\n\n  if (this._segmentsLayer) {\n    this._segmentsLayer.draw();\n  }\n};\n\nWaveformZoomView.prototype.getAmplitudeScale = function() {\n  return this._amplitudeScale;\n};\n\n/**\n * @returns {WaveformData} The view's waveform data.\n */\n\nWaveformZoomView.prototype.getWaveformData = function() {\n  return this._data;\n};\n\nWaveformZoomView.prototype._createWaveformShapes = function() {\n  if (!this._waveformShape) {\n    this._waveformShape = new WaveformShape({\n      color: this._waveformColor,\n      view: this\n    });\n\n    this._waveformShape.addToLayer(this._waveformLayer);\n  }\n\n  if (this._playedWaveformColor && !this._playedWaveformShape) {\n    const time = this._peaks.player.getCurrentTime();\n\n    this._playedSegment = {\n      startTime: 0,\n      endTime: time\n    };\n\n    this._unplayedSegment = {\n      startTime: time,\n      endTime: this._getDuration()\n    };\n\n    this._waveformShape.setSegment(this._unplayedSegment);\n\n    this._playedWaveformShape = new WaveformShape({\n      color: this._playedWaveformColor,\n      view: this,\n      segment: this._playedSegment\n    });\n\n    this._playedWaveformShape.addToLayer(this._waveformLayer);\n  }\n};\n\nWaveformZoomView.prototype._destroyPlayedWaveformShape = function() {\n  this._waveformShape.setSegment(null);\n\n  this._playedWaveformShape.destroy();\n  this._playedWaveformShape = null;\n\n  this._playedSegment = null;\n  this._unplayedSegment = null;\n};\n\nWaveformZoomView.prototype._createWaveform = function() {\n  this._waveformLayer = new Konva.Layer({ listening: false });\n\n  this._createWaveformShapes();\n\n  this._stage.add(this._waveformLayer);\n\n  this._peaks.emit('zoomview.displaying', 0, this.getEndTime());\n};\n\nWaveformZoomView.prototype._createAxisLabels = function() {\n  this._axisLayer = new Konva.Layer({ listening: false });\n  this._axis = new WaveformAxis(this, this._viewOptions);\n\n  this._axis.addToLayer(this._axisLayer);\n  this._stage.add(this._axisLayer);\n};\n\n/**\n * Scrolls the region of waveform shown in the view.\n *\n * @param {Number} scrollAmount How far to scroll, in pixels\n */\n\nWaveformZoomView.prototype.scrollWaveform = function(options) {\n  let scrollAmount;\n\n  if (objectHasProperty(options, 'pixels')) {\n    scrollAmount = Math.floor(options.pixels);\n  }\n  else if (objectHasProperty(options, 'seconds')) {\n    scrollAmount = this.timeToPixels(options.seconds);\n  }\n  else {\n    throw new TypeError('view.scrollWaveform(): Missing umber of pixels or seconds');\n  }\n\n  this.updateWaveform(this._frameOffset + scrollAmount);\n};\n\n/**\n * Updates the region of waveform shown in the view.\n *\n * @param {Number} frameOffset The new frame offset, in pixels.\n */\n\nWaveformZoomView.prototype.updateWaveform = function(frameOffset) {\n  let upperLimit;\n\n  if (this._pixelLength < this._width) {\n    // Total waveform is shorter than viewport, so reset the offset to 0.\n    frameOffset = 0;\n    upperLimit = this._width;\n  }\n  else {\n    // Calculate the very last possible position.\n    upperLimit = this._pixelLength - this._width;\n  }\n\n  frameOffset = clamp(frameOffset, 0, upperLimit);\n\n  this._frameOffset = frameOffset;\n\n  // Display playhead if it is within the zoom frame width.\n  const playheadPixel = this._playheadLayer.getPlayheadPixel();\n\n  this._playheadLayer.updatePlayheadTime(this.pixelsToTime(playheadPixel));\n\n  this._drawWaveformLayer();\n  this._axisLayer.draw();\n\n  const frameStartTime = this.getStartTime();\n  const frameEndTime   = this.getEndTime();\n\n  if (this._pointsLayer) {\n    this._pointsLayer.updatePoints(frameStartTime, frameEndTime);\n  }\n\n  if (this._segmentsLayer) {\n    this._segmentsLayer.updateSegments(frameStartTime, frameEndTime);\n  }\n\n  this._peaks.emit('zoomview.displaying', frameStartTime, frameEndTime);\n};\n\nWaveformZoomView.prototype._drawWaveformLayer = function() {\n  this._waveformLayer.draw();\n};\n\nWaveformZoomView.prototype.setWaveformColor = function(color) {\n  this._waveformColor = color;\n  this._waveformShape.setWaveformColor(color);\n};\n\nWaveformZoomView.prototype.setPlayedWaveformColor = function(color) {\n  this._playedWaveformColor = color;\n\n  if (color) {\n    if (!this._playedWaveformShape) {\n      this._createWaveformShapes();\n    }\n\n    this._playedWaveformShape.setWaveformColor(color);\n  }\n  else {\n    if (this._playedWaveformShape) {\n      this._destroyPlayedWaveformShape();\n    }\n  }\n};\n\nWaveformZoomView.prototype.showPlayheadTime = function(show) {\n  this._playheadLayer.showPlayheadTime(show);\n};\n\nWaveformZoomView.prototype.setTimeLabelPrecision = function(precision) {\n  this._timeLabelPrecision = precision;\n  this._playheadLayer.updatePlayheadText();\n};\n\nWaveformZoomView.prototype.formatTime = function(time) {\n  return this._formatPlayheadTime(time);\n};\n\nWaveformZoomView.prototype.showAxisLabels = function(show, options) {\n  this._axis.showAxisLabels(show, options);\n  this._axisLayer.draw();\n};\n\nWaveformZoomView.prototype.enableAutoScroll = function(enable, options) {\n  this._autoScroll = enable;\n\n  if (objectHasProperty(options, 'offset')) {\n    this._autoScrollOffset = options.offset;\n  }\n};\n\nWaveformZoomView.prototype.enableMarkerEditing = function(enable) {\n  if (this._segmentsLayer) {\n    this._segmentsLayer.enableEditing(enable);\n  }\n\n  if (this._pointsLayer) {\n    this._pointsLayer.enableEditing(enable);\n  }\n};\n\nWaveformZoomView.prototype.getMinSegmentDragWidth = function() {\n  return this._insertSegmentShape ? 0 : this._minSegmentDragWidth;\n};\n\nWaveformZoomView.prototype.setMinSegmentDragWidth = function(width) {\n  this._minSegmentDragWidth = width;\n};\n\nWaveformZoomView.prototype.fitToContainer = function() {\n  if (this._container.clientWidth === 0 && this._container.clientHeight === 0) {\n    return;\n  }\n\n  let updateWaveform = false;\n\n  if (this._container.clientWidth !== this._width) {\n    this._width = this._container.clientWidth;\n    this._stage.width(this._width);\n\n    let resample = false;\n    let resampleOptions;\n\n    if (this._zoomLevelAuto) {\n      resample = true;\n      resampleOptions = { width: this._width };\n    }\n    else if (this._zoomLevelSeconds !== null) {\n      resample = true;\n      resampleOptions = { scale: this._getScale(this._zoomLevelSeconds) };\n    }\n\n    if (resample) {\n      try {\n        this._resampleData(resampleOptions);\n        updateWaveform = true;\n      }\n      catch (error) {\n        // Ignore, and leave this._data as it was\n      }\n    }\n  }\n\n  if (this._container.clientHeight !== this._height) {\n    this._height = this._container.clientHeight;\n    this._stage.height(this._height);\n\n    this._waveformShape.fitToView();\n    this._playheadLayer.fitToView();\n\n    if (this._segmentsLayer) {\n      this._segmentsLayer.fitToView();\n    }\n\n    if (this._pointsLayer) {\n      this._pointsLayer.fitToView();\n    }\n  }\n\n  if (updateWaveform) {\n    this.updateWaveform(this._frameOffset);\n  }\n};\n\nWaveformZoomView.prototype.getStage = function() {\n  return this._stage;\n};\n\nWaveformZoomView.prototype.getSegmentsLayer = function() {\n  return this._segmentsLayer;\n};\n\nWaveformZoomView.prototype.getViewOptions = function() {\n  return this._viewOptions;\n};\n\nWaveformZoomView.prototype.destroy = function() {\n  // Unregister event handlers\n  this._peaks.off('player.timeupdate', this._onTimeUpdate);\n  this._peaks.off('player.playing', this._onPlaying);\n  this._peaks.off('player.pause', this._onPause);\n  this._peaks.off('keyboard.left', this._onKeyboardLeft);\n  this._peaks.off('keyboard.right', this._onKeyboardRight);\n  this._peaks.off('keyboard.shift_left', this._onKeyboardShiftLeft);\n  this._peaks.off('keyboard.shift_right', this._onKeyboardShiftRight);\n\n  this._mouseDragHandler.destroy();\n\n  this._playheadLayer.destroy();\n\n  if (this._segmentsLayer) {\n    this._segmentsLayer.destroy();\n  }\n\n  if (this._pointsLayer) {\n    this._pointsLayer.destroy();\n  }\n\n  if (this._stage) {\n    this._stage.destroy();\n    this._stage = null;\n  }\n};\n\nexport default WaveformZoomView;\n","/**\n * @file\n *\n * Defines the {@link Scrollbar} class.\n *\n * @module scrollbar\n */\n\nimport { clamp } from './utils';\n\nimport Konva from 'konva/lib/Core';\nimport { Rect } from 'konva/lib/shapes/Rect';\n\n/**\n * Creates a scrollbar.\n *\n * @class\n * @alias Scrollbar\n *\n * @param {WaveformData} waveformData\n * @param {HTMLElement} container\n * @param {Peaks} peaks\n */\n\nfunction Scrollbar(waveformData, container, peaks) {\n  this._waveformData = waveformData;\n  this._container = container;\n  this._peaks = peaks;\n  this._options = peaks.options.scrollbar;\n  this._zoomview = peaks.views.getView('zoomview');\n\n  this._dragBoundFunc = this._dragBoundFunc.bind(this);\n  this._onScrollboxDragStart = this._onScrollboxDragStart.bind(this);\n  this._onScrollboxDragMove = this._onScrollboxDragMove.bind(this);\n  this._onScrollboxDragEnd = this._onScrollboxDragEnd.bind(this);\n  this._onZoomviewDisplaying = this._onZoomviewDisplaying.bind(this);\n  this._onScrollbarClick = this._onScrollbarClick.bind(this);\n\n  peaks.on('zoomview.displaying', this._onZoomviewDisplaying);\n\n  this._width = container.clientWidth;\n  // this._height = container.clientHeight;\n  this._height = 10;\n\n  this._stage = new Konva.Stage({\n    container: container,\n    width: this._width,\n    height: this._height\n  });\n\n  this._layer = new Konva.Layer();\n  this._stage.on('click', this._onScrollbarClick);\n\n  this._stage.add(this._layer);\n\n  this._color = this._options.color;\n  this._scrollboxX = 0;\n  this._minScrollboxWidth = this._options.minWidth;\n\n  this._offsetY = 0;\n\n  this._scrollbox = new Konva.Group({\n    draggable:     true,\n    dragBoundFunc: this._dragBoundFunc\n  });\n\n  this._scrollboxRect = new Rect({\n    x:           this._scrollboxX,\n    y:           this._offsetY,\n    width:       0,\n    height:      this._height,\n    fill:        this._color,\n    cornerRadius: 10\n  });\n\n  this._scrollbox.add(this._scrollboxRect);\n  this._setScrollboxWidth();\n\n  this._scrollbox.on('dragstart', this._onScrollboxDragStart);\n  this._scrollbox.on('dragmove', this._onScrollboxDragMove);\n  this._scrollbox.on('dragend', this._onScrollboxDragEnd);\n\n  this._layer.add(this._scrollbox);\n  this._layer.draw();\n}\n\nScrollbar.prototype.setZoomview = function(zoomview) {\n  this._zoomview = zoomview;\n\n  this._updateScrollbarWidthAndPosition();\n};\n\n/**\n * Sets the width of the scrollbox, based on the visible waveform region\n * in the zoomview and minimum scrollbox width option.\n */\n\nScrollbar.prototype._setScrollboxWidth = function() {\n  if (this._zoomview) {\n    this._scrollboxWidth = Math.floor(\n      this._width * this._zoomview.pixelsToTime(this._zoomview.getWidth()) /\n        this._peaks.player.getDuration()\n    );\n\n    if (this._scrollboxWidth < this._minScrollboxWidth) {\n      this._scrollboxWidth = this._minScrollboxWidth;\n    }\n  }\n  else {\n    this._scrollboxWidth = this._width;\n  }\n\n  this._scrollboxRect.width(this._scrollboxWidth);\n};\n\n/**\n * @returns {Number} The maximum scrollbox position, in pixels.\n */\n\nScrollbar.prototype._getScrollbarRange = function() {\n  return this._width - this._scrollboxWidth;\n};\n\nScrollbar.prototype._dragBoundFunc = function(pos) {\n  // Allow the scrollbar to be moved horizontally but not vertically.\n  return {\n    x: pos.x,\n    y: 0\n  };\n};\n\nScrollbar.prototype._onScrollboxDragStart = function() {\n  this._dragging = true;\n};\n\nScrollbar.prototype._onScrollboxDragEnd = function() {\n  this._dragging = false;\n};\n\nScrollbar.prototype._onScrollboxDragMove = function() {\n  const range = this._getScrollbarRange();\n  const x = clamp(this._scrollbox.x(), 0, range);\n\n  this._scrollbox.x(x);\n\n  if (x !== this._scrollboxX) {\n    this._scrollboxX = x;\n\n    if (this._zoomview) {\n      this._updateWaveform(x);\n    }\n  }\n};\n\nScrollbar.prototype._onZoomviewDisplaying = function(/* startTime , endTime */) {\n  if (!this._dragging) {\n    this._updateScrollbarWidthAndPosition();\n  }\n};\n\nScrollbar.prototype._updateScrollbarWidthAndPosition = function() {\n  this._setScrollboxWidth();\n\n  if (this._zoomview) {\n    const startTime = this._zoomview.getStartTime();\n\n    const zoomviewRange = this._zoomview.getPixelLength() - this._zoomview.getWidth();\n\n    const scrollBoxPos = Math.floor(\n      this._zoomview.timeToPixels(startTime) * this._getScrollbarRange() / zoomviewRange\n    );\n\n    this._scrollbox.x(scrollBoxPos);\n    this._layer.draw();\n  }\n};\n\nScrollbar.prototype._onScrollbarClick = function(event) {\n  // Handle clicks on the scrollbar outside the scrollbox.\n  if (event.target === this._stage) {\n    if (this._zoomview) {\n      // Centre the scrollbox where the user clicked.\n      let x = Math.floor(event.evt.layerX - this._scrollboxWidth / 2);\n\n      if (x < 0) {\n        x = 0;\n      }\n\n      this._updateWaveform(x);\n    }\n  }\n};\n\n/**\n * Sets the zoomview waveform position based on scrollbar position.\n */\n\nScrollbar.prototype._updateWaveform = function(x) {\n  const offset = Math.floor(\n    (this._zoomview.getPixelLength() - this._zoomview.getWidth()) * x / this._getScrollbarRange()\n  );\n\n  this._zoomview.updateWaveform(offset);\n};\n\nScrollbar.prototype.fitToContainer = function() {\n  if (this._container.clientWidth === 0 && this._container.clientHeight === 0) {\n    return;\n  }\n\n  if (this._container.clientWidth !== this._width) {\n    this._width = this._container.clientWidth;\n    this._stage.width(this._width);\n\n    this._updateScrollbarWidthAndPosition();\n  }\n\n  this._height = this._container.clientHeight;\n  this._stage.height(this._height);\n};\n\nScrollbar.prototype.destroy = function() {\n  this._layer.destroy();\n\n  this._stage.destroy();\n  this._stage = null;\n};\n\nexport default Scrollbar;\n","/**\n * @file\n *\n * Defines the {@link ViewController} class.\n *\n * @module view-controller\n */\n\nimport WaveformOverview from './waveform-overview';\nimport WaveformZoomView from './waveform-zoomview';\nimport Scrollbar from './scrollbar';\nimport { isNullOrUndefined } from './utils';\n\n/**\n * Creates an object that allows users to create and manage waveform views.\n *\n * @class\n * @alias ViewController\n *\n * @param {Peaks} peaks\n */\n\nfunction ViewController(peaks) {\n  this._peaks = peaks;\n  this._overview = null;\n  this._zoomview = null;\n  this._scrollbar = null;\n}\n\nViewController.prototype.createOverview = function(container) {\n  if (this._overview) {\n    return this._overview;\n  }\n\n  const waveformData = this._peaks.getWaveformData();\n\n  this._overview = new WaveformOverview(\n    waveformData,\n    container,\n    this._peaks\n  );\n\n  if (this._zoomview) {\n    this._overview.showHighlight(\n      this._zoomview.getStartTime(),\n      this._zoomview.getEndTime()\n    );\n  }\n\n  return this._overview;\n};\n\nViewController.prototype.createZoomview = function(container) {\n  if (this._zoomview) {\n    return this._zoomview;\n  }\n\n  const waveformData = this._peaks.getWaveformData();\n\n  this._zoomview = new WaveformZoomView(\n    waveformData,\n    container,\n    this._peaks\n  );\n\n  if (this._scrollbar) {\n    this._scrollbar.setZoomview(this._zoomview);\n  }\n\n  return this._zoomview;\n};\n\nViewController.prototype.createScrollbar = function(container) {\n  const waveformData = this._peaks.getWaveformData();\n\n  this._scrollbar = new Scrollbar(\n    waveformData,\n    container,\n    this._peaks\n  );\n\n  return this._scrollbar;\n};\n\nViewController.prototype.destroyOverview = function() {\n  if (!this._overview) {\n    return;\n  }\n\n  if (!this._zoomview) {\n    return;\n  }\n\n  this._overview.destroy();\n  this._overview = null;\n};\n\nViewController.prototype.destroyZoomview = function() {\n  if (!this._zoomview) {\n    return;\n  }\n\n  if (!this._overview) {\n    return;\n  }\n\n  this._zoomview.destroy();\n  this._zoomview = null;\n\n  this._overview.removeHighlightRect();\n};\n\nViewController.prototype.destroy = function() {\n  if (this._overview) {\n    this._overview.destroy();\n    this._overview = null;\n  }\n\n  if (this._zoomview) {\n    this._zoomview.destroy();\n    this._zoomview = null;\n  }\n\n  if (this._scrollbar) {\n    this._scrollbar.destroy();\n    this._scrollbar = null;\n  }\n};\n\nViewController.prototype.getView = function(name) {\n  if (isNullOrUndefined(name)) {\n    if (this._overview && this._zoomview) {\n      return null;\n    }\n    else if (this._overview) {\n      return this._overview;\n    }\n    else if (this._zoomview) {\n      return this._zoomview;\n    }\n    else {\n      return null;\n    }\n  }\n  else {\n    switch (name) {\n      case 'overview':\n        return this._overview;\n\n      case 'zoomview':\n        return this._zoomview;\n\n      default:\n        return null;\n    }\n  }\n};\n\nViewController.prototype.getScrollbar = function() {\n  return this._scrollbar;\n};\n\nexport default ViewController;\n","/**\n * @file\n *\n * Defines the {@link ZoomController} class.\n *\n * @module zoom-controller\n */\n\n/**\n * Creates an object to control zoom levels in a {@link WaveformZoomView}.\n *\n * @class\n * @alias ZoomController\n *\n * @param {Peaks} peaks\n * @param {Array<Integer>} zoomLevels\n */\n\nfunction ZoomController(peaks, zoomLevels) {\n  this._peaks = peaks;\n  this._zoomLevels = zoomLevels;\n  this._zoomLevelIndex = 0;\n}\n\nZoomController.prototype.setZoomLevels = function(zoomLevels) {\n  this._zoomLevels = zoomLevels;\n  this.setZoom(0, true);\n};\n\n/**\n * Zoom in one level.\n */\n\nZoomController.prototype.zoomIn = function() {\n  this.setZoom(this._zoomLevelIndex - 1);\n};\n\n/**\n * Zoom out one level.\n */\n\nZoomController.prototype.zoomOut = function() {\n  this.setZoom(this._zoomLevelIndex + 1);\n};\n\n/**\n * Given a particular zoom level, triggers a resampling of the data in the\n * zoomed view.\n *\n * @param {number} zoomLevelIndex An index into the options.zoomLevels array.\n */\n\nZoomController.prototype.setZoom = function(zoomLevelIndex, forceUpdate) {\n  if (zoomLevelIndex >= this._zoomLevels.length) {\n    zoomLevelIndex = this._zoomLevels.length - 1;\n  }\n\n  if (zoomLevelIndex < 0) {\n    zoomLevelIndex = 0;\n  }\n\n  if (!forceUpdate && (zoomLevelIndex === this._zoomLevelIndex)) {\n    // Nothing to do.\n    return;\n  }\n\n  this._zoomLevelIndex = zoomLevelIndex;\n\n  const zoomview = this._peaks.views.getView('zoomview');\n\n  if (!zoomview) {\n    return;\n  }\n\n  zoomview.setZoom({ scale: this._zoomLevels[zoomLevelIndex] });\n};\n\n/**\n * Returns the current zoom level index.\n *\n * @returns {Number}\n */\n\nZoomController.prototype.getZoom = function() {\n  return this._zoomLevelIndex;\n};\n\n/**\n * Returns the current zoom level, in samples per pixel.\n *\n * @returns {Number}\n */\n\nZoomController.prototype.getZoomLevel = function() {\n  return this._zoomLevels[this._zoomLevelIndex];\n};\n\nexport default ZoomController;\n","/**\n * @file\n *\n * Defines the {@link WaveformBuilder} class.\n *\n * @module waveform-builder\n */\n\nimport { isArrayBuffer, isObject } from './utils';\nimport WaveformData from 'waveform-data';\n\nconst isXhr2 = ('withCredentials' in new XMLHttpRequest());\n\n/**\n * Creates and returns a WaveformData object, either by requesting the\n * waveform data from the server, or by creating the waveform data using the\n * Web Audio API.\n *\n * @class\n * @alias WaveformBuilder\n *\n * @param {Peaks} peaks\n */\n\nfunction WaveformBuilder(peaks) {\n  this._peaks = peaks;\n}\n\n/**\n * Options for requesting remote waveform data.\n *\n * @typedef {Object} RemoteWaveformDataOptions\n * @global\n * @property {String=} arraybuffer\n * @property {String=} json\n */\n\n/**\n * Options for supplying local waveform data.\n *\n * @typedef {Object} LocalWaveformDataOptions\n * @global\n * @property {ArrayBuffer=} arraybuffer\n * @property {Object=} json\n */\n\n/**\n * Options for the Web Audio waveform builder.\n *\n * @typedef {Object} WaveformBuilderWebAudioOptions\n * @global\n * @property {AudioContext} audioContext\n * @property {AudioBuffer=} audioBuffer\n * @property {Number=} scale\n * @property {Boolean=} multiChannel\n */\n\n/**\n * Options for [WaveformBuilder.init]{@link WaveformBuilder#init}.\n *\n * @typedef {Object} WaveformBuilderInitOptions\n * @global\n * @property {RemoteWaveformDataOptions=} dataUri\n * @property {LocalWaveformDataOptions=} waveformData\n * @property {WaveformBuilderWebAudioOptions=} webAudio\n * @property {Boolean=} withCredentials\n * @property {Array<Number>=} zoomLevels\n */\n\n/**\n * Callback for receiving the waveform data.\n *\n * @callback WaveformBuilderInitCallback\n * @global\n * @param {Error} error\n * @param {WaveformData} waveformData\n */\n\n/**\n * Loads or creates the waveform data.\n *\n * @private\n * @param {WaveformBuilderInitOptions} options\n * @param {WaveformBuilderInitCallback} callback\n */\n\nWaveformBuilder.prototype.init = function(options, callback) {\n  if ((options.dataUri && (options.webAudio || options.audioContext)) ||\n      (options.waveformData && (options.webAudio || options.audioContext)) ||\n      (options.dataUri && options.waveformData)) {\n    // eslint-disable-next-line max-len\n    callback(new TypeError('Peaks.init(): You may only pass one source (webAudio, dataUri, or waveformData) to render waveform data.'));\n    return;\n  }\n\n  if (options.audioContext) {\n    // eslint-disable-next-line max-len\n    this._peaks._logger('Peaks.init(): The audioContext option is deprecated, please pass a webAudio object instead');\n\n    options.webAudio = {\n      audioContext: options.audioContext\n    };\n  }\n\n  if (options.dataUri) {\n    return this._getRemoteWaveformData(options, callback);\n  }\n  else if (options.waveformData) {\n    return this._buildWaveformFromLocalData(options, callback);\n  }\n  else if (options.webAudio) {\n    if (options.webAudio.audioBuffer) {\n      return this._buildWaveformDataFromAudioBuffer(options, callback);\n    }\n    else {\n      return this._buildWaveformDataUsingWebAudio(options, callback);\n    }\n  }\n  else {\n    // eslint-disable-next-line max-len\n    callback(new Error('Peaks.init(): You must pass an audioContext, or dataUri, or waveformData to render waveform data'));\n  }\n};\n\n/* eslint-disable max-len */\n\n/**\n * Fetches waveform data, based on the given options.\n *\n * @private\n * @param {Object} options\n * @param {String|Object} options.dataUri\n * @param {String} options.dataUri.arraybuffer Waveform data URL\n *   (binary format)\n * @param {String} options.dataUri.json Waveform data URL (JSON format)\n * @param {String} options.defaultUriFormat Either 'arraybuffer' (for binary\n *   data) or 'json'\n * @param {WaveformBuilderInitCallback} callback\n *\n * @see Refer to the <a href=\"https://github.com/bbc/audiowaveform/blob/master/doc/DataFormat.md\">data format documentation</a>\n *   for details of the binary and JSON waveform data formats.\n */\n\n/* eslint-enable max-len */\n\nWaveformBuilder.prototype._getRemoteWaveformData = function(options, callback) {\n  const self = this;\n\n  let dataUri = null;\n  let requestType = null;\n  let url;\n\n  if (isObject(options.dataUri)) {\n    dataUri = options.dataUri;\n  }\n  else {\n    callback(new TypeError('Peaks.init(): The dataUri option must be an object'));\n    return;\n  }\n\n  ['ArrayBuffer', 'JSON'].some(function(connector) {\n    if (window[connector]) {\n      requestType = connector.toLowerCase();\n      url = dataUri[requestType];\n\n      return Boolean(url);\n    }\n  });\n\n  if (!url) {\n    // eslint-disable-next-line max-len\n    callback(new Error('Peaks.init(): Unable to determine a compatible dataUri format for this browser'));\n    return;\n  }\n\n  self._xhr = self._createXHR(url, requestType, options.withCredentials, function(event) {\n    if (this.readyState !== 4) {\n      return;\n    }\n\n    if (this.status !== 200) {\n      callback(\n        new Error('Unable to fetch remote data. HTTP status ' + this.status)\n      );\n\n      return;\n    }\n\n    self._xhr = null;\n\n    const waveformData = WaveformData.create(event.target.response);\n\n    if (waveformData.channels !== 1 && waveformData.channels !== 2) {\n      callback(new Error('Peaks.init(): Only mono or stereo waveforms are currently supported'));\n      return;\n    }\n    else if (waveformData.bits !== 8) {\n      callback(new Error('Peaks.init(): 16-bit waveform data is not supported'));\n      return;\n    }\n\n    callback(null, waveformData);\n  },\n  function() {\n    callback(new Error('XHR failed'));\n  },\n  function() {\n    callback(new Error('XHR aborted'));\n  });\n\n  self._xhr.send();\n};\n\n/* eslint-disable max-len */\n\n/**\n * Creates a waveform from given data, based on the given options.\n *\n * @private\n * @param {Object} options\n * @param {Object} options.waveformData\n * @param {ArrayBuffer} options.waveformData.arraybuffer Waveform data (binary format)\n * @param {Object} options.waveformData.json Waveform data (JSON format)\n * @param {WaveformBuilderInitCallback} callback\n *\n * @see Refer to the <a href=\"https://github.com/bbc/audiowaveform/blob/master/doc/DataFormat.md\">data format documentation</a>\n *   for details of the binary and JSON waveform data formats.\n */\n\n/* eslint-enable max-len */\n\nWaveformBuilder.prototype._buildWaveformFromLocalData = function(options, callback) {\n  let waveformData = null;\n  let data = null;\n\n  if (isObject(options.waveformData)) {\n    waveformData = options.waveformData;\n  }\n  else {\n    callback(new Error('Peaks.init(): The waveformData option must be an object'));\n    return;\n  }\n\n  if (isObject(waveformData.json)) {\n    data = waveformData.json;\n  }\n  else if (isArrayBuffer(waveformData.arraybuffer)) {\n    data = waveformData.arraybuffer;\n  }\n\n  if (!data) {\n    // eslint-disable-next-line max-len\n    callback(new Error('Peaks.init(): Unable to determine a compatible waveformData format'));\n    return;\n  }\n\n  try {\n    const createdWaveformData = WaveformData.create(data);\n\n    if (createdWaveformData.channels !== 1 && createdWaveformData.channels !== 2) {\n      callback(new Error('Peaks.init(): Only mono or stereo waveforms are currently supported'));\n      return;\n    }\n    else if (createdWaveformData.bits !== 8) {\n      callback(new Error('Peaks.init(): 16-bit waveform data is not supported'));\n      return;\n    }\n\n    callback(null, createdWaveformData);\n  }\n  catch (err) {\n    callback(err);\n  }\n};\n\n/**\n * Creates waveform data using the Web Audio API.\n *\n * @private\n * @param {Object} options\n * @param {AudioContext} options.audioContext\n * @param {HTMLMediaElement} options.mediaElement\n * @param {WaveformBuilderInitCallback} callback\n */\n\nWaveformBuilder.prototype._buildWaveformDataUsingWebAudio = function(options, callback) {\n  const self = this;\n\n  const audioContext = window.AudioContext || window.webkitAudioContext;\n\n  if (!(options.webAudio.audioContext instanceof audioContext)) {\n    // eslint-disable-next-line max-len\n    callback(new TypeError('Peaks.init(): The webAudio.audioContext option must be a valid AudioContext'));\n    return;\n  }\n\n  const webAudioOptions = options.webAudio;\n\n  if (webAudioOptions.scale !== options.zoomLevels[0]) {\n    webAudioOptions.scale = options.zoomLevels[0];\n  }\n\n  // If the media element has already selected which source to play, its\n  // currentSrc attribute will contain the source media URL. Otherwise,\n  // we wait for a canplay event to tell us when the media is ready.\n\n  const mediaSourceUrl = self._peaks.options.mediaElement.currentSrc;\n\n  if (mediaSourceUrl) {\n    self._requestAudioAndBuildWaveformData(\n      mediaSourceUrl,\n      webAudioOptions,\n      options.withCredentials,\n      callback\n    );\n  }\n  else {\n    self._peaks.once('player.canplay', function() {\n      self._requestAudioAndBuildWaveformData(\n        self._peaks.options.mediaElement.currentSrc,\n        webAudioOptions,\n        options.withCredentials,\n        callback\n      );\n    });\n  }\n};\n\nWaveformBuilder.prototype._buildWaveformDataFromAudioBuffer = function(options, callback) {\n  const webAudioOptions = options.webAudio;\n\n  if (webAudioOptions.scale !== options.zoomLevels[0]) {\n    webAudioOptions.scale = options.zoomLevels[0];\n  }\n\n  const webAudioBuilderOptions = {\n    audio_buffer: webAudioOptions.audioBuffer,\n    split_channels: webAudioOptions.multiChannel,\n    scale: webAudioOptions.scale,\n    disable_worker: true\n  };\n\n  WaveformData.createFromAudio(webAudioBuilderOptions, callback);\n};\n\n/**\n * Fetches the audio content, based on the given options, and creates waveform\n * data using the Web Audio API.\n *\n * @private\n * @param {url} The media source URL\n * @param {WaveformBuilderWebAudioOptions} webAudio\n * @param {Boolean} withCredentials\n * @param {WaveformBuilderInitCallback} callback\n */\n\nWaveformBuilder.prototype._requestAudioAndBuildWaveformData = function(url,\n    webAudio, withCredentials, callback) {\n  const self = this;\n\n  if (!url) {\n    self._peaks._logger('Peaks.init(): The mediaElement src is invalid');\n    return;\n  }\n\n  self._xhr = self._createXHR(url, 'arraybuffer', withCredentials, function(event) {\n    if (this.readyState !== 4) {\n      return;\n    }\n\n    if (this.status !== 200) {\n      callback(\n        new Error('Unable to fetch remote data. HTTP status ' + this.status)\n      );\n\n      return;\n    }\n\n    self._xhr = null;\n\n    const webAudioBuilderOptions = {\n      audio_context: webAudio.audioContext,\n      array_buffer: event.target.response,\n      split_channels: webAudio.multiChannel,\n      scale: webAudio.scale\n    };\n\n    WaveformData.createFromAudio(webAudioBuilderOptions, callback);\n  },\n  function() {\n    callback(new Error('XHR failed'));\n  },\n  function() {\n    callback(new Error('XHR aborted'));\n  });\n\n  self._xhr.send();\n};\n\nWaveformBuilder.prototype.abort = function() {\n  if (this._xhr) {\n    this._xhr.abort();\n  }\n};\n\n/**\n * @private\n * @param {String} url\n * @param {String} requestType\n * @param {Boolean} withCredentials\n * @param {Function} onLoad\n * @param {Function} onError\n *\n * @returns {XMLHttpRequest}\n */\n\nWaveformBuilder.prototype._createXHR = function(url, requestType,\n    withCredentials, onLoad, onError, onAbort) {\n  const xhr = new XMLHttpRequest();\n\n  // open an XHR request to the data source file\n  xhr.open('GET', url, true);\n\n  if (isXhr2) {\n    try {\n      xhr.responseType = requestType;\n    }\n    catch (e) {\n      // Some browsers like Safari 6 do handle XHR2 but not the json\n      // response type, doing only a try/catch fails in IE9\n    }\n  }\n\n  xhr.onload = onLoad;\n  xhr.onerror = onError;\n\n  if (isXhr2 && withCredentials) {\n    xhr.withCredentials = true;\n  }\n\n  xhr.addEventListener('abort', onAbort);\n\n  return xhr;\n};\n\nexport default WaveformBuilder;\n","/**\n * @file\n *\n * Defines the {@link Peaks} class.\n *\n * @module main\n */\n\nimport EventEmitter from 'eventemitter3';\nimport CueEmitter from './cue-emitter';\nimport WaveformPoints from './waveform-points';\nimport WaveformSegments from './waveform-segments';\nimport KeyboardHandler from './keyboard-handler';\nimport MediaElementPlayer from './mediaelement-player';\nimport Player from './player';\nimport { createPointMarker, createSegmentMarker, createSegmentLabel } from './marker-factories';\nimport ViewController from './view-controller';\nimport ZoomController from './zoom-controller';\nimport WaveformBuilder from './waveform-builder';\nimport {\n  isHTMLElement, isFunction, isInAscendingOrder, isObject,\n  objectHasProperty,\n  extend\n} from './utils';\n\n/**\n * Initialises a new Peaks instance with default option settings.\n *\n * @class\n * @alias Peaks\n *\n * @param {Object} opts Configuration options\n */\n\nfunction Peaks() {\n  EventEmitter.call(this);\n\n  // Set default options\n  this.options = {\n    zoomLevels:          [512, 1024, 2048, 4096],\n    waveformCache:       true,\n\n    mediaElement:        null,\n    mediaUrl:            null,\n\n    dataUri:             null,\n    withCredentials:     false,\n\n    waveformData:        null,\n    webAudio:            null,\n\n    nudgeIncrement:      1.0,\n\n    pointMarkerColor:    '#39cccc',\n\n    createSegmentMarker: createSegmentMarker,\n    createSegmentLabel:  createSegmentLabel,\n    createPointMarker:   createPointMarker,\n\n    // eslint-disable-next-line no-console\n    logger:              console.error.bind(console)\n  };\n\n  return this;\n}\n\nPeaks.prototype = Object.create(EventEmitter.prototype);\n\nconst defaultViewOptions = {\n  playheadColor:          '#111111',\n  playheadTextColor:      '#aaaaaa',\n  axisGridlineColor:      '#cccccc',\n  showAxisLabels:         true,\n  axisTopMarkerHeight:    10,\n  axisBottomMarkerHeight: 10,\n  axisLabelColor:         '#aaaaaa',\n  fontFamily:             'sans-serif',\n  fontSize:               11,\n  fontStyle:              'normal',\n  timeLabelPrecision:     2,\n  enablePoints:           true,\n  enableSegments:         true\n};\n\nconst defaultZoomviewOptions = {\n  // showPlayheadTime:    true,\n  playheadClickTolerance: 3,\n  waveformColor:          'rgba(0, 225, 128, 1)',\n  wheelMode:              'none',\n  autoScroll:             true,\n  autoScrollOffset:       100\n};\n\nconst defaultOverviewOptions = {\n  // showPlayheadTime:    false,\n  waveformColor:          'rgba(0, 0, 0, 0.2)',\n  highlightColor:         '#aaaaaa',\n  highlightStrokeColor:   'transparent',\n  highlightOpacity:       0.3,\n  highlightOffset:        11,\n  highlightCornerRadius:  2\n};\n\nconst defaultSegmentOptions = {\n  overlay:                   false,\n  markers:                   true,\n  startMarkerColor:          '#aaaaaa',\n  endMarkerColor:            '#aaaaaa',\n  waveformColor:             '#0074d9',\n  overlayColor:              '#ff0000',\n  overlayOpacity:            0.3,\n  overlayBorderColor:        '#ff0000',\n  overlayBorderWidth:        2,\n  overlayCornerRadius:       5,\n  overlayOffset:             25,\n  overlayLabelAlign:         'left',\n  overlayLabelVerticalAlign: 'top',\n  overlayLabelPadding:       8,\n  overlayLabelColor:         '#000000',\n  overlayFontFamily:         'sans-serif',\n  overlayFontSize:           12,\n  overlayFontStyle:          'normal'\n};\n\nconst defaultScrollbarOptions = {\n  color: '#888888',\n  minWidth: 50\n};\n\nfunction getOverviewOptions(opts) {\n  const overviewOptions = {};\n\n  if (opts.overview && opts.overview.showPlayheadTime) {\n    overviewOptions.showPlayheadTime = opts.overview.showPlayheadTime;\n  }\n\n  const optNames = [\n    'container',\n    'waveformColor',\n    'playedWaveformColor',\n    'playheadColor',\n    'playheadTextColor',\n    'formatPlayheadTime',\n    'timeLabelPrecision',\n    'axisGridlineColor',\n    'showAxisLabels',\n    'axisTopMarkerHeight',\n    'axisBottomMarkerHeight',\n    'axisLabelColor',\n    'formatAxisTime',\n    'fontFamily',\n    'fontSize',\n    'fontStyle',\n    'highlightColor',\n    'highlightStrokeColor',\n    'highlightOpacity',\n    'highlightCornerRadius',\n    'highlightOffset',\n    'enablePoints',\n    'enableSegments'\n  ];\n\n  optNames.forEach(function(optName) {\n    if (opts.overview && objectHasProperty(opts.overview, optName)) {\n      overviewOptions[optName] = opts.overview[optName];\n    }\n    else if (objectHasProperty(opts, optName)) {\n      overviewOptions[optName] = opts[optName];\n    }\n    else if (!objectHasProperty(overviewOptions, optName)) {\n      if (objectHasProperty(defaultOverviewOptions, optName)) {\n        overviewOptions[optName] = defaultOverviewOptions[optName];\n      }\n      else if (objectHasProperty(defaultViewOptions, optName)) {\n        overviewOptions[optName] = defaultViewOptions[optName];\n      }\n    }\n  });\n\n  return overviewOptions;\n}\n\nfunction getZoomviewOptions(opts) {\n  const zoomviewOptions = {};\n\n  if (opts.showPlayheadTime) {\n    zoomviewOptions.showPlayheadTime = opts.showPlayheadTime;\n  }\n  else if (opts.zoomview && opts.zoomview.showPlayheadTime) {\n    zoomviewOptions.showPlayheadTime = opts.zoomview.showPlayheadTime;\n  }\n\n  const optNames = [\n    'container',\n    'waveformColor',\n    'playedWaveformColor',\n    'playheadColor',\n    'playheadTextColor',\n    'formatPlayheadTime',\n    'playheadClickTolerance',\n    'timeLabelPrecision',\n    'axisGridlineColor',\n    'showAxisLabels',\n    'axisTopMarkerHeight',\n    'axisBottomMarkerHeight',\n    'axisLabelColor',\n    'formatAxisTime',\n    'fontFamily',\n    'fontSize',\n    'fontStyle',\n    'wheelMode',\n    'autoScroll',\n    'autoScrollOffset',\n    'enablePoints',\n    'enableSegments'\n  ];\n\n  optNames.forEach(function(optName) {\n    if (opts.zoomview && objectHasProperty(opts.zoomview, optName)) {\n      zoomviewOptions[optName] = opts.zoomview[optName];\n    }\n    else if (objectHasProperty(opts, optName)) {\n      zoomviewOptions[optName] = opts[optName];\n    }\n    else if (!objectHasProperty(zoomviewOptions, optName)) {\n      if (objectHasProperty(defaultZoomviewOptions, optName)) {\n        zoomviewOptions[optName] = defaultZoomviewOptions[optName];\n      }\n      else if (objectHasProperty(defaultViewOptions, optName)) {\n        zoomviewOptions[optName] = defaultViewOptions[optName];\n      }\n    }\n  });\n\n  return zoomviewOptions;\n}\n\nfunction getScrollbarOptions(opts) {\n  if (!objectHasProperty(opts, 'scrollbar')) {\n    return null;\n  }\n\n  const scrollbarOptions = {};\n\n  const optNames = [\n    'container',\n    'color',\n    'minWidth'\n  ];\n\n  optNames.forEach(function(optName) {\n    if (objectHasProperty(opts.scrollbar, optName)) {\n      scrollbarOptions[optName] = opts.scrollbar[optName];\n    }\n    else {\n      scrollbarOptions[optName] = defaultScrollbarOptions[optName];\n    }\n  });\n\n  return scrollbarOptions;\n}\n\nfunction extendOptions(to, from) {\n  for (const key in from) {\n    if (objectHasProperty(from, key) &&\n        objectHasProperty(to, key)) {\n      to[key] = from[key];\n    }\n  }\n\n  return to;\n}\n\nfunction addSegmentOptions(options, opts) {\n  options.segmentOptions = {};\n\n  extend(options.segmentOptions, defaultSegmentOptions);\n\n  if (opts.segmentOptions) {\n    extendOptions(options.segmentOptions, opts.segmentOptions);\n  }\n\n  options.zoomview.segmentOptions = {};\n  extend(options.zoomview.segmentOptions, options.segmentOptions);\n\n  if (opts.zoomview && opts.zoomview.segmentOptions) {\n    extendOptions(options.zoomview.segmentOptions, opts.zoomview.segmentOptions);\n  }\n\n  options.overview.segmentOptions = {};\n  extend(options.overview.segmentOptions, options.segmentOptions);\n\n  if (opts.overview && opts.overview.segmentOptions) {\n    extendOptions(options.overview.segmentOptions, opts.overview.segmentOptions);\n  }\n}\n\nfunction checkContainerElements(options) {\n  const zoomviewContainer = options.zoomview.container;\n  const overviewContainer = options.overview.container;\n\n  if (!isHTMLElement(zoomviewContainer) &&\n      !isHTMLElement(overviewContainer)) {\n    // eslint-disable-next-line max-len\n    return new TypeError('Peaks.init(): The zoomview and/or overview container options must be valid HTML elements');\n  }\n\n  if (zoomviewContainer &&\n      (zoomviewContainer.clientWidth  <= 0 ||\n       zoomviewContainer.clientHeight <= 0)) {\n    // eslint-disable-next-line max-len\n    return new Error('Peaks.init(): Please ensure that the zoomview container is visible and has non-zero width and height');\n  }\n\n  if (overviewContainer &&\n      (overviewContainer.clientWidth  <= 0 ||\n       overviewContainer.clientHeight <= 0)) {\n    // eslint-disable-next-line max-len\n    return new Error('Peaks.init(): Please ensure that the overview container is visible and has non-zero width and height');\n  }\n}\n\n/**\n * Creates and initialises a new Peaks instance with the given options.\n *\n * @param {Object} opts Configuration options\n *\n * @return {Peaks}\n */\n\nPeaks.init = function(opts, callback) {\n  const instance = new Peaks();\n\n  let err = instance._setOptions(opts);\n\n  if (err) {\n    callback(err);\n    return;\n  }\n\n  err = checkContainerElements(instance.options);\n\n  if (err) {\n    callback(err);\n    return;\n  }\n\n  let scrollbarContainer = null;\n\n  if (instance.options.scrollbar) {\n    scrollbarContainer = instance.options.scrollbar.container;\n\n    if (!isHTMLElement(scrollbarContainer)) {\n      // eslint-disable-next-line max-len\n      callback(new TypeError('Peaks.init(): The scrollbar container option must be a valid HTML element'));\n      return;\n    }\n\n    if (scrollbarContainer.clientWidth <= 0) {\n      // eslint-disable-next-line max-len\n      callback(new TypeError('Peaks.init(): Please ensure that the scrollbar container is visible and has non-zero width'));\n      return;\n    }\n  }\n\n  if (opts.keyboard) {\n    instance._keyboardHandler = new KeyboardHandler(instance);\n  }\n\n  const player = opts.player ?\n    opts.player :\n    new MediaElementPlayer(instance.options.mediaElement);\n\n  instance.player = new Player(instance, player);\n  instance.segments = new WaveformSegments(instance);\n  instance.points = new WaveformPoints(instance);\n  instance.zoom = new ZoomController(instance, instance.options.zoomLevels);\n  instance.views = new ViewController(instance);\n\n  // Setup the UI components\n  instance._waveformBuilder = new WaveformBuilder(instance);\n\n  instance.player.init(instance)\n    .then(function() {\n      instance._waveformBuilder.init(instance.options, function(err, waveformData) {\n        if (err) {\n          if (callback) {\n            callback(err);\n          }\n\n          return;\n        }\n\n        err = checkContainerElements(instance.options);\n\n        if (err) {\n          if (callback) {\n            callback(err);\n          }\n\n          return;\n        }\n\n        instance._waveformBuilder = null;\n        instance._waveformData = waveformData;\n\n        const zoomviewContainer = instance.options.zoomview.container;\n        const overviewContainer = instance.options.overview.container;\n\n        if (overviewContainer) {\n          instance.views.createOverview(overviewContainer);\n        }\n\n        if (zoomviewContainer) {\n          instance.views.createZoomview(zoomviewContainer);\n        }\n\n        if (scrollbarContainer) {\n          instance.views.createScrollbar(scrollbarContainer);\n        }\n\n        if (opts.segments) {\n          instance.segments.add(opts.segments);\n        }\n\n        if (opts.points) {\n          instance.points.add(opts.points);\n        }\n\n        if (opts.emitCueEvents) {\n          instance._cueEmitter = new CueEmitter(instance);\n        }\n\n        // Allow applications to attach event handlers before emitting events,\n        // when initialising with local waveform data.\n\n        setTimeout(function() {\n          instance.emit('peaks.ready');\n        }, 0);\n\n        callback(null, instance);\n      });\n    })\n    .catch(function(err) {\n      if (callback) {\n        callback(err);\n      }\n    });\n\n  return instance;\n};\n\nPeaks.prototype._setOptions = function(opts) {\n  if (!isObject(opts)) {\n    return new TypeError('Peaks.init(): The options parameter should be an object');\n  }\n\n  if (!opts.player) {\n    if (!opts.mediaElement) {\n      return new Error('Peaks.init(): Missing mediaElement option');\n    }\n\n    if (!(opts.mediaElement instanceof HTMLMediaElement)) {\n      // eslint-disable-next-line max-len\n      return new TypeError('Peaks.init(): The mediaElement option should be an HTMLMediaElement');\n    }\n  }\n\n  if (opts.logger && !isFunction(opts.logger)) {\n    // eslint-disable-next-line max-len\n    return new TypeError('Peaks.init(): The logger option should be a function');\n  }\n\n  if (opts.segments && !Array.isArray(opts.segments)) {\n    // eslint-disable-next-line max-len\n    return new TypeError('Peaks.init(): options.segments must be an array of segment objects');\n  }\n\n  if (opts.points && !Array.isArray(opts.points)) {\n    // eslint-disable-next-line max-len\n    return new TypeError('Peaks.init(): options.points must be an array of point objects');\n  }\n\n  extendOptions(this.options, opts);\n\n  this.options.overview = getOverviewOptions(opts);\n  this.options.zoomview = getZoomviewOptions(opts);\n  this.options.scrollbar = getScrollbarOptions(opts);\n\n  addSegmentOptions(this.options, opts);\n\n  if (!Array.isArray(this.options.zoomLevels)) {\n    return new TypeError('Peaks.init(): The zoomLevels option should be an array');\n  }\n  else if (this.options.zoomLevels.length === 0) {\n    return new Error('Peaks.init(): The zoomLevels array must not be empty');\n  }\n  else {\n    if (!isInAscendingOrder(this.options.zoomLevels)) {\n      return new Error('Peaks.init(): The zoomLevels array must be sorted in ascending order');\n    }\n  }\n\n  this._logger = this.options.logger;\n};\n\n/**\n * Remote waveform data options for [Peaks.setSource]{@link Peaks#setSource}.\n *\n * @typedef {Object} RemoteWaveformDataOptions\n * @global\n * @property {String=} arraybuffer\n * @property {String=} json\n */\n\n/**\n * Local waveform data options for [Peaks.setSource]{@link Peaks#setSource}.\n *\n * @typedef {Object} LocalWaveformDataOptions\n * @global\n * @property {ArrayBuffer=} arraybuffer\n * @property {Object=} json\n */\n\n/**\n * Web Audio options for [Peaks.setSource]{@link Peaks#setSource}.\n *\n * @typedef {Object} WebAudioOptions\n * @global\n * @property {AudioContext=} audioContext\n * @property {AudioBuffer=} audioBuffer\n * @property {Number=} scale\n * @property {Boolean=} multiChannel\n */\n\n/**\n * Options for [Peaks.setSource]{@link Peaks#setSource}.\n *\n * @typedef {Object} PeaksSetSourceOptions\n * @global\n * @property {String=} mediaUrl\n * @property {RemoteWaveformDataOptions=} dataUri\n * @property {LocalWaveformDataOptions=} waveformData\n * @property {WebAudioOptions=} webAudio\n * @property {Boolean=} withCredentials\n * @property {Array<Number>=} zoomLevels\n */\n\n/**\n * Changes the audio or video media source associated with the {@link Peaks}\n * instance.\n *\n * @see SetSourceHandler\n *\n * @param {PeaksSetSourceOptions} options\n * @param {Function} callback\n */\n\nPeaks.prototype.setSource = function(options, callback) {\n  const self = this;\n\n  self.player._setSource(options)\n    .then(function() {\n      if (!options.zoomLevels) {\n        options.zoomLevels = self.options.zoomLevels;\n      }\n\n      self._waveformBuilder = new WaveformBuilder(self);\n\n      self._waveformBuilder.init(options, function(err, waveformData) {\n        if (err) {\n          callback(err);\n          return;\n        }\n\n        self._waveformBuilder = null;\n        self._waveformData = waveformData;\n\n        ['overview', 'zoomview'].forEach(function(viewName) {\n          const view = self.views.getView(viewName);\n\n          if (view) {\n            view.setWaveformData(waveformData);\n          }\n        });\n\n        self.zoom.setZoomLevels(options.zoomLevels);\n\n        callback();\n      });\n    })\n    .catch(function(err) {\n      callback(err);\n    });\n};\n\nPeaks.prototype.getWaveformData = function() {\n  return this._waveformData;\n};\n\n/**\n * Cleans up a Peaks instance after use.\n */\n\nPeaks.prototype.destroy = function() {\n  if (this._waveformBuilder) {\n    this._waveformBuilder.abort();\n  }\n\n  if (this._keyboardHandler) {\n    this._keyboardHandler.destroy();\n  }\n\n  if (this.views) {\n    this.views.destroy();\n  }\n\n  if (this.player) {\n    this.player.destroy();\n  }\n\n  if (this._cueEmitter) {\n    this._cueEmitter.destroy();\n  }\n};\n\nexport default Peaks;\n"],"names":["has","Object","prototype","hasOwnProperty","prefix","Events","EE","fn","context","once","this","addListener","emitter","event","TypeError","listener","evt","_events","push","_eventsCount","clearEvent","EventEmitter","create","__proto__","eventNames","events","name","names","call","slice","getOwnPropertySymbols","concat","listeners","handlers","i","l","length","ee","Array","listenerCount","emit","a1","a2","a3","a4","a5","args","len","arguments","removeListener","undefined","apply","j","on","removeAllListeners","off","prefixed","module","exports","Cue","time","type","id","zeroPad","number","precision","toString","formatTime","result","fractionSeconds","Math","floor","pow","seconds","minutes","hours","join","clamp","value","min","max","objectHasProperty","object","field","extend","to","from","key","isNumber","isFinite","Infinity","isValidTime","Number","isObject","_typeof","isArray","isString","isNullOrUndefined","isBoolean","isHTMLElement","HTMLElement","isLinearGradientColor","linearGradientStart","linearGradientEnd","linearGradientColorStops","getMarkerObject","obj","parent","Konva","Layer","POINT","SEGMENT_START","SEGMENT_END","sorter","a","b","isHeadless","test","navigator","userAgent","requestAnimationFrame","window","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame","cancelAnimationFrame","mozCancelAnimationFrame","webkitCancelAnimationFrame","msCancelAnimationFrame","eventTypes","forward","reverse","eventAttributes","getPointOrSegment","peaks","cue","points","getPoint","segments","getSegment","Error","CueEmitter","_cues","_peaks","_previousTime","_updateCues","bind","_onPlaying","_onSeeked","_onTimeUpdate","_onAnimationFrame","_rAFHandle","_activeSegments","_attachEventHandlers","getSegmentIdComparator","segment","self","getPoints","getSegments","forEach","point","startTime","endTime","sort","player","getCurrentTime","_updateActiveSegments","_onUpdate","previousTime","start","end","step","isForward","marker","eventType","webdriver","document","visibilityState","isPlaying","isSeeking","activeSegments","getSegmentsAtTime","find","_detachEventHandlers","destroy","pointOptions","invalidOptions","validatePointOptions","options","updating","RangeError","labelText","editable","color","Point","pid","_pid","_setUserData","WaveformPoints","_points","_pointsById","_pointsByPid","_pointIdCounter","_pointPid","indexOf","defineProperties","enumerable","get","_id","_time","_labelText","_color","_editable","update","updatePointId","isVisible","_setTime","_getNextPointId","_getNextPid","_addPoint","_createPoint","peaksOptions","pointMarkerColor","setDefaultPointOptions","filter","add","arrayArgs","map","newPointId","_findPoint","predicate","indexes","_removeIndexes","removed","index","itemRemoved","splice","_removePoints","remove","p","removeById","pointId","removeByTime","removeAll","segmentOptions","validateSegmentOptions","borderColor","Segment","_startTime","_endTime","_borderColor","WaveformSegments","_segments","_segmentsById","_segmentsByPid","_segmentIdCounter","_segmentPid","_isInserting","updateSegmentId","_setStartTime","_setEndTime","_getNextSegmentId","_addSegment","_createSegment","globalSegmentOptions","overlay","overlayColor","waveformColor","overlayBorderColor","setDefaultSegmentOptions","_getSortedSegments","findPreviousSegment","sortedSegments","findIndex","s","findNextSegment","insert","newSegmentId","_findSegment","_removeSegments","segmentId","setInserting","isInserting","nodes","keys","KeyboardHandler","eventEmitter","_handleKeyEvent","addEventListener","MediaElementPlayer","mediaElement","_mediaElement","SetSourceHandler","_eventEmitter","_playerCanPlayHandler","_playerErrorHandler","validateAdapter","adapter","allProperties","getOwnPropertyNames","getPrototypeOf","getAllPropertiesFrom","method","includes","Player","_playingSegment","_segment","_loop","_playSegmentTimerCallback","_adapter","DefaultPointMarker","_options","_draggable","DefaultSegmentMarker","createSegmentMarker","view","createSegmentLabel","Text","x","y","text","textAlign","fontFamily","fontSize","fontStyle","fill","createPointMarker","HighlightLayer","_view","_offset","highlightOffset","highlightColor","_layer","listening","_highlightRect","_strokeColor","highlightStrokeColor","_opacity","highlightOpacity","_cornerRadius","highlightCornerRadius","PlayheadLayer","_player","_playheadPixel","_playheadLineAnimation","_playheadVisible","_playheadColor","playheadColor","_playheadTextColor","playheadTextColor","_playheadFontFamily","playheadFontFamily","_playheadFontSize","playheadFontSize","_playheadFontStyle","playheadFontStyle","_playheadLayer","_createPlayhead","showPlayheadTime","_createPlayheadText","fitToView","zoomLevelChanged","PointMarker","_point","_marker","draggable","_onDragStart","onDragStart","_onDragMove","onDragMove","_onDragEnd","onDragEnd","_dragBoundFunc","dragBoundFunc","_onMouseEnter","onMouseEnter","_onMouseLeave","onMouseLeave","_group","Group","_bindDefaultEventHandlers","init","target","nodeName","preventDefault","keyCode","shiftKey","removeEventListener","_addMediaListener","callback","_listeners","_duration","getDuration","error","_interval","src","querySelector","Promise","resolve","reject","eventHandler","readyState","HTMLMediaElement","HAVE_NOTHING","load","play","pause","paused","seeking","currentTime","duration","seek","setSource","_callback","_resolve","_reject","setAttribute","mediaUrl","_reset","err","_logger","playSegment","loop","_setSource","group","_label","_handle","Rect","width","height","visible","_line","Line","stroke","strokeWidth","layer","hide","bindEventHandlers","setX","getWidth","show","getHeight","setText","_this","handleX","startMarker","xPosition","handleLineColor","handleColor","_handleLineOne","_handleLineTwo","_handleLineSingle","cornerRadius","setTimeout","focusedSegmentShape","segmentShapes","_segmentShapes","_i","_Object$entries","entries","segmentShape","_slicedToArray","_endMarker","segmentShapeWidth","_overlay","markerInfo","getMarkerInfo","updateMarkersSmall","body","style","cursor","draw","endMarkerHandleLineSingle","startMarkerHandleLineSingle","newHandleWidth","endMarker","attrs","endMarkerHandleLines","line","startMarkerHandleLines","_startMarker","endMarkerGroupChildren","children","startMarkerGroupChildren","child","_i2","_Object$entries2","addToStage","stage","showHighlight","_createHighlightRect","_update","startOffset","timeToPixels","endOffset","setAttrs","opacity","removeHighlight","updateHighlight","offset","pixelsPerSecond","_useAnimation","_start","stop","_playheadLine","_playheadText","_playheadGroup","align","updatePlayheadTime","_syncPlayhead","pixelIndex","frameOffset","getFrameOffset","playheadX","playheadTextWidth","getTextWidth","playheadPosChanged","lastPlayheadPosition","Animation","playheadPosition","getPlayheadPixel","updatePlayheadText","addToLayer","getX","getAbsolutePosition","destroyChildren","PointsLayer","allowEditing","_allowEditing","_pointMarkers","_onPointsDrag","_onPointMarkerDragStart","_onPointMarkerDragMove","_onPointMarkerDragEnd","_pointMarkerDragBoundFunc","_onPointMarkerMouseEnter","_onPointMarkerMouseLeave","_onPointsUpdate","_onPointsAdd","_onPointsRemove","_onPointsRemoveAll","OverlaySegmentMarker","SegmentMarker","_segmentShape","pos","WaveformShape","shapeOptions","startY","_height","endY","fillLinearGradientStartPointY","fillLinearGradientEndPointY","fillLinearGradientColorStops","_shape","Shape","sceneFunc","_sceneFunc","enableEditing","enable","getPointMarker","frameStartTime","getStartTime","frameEndTime","getEndTime","pointMarker","_removePoint","_updatePoint","pointMarkerX","removeChildren","_createPointMarker","getName","_addPointMarker","_dragPointMarker","pixelOffsetToTime","updatePoints","_removeInvisiblePoints","pointPid","setVisible","viewHeight","overlayOffset","overlayRectHeight","moveToTop","isStartMarker","startDrag","stopDrag","setSegment","setWaveformColor","_drawWaveform","getWaveformData","waveformData","startPixels","endPixels","limit","channels","waveformTop","waveformHeight","_drawChannel","channel","top","amplitude","lineX","lineY","amplitudeScale","getAmplitudeScale","beginPath","min_sample","scaleY","lineTo","max_sample","closePath","fillShape","handler","scale","defaultFontFamily","defaultFontShape","SegmentShape","isSegmentDraggingEnabled","_dragging","getViewOptions","_overlayOffset","_waveformShape","_onMouseDown","_onMouseUp","_onSegmentDragStart","_onSegmentDragMove","_onSegmentDragEnd","_onSegmentMarkerDragStart","_onSegmentMarkerDragMove","_onSegmentMarkerDragEnd","_segmentMarkerDragBoundFunc","overlayBorderWidth","overlayOpacity","overlayCornerRadius","segmentStartOffset","timeToPixelOffset","segmentEndOffset","clipX","clipY","clipWidth","clipHeight","_overlayRect","_overlayText","overlayFontFamily","overlayFontSize","overlayFontStyle","overlayLabelColor","overlayLabelAlign","verticalAlign","overlayLabelVerticalAlign","padding","overlayLabelPadding","_createMarkers","createOverlayMarker","SegmentsLayer","_onSegmentsUpdate","_onSegmentsAdd","_onSegmentsRemove","_onSegmentsRemoveAll","_onSegmentsDragged","WaveformAxis","_axisGridlineColor","axisGridlineColor","_axisLabelColor","axisLabelColor","_showAxisLabels","showAxisLabels","_axisTopMarkerHeight","axisTopMarkerHeight","_axisBottomMarkerHeight","axisBottomMarkerHeight","formatAxisTime","_formatAxisTime","_axisLabelFont","_buildFontString","_axisShape","_drawAxis","MouseDragHandler","_stage","_handlers","_mouseDown","_mouseUp","_mouseMove","_lastMouseClientX","SeekMouseDragHandler","_onMouseMove","_mouseDragHandler","onMouseDown","onMouseMove","WaveformOverview","container","_originalWaveformData","_container","_viewOptions","overview","_onPause","_onZoomviewDisplaying","_amplitudeScale","_timeLabelPrecision","timeLabelPrecision","_enableSeek","formatPlayheadTime","_formatPlayheadTime","_width","clientWidth","clientHeight","_data","_resampleAndSetWaveformData","showWarnings","Stage","_waveformColor","_playedWaveformColor","playedWaveformColor","_createWaveform","enableSegments","_segmentsLayer","enablePoints","_pointsLayer","_highlightLayer","_createAxisLabels","_onClick","_onDblClick","_onContextMenu","InsertSegmentMouseDragHandler","onMouseUp","ScrollMouseDragHandler","WaveformZoomView","zoomview","_enableWaveformCache","waveformCache","_initWaveformCache","_onKeyboardLeft","_onKeyboardRight","_onKeyboardShiftLeft","_onKeyboardShiftRight","_autoScroll","autoScroll","_autoScrollOffset","autoScrollOffset","_enableSegmentDragging","_segmentDragMode","_minSegmentDragWidth","_insertSegmentShape","_playheadClickTolerance","playheadClickTolerance","_pixelLength","initialZoomLevel","zoom","getZoomLevel","_zoomLevelAuto","_zoomLevelSeconds","_resampleData","_frameOffset","_onWheel","_onWheelCaptureVerticalScroll","setWheelMode","wheelMode","Scrollbar","_waveformData","scrollbar","_zoomview","views","getView","_onScrollboxDragStart","_onScrollboxDragMove","_onScrollboxDragEnd","_onScrollbarClick","_scrollboxX","_minScrollboxWidth","minWidth","_offsetY","_scrollbox","_scrollboxRect","_setScrollboxWidth","ViewController","_overview","_scrollbar","ZoomController","zoomLevels","_zoomLevels","_zoomLevelIndex","isEditingEnabled","markers","startMarkerColor","endMarkerColor","getStartMarker","getEndMarker","bordercolor","labelColor","isDragging","segmentClicked","eventName","_moveToTop","moveSegmentMarkersToTop","enableSegmentDragging","_setPreviousAndNextSegments","getSegmentDragMode","_nextSegment","_previousSegment","_dragStartX","_dragStartTime","_dragEndTime","dragMode","offsetX","timeOffset","pixelsToTime","segmentDuration","minSegmentWidth","getMinSegmentDragWidth","minSegmentDuration","previousSegmentUpdated","nextSegmentUpdated","previousSegmentEndX","previousSegmentEndTime","minPreviousSegmentEndTime","nextSegmentStartX","nextSegmentStartTime","maxNextSegmentStartTime","moveMarkersToTop","segmentMarker","_startMarkerX","_endMarkerX","_segmentStartMarkerDragMove","_segmentEndMarkerDragMove","startMarkerX","endMarkerX","upperLimit","previousSegmentVisible","fixedPreviousSegment","compressPreviousSegment","previousSegmentDuration","lowerLimit","nextSegmentVisible","fixedNextSegment","compressNextSegment","nextSegmentDuration","segmentPid","getSegmentShape","_removeSegment","_updateSegment","_addSegmentShape","_createSegmentShape","updateSegments","_removeInvisibleSegments","topMarkerHeight","bottomMarkerHeight","_getAxisLabelScale","secs","baseSecs","steps","currentFrameStartTime","axisLabelIntervalSecs","firstAxisLabelSecs","multiple","multiplier","ceil","roundUpToNearest","axisLabelOffsetSecs","axisLabelOffsetPixels","setAttr","moveTo","label","labelX","measureText","fillText","button","touches","clientX","mouseDownPosX","_getMousePosX","capture","passive","changedTouches","mousePosX","cancelable","getContainer","getBoundingClientRect","left","_seek","isSeekEnabled","enableSeek","_clickHandler","emitViewEvent","getAttr","preventViewEvent","clickEvent","layerX","setWaveformData","_updateWaveform","resample","_playedWaveformShape","_playedSegment","_unplayedSegment","_waveformLayer","sample_rate","pixels","_getDuration","setAmplitudeScale","_createWaveformShapes","_destroyPlayedWaveformShape","_axisLayer","_axis","removeHighlightRect","playheadTime","setPlayedWaveformColor","setTimeLabelPrecision","enableMarkerEditing","fitToContainer","updateWaveform","setWidth","setHeight","_segmentIsDraggable","_insertSegment","_seeking","playheadOffset","getPlayheadOffset","abs","getPlayheadClickTolerance","_initialFrameOffset","_mouseDownX","diff","newFrameOffset","Map","set","_waveformScales","mode","_wheelMode","captureVerticalScroll","_captureVerticalScroll","delta","wheelEvent","deltaY","deltaX","deltaMode","WheelEvent","DOM_DELTA_PAGE","setWaveformDragMode","setSegmentDragMode","_keyboardScroll","direction","large","increment","nudgeIncrement","scrollWaveform","_drawWaveformLayer","endThreshold","round","_getScale","setZoom","isAutoScale","apexTime","playheadOffsetPixels","prevScale","_scale","apexPixel","currentZoom","previousZoom","sourceWaveform","setStartTime","getPixelLength","scrollAmount","playheadPixel","enableAutoScroll","setMinSegmentDragWidth","resampleOptions","getStage","getSegmentsLayer","setZoomview","_updateScrollbarWidthAndPosition","_scrollboxWidth","_getScrollbarRange","range","zoomviewRange","scrollBoxPos","createOverview","createZoomview","createScrollbar","destroyOverview","destroyZoomview","getScrollbar","setZoomLevels","zoomIn","zoomOut","zoomLevelIndex","forceUpdate","getZoom","isXhr2","XMLHttpRequest","WaveformBuilder","Peaks","dataUri","withCredentials","webAudio","logger","console","audioContext","_getRemoteWaveformData","_buildWaveformFromLocalData","audioBuffer","_buildWaveformDataFromAudioBuffer","_buildWaveformDataUsingWebAudio","url","requestType","some","connector","toLowerCase","Boolean","_xhr","_createXHR","status","WaveformData","response","bits","send","data","json","arraybuffer","createdWaveformData","AudioContext","webkitAudioContext","webAudioOptions","mediaSourceUrl","currentSrc","_requestAudioAndBuildWaveformData","webAudioBuilderOptions","audio_buffer","split_channels","multiChannel","disable_worker","createFromAudio","audio_context","array_buffer","abort","onLoad","onError","onAbort","xhr","open","responseType","e","onload","onerror","defaultViewOptions","defaultZoomviewOptions","defaultOverviewOptions","defaultSegmentOptions","defaultScrollbarOptions","extendOptions","checkContainerElements","zoomviewContainer","overviewContainer","opts","instance","_setOptions","scrollbarContainer","keyboard","_keyboardHandler","_waveformBuilder","then","emitCueEvents","_cueEmitter","catch","overviewOptions","optName","getOverviewOptions","zoomviewOptions","getZoomviewOptions","scrollbarOptions","getScrollbarOptions","addSegmentOptions","array","isInAscendingOrder","viewName"],"mappings":"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"}